(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const xr={timeTravelTicketValue:3,layout:{specials:["researchproduction","researchproduction2","extraticks","extraprofit"],bonusTicks:["bonusticks1","bonusticks2","bonusticks3","bonusticks4","bonusticks5"],timeTravelTickets:["timetravel1","timetravel2","timetravel3","timetravel4","timetravel5"]},items:[{id:"bonusticks1",idNum:1,name:"80 000 bonus ticks",description:"Getting there faster",consumable:!0,strategy:{type:"bonusTicks",amount:8e4},priceStr:{local:"1u",web:"$2.99",kongregate:"25 Kreds"}},{id:"bonusticks2",idNum:2,name:"240 000 bonus ticks",description:"+50% more",consumable:!0,strategy:{type:"bonusTicks",amount:24e4},priceStr:{local:"2u",web:"$5.99",kongregate:"50 Kreds"}},{id:"bonusticks3",idNum:3,name:"800 000 bonus ticks",description:"+200% more",consumable:!0,strategy:{type:"bonusTicks",amount:8e5},priceStr:{local:"3u",web:"$9.99",kongregate:"110 Kreds"}},{id:"bonusticks4",idNum:4,name:"2 400 000 bonus ticks",description:"+350% more",consumable:!0,strategy:{type:"bonusTicks",amount:24e5},priceStr:{local:"4u",web:"$19.99",kongregate:"225 Kreds"}},{id:"bonusticks5",idNum:5,name:"12 000 000 bonus ticks",description:"+650% more",consumable:!0,strategy:{type:"bonusTicks",amount:12e6},priceStr:{local:"5u",web:"$59.99",kongregate:"565 Kreds"}},{id:"bonusticks6",idNum:6,name:"40 000 000 bonus ticks",description:"+1145% more",consumable:!0,strategy:{type:"bonusTicks",amount:4e7},priceStr:{local:"6u",web:"$119.99",kongregate:"1150 Kreds"}},{id:"timetravel1",idNum:7,name:"1 ticket (3h)",description:"Wow, really?",consumable:!0,strategy:{type:"timeTravelTickets",amount:1},priceStr:{local:"1u",web:"$2.99",kongregate:"25 Kreds"}},{id:"timetravel2",idNum:8,name:"3 tickets  (3x3h)",description:"50% cheaper!",consumable:!0,strategy:{type:"timeTravelTickets",amount:3},priceStr:{local:"2u",web:"$5.99",kongregate:"50 Kreds"}},{id:"timetravel3",idNum:9,name:"8 tickets  (8x3h)",description:"140% cheaper!",consumable:!0,strategy:{type:"timeTravelTickets",amount:8},priceStr:{local:"3u",web:"$9.99",kongregate:"110 Kreds"}},{id:"timetravel4",idNum:10,name:"25 tickets (25x3h)",description:"270% cheaper!",consumable:!0,strategy:{type:"timeTravelTickets",amount:25},priceStr:{local:"4u",web:"$19.99",kongregate:"225 Kreds"}},{id:"timetravel5",idNum:11,name:"100 tickets (100x3h)",description:"400% cheaper!",consumable:!0,strategy:{type:"timeTravelTickets",amount:100},priceStr:{local:"5u",web:"$59.99",kongregate:"565 Kreds"}},{id:"timetravel6",idNum:12,name:"300 tickets (300x3h)",description:"650% cheaper!",consumable:!0,strategy:{type:"timeTravelTickets",amount:300},priceStr:{local:"6u",web:"$119.99",kongregate:"1150 Kreds"}},{id:"researchproduction",idNum:13,name:"Evolved brain",description:"3x research points production",consumable:!1,strategy:{type:"researchProductionBonus",bonus:3},priceStr:{local:"6u",web:"$9.99",kongregate:"110 Kreds"}},{id:"researchproduction2",idNum:14,name:"Alien brain",description:"4x research points production",consumable:!1,requiresProduct:"researchproduction",strategy:{type:"researchProductionBonus",bonus:4},priceStr:{local:"6u",web:"$9.99",kongregate:"110 Kreds"}},{id:"extraticks",idNum:15,name:"Chronobooster",description:"+8 extra ticks per second",consumable:!1,strategy:{type:"extraTicks",bonus:8},priceStr:{local:"7u",web:"$19.99",kongregate:"225 Kreds"}},{id:"extraprofit",idNum:16,name:"Tax evasion",description:"3x profit!",consumable:!1,requiresProduct:"extraticks",strategy:{type:"extraProfit",bonus:3},priceStr:{local:"7u",web:"$19.99",kongregate:"225 Kreds"}},{id:"starter1",idNum:18,name:"Starter pack",description:"8 time travel tickets + 300 000 bonus ticks",consumable:!0,special:!0,strategy:{type:"starter",timeTravelTickets:8,bonusTicks:3e5},priceStr:{local:"3u",web:"$9.99",kongregate:"110 Kreds"}},{id:"starter2",idNum:17,name:"Fun pack",description:"3 time travel tickets + 60 000 bonus ticks",consumable:!0,special:!0,strategy:{type:"starter",timeTravelTickets:3,bonusTicks:6e4},priceStr:{local:"2u",web:"$5.99",kongregate:"50 Kreds"}}]};class ot{constructor(e,t){this.componentsById=e,this.sourceBuildings=t,this.strategies={buyer:{selfCost:(r,i)=>r.strategy.interval*r.runningCostPerTick/ot.getSumOfProduction(r.strategy.purchaseResources)+r.strategy.purchaseResources[i].price,inputCost:(r,i)=>1},converter:{selfCost:r=>r.strategy.interval*r.runningCostPerTick/ot.getSumOfProduction(r.strategy.production),inputCost:(r,i)=>{const s=ot.getSumOfProduction(r.strategy.production);if(!r.strategy.inputResources[i])throw new Error(`${r.id} can't handle resources: ${i}`);return r.strategy.inputResources[i].perOutputResource/s}},seller:{selfCost:r=>r.strategy.interval*r.runningCostPerTick/ot.getSumOfProduction(r.strategy.resources),inputCost:(r,i)=>1}}}static getSumOfProduction(e){let t=0;for(const r in e)r==="waste"||e[r].bonus||(t+=e[r].amount);return t}calculateCostFor(e,t,r){const i=this.componentsById[e];let s=this.sourceBuildings[e]||{};const o=this.strategies[i.strategy.type];let u=0;const l=o.selfCost(i,t);if(i.strategy.type==="seller"){if(u+=this.calculateCostFor(s[t],t,r),i.strategy.resources[t].bonus)return r[`${e}-${t}`]={self:0,input:u,total:u},u}else for(const[h,f]of Object.entries(s))u+=this.calculateCostFor(f,h,r)*o.inputCost(i,h);const m=l+u;return r[`${e}-${t}`]={self:l,input:u,total:m},m}}const te=(p,e)=>p*Math.pow(1e3,e),at={selection:[["noComponent","transportLine","garbageCollector","sorterVertical","sorterHorizontal"],["ironBuyer","ironFoundry","ironSeller",null,"coalBuyer","steelFoundry","steelSeller"],["oilBuyer","gasBuyer","plasticMaker","plasticSeller","siliconBuyer","electronicsMaker","electronicsSeller"],["explosivesBuyer","bulletMaker","gunMaker","gunSeller"],["aluminiumBuyer","engineMaker","engineSeller"],["tankHullMaker","tankTurretMaker","tankAssembler","tankSeller","dieselRefinery"],["jetFuelRefinery","rocketHullMaker","rocketWarheadMaker","rocketAssembler"],["droneMaker","droneControlRoom","droneSeller"],["metalsLab","gasAndOilLab","analystCenter","qualityLab"],["researchCenter","researchCenter2","researchCenter3","researchCenter4"]],productionTree:{ironFoundry:{ironOre:"ironBuyer"},ironSeller:{iron:"ironFoundry"},steelFoundry:{iron:"ironFoundry",coal:"coalBuyer"},steelSeller:{steel:"steelFoundry"},plasticMaker:{oil:"oilBuyer",coal:"coalBuyer",gas:"gasBuyer"},plasticSeller:{plastic:"plasticMaker"},electronicsMaker:{silicon:"siliconBuyer",plastic:"plasticMaker"},electronicsSeller:{electronics:"electronicsMaker"},engineMaker:{aluminium:"aluminiumBuyer",steel:"steelFoundry",electronics:"electronicsMaker"},engineSeller:{engine:"engineMaker"},bulletMaker:{steel:"steelFoundry",explosives:"explosivesBuyer"},gunMaker:{steel:"steelFoundry",bullets:"bulletMaker"},gunSeller:{guns:"gunMaker"},tankHullMaker:{steel:"steelFoundry",aluminium:"aluminiumBuyer",electronics:"electronicsMaker"},tankTurretMaker:{steel:"steelFoundry",guns:"gunMaker"},tankAssembler:{tankHull:"tankHullMaker",tankTurret:"tankTurretMaker",engine:"engineMaker"},tankSeller:{tank:"tankAssembler",diesel:"dieselRefinery",rocket:"rocketAssembler"},dieselRefinery:{oil:"oilBuyer"},rocketHullMaker:{aluminium:"aluminiumBuyer",engine:"engineMaker"},rocketWarheadMaker:{aluminium:"aluminiumBuyer",electronics:"electronicsMaker",explosives:"explosivesBuyer"},rocketAssembler:{warhead:"rocketWarheadMaker",rocketHull:"rocketHullMaker",jetFuel:"jetFuelRefinery"},droneMaker:{aluminium:"aluminiumBuyer",plastic:"plasticMaker",electronics:"electronicsMaker",engine:"engineMaker",guns:"gunMaker"},droneControlRoom:{steel:"steelFoundry",electronics:"electronicsMaker"},droneSeller:{drone:"droneMaker",droneControlRoom:"droneControlRoom",jetFuel:"jetFuelRefinery",rocket:"rocketAssembler"},jetFuelRefinery:{gas:"gasBuyer"}},components:[{id:"transportLine",idNum:1,name:"Conveyor",width:1,height:1,spriteX:0,spriteY:0,iconX:1,iconY:0,drawStrategy:"track",buildByDragging:!0,canBuildToPartial:!0,runningCostPerTick:0,price:10,priceRefund:1,strategy:{type:"transport",queueSize:2}},{id:"garbageCollector",idNum:25,name:"Garbage",description:"Accepts any item and discards it as garbage.",width:1,height:1,spriteX:3,spriteY:2,iconX:2,iconY:3,runningCostPerTick:0,requiresResearch:"metalsLab",price:2500,priceRefund:.5,strategy:{type:"garbage",max:15,removeAmount:5,interval:10}},{id:"sorterVertical",idNum:36,name:"Sorter",width:1,height:3,spriteX:6,spriteY:8,iconX:7,iconY:3,runningCostPerTick:2,requiresResearch:"sorter",price:4e5,priceRefund:1,allowedInputs:{"0:1:left":!0,"0:1:right":!0},allowedOutputs:{"0:0":!0,"0:1":!0,"0:2":!0},strategy:{type:"sorter",interval:1}},{id:"sorterHorizontal",idNum:37,name:"Sorter",width:3,height:1,spriteX:3,spriteY:8,iconX:6,iconY:3,runningCostPerTick:2,requiresResearch:"sorter",price:4e5,priceRefund:1,allowedInputs:{"1:0:top":!0,"1:0:bottom":!0},allowedOutputs:{"0:0":!0,"1:0":!0,"2:0":!0},strategy:{type:"sorter",interval:1}},{id:"ironBuyer",idNum:2,name:"Iron ore buyer",width:2,height:2,spriteX:4,spriteY:0,iconX:2,iconY:0,runningCostPerTick:0,price:50,priceRefund:1,strategy:{type:"buyer",purchaseResources:{ironOre:{price:0,amount:1}},outputResourcesOrder:["ironOre"],interval:10}},{id:"ironFoundry",idNum:3,name:"Iron foundry",width:4,height:2,spriteX:0,spriteY:0,iconX:3,iconY:0,runningCostPerTick:0,price:150,priceRefund:1,requiresResearch:null,strategy:{type:"converter",inputResources:{ironOre:{perOutputResource:2}},production:{iron:{amount:1}},outputResourcesOrder:["iron"],interval:10}},{id:"ironSeller",idNum:4,name:"Iron seller",width:1,height:2,spriteX:6,spriteY:0,iconX:4,iconY:0,runningCostPerTick:0,price:100,priceRefund:1,requiresResearch:null,strategy:{type:"seller",resources:{iron:{amount:2,sellPrice:2.5,sellMargin:0}},interval:10}},{id:"coalBuyer",idNum:5,name:"Coal buyer",width:2,height:1,spriteX:0,spriteY:2,iconX:5,iconY:0,runningCostPerTick:1,price:1e3,priceRefund:1,requiresResearch:"steelComponents",strategy:{type:"buyer",purchaseResources:{coal:{price:5,amount:2}},outputResourcesOrder:["coal"],interval:10}},{id:"steelFoundry",idNum:6,name:"Steel foundry",width:3,height:3,spriteX:0,spriteY:3,iconX:6,iconY:0,runningCostPerTick:4,price:4e3,priceRefund:1,requiresResearch:"steelComponents",strategy:{type:"converter",inputResources:{iron:{perOutputResource:4},coal:{perOutputResource:4}},production:{steel:{amount:1}},outputResourcesOrder:["steel"],interval:10}},{id:"steelSeller",idNum:7,name:"Steel seller",width:2,height:2,spriteX:3,spriteY:3,iconX:7,iconY:0,runningCostPerTick:1,price:1500,priceRefund:1,requiresResearch:"steelComponents",strategy:{type:"seller",resources:{steel:{amount:2,sellPrice:0,sellMargin:.6}},interval:10}},{id:"oilBuyer",idNum:8,name:"Oil buyer",width:1,height:3,spriteX:0,spriteY:6,iconX:8,iconY:0,runningCostPerTick:8,price:4e4,priceRefund:1,requiresResearch:"plasticComponents",strategy:{type:"buyer",purchaseResources:{oil:{price:200,amount:1}},outputResourcesOrder:["oil"],interval:10}},{id:"gasBuyer",idNum:30,name:"Gas buyer",width:2,height:1,spriteX:6,spriteY:15,iconX:0,iconY:3,runningCostPerTick:6,price:6e4,priceRefund:1,requiresResearch:"plasticComponents",strategy:{type:"buyer",purchaseResources:{gas:{price:80,amount:1}},outputResourcesOrder:["gas"],interval:10}},{id:"plasticMaker",idNum:9,name:"Plastic maker",width:2,height:3,spriteX:1,spriteY:6,iconX:9,iconY:0,runningCostPerTick:20,price:24e4,priceRefund:1,requiresResearch:"plasticComponents",strategy:{type:"converter",inputResources:{oil:{perOutputResource:4},coal:{perOutputResource:4},gas:{perOutputResource:2}},production:{plastic:{amount:1},waste:{amount:1}},productionRemoveResearch:{waste:"cleanPlastic"},outputResourcesOrder:["plastic","waste"],interval:10}},{id:"plasticSeller",idNum:10,name:"Plastic seller",width:2,height:2,spriteX:3,spriteY:6,iconX:0,iconY:1,runningCostPerTick:12,price:18e4,priceRefund:1,requiresResearch:"plasticComponents",strategy:{type:"seller",resources:{plastic:{amount:1,sellPrice:0,sellMargin:.6}},interval:10}},{id:"siliconBuyer",idNum:11,name:"Silicon buyer",width:1,height:2,spriteX:0,spriteY:9,iconX:1,iconY:1,runningCostPerTick:120,price:te(50,2),priceRefund:1,requiresResearch:"electronicsComponents",strategy:{type:"buyer",purchaseResources:{silicon:{price:400,amount:1}},outputResourcesOrder:["silicon"],interval:10}},{id:"electronicsMaker",idNum:12,name:"Electronics maker",width:2,height:2,spriteX:1,spriteY:9,iconX:2,iconY:1,runningCostPerTick:300,price:te(200,2),priceRefund:1,requiresResearch:"electronicsComponents",strategy:{type:"converter",inputResources:{silicon:{perOutputResource:2},plastic:{perOutputResource:4}},production:{electronics:{amount:1},waste:{amount:1}},productionRemoveResearch:{waste:"cleanElectronics"},outputResourcesOrder:["electronics","waste"],interval:10}},{id:"electronicsSeller",idNum:13,name:"Electronics seller",width:2,height:2,spriteX:3,spriteY:9,iconX:3,iconY:1,runningCostPerTick:90,price:te(80,2),priceRefund:1,requiresResearch:"electronicsComponents",strategy:{type:"seller",resources:{electronics:{amount:1,sellPrice:0,sellMargin:2.1}},interval:10}},{id:"explosivesBuyer",idNum:17,name:"Explosives buyer",width:2,height:1,spriteX:0,spriteY:13,iconX:7,iconY:1,runningCostPerTick:1900,price:te(500,2),priceRefund:1,requiresResearch:"gunComponents",strategy:{type:"buyer",purchaseResources:{explosives:{price:900,amount:1}},outputResourcesOrder:["explosives"],interval:20}},{id:"bulletMaker",idNum:18,name:"Bullet maker",width:1,height:1,spriteX:2,spriteY:2,iconX:8,iconY:1,runningCostPerTick:3900,price:te(800,2),priceRefund:1,requiresResearch:"gunComponents",strategy:{type:"converter",inputResources:{steel:{perOutputResource:3},explosives:{perOutputResource:2}},production:{bullets:{amount:2}},outputResourcesOrder:["bullets"],interval:20}},{id:"gunMaker",idNum:19,name:"Gun maker",width:3,height:2,spriteX:0,spriteY:14,iconX:9,iconY:1,runningCostPerTick:5900,price:te(1,3),priceRefund:1,requiresResearch:"gunComponents",strategy:{type:"converter",inputResources:{steel:{perOutputResource:3},bullets:{perOutputResource:2}},production:{guns:{amount:2}},outputResourcesOrder:["guns"],interval:20}},{id:"gunSeller",idNum:20,name:"Gun seller",width:2,height:2,spriteX:3,spriteY:14,iconX:0,iconY:2,runningCostPerTick:1100,price:te(400,2),priceRefund:1,requiresResearch:"gunComponents",strategy:{type:"seller",resources:{guns:{amount:2,sellPrice:0,sellMargin:2.1}},interval:20}},{id:"aluminiumBuyer",idNum:14,name:"Aluminium buyer",width:2,height:2,spriteX:0,spriteY:11,iconX:4,iconY:1,runningCostPerTick:48e3,price:te(3,3),priceRefund:1,requiresResearch:"engineComponents",strategy:{type:"buyer",purchaseResources:{aluminium:{price:1400,amount:1}},outputResourcesOrder:["aluminium"],interval:10}},{id:"engineMaker",idNum:15,name:"Engine maker",width:4,height:3,spriteX:2,spriteY:11,iconX:5,iconY:1,runningCostPerTick:12e4,price:te(32,3),priceRefund:1,requiresResearch:"engineComponents",strategy:{type:"converter",inputResources:{aluminium:{perOutputResource:4},steel:{perOutputResource:6},electronics:{perOutputResource:3}},production:{engine:{amount:1},waste:{amount:1}},productionRemoveResearch:{waste:"cleanEngines"},outputResourcesOrder:["engine","waste"],interval:10}},{id:"engineSeller",idNum:16,name:"Engine seller",width:2,height:2,spriteX:6,spriteY:11,iconX:6,iconY:1,runningCostPerTick:8e4,price:te(8,3),priceRefund:1,requiresResearch:"engineComponents",strategy:{type:"seller",resources:{engine:{amount:1,sellPrice:0,sellMargin:2.1}},interval:10}},{id:"tankHullMaker",idNum:21,name:"Tank hull maker",width:5,height:3,spriteX:0,spriteY:16,iconX:1,iconY:2,runningCostPerTick:16e5,price:te(400,3),priceRefund:1,requiresResearch:"tankComponents",strategy:{type:"converter",inputResources:{electronics:{perOutputResource:3},steel:{perOutputResource:6},aluminium:{perOutputResource:2}},production:{tankHull:{amount:1}},outputResourcesOrder:["tankHull"],interval:10}},{id:"tankTurretMaker",idNum:22,name:"Tank turret maker",width:3,height:2,spriteX:5,spriteY:16,iconX:2,iconY:2,runningCostPerTick:2e6,price:te(800,3),priceRefund:1,requiresResearch:"tankComponents",strategy:{type:"converter",inputResources:{guns:{perOutputResource:4},steel:{perOutputResource:6}},production:{tankTurret:{amount:1}},outputResourcesOrder:["tankTurret"],interval:10}},{id:"tankAssembler",idNum:23,name:"Tank assembly",width:2,height:4,spriteX:8,spriteY:16,iconX:3,iconY:2,runningCostPerTick:18e5,price:te(700,3),priceRefund:1,requiresResearch:"tankComponents",strategy:{type:"converter",inputResources:{tankHull:{perOutputResource:1},tankTurret:{perOutputResource:1},engine:{perOutputResource:1}},production:{tank:{amount:1}},outputResourcesOrder:["tank"],interval:10}},{id:"tankSeller",idNum:26,name:"Tank seller",width:2,height:2,spriteX:5,spriteY:18,iconX:4,iconY:2,runningCostPerTick:24e5,price:te(500,3),priceRefund:1,requiresResearch:"tankComponents",strategy:{type:"seller",resources:{tank:{amount:1,sellPrice:0,sellMargin:2.1},diesel:{amount:8,sellPrice:0,sellMargin:2.6,bonus:!0,requiresResearch:"dieselRefinery"},rocket:{amount:1,sellPrice:0,sellMargin:2.6,bonus:!0,requiresResearch:"rocketComponents"}},interval:10}},{id:"dieselRefinery",idNum:32,name:"Diesel refinery",width:3,height:2,spriteX:5,spriteY:6,iconX:5,iconY:2,runningCostPerTick:18e6,price:te(15,4),priceRefund:1,requiresResearch:"dieselRefinery",strategy:{type:"converter",inputResources:{oil:{perOutputResource:96}},production:{diesel:{amount:16},waste:{amount:8}},outputResourcesOrder:["diesel","diesel","waste"],interval:10}},{id:"jetFuelRefinery",idNum:31,name:"Jet fuel refinery",width:2,height:2,spriteX:6,spriteY:13,iconX:1,iconY:3,runningCostPerTick:1e8,price:te(35,4),priceRefund:1,requiresResearch:"rocketComponents",strategy:{type:"converter",inputResources:{gas:{perOutputResource:24}},production:{jetFuel:{amount:8},waste:{amount:4}},outputResourcesOrder:["jetFuel","jetFuel","waste"],interval:10}},{id:"rocketHullMaker",idNum:27,name:"Rocket hull maker",width:3,height:2,spriteX:0,spriteY:19,iconX:6,iconY:2,runningCostPerTick:15e7,price:te(60,4),priceRefund:1,requiresResearch:"rocketComponents",strategy:{type:"converter",inputResources:{aluminium:{perOutputResource:8},engine:{perOutputResource:1}},production:{rocketHull:{amount:1,max:3}},outputResourcesOrder:["rocketHull"],interval:10}},{id:"rocketWarheadMaker",idNum:28,name:"Warhead maker",width:2,height:3,spriteX:3,spriteY:19,iconX:7,iconY:2,runningCostPerTick:12e7,price:te(130,4),priceRefund:1,requiresResearch:"rocketComponents",strategy:{type:"converter",inputResources:{aluminium:{perOutputResource:4},electronics:{perOutputResource:3},explosives:{perOutputResource:8}},production:{warhead:{amount:1}},outputResourcesOrder:["warhead"],interval:10}},{id:"rocketAssembler",idNum:29,name:"Rocket assembly",width:2,height:2,spriteX:5,spriteY:20,iconX:8,iconY:2,runningCostPerTick:19e6,price:te(110,4),priceRefund:1,requiresResearch:"rocketComponents",strategy:{type:"converter",inputResources:{rocketHull:{perOutputResource:2},warhead:{perOutputResource:2},jetFuel:{perOutputResource:8}},production:{rocket:{amount:2}},outputResourcesOrder:["rocket"],interval:10}},{id:"droneMaker",idNum:41,name:"Drone maker",width:2,height:6,spriteX:8,spriteY:9,iconX:5,iconY:4,runningCostPerTick:1e9,price:te(6,5),priceRefund:1,requiresResearch:"droneComponents",strategy:{type:"converter",inputResources:{aluminium:{perOutputResource:64},plastic:{perOutputResource:48},electronics:{perOutputResource:24},engine:{perOutputResource:8},guns:{perOutputResource:32}},production:{drone:{amount:8}},outputResourcesOrder:["drone"],interval:20}},{id:"droneControlRoom",idNum:42,name:"Drone control room",width:3,height:5,spriteX:10,spriteY:11,iconX:6,iconY:4,runningCostPerTick:15e8,price:te(6,5),priceRefund:1,requiresResearch:"droneComponents",strategy:{type:"converter",inputResources:{steel:{perOutputResource:96},electronics:{perOutputResource:24}},production:{droneControlRoom:{amount:4}},outputResourcesOrder:["droneControlRoom"],interval:20}},{id:"droneSeller",idNum:43,name:"Drone seller",width:2,height:2,spriteX:10,spriteY:16,iconX:7,iconY:4,runningCostPerTick:3e9,price:te(4,5),priceRefund:1,requiresResearch:"droneComponents",strategy:{type:"seller",resources:{drone:{amount:4,sellPrice:0,sellMargin:1.9},droneControlRoom:{amount:2,sellPrice:0,sellMargin:1.9},rocket:{amount:8,sellPrice:0,bonus:!0,sellMargin:6},jetFuel:{amount:32,sellPrice:0,bonus:!0,sellMargin:3}},interval:20}},{id:"researchCenter",idNum:33,name:"Research center",width:4,height:4,spriteX:5,spriteY:2,iconX:3,iconY:3,runningCostPerTick:4,price:1e3,priceRefund:1,requiresResearch:"researchCenter",strategy:{type:"researchCenter",researchProduction:1,resources:{report1:{max:4,bonus:2}},interval:10}},{id:"metalsLab",idNum:34,name:"Metals lab",width:3,height:2,spriteX:7,spriteY:0,iconX:5,iconY:3,runningCostPerTick:8,price:4e4,priceRefund:1,requiresResearch:"metalsLab",strategy:{type:"lab",inputResources:{iron:{perOutputResource:1,max:25,bonus:4},steel:{perOutputResource:1,max:25,bonus:6},aluminium:{perOutputResource:1,max:25,bonus:5}},production:{report1:{amount:1,max:25}},outputResourcesOrder:["report1"],interval:20}},{id:"gasAndOilLab",idNum:35,name:"Gas&Oil lab",width:2,height:3,spriteX:8,spriteY:6,iconX:4,iconY:3,runningCostPerTick:200,price:6e5,priceRefund:1,requiresResearch:"gasAndOilLab",strategy:{type:"lab",inputResources:{gas:{perOutputResource:1,max:25,bonus:2},oil:{perOutputResource:1,max:25,bonus:3},plastic:{perOutputResource:1,max:25,bonus:10},diesel:{perOutputResource:1,max:3,bonus:8},jetFuel:{perOutputResource:1,max:3,bonus:8}},production:{report2:{amount:1,max:25}},outputResourcesOrder:["report2"],interval:20}},{id:"researchCenter2",idNum:38,name:"Research center 2",width:4,height:4,spriteX:10,spriteY:0,iconX:2,iconY:4,runningCostPerTick:200,price:6e5,priceRefund:1,requiresResearch:"gasAndOilLab",applyUpgradesFrom:"researchCenter",strategy:{type:"researchCenter",researchProduction:4,resources:{report2:{max:4,bonus:3}},interval:20}},{id:"analystCenter",idNum:39,name:"Analytics center",width:3,height:3,spriteX:10,spriteY:8,iconX:4,iconY:4,runningCostPerTick:12e3,price:te(2,3),priceRefund:1,requiresResearch:"analystCenter",strategy:{type:"converter",inputResources:{report1:{perOutputResource:32,max:256,bonus:10},report2:{perOutputResource:32,max:256,bonus:10}},production:{report3:{amount:20,max:100},waste:{amount:20,max:100}},outputResourcesOrder:["report3","waste"],interval:40}},{id:"researchCenter3",idNum:40,name:"Research center 3",width:4,height:4,spriteX:10,spriteY:4,iconX:3,iconY:4,runningCostPerTick:35e3,price:te(6,3),priceRefund:1,requiresResearch:"analystCenter",applyUpgradesFrom:"researchCenter",strategy:{type:"researchCenter",researchProduction:20,resources:{report3:{max:4,bonus:16}},interval:40}},{id:"qualityLab",idNum:44,name:"Quality lab",width:4,height:2,spriteX:12,spriteY:16,iconX:0,iconY:4,runningCostPerTick:te(400,2),price:te(3,5),priceRefund:1,requiresResearch:"qualityCenter",strategy:{type:"lab",inputResources:{tank:{perOutputResource:1,max:25,bonus:21},rocket:{perOutputResource:1,max:25,bonus:16},engine:{perOutputResource:1,max:25,bonus:10},guns:{perOutputResource:1,max:3,bonus:6},drone:{perOutputResource:1,max:3,bonus:24}},production:{report4:{amount:1,max:1e3}},outputResourcesOrder:["report4"],interval:5}},{id:"researchCenter4",idNum:45,name:"Research center 4",width:4,height:4,spriteX:10,spriteY:18,iconX:1,iconY:4,runningCostPerTick:te(50,2),price:te(2,5),priceRefund:1,requiresResearch:"qualityCenter",applyUpgradesFrom:"researchCenter",strategy:{type:"researchCenter",researchProduction:100,resources:{report4:{max:64,bonus:100}},interval:40}}]};(()=>{const p={};for(const t of at.components)p[t.id]=t;const e=new ot(p,at.productionTree);for(const t of at.components){if(t.strategy?.type==="seller")for(const r in t.strategy.resources){const i={},s=e.calculateCostFor(t.id,r,i);s>0&&(t.strategy.resources[r].sellPrice=Math.ceil(s))}if(t.strategy?.type==="buyer")for(const r in t.strategy.purchaseResources)t.strategy.purchaseResources[r].max=20*t.strategy.purchaseResources[r].amount;else if(t.strategy?.type==="converter"){for(const r in t.strategy.inputResources)t.strategy.inputResources[r].max=20*t.strategy.inputResources[r].perOutputResource;for(const r in t.strategy.production)t.strategy.production[r].max=20*t.strategy.production[r].amount}else if(t.strategy?.type==="seller")for(const r in t.strategy.resources)t.strategy.resources[r].max=20*t.strategy.resources[r].amount}})();const po=[{id:"ironOre",idNum:1,name:"Iron ore",nameShort:"Iron ore",spriteX:0,spriteY:0},{id:"iron",idNum:2,name:"Iron",nameShort:"Iron",spriteX:1,spriteY:0},{id:"coal",idNum:3,name:"Coal",nameShort:"Coal",spriteX:2,spriteY:0},{id:"steel",idNum:4,name:"Steel",nameShort:"Steel",spriteX:3,spriteY:0},{id:"oil",idNum:5,name:"Oil",nameShort:"Oil",spriteX:4,spriteY:0},{id:"plastic",idNum:6,name:"Plastic",nameShort:"Plastic",spriteX:5,spriteY:0},{id:"silicon",idNum:7,name:"Silicon",nameShort:"Silicon",spriteX:6,spriteY:0},{id:"electronics",idNum:8,name:"Electronics",nameShort:"Electronics",spriteX:7,spriteY:0},{id:"aluminium",idNum:9,name:"Aluminium",nameShort:"Alu",spriteX:0,spriteY:1},{id:"engine",idNum:10,name:"Engine",nameShort:"Engine",spriteX:1,spriteY:1},{id:"explosives",idNum:11,name:"Explosives",nameShort:"Explosives",spriteX:2,spriteY:1},{id:"bullets",idNum:12,name:"Bullets",nameShort:"Bullets",spriteX:3,spriteY:1},{id:"guns",idNum:13,name:"Guns",nameShort:"Guns",spriteX:4,spriteY:1},{id:"tankHull",idNum:14,name:"Tank hull",nameShort:"Tank hull",spriteX:5,spriteY:1},{id:"tankTurret",idNum:15,name:"Tank turret",nameShort:"Tank turret",spriteX:6,spriteY:1},{id:"tank",idNum:16,name:"Tank",nameShort:"Tank",spriteX:7,spriteY:1},{id:"rocketHull",idNum:17,name:"Rocket hull",nameShort:"Rocket hull",spriteX:1,spriteY:2},{id:"warhead",idNum:18,name:"Warhead",nameShort:"Warhead",spriteX:2,spriteY:2},{id:"rocket",idNum:19,name:"Rocket",nameShort:"Rocket",spriteX:3,spriteY:2},{id:"waste",idNum:20,name:"Waste",nameShort:"Waste",spriteX:4,spriteY:2},{id:"gas",idNum:21,name:"Gas",nameShort:"Gas",spriteX:6,spriteY:2},{id:"jetFuel",idNum:22,name:"Jet fuel",nameShort:"Jet fuel",spriteX:7,spriteY:2},{id:"diesel",idNum:23,name:"Diesel",nameShort:"Diesel",spriteX:5,spriteY:2},{id:"drone",idNum:27,name:"Drone",nameShort:"Drone",spriteX:4,spriteY:3},{id:"droneControlRoom",idNum:28,name:"Drone control rooms",nameShort:"Drone CR",spriteX:5,spriteY:3},{id:"report1",idNum:24,name:"Metal report",nameShort:"Metal report",spriteX:0,spriteY:3},{id:"report2",idNum:25,name:"Gas&oil report",nameShort:"Gas&oil report",spriteX:1,spriteY:3},{id:"report3",idNum:26,name:"Big report",nameShort:"Big report",spriteX:2,spriteY:3},{id:"report4",idNum:29,name:"Quality report",nameShort:"Quality report",spriteX:3,spriteY:3}],mo=[{id:"level1",idNum:1,name:"Factory",tilesX:68,tilesY:38,startX:8,startY:10,price:100,terrains:{G:"grass",X:"wall",".":"road"," ":"floor"},buildableTerrains:{floor:!0},terrainMap:"XXXXXXXXXXXX.GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG.GGGGGGGGGG.GGGGGGGGGGX          X.XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXG.GXXXXXXXXX.XXXXXXXXXGX          X.X        X         X           XG.GX        .        XGX           .         X         X            G.G         .        XGX           .         X                      G.G       XX.XX      XGX          X.X        X                     XG.GX      XG.GX      XGX          X.X        X                     XG.GXXX XXXXG.GX      XGX          X.X      X XX X                  XG.GX      XXXXX      XGX           .       X    X      X           XG.GX                 XGXXXX    XXXX.X      X    X      X           XG.GX                 XG.............X      X    X      XXXXXXXXXXXXXG.GXXXXXXXXXX  XXX  XXGXXXX    XXXX.X      X    X      X...................................X          X.X      X    X      X.GGGGGGXXXXXXXXXXXXXXX.XX  XXX  XXXX          X.X                  X.GGGGGGX              .           XX          X.XXX   XXXXXXXXX   XX.GGGGGGX             X.X          XX          X......................GGGGGGXX           XX.XX         XX          X.XXX   XXXXXXXXX   XX.GGGGGGGX           XG.GX         XX     X    X.X                  X.GGGGGGXX           XX.XX         XX     X    X.X                  X.GGGGGGX              .           XX     X    X.X            X     X.GGGGGGX             X.X          XX     XXXXXX.X            X     X.GGGGGGXX           XX.XX         XX         XG.X            X     X.GGGGGGGX           XG.GX         XXX         G.             X     X.GGGGGGXX           XX.XX         XGX         G.             X     X.GGGGGGX              .           XGX         G.             X     X.XXXGXXX             X.X          XGX         G.             X     X.X XXX              XX.XX         XGX        XG.X                   .                   XG.GX         XGXXXX  XXXXG.X                   .                   XX.XX         XGGGGGGGGGGGG.XXXXXXXX   XXX   XXX.X                    .           X...................GGGGGGGGGGGGGG.X                    .           XGGGGX  XXXXG.XXXXX................X                    .           XGXXXX     XX.X   XXXX   XXX   XXX.X                    .           XGX          .       X           X.X                  XX.X          XGX          .                    .                   X..X          XGX          .                    .      XXXXXXXX     X.XX          XGX        XX.X      X            .      XGGGGGGX     X.X           XGXXXXXXXXXXG.X      X           X.XXXXXXXGGGGGGXXXXXXX.X           XGGGGGGGGGGGG.XXXXXXXXXXXXXXXXXXXX.GGGGGGGGGGGGGGGGGGGG.XXXXXXXXXXXXX",buildMap:"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX          XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX          XXX        X         X           XXXXX        -        XXX           -         X         X            ---         -        XXX           -         X                      ---       XXXXX      XXX          XXX        X                     XXXXX      XXXXX      XXX          XXX        X                     XXXXXXX XXXXXXXX      XXX          XXX      X XX X                  XXXXX      XXXXX      XXX           -       X    X      X           XXXXX                 XXXXXX    XXXXXX      X    X      X           XXXXX                 XXXXXX----XXXXXX      X    X      XXXXXXXXXXXXXXXXXXXXXXXXXX  XXX  XXXXXXX    XXXXXX      X    X      XXXXXXXXXXXXXXXXXXXXXXXXXX--XXX--XXXX          XXX      X    X      XXXXXXXXXXXXXXXXXXXXXXXXXX  XXX  XXXX          XXX                  XXXXXXXXX              -           XX          XXXXX   XXXXXXXXX   XXXXXXXXXX             XXX          XX          XXXXX---XXXXXXXXX---XXXXXXXXXXX           XXXXX         XX          XXXXX   XXXXXXXXX   XXXXXXXXXXX           XXXXX         XX     X    XXX                  XXXXXXXXXX           XXXXX         XX     X    XXX                  XXXXXXXXX              -           XX     X    XXX            X     XXXXXXXXX             XXX          XX     XXXXXXXX            X     XXXXXXXXXX           XXXXX         XX         XXXX            X     XXXXXXXXXX           XXXXX         XXX         --             X     XXXXXXXXXX           XXXXX         XXX         --             X     XXXXXXXXX              -           XXX         --             X     XXXXXXXXX             XXX          XXX         --             X     XXX XXX              XXXXX         XXX        X-XX                   -                   XXXXX         XXXXXX  XXXX-XX                   -                   XXXXX         XXXXXX-------XXXXXXXXX   XXX   XXXXX                    -           XXXXXX--XXXXXXXXXXXX--------------XX                    -           XXXXXX  XXXXXXXXXXXXXX---XXX---XXXXX                    -           XXXXXX     XXXX   XXXX   XXX   XXXXX                    -           XXX          -       X           XXX                  XXXX          XXX          -                    -                   XXXX          XXX          -                    -      XXXXXXXX     XXXX          XXX        XXXX      X            -      XXXXXXXX     XXX           XXXXXXXXXXXXXXX      X           XXXXXXXXXXXXXXXXXXXXXXXX           XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",areas:[{id:"a2",name:"A2",idNum:1,price:1200,locations:[{x:0,y:0,x2:11,y2:9}]},{id:"a4",name:"A4",idNum:2,price:25e4,locations:[{x:0,y:11,x2:11,y2:27}]},{id:"a1",name:"A1",idNum:3,price:700,locations:[{x:0,y:30,x2:11,y2:37}]},{id:"a5",name:"A5",idNum:4,price:26e6,locations:[{x:13,y:1,x2:32,y2:14}]},{id:"a6",name:"A6",idNum:5,price:32e6,locations:[{x:33,y:1,x2:44,y2:10}]},{id:"a3",name:"A3",idNum:6,price:12e3,locations:[{x:13,y:31,x2:32,y2:37},{x:13,y:30,x2:17,y2:30}]},{id:"a7",name:"A7",idNum:7,price:14e7,locations:[{x:48,y:1,x2:66,y2:10}]},{id:"a9",name:"A9",idNum:8,price:4e10,locations:[{x:34,y:12,x2:53,y2:36},{x:54,y:12,x2:54,y2:32}]},{id:"a8",name:"A8",idNum:9,price:29e8,locations:[{x:56,y:12,x2:67,y2:37},{x:55,y:34,x2:55,y2:37}]}],startComponents:[{id:"ironBuyer",x:15,y:18},{id:"ironFoundry",x:19,y:18},{id:"ironSeller",x:25,y:18},{id:"transportLine",x:17,y:18},{id:"transportLine",x:18,y:18},{id:"transportLine",x:23,y:18},{id:"transportLine",x:24,y:18}],transportLineConnections:[{fromX:16,fromY:18,toX:17,toY:18},{fromX:17,fromY:18,toX:18,toY:18},{fromX:18,fromY:18,toX:19,toY:18},{fromX:22,fromY:18,toX:23,toY:18},{fromX:23,fromY:18,toX:24,toY:18},{fromX:24,fromY:18,toX:25,toY:18}]},{id:"level2",idNum:2,name:"Kilofactory",tilesX:50,tilesY:35,startX:12,startY:0,price:1e9,terrains:{G:"grass",X:"wall",".":"road"," ":"floor"},buildableTerrains:{floor:!0},terrainMap:"GGGGGGGGGGGGGGG.GGGGGGGGGGGGGGGGGGGG.GGGGGGGGGGGGGGXXXXXXXXXXXXGG.GXXXXXXXXXXXXXXXXXXX.XXXXXXXXXXXXGGX          XGG.GX                 X.X          XGGX          XGG.GX                 X.X          XGGX          XGG.GX                 X.X          XGGX          XGG.GX                 X.X          XGGX           GG.G                   .           XGGX          XGG.GX                 X.X          XGGX           GG.G                   .           XGGX          XGG.GX                 X.X          XGGX           GG.G                   .           XGGX          XGG.GX                 X.X          XGGX           GG.G                   .           XGGX          XGG.GX                 X.X          XGGX           GG.G                   .           XGGX          XGG.GX                 X.X          XGGX          XGG.GX                 X.X          XGGX          XGG.GX                 X.X          XGGXXXX    XXXXGG.GXXXXX  X  XXX  X  X.XXXXXXXXXXXXG................GGGGGG  G  GGG  G  G.GGGGGGGGGGGGGGXXXX    XXXXGG.GGGGGGGGGGGGGGGGGGGG.GGGGGGGGGGGGGGX          XGG......................GGGGGGG GGGGGGX          XGG.GGGGGG  G  G.G  G  GGGGGGGG   GGGGGX          XGG.GXXXXX  X  X.X  X  XXXXXGGGG GGGGGGX          XGG.GX         X.X         XGGGGGGGGGGGX          XGG.GX         X.X         XGGGGGGGGGGGX          XGG.GX         X.X         XGGGG GGGGGGX          XGG.GX         X.X         XGGG   GGGGGX          XGG.GX         X.X         XGGGG GGGGGGX          XGG.GX         X.X         XGGGGGGGGGGGX          XGG.GX         X.X         XGGGGGGGGGGGX          XGG.GX        XX.XX        XGGGG GGGGGGX          XGG.GX        XG.GX        XGGG   GGGGGXXXXXXXXXXXXGG.GXXXXXXXXXXG.GXXXXXXXXXXGGGG GGGGGGGGGGGGGGGGGGGG.GGGGGGGGGGGG.GGGGGGGGGGGGGGGGGGGGG",buildMap:"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX          XXXXXX                 XXX          XXXX          XXXXXX                 XXX          XXXX          XXXXXX                 XXX          XXXX          XXXXXX                 XXX          XXXX           ----                   -           XXXX          X----X                 X-X          XXXX           ----                   -           XXXX          X----X                 X-X          XXXX           ----                   -           XXXX          X----X                 X-X          XXXX           ----                   -           XXXX          X----X                 X-X          XXXX           ----                   -           XXXX          XXXXXX                 XXX          XXXX          XXXXXX                 XXX          XXXX          XXXXXX                 XXX          XXXXXXX    XXXXXXXXXXXXX  X  XXX  X  XXXXXXXXXXXXXXXXXXXX----XXXXXXXXXXXXX  -  XXX  -  XXXXXXXXXXXXXXXXXXXX    XXXXXXXXXXXXX-----XXX-----XXXXXXXXXXXXXXXXX          XXXXXXXXXX-----XXX-----XXXXXXXXX XXXXXXX          XXXXXXXXXX  -  XXX  -  XXXXXXXX   XXXXXX          XXXXXXXXXX  X  XXX  X  XXXXXXXXX XXXXXXX          XXXXXX         XXX         XXXXXXXXXXXXX          XXXXXX         XXX         XXXXXXXXXXXXX          XXXXXX         XXX         XXXXX XXXXXXX          XXXXXX         XXX         XXXX   XXXXXX          XXXXXX         XXX         XXXXX XXXXXXX          XXXXXX         XXX         XXXXXXXXXXXXX          XXXXXX         XXX         XXXXXXXXXXXXX          XXXXXX        XXXXX        XXXXX XXXXXXX          XXXXXX        XXXXX        XXXX   XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",areas:[{id:"b3",name:"B3",idNum:1,price:12e9,locations:[{x:1,y:1,x2:12,y2:18}]},{id:"b1",name:"B1",idNum:2,price:25e8,locations:[{x:16,y:22,x2:27,y2:34}]},{id:"b2",name:"B2",idNum:3,price:25e8,locations:[{x:29,y:22,x2:39,y2:34}]},{id:"b5",name:"B5",idNum:4,price:8e11,locations:[{x:37,y:1,x2:48,y2:18}]},{id:"b4",name:"B4",idNum:5,price:26e10,locations:[{x:1,y:20,x2:12,y2:33}]}]},{id:"level3",idNum:3,name:"Megafactory",tilesX:68,tilesY:42,startX:10,startY:3,price:5e12,terrains:{G:"grass",X:"wall",".":"road"," ":"floor"},buildableTerrains:{floor:!0},terrainMap:"GGGGGGGGGGGGGGGGGGGGGGG.GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGXXXXXXXXXXXXXXXXXXXXXX.GXXXXXXXXXXXXXXXXXXGGXXXXXXXXXXXXXXXXXXXXXXGGX                     .G                 XGGX                    XGGX                     .G                  GG                     XGGX                    X.GX                 GG                     XGGX                    X.GX                 GG                     XGGX                    X.GX                 GG                     XGGX                    X.GX                 GG                     XGGX                    X.GX                 GG                     XGGX                    X.GX                 GG                     XGGX                    X.GX                XGGX                    XGGX                    X.GX          XXXXXXXGGXXX                  XGGX                    X.GX          XGGGGGGGGGGX                  XGGX             XXX    X.GX          XGGGGGGGGGGX                  XGGX             X........GX          XGGGGGGGGGGX                  XGGX             X.X    XXXX          XGGGGGGGGGGX                  XGGX             X.X                  XGGGGGGGGGGXXXX   XXX  XXX   XXGGX             X.X                  XGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGX             X.X                  XGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGXXXX   XXXXXXXX.X                  XGG..............................................X                  XGG.GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG.X                  XGG.GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG.X                  XGG.GGXXXXXXXXX   XXX  XXX   XXGGGGGGGGGGGGGGGGG.X                  XGG.GGX                       XGGXXXX   XXXXXGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X    XXXXXXXXXX    XGG.GGX                       XGGX          XGGG........................GGX                       XGGX          XGGG.X    XXXXXXXXXX    XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                   GG.GG                        XGGX          XGGG.X                   GG.GG                        XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGXXXXXXXXXXXXGGG.X                  XGG.GGXXXXXXXXXXXXXXXXXXXXXXXXXGGGGGGGGGGGGGGGGG.XXXXXXXXXXXXXXXXXXXXGG.GGGGGGGGGGGGGGGGGGGGGGGGGGGG",buildMap:"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX                     --                 XXXX                    XXXX                     --                  --                     XXXX                    XXXX                 --                     XXXX                    XXXX                 --                     XXXX                    XXXX                 --                     XXXX                    XXXX                 --                     XXXX                    XXXX                 --                     XXXX                    XXXX                 --                     XXXX                    XXXX                XXXX                    XXXX                    XXXX          XXXXXXXXXXXX                  XXXX                    XXXX          XXXXXXXXXXXX                  XXXX             XXX    XXXX          XXXXXXXXXXXX                  XXXX             XXX----XXXX          XXXXXXXXXXXX                  XXXX             XXX    XXXX          XXXXXXXXXXXX                  XXXX             XXX                  XXXXXXXXXXXXXXX   XXX  XXX   XXXXX             XXX                  XXXXXXXXXXXXXXX--------------XXXXX             XXX                  XXXXXXXXXXXXXXX---XXX--XXX---XXXXXXXX   XXXXXXXXXX                  XXXXXXXXXXXXXXX---XXX--XXX---XXXXXXXX---XXXXXXXXXX                  XXXXXXXXXXXXXXX---XXX--XXX---XXXXXXXX---XXXXXXXXXX                  XXXXXXXXXXXXXXX--------------XXXXXXXX---XXXXXXXXXX                  XXXXXXXXXXXXXXX   XXX  XXX   XXXXXXXX---XXXXXXXXXX                  XXXXXXX                       XXXXXXX   XXXXXXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX    XXXXXXXXXX    XXXXXXX                       XXXX          XXXXXX----XXXXXXXXXX----XXXXXXX                       XXXX          XXXXXX    XXXXXXXXXX    XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                   -----                        XXXX          XXXXXX                   -----                        XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXXXXXXXXXXXXXXXXXX                  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",areas:[{id:"c3",name:"C3",idNum:1,price:2e12,locations:[{x:1,y:1,x2:15,y2:19},{x:16,y:1,x2:22,y2:13}]},{id:"c2",name:"C2",idNum:2,price:15e12,locations:[{x:1,y:24,x2:12,y2:40}]},{id:"c1",name:"C1",idNum:3,price:7e12,locations:[{x:17,y:31,x2:36,y2:41}]},{id:"c4",name:"C4",idNum:4,price:15e13,locations:[{x:42,y:22,x2:66,y2:40}]},{id:"c5",name:"C5",idNum:5,price:6e13,locations:[{x:47,y:1,x2:66,y2:16},{x:45,y:1,x2:46,y2:11}]}]},{id:"level4",idNum:4,name:"Gigafactory",tilesX:50,tilesY:40,startX:9,startY:8,price:1e15,terrains:{G:"grass",X:"wall",".":"road"," ":"floor"},buildableTerrains:{floor:!0},terrainMap:"GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXGGGGGXX   X    X    X    X    X    X    X    X   XXGGGXX                                            XXGGX                                              XGGX                                              XGGX                                              XGGXX                                            XXGGX                                              XGGX                                              XGGX                                              XGGX                                              XGGXX                                            XXGGX                                              XGGX                                              XGGX                                              XGGX                                              XGGXX                                            XXGGX                XXX        XXX                XGGX                XGX        XGX                XGGX                XGX        XGX                XGGX                XXX        XXX                XGGXX                                            XXGGX                                              XGGX                                              XGGX                                              XGGX                                              XGGXX                                            XXGGX                                              XGGX                                              XGGX                                              XGGX                                              XGGXX                                            XXGGX                                              XGGX                                              XGGX                                              XGGXX                                            XXGGGXX   X    X    X    X    X    X    X    X   XXGGGGGXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG",buildMap:"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX   X    X    X    X    X    X    X    X   XXXXXXX                                            XXXXX                                              XXXX                                              XXXX                                              XXXXX                                            XXXXX                                              XXXX                                              XXXX                                              XXXX                                              XXXXX                                            XXXXX                                              XXXX                                              XXXX                                              XXXX                                              XXXXX                                            XXXXX                XXX        XXX                XXXX                XXX        XXX                XXXX                XXX        XXX                XXXX                XXX        XXX                XXXXX                                            XXXXX                                              XXXX                                              XXXX                                              XXXX                                              XXXXX                                            XXXXX                                              XXXX                                              XXXX                                              XXXX                                              XXXXX                                            XXXXX                                              XXXX                                              XXXX                                              XXXXX                                            XXXXXXX   X    X    X    X    X    X    X    X   XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",areas:[]},{id:"level5",idNum:5,name:"Terafactory",tilesX:80,tilesY:41,startX:9,startY:8,price:1e18,terrains:{G:"grass",X:"wall",".":"road"," ":"floor"},buildableTerrains:{floor:!0},terrainMap:"XXXXXXXXXXXXXXXXXXXXXXXXXG.GGGGGGGGGGGGGGGGGGGGGGGGGG.GXXXXXXXXXXXXXXXXXXXXXXXXXX                       XG............................GX                       XX                       XG.GXXXXXXXXXX.XX.XXXXXXXXXXG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                        G.G                        G.G                        XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                        G.G                        G.G                        XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GXXXXXXXXXXXXXXXXXXXXXXXXG.GX                       XX                       XG.GGGGGGGGGGGGGGGGGGGGGGGGGG.GX                       XXXXXXXXXXXXXXXXXXXXXXXXXXG.GGGGGGGGGGGGGGGGGGGGGGGGGG.GXXXXXXXXXXXXXXXXXXXXXXXXX",buildMap:"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX                       XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX                       XX                       XXXXXXXXXXXXXX-XX-XXXXXXXXXXXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                        ---                        ---                        XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                        ---                        ---                        XX                        ---                        ---                        XX                        ---                        ---                        XX                        ---                        ---                        XX                        ---                        ---                        XX                        ---                        ---                        XX                        ---                        ---                        XX                        ---                        ---                        XX                        ---                        ---                        XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                        ---                        ---                        XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX                       XX                       XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX                       XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",areas:[]}],he=(p,e)=>p*Math.pow(1e3,e),Xo=[{id:"researchCenter",idNum:13,name:"Research center",iconX:0,iconY:0,description:"Allows researching more technologies",price:900,priceIncrease:1,max:1,requiresResearch:""},{id:"chronometer",idNum:1,name:"Chronometer",iconX:1,iconY:0,description:"Each level gives +1 tick/sec",priceResearchPoints:50,priceIncrease:50,max:10,requiresResearch:"researchCenter"},{id:"steelComponents",idNum:2,name:"Steel components",iconX:2,iconY:0,description:"Allows steel production",priceResearchPoints:200,priceIncrease:1,max:1,requiresResearch:"researchCenter"},{id:"metalsLab",idNum:14,name:"Metals lab",iconX:3,iconY:0,description:"Allows researching metals",priceResearchPoints:2e3,priceIncrease:1,max:1,requiresResearch:"steelComponents"},{id:"plasticComponents",idNum:3,name:"Plastic components",iconX:4,iconY:0,description:"Allows plastic production",priceResearchPoints:he(160,1),priceIncrease:1,max:1,requiresResearch:"steelComponents"},{id:"sorter",idNum:16,name:"Sorter",iconX:5,iconY:0,description:"Sorts resources on lines to different paths",priceResearchPoints:he(120,1),priceIncrease:1,max:1,requiresResearch:"plasticComponents"},{id:"electronicsComponents",idNum:4,name:"Electronics components",iconX:6,iconY:0,description:"Allows electronics production",priceResearchPoints:he(20,2),priceIncrease:1,max:1,requiresResearch:"plasticComponents"},{id:"gasAndOilLab",idNum:15,name:"Gas&Oil lab",iconX:7,iconY:0,description:"Allows researching gas and oil",priceResearchPoints:he(300,1),priceIncrease:1,max:1,requiresResearch:"plasticComponents"},{id:"gunComponents",idNum:8,name:"Gun components",iconX:0,iconY:1,description:"Allows guns production",priceResearchPoints:he(150,2),priceIncrease:1,max:1,requiresResearch:"electronicsComponents"},{id:"cleanPlastic",idNum:5,name:"Clean plastic production",iconX:1,iconY:1,description:"Plastic production will not produce waste",priceResearchPoints:he(15,2),priceIncrease:1,max:1,requiresResearch:"electronicsComponents"},{id:"engineComponents",idNum:6,name:"Engine components",iconX:2,iconY:1,description:"Allows engines production",priceResearchPoints:he(2.5,3),priceIncrease:1,max:1,requiresResearch:"gunComponents"},{id:"analystCenter",idNum:17,name:"Analytics center",iconX:3,iconY:0,description:"Provides higher quality research",priceResearchPoints:he(250,2),priceIncrease:1,max:1,requiresResearch:"gunComponents"},{id:"tankComponents",idNum:9,name:"Tank components",iconX:4,iconY:1,description:"Allows tanks production",priceResearchPoints:he(20,3),priceIncrease:1,max:1,requiresResearch:"engineComponents"},{id:"cleanElectronics",idNum:7,name:"Clean electronics",iconX:5,iconY:1,description:"Electronics production will not produce waste",priceResearchPoints:he(700,2),priceIncrease:1,max:1,requiresResearch:"engineComponents"},{id:"dieselRefinery",idNum:10,name:"Diesel refinery",iconX:5,iconY:1,description:"Diesel increases tanks value.",priceResearchPoints:he(75,3),priceIncrease:1,max:1,requiresResearch:"tankComponents"},{id:"rocketComponents",idNum:11,name:"Rocket components",iconX:6,iconY:1,description:"Allows producing rockets",priceResearchPoints:he(1,4),priceIncrease:1,max:1,requiresResearch:"dieselRefinery"},{id:"qualityCenter",idNum:19,name:"Quality center",iconX:9,iconY:1,description:"Provides higher quality research",priceResearchPoints:he(2,4),priceIncrease:1,max:1,requiresResearch:"rocketComponents"},{id:"cleanEngines",idNum:12,name:"Clean engines",iconX:7,iconY:1,description:"Engine makers production will not produce waste",priceResearchPoints:he(1,4),priceIncrease:1,max:1,requiresResearch:"rocketComponents"},{id:"droneComponents",idNum:18,name:"Drone components",iconX:8,iconY:1,description:"Allows producing drones",priceResearchPoints:he(99,4),priceIncrease:1,max:1,requiresResearch:"rocketComponents"}],I=(p,e)=>p*Math.pow(10,e),xi={layout:[{name:"Conveyor",iconX:1,iconY:0,items:["packageSize"]},{name:"Research center",iconX:3,iconY:3,items:["analystCenterConvertMore","researchCenterBonus","researchCenterMaxStock"]},{name:"Garbage",iconX:2,iconY:3,items:["garbageRemoveAmount"]},{type:"break"},{type:"break"},{name:"Iron buyer",iconX:2,iconY:0,items:["ironBuyerBuyAmount"]},{name:"Coal buyer",iconX:5,iconY:0,items:["coalBuyerRunningCost","_","coalBuyerBuyAmount"]},{name:"Oil buyer",iconX:8,iconY:0,items:["oilBuyerRunningCost","_","oilBuyerBuyAmount"]},{name:"Gas buyer",iconX:0,iconY:3,items:["gasBuyerRunningCost","_","gasBuyerBuyAmount"]},{name:"Silicon buyer",iconX:1,iconY:1,items:["siliconBuyerRunningCost","_","siliconBuyerBuyAmount"]},{name:"Explosives buyer",iconX:7,iconY:1,items:["explosivesBuyerRunningCost","_","explosivesBuyerBuyAmount"]},{name:"Aluminium buyer",iconX:4,iconY:1,items:["aluminiumBuyerRunningCost","_","aluminiumBuyerBuyAmount"]},{type:"break"},{type:"break"},{name:"Iron foundry",iconX:3,iconY:0,items:["ironFoundryConvertAmount"]},{name:"Steel foundry",iconX:6,iconY:0,items:["steelFoundryConvertMoreAmount","_","steelFoundryRunningCost","_","steelFoundryConvertAmount"]},{name:"Plastic maker",iconX:9,iconY:0,items:["plasticMakerConvertMoreAmount","_","plasticMakerRunningCost","_","plasticMakerConvertAmount"]},{name:"Electronics maker",iconX:2,iconY:1,items:["electronicsMakerConvertMoreAmount","_","electronicsMakerRunningCost","_","electronicsMakerConvertAmount"]},{name:"Bullet maker",iconX:8,iconY:1,items:["bulletMakerRunningCost","_","bulletMakerConvertAmount"]},{name:"Gun maker",iconX:9,iconY:1,items:["gunMakerRunningCost","_","gunMakerConvertAmount"]},{name:"Engine maker",iconX:5,iconY:1,items:["engineMakerRunningCost","_","engineMakerConvertAmount"]},{name:"Tank hull maker",iconX:1,iconY:2,items:["tankHullMakerRunningCost","_","tankHullMakerConvertAmount"]},{name:"Tank turret maker",iconX:2,iconY:2,items:["tankTurretMakerRunningCost","_","tankTurretMakerConvertAmount"]},{name:"Tank assembler",iconX:3,iconY:2,items:["tankAssemblerRunningCost","_","tankAssemblerConvertAmount"]},{name:"Diesel refinery",iconX:5,iconY:2,items:["dieselRefineryRunningCost","_","dieselRefineryConvertAmount"]},{name:"Jet fuel refinery",iconX:1,iconY:3,items:["jetFuelRefineryRunningCost","_","jetFuelRefineryConvertAmount"]},{name:"Rocket hull maker",iconX:6,iconY:2,items:["rocketHullMakerRunningCost","_","rocketHullMakerConvertAmount"]},{name:"Rocket warhead maker",iconX:7,iconY:2,items:["rocketWarheadMakerRunningCost","_","rocketWarheadMakerConvertAmount"]},{name:"Rocket assembler",iconX:8,iconY:2,items:["rocketAssemblerRunningCost","_","rocketAssemblerConvertAmount"]},{type:"break"},{type:"break"},{name:"Iron seller",iconX:4,iconY:0,items:["ironSellerSellPrice","_","ironSellerSellAmount"]},{name:"Steel seller",iconX:7,iconY:0,items:["steelSellerSellPrice","steelSellerRunningCost","_","steelSellerSellAmount"]},{name:"Plastic seller",iconX:0,iconY:1,items:["plasticSellerSellPrice","plasticSellerRunningCost","_","plasticSellerSellAmount"]},{name:"Electronics seller",iconX:3,iconY:1,items:["electronicsSellerSellPrice","electronicsSellerRunningCost","_","electronicsSellerSellAmount"]},{name:"Gun seller",iconX:0,iconY:2,items:["gunSellerSellPrice","gunSellerRunningCost","_","gunSellerSellAmount"]},{name:"Engine seller",iconX:6,iconY:1,items:["engineSellerSellPrice","engineSellerRunningCost","_","engineSellerSellAmount"]},{name:"Tank seller",iconX:4,iconY:2,items:["tankSellerSellPrice","tankSellerRunningCost","_","tankSellerSellAmount"]}],upgrades:[{id:"packageSize",idNum:66,iconX:1,iconY:0,requiresResearch:"engineComponents",type:"packageSize",refund:.8,levels:[{price:I(1,12),bonus:1},{price:I(1,14),bonus:1},{price:I(1,16),bonus:1}]},{id:"ironBuyerBuyAmount",idNum:1,iconX:0,iconY:0,type:"buyer",componentId:"ironBuyer",refund:.8,noRunningCost:!0,levels:[{price:I(8,2),bonus:1},{price:I(8,3),bonus:2},{price:I(8,4),bonus:4},{price:I(5,5),bonus:4},{price:I(12,9),bonus:12},{price:I(1.5,11),bonus:12},{price:I(4,13),bonus:12},{price:I(60,13),bonus:16},{price:I(10,14),bonus:32}]},{id:"ironFoundryConvertAmount",idNum:2,iconX:1,iconY:0,type:"converter",componentId:"ironFoundry",refund:.8,noRunningCost:!0,levels:[{price:I(8,2),bonus:1},{price:I(8,4),bonus:2},{price:I(8,5),bonus:2},{price:I(7,9),bonus:6},{price:I(2,11),bonus:6},{price:I(6,13),bonus:6},{price:I(60,13),bonus:24},{price:I(20,14),bonus:48}]},{id:"ironSellerSellAmount",idNum:3,iconX:2,iconY:0,type:"sellerSellAmount",componentId:"ironSeller",refund:.8,noRunningCost:!0,levels:[{price:I(5,2),bonus:1},{price:I(2,3),bonus:2}]},{id:"ironSellerSellPrice",idNum:4,iconX:3,iconY:0,type:"sellerSellPrice",componentId:"ironSeller",levels:[{price:I(5,2),bonus:.25},{price:I(4,3),bonus:.25}]},{id:"coalBuyerBuyAmount",idNum:5,iconX:0,iconY:0,requiresResearch:"steelComponents",type:"buyer",componentId:"coalBuyer",refund:.8,levels:[{price:I(4,4),bonus:1},{price:I(18,5),bonus:2},{price:I(1,9),bonus:4},{price:I(6,9),bonus:4},{price:I(3,11),bonus:6},{price:I(12.5,13),bonus:6}]},{id:"steelFoundryConvertAmount",idNum:7,iconX:1,iconY:0,requiresResearch:"steelComponents",type:"converter",componentId:"steelFoundry",refund:.8,levels:[{price:I(15,4),bonus:1},{price:I(9,5),bonus:1},{price:I(6,11),bonus:3},{price:I(15,13),bonus:6},{price:I(25,14),bonus:12}]},{id:"steelFoundryConvertMoreAmount",idNum:64,iconX:1,iconY:0,requiresResearch:"engineComponents",type:"converterProduceMore",componentId:"steelFoundry",refund:.8,levels:[{price:I(4,11),bonus:1},{price:I(90,13),bonus:2}]},{id:"steelSellerSellAmount",idNum:9,iconX:2,iconY:0,requiresResearch:"steelComponents",type:"sellerSellAmount",componentId:"steelSeller",refund:.8,levels:[{price:I(5,4),bonus:1},{price:I(3,5),bonus:1}]},{id:"coalBuyerRunningCost",idNum:6,iconX:0,iconY:0,requiresResearch:"steelComponents",type:"runningCost",componentId:"coalBuyer",levels:[{price:I(2,4),bonus:.05},{price:I(9,4),bonus:.1}]},{id:"steelFoundryRunningCost",idNum:8,iconX:4,iconY:0,requiresResearch:"steelComponents",type:"runningCost",componentId:"steelFoundry",levels:[{price:I(3,4),bonus:.05},{price:I(1,5),bonus:.1}]},{id:"steelSellerRunningCost",idNum:11,iconX:4,iconY:0,requiresResearch:"steelComponents",type:"runningCost",componentId:"steelSeller",levels:[{price:I(10,4),bonus:.05},{price:I(50,4),bonus:.1}]},{id:"steelSellerSellPrice",idNum:10,iconX:3,iconY:0,requiresResearch:"steelComponents",type:"sellerSellPrice",componentId:"steelSeller",levels:[{price:I(9,4),bonus:.1},{price:I(4,5),bonus:.1}]},{id:"oilBuyerBuyAmount",idNum:12,iconX:0,iconY:0,requiresResearch:"plasticComponents",type:"buyer",componentId:"oilBuyer",refund:.8,levels:[{price:I(9,5),bonus:1},{price:I(3,8),bonus:6},{price:I(4,9),bonus:4},{price:I(3,11),bonus:12}]},{id:"gasBuyerBuyAmount",idNum:14,iconX:0,iconY:0,requiresResearch:"plasticComponents",type:"buyer",componentId:"gasBuyer",refund:.8,levels:[{price:I(1.2,6),bonus:1},{price:I(4,8),bonus:2},{price:I(8,8),bonus:4},{price:I(2,9),bonus:4},{price:I(2,11),bonus:12}]},{id:"plasticMakerConvertAmount",idNum:16,iconX:1,iconY:0,requiresResearch:"plasticComponents",type:"converter",componentId:"plasticMaker",refund:.8,levels:[{price:I(12,6),bonus:1},{price:I(5,9),bonus:1},{price:I(6,11),bonus:3}]},{id:"plasticMakerConvertMoreAmount",idNum:63,iconX:1,iconY:0,requiresResearch:"engineComponents",type:"converterProduceMore",componentId:"plasticMaker",refund:.8,levels:[{price:I(1,12),bonus:1}]},{id:"plasticSellerSellAmount",idNum:18,iconX:2,iconY:0,requiresResearch:"plasticComponents",type:"sellerSellAmount",componentId:"plasticSeller",refund:.8,levels:[{price:I(1.2,7),bonus:3},{price:I(9.5,9),bonus:2}]},{id:"oilBuyerRunningCost",idNum:13,iconX:4,iconY:0,requiresResearch:"plasticComponents",type:"runningCost",componentId:"oilBuyer",levels:[{price:I(6,5),bonus:.05},{price:I(5,8),bonus:.05}]},{id:"gasBuyerRunningCost",idNum:15,iconX:4,iconY:0,requiresResearch:"plasticComponents",type:"runningCost",componentId:"gasBuyer",levels:[{price:I(4,5),bonus:.05},{price:I(1,8),bonus:.1}]},{id:"plasticMakerRunningCost",idNum:17,iconX:4,iconY:0,requiresResearch:"plasticComponents",type:"runningCost",componentId:"plasticMaker",levels:[{price:I(9,5),bonus:.05},{price:I(6,8),bonus:.1}]},{id:"plasticSellerRunningCost",idNum:20,iconX:4,iconY:0,requiresResearch:"plasticComponents",type:"runningCost",componentId:"plasticSeller",levels:[{price:I(7,5),bonus:.05},{price:I(3,8),bonus:.05}]},{id:"plasticSellerSellPrice",idNum:19,iconX:3,iconY:0,requiresResearch:"plasticComponents",type:"sellerSellPrice",componentId:"plasticSeller",levels:[{price:I(9,6),bonus:.1},{price:I(1,9),bonus:.05}]},{id:"siliconBuyerBuyAmount",idNum:21,iconX:0,iconY:0,requiresResearch:"electronicsComponents",type:"buyer",componentId:"siliconBuyer",refund:.8,levels:[{price:I(8,8),bonus:1},{price:I(1,9),bonus:1},{price:I(5,11),bonus:3},{price:I(3,13),bonus:6}]},{id:"electronicsMakerConvertAmount",idNum:23,iconX:1,iconY:0,requiresResearch:"electronicsComponents",type:"converter",componentId:"electronicsMaker",refund:.8,levels:[{price:I(4,8),bonus:1},{price:I(3,9),bonus:1}]},{id:"electronicsMakerConvertMoreAmount",idNum:65,iconX:1,iconY:0,requiresResearch:"engineComponents",type:"converterProduceMore",componentId:"electronicsMaker",refund:.8,levels:[{price:I(1.5,12),bonus:1}]},{id:"electronicsSellerSellAmount",idNum:25,iconX:2,iconY:0,requiresResearch:"electronicsComponents",type:"sellerSellAmount",componentId:"electronicsSeller",refund:.8,levels:[{price:I(2,8),bonus:1},{price:I(2,9),bonus:1}]},{id:"siliconBuyerRunningCost",idNum:22,iconX:4,iconY:0,requiresResearch:"electronicsComponents",type:"runningCost",componentId:"siliconBuyer",levels:[{price:I(8,8),bonus:.05}]},{id:"electronicsMakerRunningCost",idNum:24,iconX:4,iconY:0,requiresResearch:"electronicsComponents",type:"runningCost",componentId:"electronicsMaker",levels:[{price:I(8,8),bonus:.05}]},{id:"electronicsSellerRunningCost",idNum:26,iconX:4,iconY:0,requiresResearch:"electronicsComponents",type:"runningCost",componentId:"electronicsSeller",levels:[{price:I(12,8),bonus:.05}]},{id:"electronicsSellerSellPrice",idNum:27,iconX:3,iconY:0,requiresResearch:"electronicsComponents",type:"sellerSellPrice",componentId:"electronicsSeller",levels:[{price:I(2,8),bonus:.05},{price:I(4,8),bonus:.05},{price:I(6,8),bonus:.05},{price:I(1,10),bonus:.05}]},{id:"explosivesBuyerBuyAmount",idNum:35,iconX:0,iconY:0,requiresResearch:"gunComponents",type:"buyer",componentId:"explosivesBuyer",refund:.8,levels:[{price:I(99,9),bonus:1},{price:I(500,9),bonus:2},{price:I(80,13),bonus:4},{price:I(120,14),bonus:8}]},{id:"bulletMakerConvertAmount",idNum:37,iconX:1,iconY:0,requiresResearch:"gunComponents",type:"converter",componentId:"bulletMaker",refund:.8,levels:[{price:I(220,9),bonus:1},{price:I(600,9),bonus:2},{price:I(35,13),bonus:4}]},{id:"gunMakerConvertAmount",idNum:39,iconX:1,iconY:0,requiresResearch:"gunComponents",type:"converter",componentId:"gunMaker",refund:.8,levels:[{price:I(450,9),bonus:1},{price:I(250,10),bonus:6},{price:I(90,13),bonus:8}]},{id:"gunSellerSellAmount",idNum:41,iconX:2,iconY:0,requiresResearch:"gunComponents",type:"sellerSellAmount",componentId:"gunSeller",refund:.8,levels:[{price:I(120,9),bonus:1}]},{id:"explosivesBuyerRunningCost",idNum:36,iconX:4,iconY:0,requiresResearch:"gunComponents",type:"runningCost",componentId:"explosivesBuyer",levels:[{price:I(15,9),bonus:.05}]},{id:"bulletMakerRunningCost",idNum:38,iconX:4,iconY:0,requiresResearch:"gunComponents",type:"runningCost",componentId:"bulletMaker",levels:[{price:I(20,9),bonus:.1}]},{id:"gunMakerRunningCost",idNum:40,iconX:4,iconY:0,requiresResearch:"gunComponents",type:"runningCost",componentId:"gunMaker",levels:[{price:I(25,9),bonus:.1}]},{id:"gunSellerRunningCost",idNum:42,iconX:4,iconY:0,requiresResearch:"gunComponents",type:"runningCost",componentId:"gunSeller",levels:[{price:I(15,9),bonus:.1}]},{id:"gunSellerSellPrice",idNum:43,iconX:3,iconY:0,requiresResearch:"gunComponents",type:"sellerSellPrice",componentId:"gunSeller",levels:[{price:I(15,9),bonus:.05}]},{id:"aluminiumBuyerBuyAmount",idNum:28,iconX:0,iconY:0,requiresResearch:"engineComponents",type:"buyer",componentId:"aluminiumBuyer",refund:.8,levels:[{price:I(300,9),bonus:1},{price:I(600,9),bonus:2},{price:I(150,10),bonus:4},{price:I(1,14),bonus:24},{price:I(60,14),bonus:32}]},{id:"engineMakerConvertAmount",idNum:30,iconX:1,iconY:0,requiresResearch:"engineComponents",type:"converter",componentId:"engineMaker",refund:.8,levels:[{price:I(1300,9),bonus:1},{price:I(40,14),bonus:2}]},{id:"engineSellerSellAmount",idNum:32,iconX:2,iconY:0,requiresResearch:"engineComponents",type:"sellerSellAmount",componentId:"engineSeller",refund:.8,levels:[{price:I(800,9),bonus:1}]},{id:"aluminiumBuyerRunningCost",idNum:29,iconX:4,iconY:0,requiresResearch:"engineComponents",type:"runningCost",componentId:"aluminiumBuyer",levels:[{price:I(150,9),bonus:.05},{price:I(450,9),bonus:.05}]},{id:"engineMakerRunningCost",idNum:31,iconX:4,iconY:0,requiresResearch:"engineComponents",type:"runningCost",componentId:"engineMaker",levels:[{price:I(100,9),bonus:.1},{price:I(200,9),bonus:.1}]},{id:"engineSellerRunningCost",idNum:33,iconX:4,iconY:0,requiresResearch:"engineComponents",type:"runningCost",componentId:"engineSeller",levels:[{price:I(50,9),bonus:.1},{price:I(150,9),bonus:.1}]},{id:"engineSellerSellPrice",idNum:34,iconX:3,iconY:0,requiresResearch:"engineComponents",type:"sellerSellPrice",componentId:"engineSeller",levels:[{price:I(150,9),bonus:.05},{price:I(250,9),bonus:.05},{price:I(450,9),bonus:.05}]},{id:"tankHullMakerConvertAmount",idNum:44,iconX:1,iconY:0,requiresResearch:"tankComponents",type:"converter",componentId:"tankHullMaker",refund:.8,levels:[{price:I(600,9),bonus:3},{price:I(150,10),bonus:4}]},{id:"tankTurretMakerConvertAmount",idNum:46,iconX:1,iconY:0,requiresResearch:"tankComponents",type:"converter",componentId:"tankTurretMaker",refund:.8,levels:[{price:I(450,9),bonus:3},{price:I(100,10),bonus:4}]},{id:"tankAssemblerConvertAmount",idNum:48,iconX:1,iconY:0,requiresResearch:"tankComponents",type:"converter",componentId:"tankAssembler",refund:.8,levels:[{price:I(300,9),bonus:1},{price:I(200,10),bonus:2}]},{id:"tankSellerSellAmount",idNum:50,iconX:2,iconY:0,requiresResearch:"tankComponents",type:"sellerSellAmount",componentId:"tankSeller",refund:.8,levels:[{price:I(400,9),bonus:3},{price:I(620,10),bonus:4}]},{id:"tankHullMakerRunningCost",idNum:45,iconX:4,iconY:0,requiresResearch:"tankComponents",type:"runningCost",componentId:"tankHullMaker",levels:[{price:I(400,9),bonus:.05},{price:I(200,10),bonus:.05}]},{id:"tankTurretMakerRunningCost",idNum:47,iconX:4,iconY:0,requiresResearch:"tankComponents",type:"runningCost",componentId:"tankTurretMaker",levels:[{price:I(300,9),bonus:.05},{price:I(200,10),bonus:.05}]},{id:"tankAssemblerRunningCost",idNum:49,iconX:4,iconY:0,requiresResearch:"tankComponents",type:"runningCost",componentId:"tankAssembler",levels:[{price:I(500,9),bonus:.05},{price:I(100,10),bonus:.05}]},{id:"tankSellerRunningCost",idNum:51,iconX:4,iconY:0,requiresResearch:"tankComponents",type:"runningCost",componentId:"tankSeller",levels:[{price:I(350,9),bonus:.05},{price:I(150,10),bonus:.05}]},{id:"tankSellerSellPrice",idNum:52,iconX:3,iconY:0,requiresResearch:"tankComponents",type:"sellerSellPrice",componentId:"tankSeller",levels:[{price:I(400,9),bonus:.1},{price:I(240,10),bonus:.1}]},{id:"dieselRefineryConvertAmount",idNum:53,iconX:1,iconY:0,requiresResearch:"dieselRefinery",type:"converter",componentId:"dieselRefinery",refund:.8,levels:[{price:I(700,9),bonus:1}]},{id:"dieselRefineryRunningCost",idNum:54,iconX:4,iconY:0,requiresResearch:"dieselRefinery",type:"runningCost",componentId:"dieselRefinery",levels:[{price:I(900,9),bonus:.05}]},{id:"jetFuelRefineryConvertAmount",idNum:55,iconX:1,iconY:0,requiresResearch:"rocketComponents",type:"converter",componentId:"jetFuelRefinery",refund:.8,levels:[{price:I(100,10),bonus:1}]},{id:"rocketHullMakerConvertAmount",idNum:57,iconX:1,iconY:0,requiresResearch:"rocketComponents",type:"converter",componentId:"rocketHullMaker",refund:.8,levels:[{price:I(150,10),bonus:1}]},{id:"rocketWarheadMakerConvertAmount",idNum:59,iconX:1,iconY:0,requiresResearch:"rocketComponents",type:"converter",componentId:"rocketWarheadMaker",refund:.8,levels:[{price:I(200,10),bonus:1}]},{id:"rocketAssemblerConvertAmount",idNum:61,iconX:1,iconY:0,requiresResearch:"rocketComponents",type:"converter",componentId:"rocketAssembler",refund:.8,levels:[{price:I(250,10),bonus:1}]},{id:"jetFuelRefineryRunningCost",idNum:56,iconX:4,iconY:0,requiresResearch:"rocketComponents",type:"runningCost",componentId:"jetFuelRefinery",levels:[{price:I(300,10),bonus:.05}]},{id:"rocketHullMakerRunningCost",idNum:58,iconX:4,iconY:0,requiresResearch:"rocketComponents",type:"runningCost",componentId:"rocketHullMaker",levels:[{price:I(350,10),bonus:.05}]},{id:"rocketWarheadMakerRunningCost",idNum:60,iconX:4,iconY:0,requiresResearch:"rocketComponents",type:"runningCost",componentId:"rocketWarheadMaker",levels:[{price:I(250,10),bonus:.05}]},{id:"rocketAssemblerRunningCost",idNum:62,iconX:4,iconY:0,requiresResearch:"rocketComponents",type:"runningCost",componentId:"rocketAssembler",levels:[{price:I(300,10),bonus:.05}]},{id:"garbageRemoveAmount",idNum:99,iconX:5,iconY:0,description:"",requiresResearch:"metalsLab",type:"garbage",componentId:"garbageCollector",levels:[{price:I(5,4),bonus:1},{price:I(3,9),bonus:2}]},{id:"researchCenterBonus",idNum:100,iconX:6,iconY:0,description:"researchCenter",requiresResearch:"metalsLab",type:"researchCenterBonus",componentId:"researchCenter",levels:[{price:I(5,5),bonus:.1},{price:I(5,7),bonus:.2},{price:I(5,8),bonus:.2},{price:I(1.1,10),bonus:.25},{price:I(2.8,10),bonus:.25},{price:I(1.2,11),bonus:.5},{price:I(9.4,11),bonus:.5},{price:I(200,12),bonus:1.5},{price:I(100,13),bonus:1.5},{price:I(10,14),bonus:6}]},{id:"researchCenterMaxStock",idNum:101,iconX:7,iconY:0,description:"Research center max papers",requiresResearch:"metalsLab",type:"researchCenterMaxStock",componentId:"researchCenter",levels:[{price:I(5,5),bonus:1},{price:I(1,8),bonus:1},{price:I(1,9),bonus:1},{price:I(3,9),bonus:2},{price:I(9,9),bonus:2},{price:I(4,11),bonus:4},{price:I(5,13),bonus:3},{price:I(6,14),bonus:5}]},{id:"analystCenterConvertMore",idNum:102,iconX:1,iconY:0,requiresResearch:"engineComponents",type:"converterProduceMore",componentId:"analystCenter",refund:.8,levels:[{price:I(2,11),bonus:1},{price:I(400,13),bonus:2}]}]};class go{static generateAll(){const e=[{id:"makingProfit",idNum:0,name:"Making profit!",spriteX:3,spriteY:0,bonus:{type:"custom",description:"Unlocks research"},tests:[{type:"avgMoneyIncome",amount:1.4}]},{id:"collectingCash",idNum:1,name:"Collecting some cash",spriteX:2,spriteY:0,bonus:{type:"custom",description:"Unlocks extras"},tests:[{type:"amountOfMoney",amount:25e3}]},{id:"gettingSmarter",idNum:2,name:"Getting smarter",spriteX:2,spriteY:0,bonus:{type:"custom",description:"Unlocks upgrades"},tests:[{type:"researched",researchId:"researchCenter"}]}];for(let t=1;t<=20;t++)e.push({id:`money${t}`,idNum:2+t,name:"Getting money",spriteX:2,spriteY:0,requiresAchievement:t>1?`money${t-1}`:null,bonus:{type:"money",amount:250*Math.pow(10,t)},tests:[{type:"amountOfMoney",amount:1e3*Math.pow(10,t)}]});return e}}const fo=go.generateAll(),yo={id:0,name:"Main idle",version:1,startingMoney:2e3,minNegativeMoney:-1e4,startingResearchPoints:1,maxBonusTicks:7200,minBonusTicks:50,offlineSlower:5,incentivizedAdBonusTicks:1e3,resources:po,components:at.components,componentsSelection:at.selection,productionTree:at.productionTree,factories:mo,research:Xo,upgrades:xi.upgrades,upgradesLayout:xi.layout,achievements:fo};class vo{static prepareMeta(e){const t=r=>{if(!r)throw new Error("buildLookup called with null/undefined");if(!Array.isArray(r))throw new Error(`buildLookup expected array but got ${typeof r}:`,r);const i={},s=[];for(const o of r){if(i[o.id])throw new Error(`Duplicate id: ${o.id}`);if(s[o.idNum])throw new Error(`Duplicate idNum: ${o.idNum}`);i[o.id]=o,s[o.idNum]=o}return{byId:i,byIdNum:s}};if(e.components&&({byId:e.componentsById,byIdNum:e.componentsByIdNum}=t(e.components)),e.factories){({byId:e.factoriesById,byIdNum:e.factoriesByIdNum}=t(e.factories));for(const r of e.factories)if(r.areas){({byId:r.areasById,byIdNum:r.areasByIdNum}=t(r.areas));for(const i of r.areas)if(i.locations)for(const s of i.locations)s.width=s.x2-s.x+1,s.height=s.y2-s.y+1}}return e.resources&&({byId:e.resourcesById,byIdNum:e.resourcesByIdNum}=t(e.resources)),e.research&&({byId:e.researchById,byIdNum:e.researchByIdNum}=t(e.research)),e.upgrades&&({byId:e.upgradesById,byIdNum:e.upgradesByIdNum}=t(e.upgrades)),e.achievements&&({byId:e.achievementsById,byIdNum:e.achievementsByIdNum}=t(e.achievements)),e}}const Se={main:vo.prepareMeta(yo),productsLayout:xr.layout,products:xr.items,timeTravelTicketValue:xr.timeTravelTicketValue};Se.productsById={};Se.productsByIdNum=[];for(const p of Se.products){if(Se.productsById[p.id])throw new Error(`Purchase with id ${p.id} already exists!`);if(Se.productsByIdNum[p.idNum])throw new Error(`Purchase with idNum ${p.idNum} already exists!`);Se.productsById[p.id]=p,Se.productsByIdNum[p.idNum]=p}const qe={userHash:{key:"FactoryIdleUserHash"},imageMap:{path:"img/",files:{yellowSelection:"mouse/yellow.png",greenSelection:"mouse/green.png",redSelection:"mouse/red.png",blueSelection:"mouse/selected.png",cantPlace:"mouse/cantPlace.png",terrains:"terrains.png",components:"components.png",componentIcons:"componentIcons.png",transportLine:"transportLine.png",resources:"resources.png"}},api:{server:{url:"/api/games"},armorGames:{gameKey:""},local:{storageKey:"FactoryIdleLocal"}},saveManager:{cloudSaveIntervalMs:9e5,localSaveIntervalMs:5e3},meta:{...Se,warnToStoreUserHashAfterTicks:{1e4:!0,1e5:!0,1e6:!0}}};class Vr{constructor(e=0,t=0){typeof e=="number"?(this.buffer=e>>>0,this.length=t||8):(this.buffer=0,this.length=0)}writeAll(...e){for(let t=0;t<8;t++)this.writeBoolean(e[t]);return this}writeBoolean(e){return this.buffer<<=1,this.buffer|=e?1:0,this.length++,this}fillZero(){for(;this.length<8;)this.writeBoolean(0)}readBoolean(){const e=this.buffer&1;return this.buffer>>=1,!!e}getValue(){return this.buffer}reverse(){const e=[];for(let t=0;t<8;t++)e.push(this.readBoolean());for(let t=0;t<8;t++)this.writeBoolean(e[t]);return this}toString(){return this.buffer.toString()}}const Lt={top:"bottom",bottom:"top",left:"right",right:"left"},Nt=["top","right","bottom","left"];class bo{tile;changedCallback;inputsByDirection={};outputsByDirection={};inputsList=[];outputsList=[];constructor(e,t){this.tile=e,this.changedCallback=t,Nt.forEach(r=>{this.inputsByDirection[r]=null,this.outputsByDirection[r]=null}),this.reset()}reset(){Nt.forEach(e=>{this.clearInput(e),this.clearOutput(e)})}setInput(e){if(!this.inputsByDirection[e]){this.clearOutput(e);const t=this.tile.getTileInDirection(e);if(!t)return;this.inputsByDirection[e]=t,this._updateInputOutputLists(),t.getInputOutputManager().setOutput(Lt[e]),this.changedCallback()}}setOutput(e){if(!this.outputsByDirection[e]){this.clearInput(e);const t=this.tile.getTileInDirection(e);if(!t)return;this.outputsByDirection[e]=t,this._updateInputOutputLists(),t.getInputOutputManager().setInput(Lt[e]),this.changedCallback()}}clearInput(e){const t=this.inputsByDirection[e];t&&(this.inputsByDirection[e]=null,t.getInputOutputManager().clearOutput(Lt[e]),this._updateInputOutputLists(),this.changedCallback())}clearOutput(e){const t=this.outputsByDirection[e];t&&(this.outputsByDirection[e]=null,t.getInputOutputManager().clearInput(Lt[e]),this._updateInputOutputLists(),this.changedCallback())}_updateInputOutputLists(){this.inputsList=Nt.map(e=>this.inputsByDirection[e]).filter(Boolean),this.outputsList=Nt.map(e=>this.outputsByDirection[e]).filter(Boolean)}getInputsList(){return this.inputsList}getInputsByDirection(){return this.inputsByDirection}getOutputsList(){return this.outputsList}getOutputsByDirection(){return this.outputsByDirection}exportToWriter(e){const t=new Vr;t.writeAll(this.inputsByDirection.top,this.inputsByDirection.right,this.inputsByDirection.bottom,this.inputsByDirection.left,this.outputsByDirection.top,this.outputsByDirection.right,this.outputsByDirection.bottom,this.outputsByDirection.left),e.writeBooleanMap(t)}importFromReader(e){const t=e.readBooleanMap();t.readBoolean()&&this.setInput("top"),t.readBoolean()&&this.setInput("right"),t.readBoolean()&&this.setInput("bottom"),t.readBoolean()&&this.setInput("left"),t.readBoolean()&&this.setOutput("top"),t.readBoolean()&&this.setOutput("right"),t.readBoolean()&&this.setOutput("bottom"),t.readBoolean()&&this.setOutput("left")}}class yr{constructor(e,t){this.component=e,this.inputResources=t,this.reset()}reset(){this.resources={},this.inputTileIndex=[];for(const e in this.inputResources)this.resources[e]=0,this.inputTileIndex.push({resource:e,offset:0})}updateWithDescriptionData(e){e.stock||(e.stock=[]);const t=this.component.getFactory().getGame().getMeta().resourcesById;for(const r in this.inputResources){const i=this.inputResources[r];let s=!0;i.requiresResearch&&(s=this.component.getFactory().getGame().getResearchManager().getResearch(i.requiresResearch)>0),s&&e.stock.push({resourceId:r,resourceName:t[r].nameShort,amount:this.resources[r],max:this.getMax(r)})}}getMax(e){const t=this.component.getMeta(),r=this.component.getFactory().getUpgradesManager().getComponentBonuses(t.applyUpgradesFrom??t.id);return this.inputResources[e].max*r.maxStorageBonus}takeIn(){const e=this.component.getSurroundedInputTiles();for(const t of this.inputTileIndex){const r=t.resource;let i=t.offset;for(let s=0;s<e.length&&this.resources[r]<this.getMax(r);s++){const o=e[(i+s)%e.length],u=o.tile.getComponent().getStrategy().getOutputQueue(o.direction),l=u.getLast();l&&l.getResourceId()===r&&(u.unsetLast(),i=(i+s+1)%e.length,this.resources[r]+=l.getAmount())}t.offset=i}for(const t of e)t.tile.getComponent().getStrategy().getOutputQueue(t.direction).forward()}addResource(e,t){this.resources[e]+=t}getResource(e){return this.resources[e]}toString(){let e="IN<br />";for(const t of this.inputTileIndex)e+=`${t.resource}: ${this.resources[t.resource]} (offset:${t.offset})<br />`;return e}exportToWriter(e){e.writeUint8(this.inputTileIndex.length);for(const t of this.inputTileIndex)e.writeUint32(this.resources[t.resource]),e.writeUint8(t.offset)}importFromReader(e){const t=Math.min(this.inputTileIndex.length,e.readUint8());for(let r=0;r<t;r++)this.resources[this.inputTileIndex[r].resource]=e.readUint32(),this.inputTileIndex[r].offset=e.readUint8()}}let Br=[];class be{constructor(e,t,r){if(!r)throw new Error("Missing argument factory");this.resourceId=e,this.meta=r.getGame().getMeta().resourcesById[e],this.offset=Math.round(4*Math.random())-2,this.amount=t}static getNew(e,t,r){return Br.length>0?Br.pop():new be(e,t,r)}static free(e){Br.push(e)}getResourceId(){return this.resourceId}getResourceIdNum(){return this.meta.idNum}getOffset(){return this.offset}getAmount(){return this.amount}toString(){return this.resourceId}static staticExportData(e,t){e?(t.writeUint8(e.getResourceIdNum()),t.writeUint8(e.getAmount())):t.writeUint8(0)}static createFromExport(e,t,r){const i=t.readUint8();if(i===0)return null;const o=(r===void 0?6:Number(r))>=6?t.readUint8():1,u=e.getGame().getMeta().resourcesByIdNum[i];return u?be.getNew(u.id,o,e):null}}class Ze{constructor(e,t,r){this.component=e,this.handledResources=t,this.outputResourcesOrder=r,this.reset()}reset(){this.resources={};for(const e of this.outputResourcesOrder)this.resources[e]=0;this.outResourceSelectionIndex=0,this.distributeTileIndex=0}updateWithDescriptionData(e){e.stock||=[];const t=this.component.getFactory().getGame().getMeta().resourcesById;for(const r in this.resources)e.stock.push({resourceId:r,resourceName:t[r].nameShort,amount:this.resources[r],max:this.getMax(r)})}getMax(e){const t=this.component.getMeta(),r=this.component.getFactory().getUpgradesManager().getComponentBonuses(t.applyUpgradesFrom??t.id);return this.handledResources[e].max*r.maxStorageBonus}static getMetaOutputAmount(e,t){return 1+t.getUpgradesManager().getBonuses().packageSizeBonus+t.getUpgradesManager().getComponentBonuses(e.id).packageSizeBonus}getOutputAmount(){return Ze.getMetaOutputAmount(this.component.getMeta(),this.component.getFactory())}distribute(){const e=this.component.getSurroundedOutputTiles();for(let t=0;t<e.length;t++){const r=this._getNextOutputResource();if(!r)break;const i=e[this.distributeTileIndex];this.distributeTileIndex=(this.distributeTileIndex+1)%e.length;const s=i.tile.getComponent().getStrategy().getInputQueue(i.oppositeDirection);if(!s.getFirst()){const o=this.getOutputAmount();s.setFirst(new be(r,o,this.component.getFactory())),this.resources[r]-=o,this.outResourceSelectionIndex=(this.outResourceSelectionIndex+1)%this.outputResourcesOrder.length}}}_getNextOutputResource(){for(let e=0;e<this.outputResourcesOrder.length;e++){const t=this.outputResourcesOrder[(this.outResourceSelectionIndex+e)%this.outputResourcesOrder.length];if(this.resources[t]>=this.getOutputAmount())return t}return this.outResourceSelectionIndex=0,null}addResource(e,t){this.resources[e]+=t}getResource(e){return this.resources[e]}toString(){let e=`OUT outIndex:${this.distributeTileIndex} resIndex:${this.outResourceSelectionIndex}<br />`;for(const t in this.resources)e+=`${t}: ${this.resources[t]}<br />`;return e}exportToWriter(e){const t=Object.keys(this.resources).length;e.writeUint8(t);for(const r in this.resources)e.writeUint32(this.resources[r]);e.writeUint8(this.outResourceSelectionIndex),e.writeUint8(this.distributeTileIndex)}importFromReader(e){const t=e.readUint8(),r=Object.keys(this.resources);for(let i=0;i<t;i++)this.resources[r[i]]=e.readUint32();this.outResourceSelectionIndex=e.readUint8(),this.distributeTileIndex=e.readUint8()}}class et{constructor(e){this.interval=e,this.calculateEfficiencyInterval=50,this.reset()}reset(){this.timer=0,this.efficiency=null,this.workingTime=0,this.totalTime=0}updateWithDescriptionData(e){e.effectivenessStr=this.efficiency!==null?`${Math.round(this.efficiency)}%`:"-"}canStart(){throw new Error("canStart method should be overwritten")}start(){throw new Error("start method should be overwritten")}finished(){throw new Error("finished method should be overwritten")}getEfficiency(){return this.efficiency}calculate(e){this.timer>0&&(this.timer>=this.interval&&(this.finished(e),this.timer=-1),this.timer++),this.timer===0&&this.canStart()&&(this.start(e),this.timer=1),this.totalTime>=this.calculateEfficiencyInterval&&(this.efficiency=Math.round(100*this.workingTime/this.totalTime),this.totalTime=0,this.workingTime=0),this.totalTime++,this.timer>0&&this.workingTime++}toString(){let e="PRODUCTION<br />";return e+=`Efficiency: ${this.efficiency===null?"...":this.efficiency+"%"}<br />`,e+=this.timer===0?"Idle<br />":`${this.timer}/${this.interval}<br />`,e}exportToWriter(e){e.writeUint8(this.timer)}importFromReader(e){this.timer=e.readUint8()}}function vt(p){return!Array.isArray(p)||p.length===0?"":p.length===1?p[0]:p.length===2?`${p[0]} and ${p[1]}`:`${p.slice(0,-1).join(", ")} and ${p[p.length-1]}`}function ct(p){return!p||typeof p!="string"?"":p.charAt(0).toLowerCase()+p.slice(1)}class Be{constructor(e,t){this.component=e,this.meta=t,this.inResourcesManager=new yr(e,t.inputResources,t.production),this.outResourcesManager=new Ze(e,t.production,t.outputResourcesOrder),this.producer=new et(t.interval),this.producer.canStart=this.canStartProduction.bind(this),this.producer.start=this.startProduction.bind(this),this.producer.finished=this.finishedProduction.bind(this)}clearContents(){this.inResourcesManager.reset(),this.outResourcesManager.reset(),this.producer.reset()}static getMetaUseAmount(e,t,r){const i=e.strategy.inputResources[t].perOutputResource,s=r.getUpgradesManager().getComponentBonuses(e.id).convertAmountBonus;return i*s}getUseAmount(e){return Be.getMetaUseAmount(this.component.getMeta(),e,this.component.getFactory())}static getMetaProduceAmount(e,t,r){const i=e.strategy.production[t],s=r.getUpgradesManager().getComponentBonuses(e.id);return i.amount*s.convertAmountBonus*s.convertProduceMoreBonus}getProduceAmount(e){return Be.getMetaProduceAmount(this.component.getMeta(),e,this.component.getFactory())}static isProducing(e,t,r){return!t.productionRemoveResearch||!t.productionRemoveResearch[r]||!e.getResearchManager().getResearch(t.productionRemoveResearch[r])}static getMetaDescriptionData(e,t,r){const i=e.strategy,s=t.getGame().getMeta().resourcesById,o=Object.keys(i.inputResources).map(h=>`<span class='${h}'><b>${Be.getMetaUseAmount(e,h,t)}</b> ${ct(s[h].name)}</span>`);let u=0;const l=Object.keys(i.production).filter(h=>Be.isProducing(t.getGame(),i,h)).map(h=>{const f=Be.getMetaProduceAmount(e,h,t);return u=Math.max(u,f),`<span class='${h}'><b>${f}</b> ${ct(s[h].name)}</span>`}),m=[];return{interval:i.interval,inputStr:vt(o),outputStr:vt(l),storageStr:vt(m),noOfOutputs:Math.ceil(u/i.interval/Ze.getMetaOutputAmount(e,t))}}getDescriptionData(){const e=Be.getMetaDescriptionData(this.component.getMeta(),this.component.getFactory(),this);return this.producer.updateWithDescriptionData(e),this.inResourcesManager.updateWithDescriptionData(e),this.outResourcesManager.updateWithDescriptionData(e),e}calculateInputTick(){this.inResourcesManager.takeIn()}calculateOutputTick(){this.producer.calculate(),this.outResourcesManager.distribute()}canStartProduction(){for(const e in this.meta.inputResources)if(this.inResourcesManager.getResource(e)<this.getUseAmount(e))return!1;for(const e in this.meta.production)if(this.outResourcesManager.getResource(e)+this.getProduceAmount(e)>this.outResourcesManager.getMax(e))return!1;return!0}startProduction(){for(const e in this.meta.inputResources)this.inResourcesManager.addResource(e,-this.getUseAmount(e))}finishedProduction(){for(const e in this.meta.production)Be.isProducing(this.component.getFactory().getGame(),this.meta,e)&&this.outResourcesManager.addResource(e,this.getProduceAmount(e))}toString(){return`${this.inResourcesManager.toString()}<br />${this.outResourcesManager.toString()}<br />${this.producer.toString()}<br />`}exportToWriter(e){this.outResourcesManager.exportToWriter(e),this.inResourcesManager.exportToWriter(e),this.producer.exportToWriter(e)}importFromReader(e,t){this.outResourcesManager.importFromReader(e,t),this.inResourcesManager.importFromReader(e,t),this.producer.importFromReader(e,t)}}const Bi={6:" million",9:" billion",12:" trillion",15:" quadrillion",18:" quintillion",21:" sextillion",24:" septillion",27:" octillion",30:" nonillion",33:" decillion",36:" undecillion",39:" duodecillion",42:" tredecillion",45:" quattuordecillion",48:" quindecillion",51:" sexdecillion",54:" septendecillion",57:" octodecillion",60:" novemdecillion",63:" vigintillion"},K={format(p){if(p===void 0)return"?";const e=Math.abs(p);if(e<10)return Math.round(p*100)/100;if(e<1e3)return Math.round(p*10)/10;if(e<1e6)return Number(p).toFixed(0).replace(/\d(?=(\d{3})+$)/g,"$& ");let t=p.toString().split("e+",2),r=Number(t[0]);const i=r<0?2:1;let s=3*Math.floor((Math.abs(Math.round(r)).toString().length-i)/3),o=s+(t[1]?Number(t[1]):0);const u=o%3;return r*=Math.pow(10,u-s),o-=u,Math.round(100*r)/100+(Bi[o]?Bi[o]:"e"+o)},formatNumber(p){return this.format(p)},formatNumberPlus(p){return(p>0?"+":"")+this.format(p)},test(){const p={1:"1",10:"10",10.5:"10.5",100:"100",100.5:"100.5",1e3:"1 000",1000.5:"1 001",1234.5:"1 235",12134523451212334e8:"1.21 septillion",14860535876960295e9:"14.86 septillion"};for(const e in p){const t=this.nf(Number(e));t===p[e]?console.log(`${e} == ${t}`):console.error(`${e} != ${t}`);const r=this.nf(-Number(e));r==="-"+p[e]?console.log(`-${e} == ${r}`):console.error(`-${e} != ${r}`)}}};class Ke{constructor(e,t){this.component=e,this.meta=t,this.game=e.getFactory().getGame(),this.inResourcesManager=new yr(e,t.resources),this.producer=new et(t.interval),this.producer.canStart=this.canStartSaleProcess.bind(this),this.producer.start=this.startSale.bind(this),this.producer.finished=this.finishSale.bind(this)}clearContents(){this.inResourcesManager.reset(),this.producer.reset()}static getMetaSellAmount(e,t,r){const i=e.strategy.resources[t].amount,s=r.getUpgradesManager().getComponentBonuses(e.id).sellAmountBonus;return i*s}getSellAmount(e){return Ke.getMetaSellAmount(this.component.getMeta(),e,this.component.getFactory())}static getMetaSellPrice(e,t,r){const i=e.strategy.resources[t],s=i.sellPrice*(1+i.sellMargin),o=r.getUpgradesManager().getComponentBonuses(e.id).sellPriceBonus;return s*o*r.getGame().getProfitMultiplier()}getSellPrice(e){return Ke.getMetaSellPrice(this.component.getMeta(),e,this.component.getFactory())}static getMetaDescriptionData(e,t){const r=e.strategy,i=[],s=[];let o=0;const u=t.getGame().getMeta().resourcesById;for(const l in r.resources){const m=r.resources[l],h=Ke.getMetaSellAmount(e,l,t),f=h*Ke.getMetaSellPrice(e,l,t);let c=!0;m.requiresResearch&&(c=t.getGame().getResearchManager().getResearch(m.requiresResearch)>0),m.bonus?c&&s.push(`<span class='${l}'><b>${h}</b> ${ct(u[l].name)}</span> adds <b class='money'>$${K.formatNumber(f)}</b>`):(o+=f,i.push(`<span class='${l}'><b>${h}</b> ${ct(u[l].name)}</span>`))}return{isSeller:!0,interval:r.interval,sellPrice:K.formatNumber(o),sellStr:vt(i),bonusStr:s.join(", ")}}getDescriptionData(){const e=Ke.getMetaDescriptionData(this.component.getMeta(),this.component.getFactory());return this.producer.updateWithDescriptionData(e),this.inResourcesManager.updateWithDescriptionData(e),e}calculateInputTick(e){this.inResourcesManager.takeIn(),this.producer.calculate(e)}canStartSaleProcess(){for(const e in this.meta.resources)if(!this.meta.resources[e].bonus&&this.inResourcesManager.getResource(e)<this.getSellAmount(e))return!1;return!0}startSale(e){}finishSale(e){for(const t in this.meta.resources){const r=this.getSellAmount(t);this.inResourcesManager.getResource(t)>=r&&(this.inResourcesManager.addResource(t,-r),e.resourceSales+=r*this.getSellPrice(t))}}toString(){return`${this.inResourcesManager.toString()}<br />${this.producer.toString()}<br />`}exportToWriter(e){this.inResourcesManager.exportToWriter(e),this.producer.exportToWriter(e)}importFromReader(e,t){this.inResourcesManager.importFromReader(e,t),this.producer.importFromReader(e,t)}}class je{constructor(e,t){this.component=e,this.meta=t,this.game=e.getFactory().getGame(),this.noOfItems=0,this.inputTileIndex=0,this.removeAmount=0,this.producer=new et(t.interval),this.producer.canStart=this.canRemove.bind(this),this.producer.start=this.startRemoval.bind(this),this.producer.finished=this.finishRemoval.bind(this)}clearContents(){this.noOfItems=0,this.inputTileIndex=0,this.removeAmount=0,this.producer.reset()}getMax(){return je.getMetaMax(this.component.getMeta(),this.component.getFactory())}static getMetaMax(e,t){return e.strategy.max*t.getUpgradesManager().getComponentBonuses(e.id).maxStorageBonus}getRemoveAmount(){return je.getMetaRemoveAmount(this.component.getMeta(),this.component.getFactory())}static getMetaRemoveAmount(e,t){return e.strategy.removeAmount*t.getUpgradesManager().getComponentBonuses(e.id).removeAmountBonus}takeIn(){const e=this.component.getSurroundedInputTiles();let t=this.inputTileIndex;for(let r=0;r<e.length;r++){const i=e[(t+r)%e.length],s=i.tile.getComponent().getStrategy().getOutputQueue(i.direction);s.getLast()&&this.noOfItems<this.getMax()&&(s.unsetLast(),t=(t+r+1)%e.length,this.noOfItems++),s.forward()}this.inputTileIndex=t}canRemove(){return this.noOfItems>=this.getRemoveAmount()}startRemoval(){this.removeAmount=Math.min(this.noOfItems,this.getRemoveAmount())}finishRemoval(){this.noOfItems-=this.removeAmount,this.removeAmount=0}calculateInputTick(){this.takeIn(),this.producer.calculate()}getDescriptionData(){const e=je.getMetaDescriptionData(this.component.getMeta(),this.component.getFactory(),this);return e.noOfItems=this.noOfItems,this.producer.updateWithDescriptionData(e),e}static getMetaDescriptionData(e,t,r){return{interval:e.strategy.interval,removeAmount:je.getMetaRemoveAmount(e,t),max:r?r.getMax():je.getMetaMax(e,t)}}toString(){let e=`No of items: ${this.noOfItems}<br />${this.producer.toString()}`;return this.removeAmount>0&&(e+=`Removing ${this.removeAmount} items`),e+"<br />"}exportToWriter(e){e.writeUint32(this.noOfItems),e.writeUint8(this.inputTileIndex),e.writeUint32(this.removeAmount),this.producer.exportToWriter(e)}importFromReader(e){this.noOfItems=e.readUint32(),this.inputTileIndex=e.readUint8(),this.removeAmount=e.readUint32(),this.producer.importFromReader(e)}}class So{constructor(e,t){this.component=e,this.meta=t,this.inputTileIndex=0,this.inItem=null,this.inSortingItem=null,this.outItem=null,this.distributeTileIndexes={default:0},this.sortingIndex={};for(const r in this.component.getMeta().allowedOutputs)this.sortingIndex[r]=null;this.producer=new et(t.interval),this.producer.canStart=this.canStartSorting.bind(this),this.producer.start=this.startSorting.bind(this),this.producer.finished=this.finishedSorting.bind(this)}clearContents(){this.inputTileIndex=0,this.inItem=null,this.inSortingItem=null,this.outItem=null,this.distributeTileIndexes={default:0};for(const e in this.sortingIndex)this.sortingIndex[e]&&(this.distributeTileIndexes[this.sortingIndex[e]]=0);this.producer.reset()}calculateInputTick(){if(!this.inItem){const e=this.component.getSurroundedInputTiles();let t=this.inputTileIndex;for(let r=0;r<e.length;r++){const i=e[(t+r)%e.length],s=i.tile.getComponent().getStrategy().getOutputQueue(i.direction),o=s.getLast();o&&!this.inItem&&(s.unsetLast(),t=(t+r+1)%e.length,this.inItem=o),s.forward()}this.inputTileIndex=t}}calculateOutputTick(){this.producer.calculate(),this.moveItemOut()}canStartSorting(){return this.inItem&&!this.outItem}startSorting(){this.inSortingItem=this.inItem,this.inItem=null}finishedSorting(){this.outItem=this.inSortingItem,this.inSortingItem=null,this.moveItemOut()}moveItemOut(){if(!this.outItem)return;let e=this.outItem.getResourceId();this.distributeTileIndexes[e]===void 0&&(e="default");const t=this.component.getSurroundedOutputTiles();for(let r=0;r<t.length;r++){const i=t[this.distributeTileIndexes[e]];this.distributeTileIndexes[e]=(this.distributeTileIndexes[e]+1)%t.length;const s=i.from.getX()-this.component.getX(),o=i.from.getY()-this.component.getY(),u=this.sortingIndex[s+":"+o];if(!(u&&u!==this.outItem.getResourceId()||!u&&this.distributeTileIndexes[this.outItem.getResourceId()]!==void 0)){const l=i.tile.getComponent().getStrategy().getInputQueue(i.oppositeDirection);if(!l.getFirst()){l.setFirst(this.outItem),this.outItem=null;break}}}}setSortingResource(e,t,r){this.sortingIndex[e+":"+t]=r,this.clearContents()}getSortingResource(e,t){return this.sortingIndex[e+":"+t]}toString(){let e=`Next: ${this.inItem?this.inItem.getResourceId():"-"}<br />`;e+=`Sorting: ${this.inSortingItem?this.inSortingItem.getResourceId():"-"}<br />`,e+=`Out: ${this.outItem?this.outItem.getResourceId():"-"}<br />`,e+=this.producer.toString()+"<br />",e+="Sort rules:<br />";for(const t in this.sortingIndex)e+=`${t}: ${this.sortingIndex[t]}<br />`;e+=`<br />Input index: ${this.inputTileIndex}<br />Out indexes:<br />`;for(const t in this.distributeTileIndexes)e+=`${t}: ${this.distributeTileIndexes[t]}<br />`;return e}exportToWriter(e){e.writeUint8(this.inputTileIndex),be.staticExportData(this.inItem,e),be.staticExportData(this.inSortingItem,e),be.staticExportData(this.outItem,e),e.writeUint8(this.distributeTileIndexes.default);for(const t in this.sortingIndex){const r=this.sortingIndex[t];let i=0,s=0;r&&(i=this.component.getFactory().getGame().getMeta().resourcesById[r].idNum,s=this.distributeTileIndexes[r]),e.writeUint8(i),e.writeUint8(s)}this.producer.exportToWriter(e)}importFromReader(e){this.inputTileIndex=e.readUint8(),this.inItem=be.createFromExport(this.component.getFactory(),e),this.inSortingItem=be.createFromExport(this.component.getFactory(),e),this.outItem=be.createFromExport(this.component.getFactory(),e),this.distributeTileIndexes={default:e.readUint8()};for(const t in this.sortingIndex){const r=e.readUint8();this.sortingIndex[t]=r?this.component.getFactory().getGame().getMeta().resourcesByIdNum[r].id:null,this.sortingIndex[t]&&(this.distributeTileIndexes[this.sortingIndex[t]]=e.readUint8())}this.producer.importFromReader(e)}}class Qe{constructor(e,t){this.component=e,this.game=this.component.getFactory().getGame(),this.meta=t,this.outResourcesManager=new Ze(e,t.purchaseResources,t.outputResourcesOrder),this.producer=new et(t.interval),this.producer.canStart=this.canBuy.bind(this),this.producer.start=this.preparePurchase.bind(this),this.producer.finished=this.finishPurchase.bind(this)}static getMetaBuyPrice(e,t,r){return e.strategy.purchaseResources[t].price*r.getGame().getProfitMultiplier()}static getMetaBuyAmount(e,t,r){const i=r.getUpgradesManager().getComponentBonuses(e.id);return e.strategy.purchaseResources[t].amount*i.buyAmountBonus}static getMetaDescriptionData(e,t,r){const i=e.strategy,s=t.getGame().getMeta().resourcesById;let o=[],u=0,l=0;for(const m in i.purchaseResources){const h=Qe.getMetaBuyAmount(e,m,t),f=Qe.getMetaBuyPrice(e,m,t);u+=h*f,o.push(`<span class='${m}'><b>${h}</b> ${ct(s[m].name)}</span>`),l=Math.max(l,h)}return{interval:i.interval,purchasePrice:K.formatNumber(u),buyStr:vt(o),noOfOutputs:Math.ceil(l/i.interval/Ze.getMetaOutputAmount(e,t))}}getBuyPrice(e){return Qe.getMetaBuyPrice(this.component.getMeta(),e,this.component.getFactory())}getBuyAmount(e){return Qe.getMetaBuyAmount(this.component.getMeta(),e,this.component.getFactory())}getDescriptionData(){const e=Qe.getMetaDescriptionData(this.component.getMeta(),this.component.getFactory(),this);return this.producer.updateWithDescriptionData(e),this.outResourcesManager.updateWithDescriptionData(e),e}clearContents(){this.outResourcesManager.reset(),this.producer.reset()}calculateOutputTick(e){this.producer.calculate(e),this.outResourcesManager.distribute()}calculatePurchasePrice(){let e=0;for(const t in this.meta.purchaseResources)e+=this.getBuyAmount(t)*this.getBuyPrice(t);return e}canBuy(){for(const e in this.meta.purchaseResources)if(this.outResourcesManager.getResource(e)+this.getBuyAmount(e)>this.outResourcesManager.getMax(e))return!1;return!0}preparePurchase(e){e.resourceCosts+=this.calculatePurchasePrice()}finishPurchase(e){for(const t in this.meta.purchaseResources)this.outResourcesManager.addResource(t,this.getBuyAmount(t))}toString(){return`${this.outResourcesManager.toString()}<br />${this.producer.toString()}<br />`}exportToWriter(e){this.outResourcesManager.exportToWriter(e),this.producer.exportToWriter(e)}importFromReader(e){this.outResourcesManager.importFromReader(e),this.producer.importFromReader(e)}}class Li{constructor(e,t){this.queue=new Array(e).fill(void 0),this.tile=t}reset(){this.queue.fill(void 0)}forward(){for(let e=this.queue.length-2;e>=0;e--)this.queue[e+1]||(this.queue[e+1]=this.queue[e],this.queue[e]=void 0)}setFirst(e){this.queue[0]=e}unsetFirst(){this.setFirst(void 0)}setLast(e){this.queue[this.queue.length-1]=e}unsetLast(){this.setLast(void 0)}getFirst(){return this.queue[0]}getLast(){return this.queue[this.queue.length-1]}getQueue(){return this.queue}get(e){return this.queue[e]}set(e,t){this.queue[e]=t??void 0}getLength(){return this.queue.length}toString(){return this.queue.join(",")}exportToWriter(e){for(const t of this.queue)be.staticExportData(t,e)}importFromReader(e){for(let t=0;t<this.queue.length;t++)this.set(t,be.createFromExport(this.tile.getFactory(),e))}}const Go={top:"bottom",bottom:"top",left:"right",right:"left"};class zr{constructor(e,t){this.component=e,this.meta=t,this.tile=this.component.getMainTile(),this.reset()}reset(){this.inputQueueOffset=0,this.inputQueuesList=[],this.inputQueues={},this.outputQueueOffset=0,this.outputQueuesList=[],this.outputQueues={},this.isBridge=!1}clearContents(){this.updateInputsOutputs()}static getMetaDescriptionData(e,t){return{}}getDescriptionData(){return zr.getMetaDescriptionData(this.component.getMeta(),this.component.getFactory())}updateInputsOutputs(){this.reset();const e=this.tile.getInputOutputManager().getInputsByDirection();for(const s in e)if(e[s]){const o=new Li(this.meta.queueSize,this.tile);this.inputQueuesList.push(o),this.inputQueues[s]=o}const t=this.tile.getInputOutputManager().getOutputsByDirection();for(const s in t)if(t[s]){const o=new Li(this.meta.queueSize,this.tile);this.outputQueuesList.push(o),this.outputQueues[s]=o}const r=this.outputQueues.top&&this.inputQueues.bottom||this.outputQueues.bottom&&this.inputQueues.top,i=this.outputQueues.left&&this.inputQueues.right||this.outputQueues.right&&this.inputQueues.left;this.isBridge=r&&i}getOutputQueues(){return this.outputQueues}getOutputQueue(e){return this.outputQueues[e]}getInputQueues(){return this.inputQueues}getInputQueue(e){return this.inputQueues[e]}calculateTransport(){this.isBridge?(this.moveInternalInputsToOutputsBridge("top","bottom"),this.moveInternalInputsToOutputsBridge("left","right")):this.moveInternalInputsToOutputs(),["top","right","bottom","left"].forEach(e=>this.pullFromOutsideToInputs(e,this.inputQueues[e]))}moveInternalInputsToOutputsBridge(e,t){this.inputQueues[t]&&([e,t]=[t,e]);const r=this.inputQueues[e],i=this.outputQueues[t],s=r.getLast();s&&!i.getFirst()&&(i.setFirst(s),r.unsetLast()),r.forward()}moveInternalInputsToOutputs(){let e=0;for(let t=0;t<this.inputQueuesList.length;t++){const r=this.inputQueuesList[(this.inputQueueOffset+t)%this.inputQueuesList.length],i=r.getLast();if(!i){r.forward();continue}for(let s=0;s<this.outputQueuesList.length;s++){const o=(this.outputQueueOffset+s)%this.outputQueuesList.length,u=this.outputQueuesList[o];if(!u.getFirst()){this.outputQueueOffset=(this.outputQueueOffset+1)%this.outputQueuesList.length,u.setFirst(i),r.unsetLast(),e++;break}}r.forward()}this.inputQueueOffset=(this.inputQueueOffset+e)%this.inputQueuesList.length}pullFromOutsideToInputs(e,t){if(!t)return;const i=this.tile.getTileInDirection(e).getComponent();if(i.getMeta().strategy.type==="transport"){const s=i.getStrategy().getOutputQueue(Go[e]);!t.getFirst()&&s.getLast()&&(t.setFirst(s.getLast()),s.unsetLast()),s.forward()}}toString(){let e=`IN offset:${this.inputQueueOffset}<br />`;for(const t in this.inputQueues)e+=t+": "+this.inputQueues[t].getQueue().map(r=>r?r.getResourceId():"").join(",")+"<br />";e+=`<br />OUT offset:${this.outputQueueOffset}<br />`;for(const t in this.outputQueues)e+=t+": "+this.outputQueues[t].getQueue().map(r=>r?r.getResourceId():"").join(",")+"<br />";return e}exportToWriter(e){const t=r=>r?.exportToWriter(e);e.writeUint8(this.inputQueueOffset),e.writeUint8(this.outputQueueOffset),["top","right","bottom","left"].forEach(r=>t(this.inputQueues[r])),["top","right","bottom","left"].forEach(r=>t(this.outputQueues[r]))}importFromReader(e){const t=r=>r?.importFromReader(e);this.inputQueueOffset=e.readUint8(),this.outputQueueOffset=e.readUint8(),["top","right","bottom","left"].forEach(r=>t(this.inputQueues[r])),["top","right","bottom","left"].forEach(r=>t(this.outputQueues[r]))}}class Je{constructor(e,t){this.component=e,this.meta=t,this.game=e.getFactory().getGame(),this.productionBonus=0,this.inResourcesManager=new yr(e,t.resources),this.producer=new et(t.interval),this.producer.canStart=this.canProduce.bind(this),this.producer.start=this.startProduction.bind(this),this.producer.finished=this.finishProduction.bind(this)}clearContents(){this.inResourcesManager.reset(),this.producer.reset()}static getMetaBonus(e,t,r){return e.strategy.resources[t].bonus*r.getUpgradesManager().getComponentBonuses(e.applyUpgradesFrom?e.applyUpgradesFrom:e.id).researchPaperBonus}getBonus(e){return Je.getMetaBonus(this.component.getMeta(),e,this.component.getFactory())}static getResearchProduction(e,t){return e.strategy.researchProduction*t.getGame().getResearchProductionMultiplier()}getResearchProduction(){return Je.getResearchProduction(this.component.getMeta(),this.component.getFactory())}static getMetaDescriptionData(e,t,r){const i=e.strategy.resources,s=t.getGame().getMeta().resourcesById,o=Object.keys(i).map(u=>`<span class='${u}'>${s[u].name.lcFirst()}: <b>${nf(Je.getMetaBonus(e,u,t))}</b></span> `);return{interval:e.strategy.interval,bonusStr:arrayToHumanStr(o),productionStr:`<span class='research'><b>${nf(Je.getResearchProduction(e,t))}</b> research points </span>`}}getDescriptionData(){const e=Je.getMetaDescriptionData(this.component.getMeta(),this.component.getFactory(),this);return this.producer.updateWithDescriptionData(e),this.inResourcesManager.updateWithDescriptionData(e),e}calculateInputTick(){this.inResourcesManager.takeIn(),this.producer.calculate()}canProduce(){return!0}startProduction(){let e=1;for(const t in this.meta.resources)e+=this.inResourcesManager.getResource(t)*this.getBonus(t),this.inResourcesManager.addResource(t,-this.inResourcesManager.getResource(t));this.productionBonus=e}finishProduction(e){e.researchProduction+=this.getResearchProduction()*this.productionBonus}toString(){return this.producer.toString()+"<br />"}exportToWriter(e){e.writeUint32(this.productionBonus),this.producer.exportToWriter(e)}importFromReader(e){this.productionBonus=e.readUint32(),this.producer.importFromReader(e)}}class bt{constructor(e,t){this.component=e,this.meta=t,this.inResourcesManager=new yr(e,t.inputResources),this.outResourcesManager=new Ze(e,t.production,t.outputResourcesOrder),this.productionBonus=0,this.producer=new et(t.interval),this.producer.canStart=this.canStartProduction.bind(this),this.producer.start=this.startProduction.bind(this),this.producer.finished=this.finishedProduction.bind(this)}clearContents(){this.inResourcesManager.reset(),this.outResourcesManager.reset(),this.producer.reset()}static isProducing(e,t,r){return!t.productionRemoveResearch||!t.productionRemoveResearch[r]||!e.getResearchManager().getResearch(t.productionRemoveResearch[r])}static getMetaDescriptionData(e,t,r){const i=e.strategy||e,s=t.getGame().getMeta().resourcesById,o=[],u=[],l=[],m=[];let h=0;for(const f in i.inputResources){const c=i.inputResources[f];o.push(`<span class='${f}'><b>${c.perOutputResource}</b> ${s[f].nameShort.lcFirst()}</span>`),l.push(`<span class='${f}'>${s[f].nameShort.lcFirst()}: <b>${c.max}</b></span>`),m.push(`<span class='${f}'>${s[f].nameShort.lcFirst()}: <b>${c.bonus}</b></span>`),h+=c.bonus}for(const f in i.production)if(bt.isProducing(t.getGame(),i,f)){const c=i.production[f];u.push(`<span class='${f}'><b>${c.amount}</b> ${s[f].nameShort.lcFirst()}</span>`),l.push(`<span class='${f}'>${s[f].nameShort.lcFirst()}: <b>${c.max}</b></span>`)}return{interval:i.interval,inputStr:arrayToHumanStr(o),outputStr:arrayToHumanStr(u),storageStr:arrayToHumanStr(l),bonusStr:arrayToHumanStr(m),maxBonus:h}}getDescriptionData(){const e=bt.getMetaDescriptionData(this.component.getMeta(),this.component.getFactory(),this);return this.producer.updateWithDescriptionData(e),this.inResourcesManager.updateWithDescriptionData(e),this.outResourcesManager.updateWithDescriptionData(e),e}calculateInputTick(){this.inResourcesManager.takeIn()}calculateOutputTick(){this.producer.calculate(),this.outResourcesManager.distribute()}canStartProduction(){for(const e in this.meta.production)if(this.outResourcesManager.getResource(e)+this.meta.production[e].amount>this.outResourcesManager.getMax(e))return!1;return!0}startProduction(){let e=1;for(const t in this.meta.inputResources){const r=this.meta.inputResources[t];this.inResourcesManager.getResource(t)>=r.perOutputResource&&(this.inResourcesManager.addResource(t,-r.perOutputResource),e+=r.bonus)}this.productionBonus=e}finishedProduction(){for(const e in this.meta.production)bt.isProducing(this.component.getFactory().getGame(),this.meta,e)&&this.outResourcesManager.addResource(e,this.meta.production[e].amount*this.productionBonus)}toString(){return this.inResourcesManager.toString()+"<br />"+this.outResourcesManager.toString()+"<br />"+this.producer.toString()+"<br />"}exportToWriter(e){e.writeUint32(this.productionBonus),this.outResourcesManager.exportToWriter(e),this.inResourcesManager.exportToWriter(e),this.producer.exportToWriter(e)}importFromReader(e){this.productionBonus=e.readUint32(),this.outResourcesManager.importFromReader(e),this.inResourcesManager.importFromReader(e),this.producer.importFromReader(e)}}const Co=Object.freeze(Object.defineProperty({__proto__:null,buyer:Qe,converter:Be,garbage:je,lab:bt,researchCenter:Je,seller:Ke,sorter:So,transport:zr},Symbol.toStringTag,{value:"Module"}));class mr{static getStrategyClass(e){const t=Co[e];if(!t)throw new Error("Unknown component strategy "+e);return t}static getForComponent(e){const t=e.getMeta().strategy?.type,r=this.getStrategyClass(t);return new r(e,e.getMeta().strategy)}static getMetaDescriptionData(e,t){const r=this.getStrategyClass(e.strategy.type);if(typeof r.getMetaDescriptionData!="function")throw new Error(`Strategy class ${e.strategy.type} has no getMetaDescriptionData method`);return r.getMetaDescriptionData(e,t)}}class St{constructor(e,t,r,i){this.meta=i,this.factory=e,this.x=t,this.y=r,this.strategy=mr.getForComponent(this),this.surroundedInputTiles=[],this.surroundedOutputTiles=[]}static getMetaDescriptionData(e,t,r){const i=mr.getMetaDescriptionData(e,t,r);return this._addCommonMetaDescriptionData(i,e,t,r),i}getDescriptionData(){const e=this.strategy.getDescriptionData();return St._addCommonMetaDescriptionData(e,this.meta,this.factory,this.strategy),e}static _addCommonMetaDescriptionData(e,t,r,i){e.name=t.name,e["is"+t.strategy.type.charAt(0).toUpperCase()+t.strategy.type.slice(1)]=!0,e.description=t.description,e.priceStr="$"+K.formatNumber(t.price),t.runningCostPerTick&&(e.runningCostStr="$"+K.formatNumber(this.getMetaRunningCostPerTick(t,r))+"/tick")}static getMetaRunningCostPerTick(e,t){const r=t.getUpgradesManager().getComponentBonuses(e.applyUpgradesFrom??e.id);return e.runningCostPerTick*r.runningCostPerTickIncrease*r.runningCostPerTickBonus*t.getGame().getProfitMultiplier()}getRunningCostPerTick(){return St.getMetaRunningCostPerTick(this.meta,this.factory)}_checkForSurroundedInputsOutputs(e,t,r){const i=this.factory.getTile(e,t),s=i.getInputOutputManager().getOutputsByDirection()[r];s&&this.surroundedOutputTiles.push({tile:s,from:i,direction:i.getDirection(s),oppositeDirection:s.getDirection(i)});const o=i.getInputOutputManager().getInputsByDirection()[r];o&&this.surroundedInputTiles.push({tile:o,from:i,direction:o.getDirection(i),oppositeDirection:i.getDirection(o)})}_updateSurroundedTilesCache(){this.surroundedInputTiles=[],this.surroundedOutputTiles=[];for(let e=this.x;e<this.x+this.meta.width;e++)this._checkForSurroundedInputsOutputs(e,this.y,"top");for(let e=this.y;e<this.y+this.meta.height;e++)this._checkForSurroundedInputsOutputs(this.x+this.meta.width-1,e,"right");for(let e=this.x+this.meta.width-1;e>=this.x;e--)this._checkForSurroundedInputsOutputs(e,this.y+this.meta.height-1,"bottom");for(let e=this.y+this.meta.height-1;e>=this.y;e--)this._checkForSurroundedInputsOutputs(this.x,e,"left")}outputsInputsChanged(){this._updateSurroundedTilesCache(),this.getStrategy().clearContents(),this.getStrategy().updateInputsOutputs&&this.getStrategy().updateInputsOutputs()}getSurroundedInputTiles(){return this.surroundedInputTiles}getSurroundedOutputTiles(){return this.surroundedOutputTiles}calculateInputTick(e){this.meta.runningCostPerTick>0&&(e.runningCosts+=this.getRunningCostPerTick())}getFactory(){return this.factory}getMeta(){return this.meta}getStrategy(){return this.strategy}getX(){return this.x}getY(){return this.y}getMainTile(){return this.factory.getTile(this.x,this.y)}exportToWriter(e){this.strategy.exportToWriter(e)}importFromReader(e,t){this.strategy.importFromReader(e,t)}}const Mo={top:[0,-1],right:[1,0],bottom:[0,1],left:[-1,0],top_right:[1,-1],top_left:[-1,-1],bottom_right:[1,1],bottom_left:[-1,1]},ko={"-10":"top","-1":"left",1:"right",10:"bottom"};class Ae{static BUILDABLE_NO="X";static BUILDABLE_YES=" ";static BUILDABLE_PARTIAL="-";constructor(e,t,r,i,s){this.id=t*s.getMeta().tilesX+e,this.x=e,this.y=t,this.factory=s,this.setTerrain(i),this.setBuildableType(r),this.component=null,this.inputOutputManager=new bo(this,()=>{this.component&&this.component.outputsInputsChanged()})}getId(){return this.id}getIdStr(){return`${this.x}:${this.y}`}getX(){return this.x}getY(){return this.y}setBuildableType(e){[Ae.BUILDABLE_YES,Ae.BUILDABLE_PARTIAL].includes(e)||(e=Ae.BUILDABLE_NO),this.buildableType=e}getBuildableType(){return this.buildableType}isPossibleToBuildOnType(e){return this.buildableType===Ae.BUILDABLE_YES||e.canBuildToPartial&&this.buildableType===Ae.BUILDABLE_PARTIAL}setTerrain(e="grass"){this.terrain=e}getTerrain(){return this.terrain}getInputOutputManager(){return this.inputOutputManager}getDirection(e){return ko[String(10*(e.getY()-this.y)+(e.getX()-this.x))]}getTileInDirection(e){const[t,r]=Mo[e];return this.factory.getTile(this.x+t,this.y+r)}isMainComponentContainer(){return this.component&&this.component.getX()===this.x&&this.component.getY()===this.y}getFactory(){return this.factory}getComponent(){return this.component}setComponent(e){if(e){const t=new St(this.factory,this.x,this.y,e);for(let r=0;r<e.width;r++)for(let i=0;i<e.height;i++){const s=this.factory.getTile(this.x+r,this.y+i);s&&(s.component=t)}this.component=t}else this.component=null;this.inputOutputManager.reset()}exportToWriter1(e){this.inputOutputManager.exportToWriter(e)}exportToWriter2(e){this.component.exportToWriter(e)}importFromReader1(e,t){this.inputOutputManager.importFromReader(e,t)}importFromReader2(e,t){this.component.importFromReader(e,t)}}class Ct{constructor(e=[],t=""){this.handledEvents=e,this.eventTag=t,this.events={}}addListener(e,t,r){t||console.warn("Trying to add listener with undefined type!",e),(Array.isArray(this.handledEvents)?this.handledEvents:Object.values(this.handledEvents)).includes(t)||console.warn(`${this.eventTag}: Event ${t} is not handled. ${e} tried to listen for it.`),this.events[t]||(this.events[t]={}),this.events[t][e]=r}removeListener(e,t){this.events[t]&&this.events[t][e]&&delete this.events[t][e]}removeListenerForType(e){for(const t in this.events)this.events[t][e]&&delete this.events[t][e]}invokeEvent(e,...t){if(this.events[e])for(const r in this.events[e]){const i=this.events[e][r];i&&i(...t)}}}class Oe{getNextMultiplier(){return this.meta.levels[this.amount]?this.meta.levels[this.amount].bonus:0}getTotalMultiplier(){let e=0;for(let t=0;t<this.amount;t++){const r=this.meta.levels[t];r&&(e+=r.bonus)}return e}getMultiplierStrings(e=!1){const t=this.getNextMultiplier(),r=1+this.getTotalMultiplier();let i=0;t>0&&(i=(r+t)/r-1);const s=Math.round(i*1e4)/100;return e?{total:`${Math.round((r-1)*1e4)/100}%`,next:`<b>${s}%</b>`}:{total:`${r}x`,next:`<b>${s}%</b>`}}}class Eo extends Oe{constructor(e,t,r){super(),this.meta=e,this.amount=t,this.factory=r}updateMap(e){const t=this.getTotalMultiplier(),r=e.byComponent[this.meta.componentId];r.runningCostPerTickIncrease+=t,r.buyAmountBonus+=t,r.maxStorageBonus+=t}getTitle(){return"Amount of resources component buys"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`<b>${e.name}</b> buys <span class="green">${t.next}</span> more resources.<br />`+(this.meta.noRunningCost?"":`Increases running cost by <b class="red">${t.next}</b><br />`)+`<br />More production per component, but expenses are proportionally the same. More production per component => more resources to sell.<br /><br /><b>Current total buy resources bonus: </b><b class="green">${t.total}</b>`}}class To extends Oe{constructor(e,t,r){super(),this.meta=e,this.amount=t,this.factory=r}updateMap(e){const t=this.getTotalMultiplier(),r=e.byComponent[this.meta.componentId];r.runningCostPerTickIncrease+=t,r.convertAmountBonus+=t,r.maxStorageBonus+=t}getTitle(){return"Amount of resources used and produced amount"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`<b>${e.name}</b> uses and produces <b class="green">${t.next}</b> more resources.<br />`+(this.meta.noRunningCost?"":`Increases running cost by <b class="red">${t.next}</b><br />`)+`<br />More production per component, but expenses are proportionally the same. More production per component => more resources to sell.<br /><br /><b>Current total increase: </b><b class="green">${t.total}</b>`}}class Io extends Oe{constructor(e,t,r){super(),this.meta=e,this.amount=t,this.factory=r}updateMap(e){const t=this.getTotalMultiplier(),r=e.byComponent[this.meta.componentId];r.runningCostPerTickIncrease+=t,r.convertProduceMoreBonus+=t,r.maxStorageBonus+=t}getTitle(){return"Amount of resources produced"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`<b>${e.name}</b> produces <b class="green">${t.next}</b> more resources.<br />`+(this.meta.noRunningCost?"":`Increases running cost by <b class="red">${t.next}</b><br />`)+`<br />More production per component with less raw materials, but expenses are proportionally the same. More production per component => more resources to sell.<br /><br /><b>Current total increase: </b><b class="green">${t.total}</b>`}}class wo extends Oe{constructor(e,t,r){super(),this.meta=e,this.amount=t,this.factory=r}updateMap(e){const t=this.getTotalMultiplier(),r=e.byComponent[this.meta.componentId];r.removeAmountBonus+=t,r.maxStorageBonus+=t}getTitle(){return"Amount of resources removed"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`${e.name} removes ${t.next} more items<br /><br /><b>Current total bonus: </b><b class="green">${t.total}</b>`}}class _o extends Oe{constructor(e,t,r){super(),this.meta=e,this.amount=t,this.factory=r}updateMap(e){const t=this.getTotalMultiplier();this.meta.componentId?e.byComponent[this.meta.componentId].packageSizeBonus+=t:e.packageSizeBonus+=t}getTitle(){return"Package size"}getDescription(){let e=null;this.meta.componentId&&(e=this.factory.getGame().getMeta().componentsById[this.meta.componentId]);const t=this.getMultiplierStrings();return`<b>${e?e.name+" outputs":"All components output"}</b> <span class="green">${t.next}</span> more resources into single package.<br /><br />Makes conveyors much more effective, as they transport more resources.<br /><br /><b>Current total bonus: </b><b class="green">${t.total}</b>`}}class Ro extends Oe{constructor(e,t,r){super(),this.meta=e,this.amount=t,this.factory=r}updateMap(e){const t=this.getTotalMultiplier(),r=e.byComponent[this.meta.componentId];r.runningCostPerTickIncrease+=t,r.researchPaperBonus+=t}getTitle(){return"Research paper bonus"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`<b>${e.name}</b> research paper bonus increased by <b class="green">${t.next}</b><br /><br /><b>Current total increase: </b><b class="green">${t.total}</b>`}}class Ao extends Oe{constructor(e,t,r){super(),this.meta=e,this.amount=t,this.factory=r}updateMap(e){e.byComponent[this.meta.componentId].maxStorageBonus+=this.getTotalMultiplier()}getTitle(){return"Max stock size"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`<b>${e.name}</b> max stock increased by <b class="green">${t.next}</b><br /><br /> <b>Current total increase: </b><b class="green">${t.total}</b>`}}class Po extends Oe{constructor(e,t,r){super(),this.meta=e,this.amount=t,this.factory=r}updateMap(e){e.byComponent[this.meta.componentId].runningCostPerTickBonus-=this.getTotalMultiplier()}getTitle(){return"Reduce running costs"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings(!0);return`<b>${e.name}</b> running costs are reduced by <b class="green">${t.next}</b><br /><br /><b>Current total decrease: </b><b class="green">${t.total}</b>`}}class Oo extends Oe{constructor(e,t,r){super(),this.meta=e,this.amount=t,this.factory=r}updateMap(e){const t=this.getTotalMultiplier(),r=e.byComponent[this.meta.componentId];r.runningCostPerTickIncrease+=t,r.sellAmountBonus+=t,r.maxStorageBonus+=t}getTitle(){return"Amount of resources sold"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`<b>${e.name}</b> sells <b class="green">${t.next}</b> more resources.<br />`+(this.meta.noRunningCost?"":`Increases running cost by <b class="red">${t.next}</b><br />`)+`<br />More resources sold per tick in average => more money<br /><br /><b>Current total increase: </b><b class="green">${t.total}</b>`}}class xo extends Oe{constructor(e,t,r){super(),this.meta=e,this.amount=t,this.factory=r}updateMap(e){e.byComponent[this.meta.componentId].sellPriceBonus+=this.getTotalMultiplier()}getTitle(){return"Resources sale price"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`<b>${e.name}</b> sells with <b class="green">${t.next}</b> higher price. <br /><br /><b>Current total increase: </b><b class="green">${t.total}</b>`}}const Bo={buyer:Eo,converter:To,converterProduceMore:Io,garbage:wo,packageSize:_o,researchCenterBonus:Ro,researchCenterMaxStock:Ao,runningCost:Po,sellerSellAmount:Oo,sellerSellPrice:xo},Lo={getStrategyClass(p){const e=Bo[p];if(!e)throw new Error(`Unknown component strategy ${p}`);return e},getStrategy(p,e,t){const r=this.getStrategyClass(p.type);return new r(p,e,t)}};class Le{constructor(){this.data=[],this.totalLength=0}_write(e,t,r){return this.data.push({value:e,length:t,method:r}),this.totalLength+=t,this}writeInt8(e){return this._write(e,1,"setInt8")}writeInt16(e){return this._write(e,2,"setInt16")}writeInt32(e){return this._write(e,4,"setInt32")}writeUint8(e){return this._write(e,1,"setUint8")}writeUint16(e){return this._write(e,2,"setUint16")}writeUint32(e){return this._write(e,4,"setUint32")}writeFloat64(e){return this._write(e,8,"setFloat64")}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeBooleanMap(e){return this.writeUint8(e.getValue())}writeBooleansArrayFunc(e,t){let r=null;for(let i=0;i<e.length;i++)r||(r=new Vr),r.writeBoolean(t(e[i])?1:0),(i+1)%8===0&&(this.writeBooleanMap(r),r=null);return r&&(r.fillZero(),this.writeBooleanMap(r)),this}writeWriter(e){if(!e)return this.writeInt32(0);const t=e.getData();this.writeInt32(e.getTotalLength());for(const r of t)this._write(r.value,r.length,r.method);return this}getData(){return this.data}getTotalLength(){return this.totalLength}getBuffer(){const e=new ArrayBuffer(this.totalLength),t=new DataView(e);let r=0;for(const i of this.data)t[i.method](r,i.value,!0),r+=i.length;return e}}class No{constructor(e){this.factory=e,this.game=e.getGame(),this.upgrades={},this.isChanged=!0}buildMap(){const e={packageSizeBonus:0,byComponent:{}};for(const r in this.game.getMeta().componentsById)e.byComponent[r]={runningCostPerTickIncrease:1,runningCostPerTickBonus:1,buyAmountBonus:1,maxStorageBonus:1,packageSizeBonus:0,convertAmountBonus:1,convertProduceMoreBonus:1,removeAmountBonus:1,researchPaperBonus:1,sellAmountBonus:1,sellPriceBonus:1};const t=this.game.getMeta().upgrades;for(const r in t)this.getStrategy(t[r].id).updateMap(e);return e}getBonuses(){return this.isChanged&&(this.bonuses=this.buildMap(),this.isChanged=!1),this.bonuses}getComponentBonuses(e){return this.getBonuses().byComponent[e]}setUpgrade(e,t){this.upgrades[e]=t,this.isChanged=!0}addUpgrade(e,t){this.setUpgrade(e,this.getUpgrade(e)+t)}getUpgrade(e){return this.upgrades[e]||0}getStrategy(e){const t=this.game.getMeta().upgradesById[e];return Lo.getStrategy(t,this.getUpgrade(e),this.factory)}getPrice(e,t=this.getUpgrade(e)){return this.game.getMeta().upgradesById[e].levels[t]?.price??0}getSellPrice(e){const t=this.game.getMeta().upgradesById[e];return this.getUpgrade(e)<=0?0:this.getPrice(e,this.getUpgrade(e)-1)*t.refund}canPurchase(e){return this.couldPurchase(e)&&this.game.getMoney()>=this.getPrice(e)&&this.isVisible(e)}couldPurchase(e){const t=this.game.getMeta().upgradesById[e];return this.getUpgrade(e)<t.levels.length}isVisible(e){const t=this.game.getMeta().upgradesById[e];return!t.requiresResearch||this.game.getResearchManager().getResearch(t.requiresResearch)>0}canSell(e){const t=this.game.getMeta().upgradesById[e];return this.getUpgrade(e)>0&&t.refund!=null&&this.isVisible(e)}exportToWriter(){const e=Object.keys(this.upgrades).filter(r=>this.upgrades[r]>0).length,t=new Le;t.writeUint16(e);for(const r in this.upgrades){const i=this.upgrades[r];i>0&&(t.writeUint16(this.game.getMeta().upgradesById[r].idNum),t.writeUint16(i))}return t}importFromReader(e){if(!e.getLength())return;this.upgrades={};const t=e.readUint16();for(let r=0;r<t;r++){const i=e.readUint16(),s=e.readUint16(),o=this.game.getMeta().upgradesByIdNum[i];o&&(this.upgrades[o.id]=s)}this.isChanged=!0}}class Uo{constructor(e){this.factory=e,this.game=e.getGame(),this.boughtAreas={}}setAreaBought(e,t){this.boughtAreas[e]=t}getIsAreaBought(e){return!!this.boughtAreas[e]}getPrice(e){return this.factory.getMeta().areasById[e]}canPurchase(e){return this.game.getMoney()>=this.getPrice(e)}canBuildAt(e,t,r,i){for(const s of this.factory.getMeta().areas)for(const o of s.locations)if(!(o.x>=e+r||o.x+o.width<=e||o.y>=t+i||o.y+o.height<=t)&&!this.boughtAreas[s.id])return!1;return!0}exportToWriter(){const e=Object.keys(this.boughtAreas).length,t=new Le;t.writeUint8(e);for(const r in this.boughtAreas)t.writeUint8(this.factory.getMeta().areasById[r].idNum);return t}importFromReader(e){if(!e.getLength())return;this.boughtAreas={};const t=e.readUint8();for(let r=0;r<t;r++){const i=e.readUint8(),s=this.factory.getMeta().areasByIdNum[i];this.setAreaBought(s.id,!0)}}}const W={FACTORY_COMPONENTS_CHANGED:"FACTORY_COMPONENTS_CHANGED",TILE_TYPE_CHANGED:"TILE_TYPE_CHANGED",FACTORY_TICK:"FACTORY_TICK",FACTORY_MOUSE_OUT:"FACTORY_MOUSE_OUT",FACTORY_MOUSE_MOVE:"FACTORY_MOUSE_MOVE",FACTORY_MOUSE_DOWN:"FACTORY_MOUSE_DOWN",FACTORY_MOUSE_UP:"FACTORY_MOUSE_UP",FACTORY_SCROLL_START:"FACTORY_SCROLL_START",FACTORY_SCROLL_END:"FACTORY_SCROLL_END",COMPONENT_META_SELECTED:"COMPONENT_META_SELECTED",HOVER_COMPONENT_META:"HOVER_COMPONENT_META",MAP_TOOL_SELECTED:"MAP_TOOL_SELECTED",COMPONENT_SELECTED:"COMPONENT_SELECTED",REFRESH_COMPONENT_INFO:"REFRESH_COMPONENT_INFO",UPGRADE_BOUGHT:"UPGRADE_BOUGHT",OPEN_SCREENSHOT_VIEW:"SHOW_SCREENSHOT_VIEW"};class ut{constructor(e,t){this.tile=e,this.factory=e.getFactory(),this.componentMeta=t}static possibleToBuy(e,t){return!t.requiresResearch||e.getGame().getResearchManager().getResearch(t.requiresResearch)>0}canBuy(){return this.factory.isPossibleToBuildOnTypeWithSize(this.tile.getX(),this.tile.getY(),this.componentMeta.width,this.componentMeta.height,this.componentMeta)&&!(this.componentMeta.price>this.factory.getGame().getMoney())&&ut.possibleToBuy(this.factory,this.componentMeta)&&this.factory.getAreasManager().canBuildAt(this.tile.getX(),this.tile.getY(),this.componentMeta.width,this.componentMeta.height)}buy(){this.factory.getGame().addMoney(-this.componentMeta.price),this.buyFree()}buyFree(){this.tile.setComponent(this.componentMeta),this.factory.getEventManager().invokeEvent(W.FACTORY_COMPONENTS_CHANGED,this.tile)}}class Bs{constructor(e,t){this.fromTile=e,this.toTile=t,this.factory=e.getFactory()}canUpdate(){const e=this.fromTile.getComponent(),t=this.toTile.getComponent();if(!e||!t||e===t||!this.fromTile.getDirection(this.toTile))return!1;const r=e.getMeta(),i=t.getMeta();return(r.strategy.type==="transport"||i.strategy.type==="transport")&&this._isLinkAllowed(this.fromTile,this.toTile,r.allowedOutputs)&&this._isLinkAllowed(this.toTile,this.fromTile,i.allowedInputs)&&!this._detectLoop(this.fromTile,this.toTile)}_isLinkAllowed(e,t,r){if(!r)return!0;const i=e.getDirection(t),s=e.getX()-e.getComponent().getX(),o=e.getY()-e.getComponent().getY();return r[`${s}:${o}`]||r[`${s}:${o}:${i}`]}_detectLoop(e,t){const r=(i,s=0)=>{if(i.getComponent().getMeta().strategy.type!=="transport")return!1;if(i.getId()===e.getId()&&s>0)return!0;for(const o of i.getInputOutputManager().getOutputsList())if(r(o,s+1))return!0;return!1};return r(t,0)}update(){this.fromTile.getInputOutputManager().setOutput(this.fromTile.getDirection(this.toTile)),this.factory.getEventManager().invokeEvent(W.FACTORY_COMPONENTS_CHANGED,this.fromTile)}}class Do{constructor(e){this.factory=e,this.factoryMeta=e.getMeta(),this.gameMeta=e.getGame().getMeta()}init(){return this._initComponents(),this._initTransportLines(),this}_initComponents(){if(this.factoryMeta.startComponents)for(const e of this.factoryMeta.startComponents){const t=this.factory.getTile(e.x,e.y);new ut(t,this.gameMeta.componentsById[e.id]).buyFree()}}_initTransportLines(){if(this.factoryMeta.transportLineConnections)for(const e of this.factoryMeta.transportLineConnections){const t=this.factory.getTile(e.fromX,e.fromY),r=this.factory.getTile(e.toX,e.toY),i=new Bs(t,r);i.canUpdate()&&i.update()}}}class Fo{constructor(e,t){this.game=t,this.isPaused=!1,this.isBought=!1,this.meta=e,this.em=new Ct(W,"Factory"),this.upgradesManager=new No(this),this.tiles=[],this.components=[];for(let r=0;r<e.tilesY;r++)for(let i=0;i<e.tilesX;i++){const s=e.terrains[e.terrainMap[r*e.tilesX+i]],o=e.buildMap[r*e.tilesX+i];this.tiles[r*e.tilesX+i]=new Ae(i,r,o,s,this)}this.areasManager=new Uo(this)}reset(){this.tiles.forEach(e=>e.setComponent(null)),new Do(this).init()}getEventManager(){return this.em}getUpgradesManager(){return this.upgradesManager}getAreasManager(){return this.areasManager}getMeta(){return this.meta}setIsBought(e){this.isBought=e}getIsBought(){return this.isBought}getGame(){return this.game}getTiles(){return this.tiles}getComponents(){return this.components}getTile(e,t){return e<0||e>=this.meta.tilesX||t<0||t>=this.meta.tilesY?null:this.tiles[t*this.meta.tilesX+e]}getIsPaused(){return this.isPaused}setIsPaused(e){this.isPaused=e}isOnMap(e,t,r=1,i=1){return e>=0&&t>=0&&e+r<=this.meta.tilesX&&t+i<=this.meta.tilesY}isPossibleToBuildOnTypeWithSize(e,t,r=1,i=1,s){if(!this.isOnMap(e,t,r,i))return!1;for(let o=0;o<r;o++)for(let u=0;u<i;u++){const l=this.getTile(e+o,t+u);if(!l||!l.isPossibleToBuildOnType(s)||l.getComponent())return!1}return!0}exportToWriter(){const e=new Le;e.writeWriter(this.upgradesManager.exportToWriter()),e.writeWriter(this.areasManager.exportToWriter()),e.writeUint8(this.isPaused?1:0),e.writeUint8(this.isBought?1:0),e.writeUint8(this.meta.tilesX),e.writeUint8(this.meta.tilesY);const t=[];e.writeBooleansArrayFunc(this.tiles,r=>r.isMainComponentContainer()?(t.push(r),!0):!1);for(const r of t)e.writeUint8(r.getComponent().getMeta().idNum);for(const r of t)r.exportToWriter1(e);for(const r of t)r.exportToWriter2(e);return e}importFromReader(e,t){this.upgradesManager.importFromReader(e.readReader(),t),this.areasManager.importFromReader(e.readReader(),t),this.isPaused=!!e.readUint8(),this.isBought=!!e.readUint8();const r=e.readUint8(),i=e.readUint8();this.tiles.forEach(o=>o.setComponent(null));const s=[];e.readBooleanArrayFunc(r*i,(o,u)=>{u&&s.push(this.tiles[Math.floor(o/r)*this.meta.tilesX+o%r])});for(const o of s){const u=e.readUint8();o.setComponent(this.getGame().getMeta().componentsByIdNum[u])}for(const o of s)o.importFromReader1(e,t);for(const o of s)o.importFromReader2(e,t);this.em.invokeEvent(W.FACTORY_COMPONENTS_CHANGED)}}class qo{game;research={};constructor(e){this.game=e}setResearch(e,t){this.research[e]=t}addResearch(e,t){this.setResearch(e,this.getResearch(e)+t)}getResearch(e){return this.research[e]||0}getPrice(e){const t=this.game.getMeta().researchById[e];if(!t)return 0;let r=t.price||0;for(let i=0;i<this.getResearch(t.id);i++)r*=t.priceIncrease;return r}getPriceResearchPoints(e){const t=this.game.getMeta().researchById[e];if(!t)return 0;let r=t.priceResearchPoints||0;for(let i=0;i<this.getResearch(t.id);i++)r*=t.priceIncrease;return r}couldPurchase(e){const t=this.game.getMeta().researchById[e];return!(this.getResearch(e)>=t.max)}isVisible(e){const t=this.game.getMeta().researchById[e];return!t.requiresResearch||this.getResearch(t.requiresResearch)>0}canPurchase(e){return this.couldPurchase(e)&&this.game.getMoney()>=this.getPrice(e)&&this.game.getResearchPoints()>=this.getPriceResearchPoints(e)&&this.isVisible(e)}exportToWriter(){const e=new Le,t=new Le,r=this.game.getMeta().researchByIdNum;return t.writeUint16(r.length),t.writeBooleansArrayFunc(r,i=>{if(!i)return!1;const s=this.research[i.id]||0;return s>0?(s>1&&(e.writeUint16(i.idNum),e.writeUint16(s)),!0):!1}),t.writeWriter(e),t}importFromReader(e){if(e.getLength()===0)return;this.research={};const t=e.readUint16();e.readBooleanArrayFunc(t,(i,s)=>{if(s){const o=this.game.getMeta().researchByIdNum[i];o&&this.setResearch(o.id,1)}});const r=e.readReader();for(;r.getOffset()<r.getLength();){const i=r.readUint16(),s=r.readUint16(),o=this.game.getMeta().researchByIdNum[i];o&&this.setResearch(o.id,s)}}}const J={GAME_TICK:"GAME_TICK",MONEY_UPDATED:"MONEY_UPDATED",RESEARCH_POINTS_UPDATED:"RESEARCH_POINTS_UPDATED",ACHIEVEMENT_RECEIVED:"ACHIEVEMENT_RECEIVED",TICKS_STOPPED:"TICKS_STOPPED",TICKS_STARTED:"TICKS_STARTED",BONUS_TICKS_UPDATED:"BONUS_TICKS_UPDATED",TIME_TRAVEL_TICKETS_UPDATED:"TIME_TRAVEL_TICKETS_UPDATED",FOCUS:"FOCUS",BLUR:"BLUR",RESEARCH_BOUGHT:"RESEARCH_BOUGHT",BACKGROUND_MODE_ACTIVATED:"BACKGROUND_MODE_ACTIVATED",BACKGROUND_MODE_DISABLED:"BACKGROUND_MODE_DISABLED"};class Ho{constructor(e){this.game=e,this.achievements={},this.testers=this.getTesterImplementations(),this.bonuses=this.getBonusImplementations()}_setAchieved(e,t){this.achievements[e]=t}setAchieved(e,t){this._setAchieved(e,t),t&&this.game.getEventManager().invokeEvent(J.ACHIEVEMENT_RECEIVED,e)}getAchievement(e){return this.achievements[e]}isVisible(e){const t=this.game.getMeta().achievementsById[e];return!(t.requiresAchievement&&!this.getAchievement(t.requiresAchievement))}getTester(e){return this.testers[e.type].test(e)}test(e){return e.tests.every(t=>this.testers[t.type].test(t))}testAll(){const e=this.game.getMeta().achievements;for(const t of e)!this.getAchievement(t.id)&&this.test(t)&&(this.setAchieved(t.id,!0),t.bonus&&this.bonuses[t.bonus.type].invoke(t.bonus))}getTesterDescriptionText(e){const t=this.game.getMeta().achievementsById[e];return t?t.tests.map(r=>this.testers[r.type].getRequirementsInfoText(r)):[]}getBonusDescriptionText(e){const t=this.game.getMeta().achievementsById[e];return!t||!t.bonus?"":this.bonuses[t.bonus.type].getInfoText(t.bonus)}getTesterImplementations(){const e=this.game.getMeta().researchById;return{amountOfMoney:{getRequirementsInfoText:t=>`Have more money than <span class="money">$${K.formatNumber(t.amount)}</span>`,test:t=>this.game.getMoney()>t.amount},avgMoneyIncome:{getRequirementsInfoText:t=>`Have avg income greater than <span class="money">$${K.formatNumber(t.amount)}</span>`,test:t=>this.game.getStatistics().getAvgProfit()>t.amount},researched:{getRequirementsInfoText:t=>`Research ${ct(e[t.researchId].name)}`,test:t=>this.game.getResearchManager().getResearch(t.researchId)>0}}}getBonusImplementations(){return{money:{getInfoText:e=>`<span class="money">+$${K.formatNumber(e.amount)}</span>`,invoke:e=>this.game.addMoney(e.amount)},custom:{getInfoText:e=>e.description,invoke:()=>{}}}}exportToWriter(){const e=new Le,t=this.game.getMeta().achievementsByIdNum;return e.writeUint16(t.length),e.writeBooleansArrayFunc(t,r=>this.getAchievement(r.id)),e}importFromReader(e){if(e.getLength()===0)return;const t=e.readUint16();this.achievements={},e.readBooleanArrayFunc(t,(r,i)=>{if(i){const s=this.game.getMeta().achievementsByIdNum[r];s&&this._setAchieved(s.id,!0)}}),Object.keys(this.achievements).length}}class Yo{constructor(e){this.factory=e,this.endTiles=[],this.doneIndex=[],this.queue=[],this.queueChecked=0}calculate(){this.doneIndex.length=0,this.queue.length=0,this.queueChecked=0;for(const e of this.endTiles)this.queue.push(e),this.log(`${e.getIdStr()} added to queue as end tile`);for(;this.queue.length>this.queueChecked;)this.step(this.queue[this.queueChecked]),this.queueChecked++}log(e){}step(e){if(!this.doneIndex[e.getId()]){const t=e.getInputOutputManager().getOutputsList();if(t.length>1&&t.filter(o=>this.doneIndex[o.getId()]).length!==t.length){this.log(`${e.getIdStr()} skipped, not all outputs calculated!`);return}this.doneIndex[e.getId()]=!0,this.log(`Calculate ${e.getIdStr()}`),e.getComponent().getStrategy().calculateTransport?.();const i=e.getInputOutputManager().getInputsList();for(const s of i)this.queue.push(s),this.log(`${s.getIdStr()} added to queue`)}}buildCaches(){this.endTiles=[];const e=this.factory.getTiles();for(const t of e)t.getComponent()&&t.getInputOutputManager().getOutputsList().length!==0&&t.getComponent().getMeta().strategy.type==="transport"&&this.endTiles.push(t)}}class Wo{constructor(e){this.factory=e,this.transportCalculator=new Yo(e),this.components=[],this.strategies={},this.cachesOk=!1}calculate(){this.cachesOk||this.buildCaches();const e={runningCosts:0,resourceCosts:0,resourceSales:0,researchProduction:0,profit:0};if(this.factory.getIsPaused())e.isPaused=!0;else{for(const t of this.components)t.calculateInputTick(e),t.getStrategy().calculateInputTick?.(e);this.transportCalculator.calculate();for(const t of this.components)t.getStrategy().calculateOutputTick?.(e);this.factory.getEventManager().invokeEvent(W.FACTORY_TICK,e)}return e.profit=e.resourceSales-e.resourceCosts-e.runningCosts,e}buildCaches(){this.cachesOk=!0,this.transportCalculator.buildCaches(),this.components=this.factory.getTiles().filter(e=>e.isMainComponentContainer()).map(e=>e.getComponent())}setup(){this.factory.getEventManager().addListener("FactoryCalculator",W.FACTORY_COMPONENTS_CHANGED,()=>{this.cachesOk=!1})}destroy(){this.factory.getEventManager().removeListenerForType("FactoryCalculator")}}class Vo{constructor(e){this.game=e,this.factoryCalculators={};for(const t in e.getMeta().factoriesById)this.factoryCalculators[t]=new Wo(e.getFactory(t))}init(){for(const e of Object.values(this.factoryCalculators))e.setup();return this}destroy(){for(const e of Object.values(this.factoryCalculators))e.destroy()}calculate(){const e={profit:0,researchProduction:0,factory_results:{}};for(const t in this.factoryCalculators){const r=this.factoryCalculators[t].calculate();e.profit+=r.profit,e.researchProduction+=r.researchProduction,e.factory_results[t]=r}return this.game.addMoney(e.profit),this.game.addResearchPoints(e.researchProduction),e}}class Ni{config;data;constructor(e){this.config=e,this.reset()}getData(){return this.data}_buildDataStructure(e){const t={variables:{},sampleCounter:0};for(const r of e.fields)t.variables[r]={sum:0,values:[],sample:null};return e.child&&(t.addToChildCounter=0,t.child=this._buildDataStructure(e.child)),t}reset(){this.data=this._buildDataStructure(this.config)}handleInput(e){this._handleCollector(this.config,this.data,e)}_handleCollector(e,t,r){t.sampleCounter++;const i={};for(const s of e.fields){const o=t.variables[s];o.sum+=r[s],o.values.length>=e.max_values_length&&(o.sum-=o.values.shift()),o.values.push(r[s]);const u=o.sum/o.values.length;i[s]=u,t.sampleCounter>=e.sample_interval&&(o.sample=u)}t.sampleCounter>=e.sample_interval&&(t.sampleCounter=0),e.child&&e.add_to_child_interval&&(t.addToChildCounter++,t.addToChildCounter>=e.add_to_child_interval&&(t.addToChildCounter=0,this._handleCollector(e.child,t.child,i)))}}class zo{game;gameCollector;factoryCollectors={};constructor(e){this.game=e,this.gameCollector=new Ni({max_values_length:80,sample_interval:10,fields:["profit","researchProduction"]});for(const t of this.game.getMeta().factories)this.factoryCollectors[t.id]=new Ni({max_values_length:80,sample_interval:10,fields:["profit","researchProduction"]})}init(){return this.game.getEventManager().addListener("Statistics",J.GAME_TICK,e=>{let t={profit:e.profit,researchProduction:e.researchProduction};this.gameCollector.handleInput(t);for(const r of this.game.getMeta().factories){const i=e.factory_results[r.id];i&&!i.isPaused&&(t={profit:i.profit,researchProduction:i.researchProduction},this.factoryCollectors[r.id].handleInput(t))}}),this}destroy(){this.game.getEventManager().removeListenerForType("Statistics")}reset(){this.gameCollector.reset();for(const e of Object.values(this.factoryCollectors))e.reset()}getAvgProfit(){return this.gameCollector.getData().variables.profit.sample}getAvgResearchPointsProduction(){return this.gameCollector.getData().variables.researchProduction.sample}getFactoryAvgProfit(e){return this.factoryCollectors[e]?.getData().variables.profit.sample}getFactoryAvgResearchPointsProduction(e){return this.factoryCollectors[e]?.getData().variables.researchProduction.sample}exportToWriter(){return new Le}importFromReader(e,t){}}const $o=()=>{const p=new Date,e=t=>String(t).padStart(2,"0");return`${e(p.getHours())}:${e(p.getMinutes())}:${e(p.getSeconds())}`},Ut=(p,e,t,r)=>{const i=[$o(),e,p,t];r!==void 0&&i.push(JSON.stringify(r)),console.log(i.join(" | "))},Q={config:null,init(p){this.config=p},debug(p,e,t){Ut(p,"debug",e,t)},info(p,e,t){Ut(p,"info",e,t)},warning(p,e,t){Ut(p,"warning",e,t)},error(p,e,t){Ut(p,"error",e,t)}};class Ko{name;timeSpent=0;count=0;weightSum=0;lastStartTime=null;firstStartTime=null;interval=null;intervalValue=2e3;constructor(e){this.name=e}init(){this.firstStartTime=Date.now(),this.interval=setInterval(()=>{const t=Date.now()-this.firstStartTime;this.weightSum&&Math.round(this.timeSpent/this.weightSum*10)/10,Math.round(100*this.timeSpent/t*100)/100,this.timeSpent=0,this.count=0,this.weightSum=0,this.firstStartTime=Date.now()},this.intervalValue)}destroy(){this.interval&&clearInterval(this.interval)}start(){this.lastStartTime=Date.now()}stop(e=1){this.lastStartTime&&(this.timeSpent+=Date.now()-this.lastStartTime,this.count++,this.weightSum+=e)}}class jo{game;confirmedTimestamp;ticks=0;bonusTicks=0;purchaseBonusTicks=0;timeTravelTickets=1;focused=!0;isPlaying=!1;isFastActive=!1;interval=null;noOfTicks=0;lastSaveTimestamp=null;benchmarker;backgroundModeTimeout=null;actualTicksPerSec={ticks:0,second:0,actual:0};constructor(e,t){this.game=e,this.confirmedTimestamp=t,this.benchmarker=new Ko(e.getMeta()?.id)}init(){return this.start(),this.game.getEventManager().addListener("Ticker",J.FOCUS,()=>this.disableBackgroundMode()),this.game.getEventManager().addListener("Ticker",J.BLUR,()=>this.startBackgroundModeTimer()),this.game.getEventManager().addListener("Ticker",J.RESEARCH_BOUGHT,()=>this.updateInterval()),Q.info("Ticker",`Ticker initialized for game ${this.game.getMeta()?.id}`),this.benchmarker.init(),this}startBackgroundModeTimer(){this.backgroundModeTimeout&&clearTimeout(this.backgroundModeTimeout),this.backgroundModeTimeout=setTimeout(()=>{const e=this.focused;this.focused=!1,e&&this.updateInterval(),this.game.getEventManager().invokeEvent(J.BACKGROUND_MODE_ACTIVATED)},15e3)}disableBackgroundMode(){this.backgroundModeTimeout&&clearTimeout(this.backgroundModeTimeout);const e=!this.focused;this.focused=!0,e&&this.updateInterval(),this.game.getEventManager().invokeEvent(J.BACKGROUND_MODE_DISABLED)}destroy(){this.stop(),this.game.getEventManager().removeListenerForType("Ticker"),this.benchmarker.destroy()}getBonusTicks(){return this.bonusTicks}addBonusTicks(e){this.bonusTicks=Math.round(this.bonusTicks+e),this.game.getEventManager().invokeEvent(J.BONUS_TICKS_UPDATED)}setBonusTicks(e){this.bonusTicks=e,this.game.getEventManager().invokeEvent(J.BONUS_TICKS_UPDATED)}setPurchaseBonusTicks(e){this.purchaseBonusTicks=e,this.updateInterval()}getTimeTravelTickets(){return this.timeTravelTickets}addTimeTravelTickets(e){this.timeTravelTickets=Math.round(this.timeTravelTickets+e),this.game.getEventManager().invokeEvent(J.TIME_TRAVEL_TICKETS_UPDATED)}setTimeTravelTickets(e){this.timeTravelTickets=e,this.game.getEventManager().invokeEvent(J.TIME_TRAVEL_TICKETS_UPDATED)}getLastSaveTimestamp(){return this.lastSaveTimestamp}getIsPlaying(){return this.isPlaying}getIsFastActive(){return this.isFastActive}getIsFocused(){return this.focused}getNoOfTicks(){return this.noOfTicks}addNoOfTicks(e){this.noOfTicks+=e}getNormalTicksPerSec(){return 4+this.game.getResearchManager().getResearch("chronometer")+this.purchaseBonusTicks}getTicksPerSec(){return this.isFastActive?200:this.getNormalTicksPerSec()}getActualTicksPerSec(){return this.actualTicksPerSec.actual}getTickData(){let e=1,t=this.getTicksPerSec();return this.focused||(e=t,t=1),{runs:e,ticksPerSec:t}}updateInterval(){if(this.interval&&clearInterval(this.interval),this.interval=null,!this.isPlaying)return;const{runs:e,ticksPerSec:t}=this.getTickData();this.interval=setInterval(()=>{this.benchmarker.start();for(let r=0;r<e;r++)this.tick();this.benchmarker.stop(e)},Math.round(1e3/t)),this.game.getEventManager().invokeEvent(J.TICKS_STARTED)}start(){this.isPlaying=!0,this.updateInterval()}stop(){this.isPlaying=!1,this.isFastActive=!1,this.interval&&clearInterval(this.interval),this.interval=null,this.game.getEventManager().invokeEvent(J.TICKS_STOPPED)}startFast(){this.bonusTicks>0&&(this.isPlaying=!0,this.isFastActive=!0,this.updateInterval())}stopFast(){this.isFastActive=!1,this.updateInterval()}calculateOfflineGains(){const e=this.game.getMeta();if(!this.lastSaveTimestamp||!e.maxBonusTicks)return 0;let t=(this.confirmedTimestamp.getConfirmedNow()-this.lastSaveTimestamp)*this.getNormalTicksPerSec();t=Math.round(t/e.offlineSlower);const r=e.maxBonusTicks*this.getNormalTicksPerSec();return t>r&&(t=r),t<e.minBonusTicks&&(t=0),t}addOfflineGains(){const e=this.calculateOfflineGains();Q.info("Ticker",`Bonus ticks gained: ${e}`),this.addBonusTicks(e)}tick(){const e=this.game.getCalculator().calculate();this.game.getEventManager().invokeEvent(J.GAME_TICK,e),this.noOfTicks++,this.noOfTicks%5===0&&this.game.getAchievementsManager().testAll(),this.isFastActive&&(this.addBonusTicks(-1),this.bonusTicks<=0&&(this.isFastActive=!1,this.updateInterval()));const t=Math.floor(Date.now()/1e3);this.actualTicksPerSec.ticks++,t!==this.actualTicksPerSec.second&&(this.actualTicksPerSec.actual=this.actualTicksPerSec.ticks,this.actualTicksPerSec.ticks=0,this.actualTicksPerSec.second=t)}exportToWriter(){const e=new Le;return e.writeUint32(this.bonusTicks),e.writeUint16(this.timeTravelTickets),e.writeUint32(this.noOfTicks),e.writeUint32(this.confirmedTimestamp.getConfirmedNow()),e}importFromReader(e,t){this.setBonusTicks(e.readUint32()),t>=5&&(this.timeTravelTickets=e.readUint16()),this.noOfTicks=e.readUint32(),this.lastSaveTimestamp=e.readUint32()}}const Z={SHOW_FACTORY:"SHOW_FACTORY",SHOW_FACTORIES:"SHOW_FACTORIES",SHOW_RESEARCH:"SHOW_RESEARCH",SHOW_UPGRADES:"SHOW_UPGRADES",SHOW_ACHIEVEMENTS:"SHOW_ACHIEVEMENTS",SHOW_HELP:"SHOW_HELP",SHOW_STATISTICS:"SHOW_STATISTICS",SHOW_PURCHASES:"SHOW_PURCHASES",SHOW_SETTINGS:"SHOW_SETTINGS",SHOW_TIME_TRAVEL:"SHOW_TIME_TRAVEL",GAME_TICK:"GAME_TICK",MONEY_UPDATED:"MONEY_UPDATED",RESEARCH_POINTS_UPDATED:"RESEARCH_POINTS_UPDATED",ACHIEVEMENT_RECEIVED:"ACHIEVEMENT_RECEIVED",TOGGLE_TICKS:"TOGGLE_TICKS",TICKS_STOPPED:"TICKS_STOPPED",TICKS_STARTED:"TICKS_STARTED",BONUS_TICKS_UPDATED:"BONUS_TICKS_UPDATED",TIME_TRAVEL_TICKETS_UPDATED:"TIME_TRAVEL_TICKETS_UPDATED",FOCUS:"FOCUS",BLUR:"BLUR",RESEARCH_BOUGHT:"RESEARCH_BOUGHT",BACKGROUND_MODE_ACTIVATED:"BACKGROUND_MODE_ACTIVATED",BACKGROUND_MODE_DISABLED:"BACKGROUND_MODE_DISABLED",PREMIUM_STATUS_CHANGED:"PREMIUM_STATUS_CHANGED"},Qo=new Ct(Z,"GameUiBus"),Ee={play:null,game:null,gameUiBus:Qo,reset(){this.play=null,this.game=null,this.gameUiBus=null}};class Jo{constructor(e,t){this.meta=e,this.confirmedTimestamp=t,this.money=e.startingMoney,this.researchPoints=e.startingResearchPoints,this.em=Ee.gameUiBus,this.factories={};for(const r in e.factories){const i=e.factories[r];this.factories[i.id]=new Fo(i,this)}this.researchManager=new qo(this),this.achievementsManager=new Ho(this),this.calculator=new Vo(this),this.statistics=new zo(this),this.ticker=new jo(this,t),this.profitMultiplier=1,this.researchProductionMultiplier=1,this.isPremium=!1}init(){return this.calculator.init(),this.statistics.init(),this.ticker.init(),this}destroy(){this.calculator.destroy(),this.statistics.destroy(),this.ticker.destroy()}getMeta(){return this.meta}getEventManager(){return this.em}getResearchManager(){return this.researchManager}getAchievementsManager(){return this.achievementsManager}getCalculator(){return this.calculator}getStatistics(){return this.statistics}getTicker(){return this.ticker}getFactory(e){return this.factories[e]}setProfitMultiplier(e){this.profitMultiplier=e}getProfitMultiplier(){return this.profitMultiplier}setResearchProductionMultiplier(e){this.researchProductionMultiplier=e}getResearchProductionMultiplier(){return this.researchProductionMultiplier}setIsPremium(e){this.isPremium=e}getIsPremium(){return this.isPremium}getMoney(){return this.money}setMoney(e){e=isNaN(Number(e))?0:e,e<this.meta.minNegativeMoney&&(e=this.meta.minNegativeMoney),this.money=e,this.em.invokeEvent(J.MONEY_UPDATED,this.money)}addMoney(e){this.setMoney(this.money+(isNaN(Number(e))?0:e))}getResearchPoints(){return this.researchPoints}setResearchPoints(e){e=isNaN(Number(e))?0:e,this.researchPoints=e,this.em.invokeEvent(J.RESEARCH_POINTS_UPDATED,this.researchPoints)}addResearchPoints(e){this.setResearchPoints(this.researchPoints+(isNaN(Number(e))?0:e))}exportToWriter(){const e=new Le;e.writeUint16(7),e.writeFloat64(this.money),e.writeFloat64(this.researchPoints),e.writeInt8(this.isPremium?1:0),e.writeWriter(this.researchManager.exportToWriter()),e.writeWriter(this.achievementsManager.exportToWriter()),e.writeWriter(this.statistics.exportToWriter()),e.writeWriter(this.ticker.exportToWriter()),e.writeUint8(this.meta.factories.length);for(const t in this.factories){const r=this.factories[t];e.writeUint8(r.getMeta().idNum),e.writeWriter(r.exportToWriter())}return e}importFromReader(e){const t=e.readUint16();this.setMoney(e.readFloat64()),this.setResearchPoints(e.readFloat64()),t>=7?this.setIsPremium(!!e.readInt8()):this.setIsPremium(!1),this.researchManager.importFromReader(e.readReader(),t),this.achievementsManager.importFromReader(e.readReader(),t),this.statistics.importFromReader(e.readReader(),t),this.ticker.importFromReader(e.readReader(),t);const r=e.readUint8();for(let i=0;i<r;i++){const s=this.meta.factoriesByIdNum[e.readUint8()],o=e.readReader();s||console.warn("Game.import: Missing factoryMeta for index",i),s&&this.factories[s.id].importFromReader(o,t)}this.statistics.reset()}}const Ls=()=>{const p={},e=new URLSearchParams(window.location.search);for(const[t,r]of e.entries())p[t]=r;return p},Zo=()=>{const p=Ls(),e=p.ref;if(p.kongregate_username&&e==="kongregate")return"kongregate";if(e==="notdoppler")return"notdoppler";if(e==="armorgames")return"armorgames";if(e==="newgrounds")return"newgrounds";if(e==="beta")return"beta";const t=window.location.href;return t.includes("localhost")||t.includes("file")?"localhost":"direct"},Xr={getUrlVars:Ls,identifySite:Zo},$e="SaveManager";class ea{constructor(e,t,r){this.api=e,this.localStorageKey=`${r}|${t}`,this.cloudSaveName="Main",this.cloudSaveIntervalMs=qe.saveManager.cloudSaveIntervalMs,this.localSaveIntervalMs=qe.saveManager.localSaveIntervalMs,this.cloudSaveInterval=null,this.localSaveInterval=null;const i=Xr.getUrlVars();this.useCloud=i.cloud!=="0"&&i.cloud!==0&&i.cloud!=="false",this.useCloud||Q.info($e,"Cloud save disabled")}getCloudSaveInterval(){return this.cloudSaveIntervalMs}getLocalSaveInterval(){return this.localSaveIntervalMs}setUpdateGameFromLoadedDataCallback(e){return this.updateGameFromLoadedDataCallback=e,this}setGetSaveDataCallback(e){return this.saveDataCallback=e,this}init(e,t){return new Promise(r=>{const i=()=>{this._startInterval(),Q.info($e,"Initialized"),t?.(),r()};e?(this.saveAutoCloud(()=>{}),this.saveAutoLocal(()=>{}),i()):this.loadAuto(()=>i())})}_startInterval(){this.cloudSaveInterval=setInterval(()=>{this.saveAutoCloud(()=>{Q.info($e,"Auto saved to cloud")})},this.cloudSaveIntervalMs),this.localSaveInterval=setInterval(()=>{this.saveAutoLocal(()=>{Q.info($e,"Auto saved to local")})},this.localSaveIntervalMs)}destroy(){this.cloudSaveInterval&&clearInterval(this.cloudSaveInterval),this.localSaveInterval&&clearInterval(this.localSaveInterval)}getSavesInfo(e,t){this.api.getSavesInfo(e,t)}saveManual(e,t){this._saveCloud(e,t)}saveAuto(e){this._saveLocal(this.cloudSaveName,()=>{this._saveCloud(this.cloudSaveName,e)})}saveAutoCloud(e){this._saveCloud(this.cloudSaveName,e)}saveAutoLocal(e){this._saveLocal(this.cloudSaveName,e)}_saveCloud(e,t){this.useCloud?this.api.save(e,this.saveDataCallback(),t):(Q.info($e,"Cloud save skipped!"),t?.())}_saveLocal(e,t){localStorage.setItem(`${this.localStorageKey}|${e}`,JSON.stringify(this.saveDataCallback())),t?.()}loadManual(e,t){this._loadCloud(e,r=>{this.updateGameFromSaveData(r),this.saveAutoCloud(()=>{}),t?.()})}loadAuto(e){this._loadCloud(this.cloudSaveName,t=>{this._loadLocal(this.cloudSaveName,r=>{let i=null;r&&t?r.meta.ver>t.meta.ver?(Q.info($e,`Preferred local save local ver:${r.meta.ver} > cloud ver:${t.meta.ver}`),i=r):(Q.info($e,`Preferred cloud save local ver:${r.meta.ver} < cloud ver:${t.meta.ver}`),i=t):r?i=r:t&&(i=t),i&&this.updateGameFromSaveData(i),e?.()})})}updateGameFromSaveData(e){this.updateGameFromLoadedDataCallback?.(e)}_loadCloud(e,t){this.api.load(e,t)}_loadLocal(e,t){try{const r=`${this.localStorageKey}|${e}`,i=localStorage.getItem(r);if(!i){console.log("SaveManager: No local save found for slot",e),t(null);return}try{const s=JSON.parse(i);console.log("SaveManager: Local save data length:",typeof s?.data=="string"?s.data.length:0),t(s)}catch(s){console.warn("SaveManager: Failed to parse local save JSON",s),t(null)}}catch(r){console.warn("SaveManager: Error while loading local save",r),t(null)}}}class ta{constructor(e){this.play=e,this.game=e.getGame(),this.unlocks={},this.strategies={bonusTicks:{apply:({amount:t})=>{this.game.getTicker().addBonusTicks(t),this.game.setIsPremium(!0),Q.info("PurchasesManager",`Added ${t} bonus ticks`)}},timeTravelTickets:{apply:({amount:t})=>{this.game.getTicker().addTimeTravelTickets(t),this.game.setIsPremium(!0),Q.info("PurchasesManager",`Added ${t} time travel tickets`)}},researchProductionBonus:{apply:({bonus:t})=>{this.game.setResearchProductionMultiplier(this.game.getResearchProductionMultiplier()*t),this.game.setIsPremium(!0),Q.info("PurchasesManager","Set research production bonus")}},extraTicks:{apply:({bonus:t})=>{this.game.getTicker().setPurchaseBonusTicks(t),this.game.setIsPremium(!0),Q.info("PurchasesManager","Set extra ticks")}},extraProfit:{apply:({bonus:t})=>{this.game.setProfitMultiplier(t),this.game.setIsPremium(!0),Q.info("PurchasesManager","Set extra profit")}}}}isVisible(e){const t=this.play.getMeta().productsById[e];return t?!(t.requiresProduct&&!this.getIsUnlocked(t.requiresProduct))&&!t.special:!1}getPriceKey(){return this.play.getApi().getKey()}init(e=()=>{}){this.loadPurchases(e)}loadPurchases(e=()=>{}){this.play.getApi().loadPurchases(t=>{Q.info("PurchasesManager","Purchases loaded",t),this.handlePurchases(t),e()})}startPurchase(e,t=()=>{}){this.play.getApi().purchase(e,()=>{this.loadPurchases(t)})}destroy(){}handlePurchases(e){this.game.setResearchProductionMultiplier(1),this.game.getTicker().setPurchaseBonusTicks(0),this.game.setProfitMultiplier(1),e.forEach(this.handlePurchase.bind(this))}handlePurchase(e){const t=this.play.getMeta().productsById[e.productId];if(!t){Q.warning("PurchasesManager",`Unknown product with id ${e.productId}`,e);return}const r=this.strategies[t.strategy.type];r?(r.apply(t.strategy),Q.info("PurchasesManager",`Applied consumable strategy ${t.strategy.type} for purchase ${e.productId}`),t.consumable?this.play.getSaveManager().saveAuto(()=>{this.play.getApi().setConsumed(e.externalId,()=>{Q.info("PurchasesManager",`Purchase ${e.externalId} set to consumed`)})}):(this.unlocks[e.productId]=!0,Q.info("PurchasesManager",`Purchase unlocked ${e.productId} with external id ${e.externalId}`))):Q.error("PurchasesManager",`Invalid consumable strategy ${t.strategy.type} for purchase ${e.productId}. Could not handle purchase.`)}getIsUnlocked(e){return!!this.unlocks[e]}}class ra{storageKey;hashLength=40;userHash=null;constructor(e){this.storageKey=e}init(){return this.userHash=localStorage.getItem(this.storageKey),this.userHash||(this.userHash=this._generateUserHash(this.hashLength),this.updateUserHash(this.userHash)),this}updateUserHash(e){localStorage.setItem(this.storageKey,e)}getUserHash(){return this.userHash}toString(){return this.userHash}_generateUserHash(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Array.from({length:e},()=>t.charAt(Math.floor(Math.random()*t.length))).join("")}}const ge={INCENTIVIZED_AD_SHOW:"INCENTIVIZED_AD_SHOW",INCENTIVIZED_AD_CHECK_STATUS:"INCENTIVIZED_AD_CHECK_STATUS",INCENTIVIZED_AD_STATUS:"INCENTIVIZED_AD_STATUS",INCENTIVIZED_AD_COMPLETED:"INCENTIVIZED_AD_COMPLETED",INCENTIVIZED_AD_ABANDONED:"INCENTIVIZED_AD_ABANDONED"};class gr{static chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";static lookup=null;static setup(){if(!this.lookup){this.lookup=new Uint8Array(256);for(let e=0;e<this.chars.length;e++)this.lookup[this.chars.charCodeAt(e)]=e}}static encode(e){const t=new Uint8Array(e);let r="";for(let s=0;s<t.length;s+=3){const o=t[s],u=t[s+1]||0,l=t[s+2]||0;r+=this.chars[o>>2],r+=this.chars[(o&3)<<4|u>>4],r+=this.chars[(u&15)<<2|l>>6],r+=this.chars[l&63]}const i=t.length%3;return i===1?r=r.slice(0,-2)+"==":i===2&&(r=r.slice(0,-1)+"="),r}static decode(e){this.setup();let t=0;e.endsWith("==")?t=2:e.endsWith("=")&&(t=1);const r=e.length*3/4-t,i=new ArrayBuffer(r),s=new Uint8Array(i);let o=0;for(let u=0;u<e.length;u+=4){const l=this.lookup[e.charCodeAt(u)],m=this.lookup[e.charCodeAt(u+1)],h=this.lookup[e.charCodeAt(u+2)],f=this.lookup[e.charCodeAt(u+3)];s[o++]=l<<2|m>>4,isNaN(h)||(s[o++]=(m&15)<<4|h>>2),isNaN(f)||(s[o++]=(h&3)<<6|f)}return i}}gr.setup();class Gt{constructor(e){this.buffer=e,this.dataView=new DataView(e),this.offset=0}_read(e,t){if(this.offset+e>this.buffer.byteLength)throw new Error(`Read out of bounds: trying to read ${e} bytes at offset ${this.offset}, buffer length ${this.buffer.byteLength}`);const r=this.dataView[t](this.offset,!0);return this.offset+=e,r}_peek(e,t){if(this.offset+e>this.buffer.byteLength)throw new Error(`Peek out of bounds: trying to peek ${e} bytes at offset ${this.offset}, buffer length ${this.buffer.byteLength}`);return this.dataView[t](this.offset,!0)}peekBytes(e){if(this.offset+e>this.buffer.byteLength)throw new Error(`Peek out of bounds: trying to peek ${e} bytes at offset ${this.offset}, buffer length ${this.buffer.byteLength}`);return new Uint8Array(this.buffer,this.offset,e)}readBooleanMap(){return new Vr(this.readUint8()).reverse()}readChar(){return String.fromCharCode(this.readInt8())}readInt8(){return this._read(1,"getInt8")}readInt16(){return this._read(2,"getInt16")}readInt32(){return this._read(4,"getInt32")}readUint8(){return this._read(1,"getUint8")}readUint16(){return this._read(2,"getUint16")}readUint32(){return this._read(4,"getUint32")}readFloat64(){return this._read(8,"getFloat64")}peekInt8(){return this._peek(1,"getInt8")}peekInt16(){return this._peek(2,"getInt16")}peekInt32(){return this._peek(4,"getInt32")}peekUint8(){return this._peek(1,"getUint8")}peekUint16(){return this._peek(2,"getUint16")}peekUint32(){return this._peek(4,"getUint32")}peekFloat64(){return this._peek(8,"getFloat64")}readReader(){const e=this.readInt32();if(this.offset+e>this.buffer.byteLength)throw new Error("readReader: length exceeds buffer size");const t=new ArrayBuffer(e),r=new Int8Array(t,0,e);for(let i=0;i<e;i++)r[i]=this.readInt8();return new Gt(t)}peekReader(){const e=this.peekInt32();if(this.offset+4+e>this.buffer.byteLength)throw new Error("peekReader: length exceeds buffer size");return new Gt(this.buffer.slice(this.offset+4,this.offset+4+e))}readBooleanArrayFunc(e,t){let r=null;for(let i=0;i<e;i++)i%8===0&&(r=this.readBooleanMap()),t(i,r.readBoolean())}getBuffer(){return this.buffer}getLength(){return this.buffer.byteLength}getOffset(){return this.offset}}class ia{userHash;storageKey;em;purchases=[];savesMeta={};saves={};insentiveInterval=null;isShowingAd=!1;isAvailable=!1;constructor(e,t,r){this.userHash=t,this.storageKey=`${r}|${t}`,this.em=e}getTimestamp(e){e(Math.floor(Date.now()/1e3))}_saveToLocalStorage(){localStorage.setItem(this.storageKey,JSON.stringify({purchases:this.purchases,savesMeta:this.savesMeta,saves:this.saves}))}_loadFromLocalStorage(){this.purchases=[],this.saves={},this.savesMeta={},this.decodeMainSave();try{const e=JSON.parse(localStorage.getItem(this.storageKey));e&&(this.purchases=e.purchases||[],this.savesMeta=e.savesMeta||{},this.saves=e.saves||{})}catch(e){Q.warning("Local","Could not load data",e)}}init(){return new Promise(e=>{this._loadFromLocalStorage(),this.initializeIncentivizedAds(),Q.info("Local","Init"),setTimeout(()=>{Q.info("Local","API loaded"),e()},100)})}destroy(){this.insentiveInterval&&clearInterval(this.insentiveInterval)}purchase(e,t){setTimeout(()=>{this.purchases.push({externalId:String(Math.floor(Math.random()*1e12)),productId:e}),this._saveToLocalStorage(),t()},100)}loadPurchases(e){setTimeout(()=>e(this.purchases),100)}setConsumed(e,t){setTimeout(()=>{this.purchases=this.purchases.filter(r=>r.externalId!==e),this._saveToLocalStorage(),t(!0)},100)}submitStatistic(e,t,r){this._saveToLocalStorage(),setTimeout(r,100)}getSavesInfo(e,t){setTimeout(()=>t(this.savesMeta),100)}load(e,t){setTimeout(()=>t(this.savesMeta[e]?{meta:this.savesMeta[e],data:this.saves[e]}:null),100)}save(e,t,r){setTimeout(()=>{this.savesMeta[e]=t.meta,this.saves[e]=t.data,this._saveToLocalStorage(),r(!0)},100)}initializeIncentivizedAds(){this.insentiveInterval=setInterval(()=>{this.isAvailable=!this.isAvailable,this.em.invokeEvent(ge.INCENTIVIZED_AD_STATUS,this.isAvailable)},2e3),this.em.addListener("Local",ge.INCENTIVIZED_AD_CHECK_STATUS,()=>{this.em.invokeEvent(ge.INCENTIVIZED_AD_STATUS,this.isAvailable)}),this.em.addListener("Local",ge.INCENTIVIZED_AD_SHOW,()=>this._showIncentivizedAd())}_showIncentivizedAd(){if(this.isShowingAd||!this.isAvailable)return;this.isShowingAd=!0,this.isAvailable=!1,this.em.invokeEvent(ge.INCENTIVIZED_AD_STATUS,this.isAvailable);const e=document.createElement("div");e.id="LocalApiAd",e.style.cssText="position:absolute; top:0; left:0; width:100%; height:100%; background-color:red; text-align:center; font-size:50px; padding-top:200px;",e.innerText="This is an ad!",document.body.appendChild(e),setTimeout(()=>{this.isShowingAd=!1,this.em.invokeEvent(ge.INCENTIVIZED_AD_COMPLETED),e.remove()},500)}decodeMainSave(){const t=this.saves["Main"];if(!t)return Q.info("LocalApi","No Main save data found"),null;try{const r=gr.decode(t),i=new Uint8Array(r),s=new Gt(r),o=s.readUint16(),u=s.readFloat64(),l=s.readFloat64();let m=0;return o>=7&&(m=s.readInt8()),{version:o,money:u,researchPoints:l,isPremium:m,reader:s}}catch(r){return Q.warning("LocalApi","Failed to decode Main save",r),null}}}class sa{em;localApi;constructor(e,t){this.em=new Ct(ge,"ApiLocal"),this.localApi=new ia(this.em,e,t)}getEventManager(){return this.em}getKey(){return"local"}init(e){this.localApi.init(e).then(()=>{this.localApi.decodeMainSave()})}destroy(){this.localApi.destroy()}getTimestamp(e){this.localApi.getTimestamp(e)}purchase(e,t){this.localApi.purchase(e,t)}loadPurchases(e){this.localApi.loadPurchases(e)}setConsumed(e,t){this.localApi.setConsumed(e,t)}submitStatistic(e,t,r){this.localApi.submitStatistic(e,t,r)}getSavesInfo(e,t){this.localApi.getSavesInfo(e,t)}load(e,t){this.localApi.load(e,t)}save(e,t,r){this.localApi.save(e,t,r)}initializeIncentivizedAds(){return this.localApi.initializeIncentivizedAds(),!0}}class na{constructor(e,t,r){this.userHash=e,this.apiUrl=t,this.ref=r}init(e){logger.info("ServerApi","Init"),typeof e=="function"&&e()}async getTimestamp(){try{const e=await fetch(`${this.apiUrl}/getTimestamp?user_hash=${this.userHash}`);if(!e.ok)throw new Error("Failed to fetch timestamp");return await e.json()}catch(e){return logger.error("ServerApi","getTimestamp failed",e),null}}purchase(e){const t=`${this.apiUrl}/makePurchase?package_id=${e}&user_hash=${this.userHash}&timezone=${encodeURIComponent(Intl.DateTimeFormat().resolvedOptions().timeZone)}&back_url=${encodeURIComponent(window.location.protocol+"//"+window.location.host)}&site=${this.ref==="direct"?"grestGames":this.ref}`;document.location=t}async loadPurchases(){logger.info("ServerApi","Load items");try{const e=await fetch(`${this.apiUrl}/getPurchases?user_hash=${this.userHash}`);if(!e.ok)throw new Error("Failed to fetch purchases");const t=await e.json();return logger.info("ServerApi","Items loaded",t),t.code!==0?[]:t.data.items.map(r=>({externalId:r.created,productId:r.package_id}))}catch(e){return logger.error("ServerApi","loadPurchases failed",e),[]}}async setConsumed(e){logger.info("ServerApi",`Set consumed ${e}`);try{const t=await fetch(`${this.apiUrl}/setConsumed?user_hash=${this.userHash}&created=${e}`);if(!t.ok)throw new Error("Failed to set consumed");const r=await t.json();return logger.info("ServerApi","Items consumed",r),r.code===0}catch(t){return logger.error("ServerApi","setConsumed failed",t),!1}}}var oa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function aa(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}function ca(p){if(Object.prototype.hasOwnProperty.call(p,"__esModule"))return p;var e=p.default;if(typeof e=="function"){var t=function r(){var i=!1;try{i=this instanceof r}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(p).forEach(function(r){var i=Object.getOwnPropertyDescriptor(p,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return p[r]}})}),t}var Re={exports:{}};const ua={},la=Object.freeze(Object.defineProperty({__proto__:null,default:ua},Symbol.toStringTag,{value:"Module"})),Dt=ca(la),ha="16.6.1",da={version:ha};var Ui;function pa(){if(Ui)return Re.exports;Ui=1;var p={};const e=Dt,t=Dt,r=Dt,i=Dt,o=da.version,u=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function l(E){const P={};let F=E.toString();F=F.replace(/\r\n?/mg,`
`);let O;for(;(O=u.exec(F))!=null;){const x=O[1];let B=O[2]||"";B=B.trim();const q=B[0];B=B.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),q==='"'&&(B=B.replace(/\\n/g,`
`),B=B.replace(/\\r/g,"\r")),P[x]=B}return P}function m(E){E=E||{};const P=g(E);E.path=P;const F=_.configDotenv(E);if(!F.parsed){const q=new Error(`MISSING_DATA: Cannot parse ${P} for an unknown reason`);throw q.code="MISSING_DATA",q}const O=a(E).split(","),x=O.length;let B;for(let q=0;q<x;q++)try{const z=O[q].trim(),re=n(F,z);B=_.decrypt(re.ciphertext,re.key);break}catch(z){if(q+1>=x)throw z}return _.parse(B)}function h(E){console.log(`[dotenv@${o}][WARN] ${E}`)}function f(E){console.log(`[dotenv@${o}][DEBUG] ${E}`)}function c(E){console.log(`[dotenv@${o}] ${E}`)}function a(E){return E&&E.DOTENV_KEY&&E.DOTENV_KEY.length>0?E.DOTENV_KEY:p.DOTENV_KEY&&p.DOTENV_KEY.length>0?p.DOTENV_KEY:""}function n(E,P){let F;try{F=new URL(P)}catch(z){if(z.code==="ERR_INVALID_URL"){const re=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw re.code="INVALID_DOTENV_KEY",re}throw z}const O=F.password;if(!O){const z=new Error("INVALID_DOTENV_KEY: Missing key part");throw z.code="INVALID_DOTENV_KEY",z}const x=F.searchParams.get("environment");if(!x){const z=new Error("INVALID_DOTENV_KEY: Missing environment part");throw z.code="INVALID_DOTENV_KEY",z}const B=`DOTENV_VAULT_${x.toUpperCase()}`,q=E.parsed[B];if(!q){const z=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${B} in your .env.vault file.`);throw z.code="NOT_FOUND_DOTENV_ENVIRONMENT",z}return{ciphertext:q,key:O}}function g(E){let P=null;if(E&&E.path&&E.path.length>0)if(Array.isArray(E.path))for(const F of E.path)e.existsSync(F)&&(P=F.endsWith(".vault")?F:`${F}.vault`);else P=E.path.endsWith(".vault")?E.path:`${E.path}.vault`;else P=t.resolve(process.cwd(),".env.vault");return e.existsSync(P)?P:null}function v(E){return E[0]==="~"?t.join(r.homedir(),E.slice(1)):E}function G(E){const P=!!(E&&E.debug),F=E&&"quiet"in E?E.quiet:!0;(P||!F)&&c("Loading env from encrypted .env.vault");const O=_._parseVault(E);let x=p;return E&&E.processEnv!=null&&(x=E.processEnv),_.populate(x,O,E),{parsed:O}}function M(E){const P=t.resolve(process.cwd(),".env");let F="utf8";const O=!!(E&&E.debug),x=E&&"quiet"in E?E.quiet:!0;E&&E.encoding?F=E.encoding:O&&f("No encoding is specified. UTF-8 is used by default");let B=[P];if(E&&E.path)if(!Array.isArray(E.path))B=[v(E.path)];else{B=[];for(const ee of E.path)B.push(v(ee))}let q;const z={};for(const ee of B)try{const ne=_.parse(e.readFileSync(ee,{encoding:F}));_.populate(z,ne,E)}catch(ne){O&&f(`Failed to load ${ee} ${ne.message}`),q=ne}let re=p;if(E&&E.processEnv!=null&&(re=E.processEnv),_.populate(re,z,E),O||!x){const ee=Object.keys(z).length,ne=[];for(const Ie of B)try{const Ye=t.relative(process.cwd(),Ie);ne.push(Ye)}catch(Ye){O&&f(`Failed to load ${Ie} ${Ye.message}`),q=Ye}c(`injecting env (${ee}) from ${ne.join(",")}`)}return q?{parsed:z,error:q}:{parsed:z}}function A(E){if(a(E).length===0)return _.configDotenv(E);const P=g(E);return P?_._configVault(E):(h(`You set DOTENV_KEY but you are missing a .env.vault file at ${P}. Did you forget to build it?`),_.configDotenv(E))}function b(E,P){const F=Buffer.from(P.slice(-64),"hex");let O=Buffer.from(E,"base64");const x=O.subarray(0,12),B=O.subarray(-16);O=O.subarray(12,-16);try{const q=i.createDecipheriv("aes-256-gcm",F,x);return q.setAuthTag(B),`${q.update(O)}${q.final()}`}catch(q){const z=q instanceof RangeError,re=q.message==="Invalid key length",ee=q.message==="Unsupported state or unable to authenticate data";if(z||re){const ne=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw ne.code="INVALID_DOTENV_KEY",ne}else if(ee){const ne=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw ne.code="DECRYPTION_FAILED",ne}else throw q}}function k(E,P,F={}){const O=!!(F&&F.debug),x=!!(F&&F.override);if(typeof P!="object"){const B=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw B.code="OBJECT_REQUIRED",B}for(const B of Object.keys(P))Object.prototype.hasOwnProperty.call(E,B)?(x===!0&&(E[B]=P[B]),O&&f(x===!0?`"${B}" is already defined and WAS overwritten`:`"${B}" is already defined and was NOT overwritten`)):E[B]=P[B]}const _={configDotenv:M,_configVault:G,_parseVault:m,config:A,decrypt:b,parse:l,populate:k};return Re.exports.configDotenv=_.configDotenv,Re.exports._configVault=_._configVault,Re.exports._parseVault=_._parseVault,Re.exports.config=_.config,Re.exports.decrypt=_.decrypt,Re.exports.parse=_.parse,Re.exports.populate=_.populate,Re.exports=_,Re.exports}/*! Axios v1.12.2 Copyright (c) 2025 Matt Zabriskie and contributors */var Lr,Di;function ma(){if(Di)return Lr;Di=1;function p(d,X){return function(){return d.apply(X,arguments)}}const{toString:e}=Object.prototype,{getPrototypeOf:t}=Object,{iterator:r,toStringTag:i}=Symbol,s=(d=>X=>{const y=e.call(X);return d[y]||(d[y]=y.slice(8,-1).toLowerCase())})(Object.create(null)),o=d=>(d=d.toLowerCase(),X=>s(X)===d),u=d=>X=>typeof X===d,{isArray:l}=Array,m=u("undefined");function h(d){return d!==null&&!m(d)&&d.constructor!==null&&!m(d.constructor)&&n(d.constructor.isBuffer)&&d.constructor.isBuffer(d)}const f=o("ArrayBuffer");function c(d){let X;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?X=ArrayBuffer.isView(d):X=d&&d.buffer&&f(d.buffer),X}const a=u("string"),n=u("function"),g=u("number"),v=d=>d!==null&&typeof d=="object",G=d=>d===!0||d===!1,M=d=>{if(s(d)!=="object")return!1;const X=t(d);return(X===null||X===Object.prototype||Object.getPrototypeOf(X)===null)&&!(i in d)&&!(r in d)},A=d=>{if(!v(d)||h(d))return!1;try{return Object.keys(d).length===0&&Object.getPrototypeOf(d)===Object.prototype}catch{return!1}},b=o("Date"),k=o("File"),_=o("Blob"),E=o("FileList"),P=d=>v(d)&&n(d.pipe),F=d=>{let X;return d&&(typeof FormData=="function"&&d instanceof FormData||n(d.append)&&((X=s(d))==="formdata"||X==="object"&&n(d.toString)&&d.toString()==="[object FormData]"))},O=o("URLSearchParams"),[x,B,q,z]=["ReadableStream","Request","Response","Headers"].map(o),re=d=>d.trim?d.trim():d.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ee(d,X,{allOwnKeys:y=!1}={}){if(d===null||typeof d>"u")return;let S,C;if(typeof d!="object"&&(d=[d]),l(d))for(S=0,C=d.length;S<C;S++)X.call(null,d[S],S,d);else{if(h(d))return;const w=y?Object.getOwnPropertyNames(d):Object.keys(d),T=w.length;let L;for(S=0;S<T;S++)L=w[S],X.call(null,d[L],L,d)}}function ne(d,X){if(h(d))return null;X=X.toLowerCase();const y=Object.keys(d);let S=y.length,C;for(;S-- >0;)if(C=y[S],X===C.toLowerCase())return C;return null}const Ie=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:oa,Ye=d=>!m(d)&&d!==Ie;function br(){const{caseless:d,skipUndefined:X}=Ye(this)&&this||{},y={},S=(C,w)=>{const T=d&&ne(y,w)||w;M(y[T])&&M(C)?y[T]=br(y[T],C):M(C)?y[T]=br({},C):l(C)?y[T]=C.slice():(!X||!m(C))&&(y[T]=C)};for(let C=0,w=arguments.length;C<w;C++)arguments[C]&&ee(arguments[C],S);return y}const Zs=(d,X,y,{allOwnKeys:S}={})=>(ee(X,(C,w)=>{y&&n(C)?d[w]=p(C,y):d[w]=C},{allOwnKeys:S}),d),en=d=>(d.charCodeAt(0)===65279&&(d=d.slice(1)),d),tn=(d,X,y,S)=>{d.prototype=Object.create(X.prototype,S),d.prototype.constructor=d,Object.defineProperty(d,"super",{value:X.prototype}),y&&Object.assign(d.prototype,y)},rn=(d,X,y,S)=>{let C,w,T;const L={};if(X=X||{},d==null)return X;do{for(C=Object.getOwnPropertyNames(d),w=C.length;w-- >0;)T=C[w],(!S||S(T,d,X))&&!L[T]&&(X[T]=d[T],L[T]=!0);d=y!==!1&&t(d)}while(d&&(!y||y(d,X))&&d!==Object.prototype);return X},sn=(d,X,y)=>{d=String(d),(y===void 0||y>d.length)&&(y=d.length),y-=X.length;const S=d.indexOf(X,y);return S!==-1&&S===y},nn=d=>{if(!d)return null;if(l(d))return d;let X=d.length;if(!g(X))return null;const y=new Array(X);for(;X-- >0;)y[X]=d[X];return y},on=(d=>X=>d&&X instanceof d)(typeof Uint8Array<"u"&&t(Uint8Array)),an=(d,X)=>{const S=(d&&d[r]).call(d);let C;for(;(C=S.next())&&!C.done;){const w=C.value;X.call(d,w[0],w[1])}},cn=(d,X)=>{let y;const S=[];for(;(y=d.exec(X))!==null;)S.push(y);return S},un=o("HTMLFormElement"),ln=d=>d.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(y,S,C){return S.toUpperCase()+C}),jr=(({hasOwnProperty:d})=>(X,y)=>d.call(X,y))(Object.prototype),hn=o("RegExp"),Qr=(d,X)=>{const y=Object.getOwnPropertyDescriptors(d),S={};ee(y,(C,w)=>{let T;(T=X(C,w,d))!==!1&&(S[w]=T||C)}),Object.defineProperties(d,S)},dn=d=>{Qr(d,(X,y)=>{if(n(d)&&["arguments","caller","callee"].indexOf(y)!==-1)return!1;const S=d[y];if(n(S)){if(X.enumerable=!1,"writable"in X){X.writable=!1;return}X.set||(X.set=()=>{throw Error("Can not rewrite read-only method '"+y+"'")})}})},pn=(d,X)=>{const y={},S=C=>{C.forEach(w=>{y[w]=!0})};return l(d)?S(d):S(String(d).split(X)),y},mn=()=>{},Xn=(d,X)=>d!=null&&Number.isFinite(d=+d)?d:X;function gn(d){return!!(d&&n(d.append)&&d[i]==="FormData"&&d[r])}const fn=d=>{const X=new Array(10),y=(S,C)=>{if(v(S)){if(X.indexOf(S)>=0)return;if(h(S))return S;if(!("toJSON"in S)){X[C]=S;const w=l(S)?[]:{};return ee(S,(T,L)=>{const H=y(T,C+1);!m(H)&&(w[L]=H)}),X[C]=void 0,w}}return S};return y(d,0)},yn=o("AsyncFunction"),vn=d=>d&&(v(d)||n(d))&&n(d.then)&&n(d.catch),Jr=((d,X)=>d?setImmediate:X?((y,S)=>(Ie.addEventListener("message",({source:C,data:w})=>{C===Ie&&w===y&&S.length&&S.shift()()},!1),C=>{S.push(C),Ie.postMessage(y,"*")}))(`axios@${Math.random()}`,[]):y=>setTimeout(y))(typeof setImmediate=="function",n(Ie.postMessage)),bn=typeof queueMicrotask<"u"?queueMicrotask.bind(Ie):typeof process<"u"&&process.nextTick||Jr;var R={isArray:l,isArrayBuffer:f,isBuffer:h,isFormData:F,isArrayBufferView:c,isString:a,isNumber:g,isBoolean:G,isObject:v,isPlainObject:M,isEmptyObject:A,isReadableStream:x,isRequest:B,isResponse:q,isHeaders:z,isUndefined:m,isDate:b,isFile:k,isBlob:_,isRegExp:hn,isFunction:n,isStream:P,isURLSearchParams:O,isTypedArray:on,isFileList:E,forEach:ee,merge:br,extend:Zs,trim:re,stripBOM:en,inherits:tn,toFlatObject:rn,kindOf:s,kindOfTest:o,endsWith:sn,toArray:nn,forEachEntry:an,matchAll:cn,isHTMLForm:un,hasOwnProperty:jr,hasOwnProp:jr,reduceDescriptors:Qr,freezeMethods:dn,toObjectSet:pn,toCamelCase:ln,noop:mn,toFiniteNumber:Xn,findKey:ne,global:Ie,isContextDefined:Ye,isSpecCompliantForm:gn,toJSONObject:fn,isAsyncFn:yn,isThenable:vn,setImmediate:Jr,asap:bn,isIterable:d=>d!=null&&n(d[r])};function j(d,X,y,S,C){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=d,this.name="AxiosError",X&&(this.code=X),y&&(this.config=y),S&&(this.request=S),C&&(this.response=C,this.status=C.status?C.status:null)}R.inherits(j,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:R.toJSONObject(this.config),code:this.code,status:this.status}}});const Zr=j.prototype,ei={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(d=>{ei[d]={value:d}}),Object.defineProperties(j,ei),Object.defineProperty(Zr,"isAxiosError",{value:!0}),j.from=(d,X,y,S,C,w)=>{const T=Object.create(Zr);R.toFlatObject(d,T,function(N){return N!==Error.prototype},D=>D!=="isAxiosError");const L=d&&d.message?d.message:"Error",H=X==null&&d?d.code:X;return j.call(T,L,H,y,S,C),d&&T.cause==null&&Object.defineProperty(T,"cause",{value:d,configurable:!0}),T.name=d&&d.name||"Error",w&&Object.assign(T,w),T};var Sn=null;function Sr(d){return R.isPlainObject(d)||R.isArray(d)}function ti(d){return R.endsWith(d,"[]")?d.slice(0,-2):d}function ri(d,X,y){return d?d.concat(X).map(function(C,w){return C=ti(C),!y&&w?"["+C+"]":C}).join(y?".":""):X}function Gn(d){return R.isArray(d)&&!d.some(Sr)}const Cn=R.toFlatObject(R,{},null,function(X){return/^is[A-Z]/.test(X)});function kt(d,X,y){if(!R.isObject(d))throw new TypeError("target must be an object");X=X||new FormData,y=R.toFlatObject(y,{metaTokens:!0,dots:!1,indexes:!1},!1,function($,Y){return!R.isUndefined(Y[$])});const S=y.metaTokens,C=y.visitor||N,w=y.dots,T=y.indexes,H=(y.Blob||typeof Blob<"u"&&Blob)&&R.isSpecCompliantForm(X);if(!R.isFunction(C))throw new TypeError("visitor must be a function");function D(U){if(U===null)return"";if(R.isDate(U))return U.toISOString();if(R.isBoolean(U))return U.toString();if(!H&&R.isBlob(U))throw new j("Blob is not supported. Use a Buffer instead.");return R.isArrayBuffer(U)||R.isTypedArray(U)?H&&typeof Blob=="function"?new Blob([U]):Buffer.from(U):U}function N(U,$,Y){let ae=U;if(U&&!Y&&typeof U=="object"){if(R.endsWith($,"{}"))$=S?$:$.slice(0,-2),U=JSON.stringify(U);else if(R.isArray(U)&&Gn(U)||(R.isFileList(U)||R.endsWith($,"[]"))&&(ae=R.toArray(U)))return $=ti($),ae.forEach(function(ce,de){!(R.isUndefined(ce)||ce===null)&&X.append(T===!0?ri([$],de,w):T===null?$:$+"[]",D(ce))}),!1}return Sr(U)?!0:(X.append(ri(Y,$,w),D(U)),!1)}const V=[],ie=Object.assign(Cn,{defaultVisitor:N,convertValue:D,isVisitable:Sr});function le(U,$){if(!R.isUndefined(U)){if(V.indexOf(U)!==-1)throw Error("Circular reference detected in "+$.join("."));V.push(U),R.forEach(U,function(ae,fe){(!(R.isUndefined(ae)||ae===null)&&C.call(X,ae,R.isString(fe)?fe.trim():fe,$,ie))===!0&&le(ae,$?$.concat(fe):[fe])}),V.pop()}}if(!R.isObject(d))throw new TypeError("data must be an object");return le(d),X}function ii(d){const X={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(d).replace(/[!'()~]|%20|%00/g,function(S){return X[S]})}function Gr(d,X){this._pairs=[],d&&kt(d,this,X)}const si=Gr.prototype;si.append=function(X,y){this._pairs.push([X,y])},si.toString=function(X){const y=X?function(S){return X.call(this,S,ii)}:ii;return this._pairs.map(function(C){return y(C[0])+"="+y(C[1])},"").join("&")};function Mn(d){return encodeURIComponent(d).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function ni(d,X,y){if(!X)return d;const S=y&&y.encode||Mn;R.isFunction(y)&&(y={serialize:y});const C=y&&y.serialize;let w;if(C?w=C(X,y):w=R.isURLSearchParams(X)?X.toString():new Gr(X,y).toString(S),w){const T=d.indexOf("#");T!==-1&&(d=d.slice(0,T)),d+=(d.indexOf("?")===-1?"?":"&")+w}return d}class kn{constructor(){this.handlers=[]}use(X,y,S){return this.handlers.push({fulfilled:X,rejected:y,synchronous:S?S.synchronous:!1,runWhen:S?S.runWhen:null}),this.handlers.length-1}eject(X){this.handlers[X]&&(this.handlers[X]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(X){R.forEach(this.handlers,function(S){S!==null&&X(S)})}}var oi=kn,ai={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},En=typeof URLSearchParams<"u"?URLSearchParams:Gr,Tn=typeof FormData<"u"?FormData:null,In=typeof Blob<"u"?Blob:null,wn={isBrowser:!0,classes:{URLSearchParams:En,FormData:Tn,Blob:In},protocols:["http","https","file","blob","url","data"]};const Cr=typeof window<"u"&&typeof document<"u",Mr=typeof navigator=="object"&&navigator||void 0,_n=Cr&&(!Mr||["ReactNative","NativeScript","NS"].indexOf(Mr.product)<0),Rn=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",An=Cr&&window.location.href||"http://localhost";var Pn=Object.freeze({__proto__:null,hasBrowserEnv:Cr,hasStandardBrowserWebWorkerEnv:Rn,hasStandardBrowserEnv:_n,navigator:Mr,origin:An}),ue={...Pn,...wn};function On(d,X){return kt(d,new ue.classes.URLSearchParams,{visitor:function(y,S,C,w){return ue.isNode&&R.isBuffer(y)?(this.append(S,y.toString("base64")),!1):w.defaultVisitor.apply(this,arguments)},...X})}function xn(d){return R.matchAll(/\w+|\[(\w*)]/g,d).map(X=>X[0]==="[]"?"":X[1]||X[0])}function Bn(d){const X={},y=Object.keys(d);let S;const C=y.length;let w;for(S=0;S<C;S++)w=y[S],X[w]=d[w];return X}function ci(d){function X(y,S,C,w){let T=y[w++];if(T==="__proto__")return!0;const L=Number.isFinite(+T),H=w>=y.length;return T=!T&&R.isArray(C)?C.length:T,H?(R.hasOwnProp(C,T)?C[T]=[C[T],S]:C[T]=S,!L):((!C[T]||!R.isObject(C[T]))&&(C[T]=[]),X(y,S,C[T],w)&&R.isArray(C[T])&&(C[T]=Bn(C[T])),!L)}if(R.isFormData(d)&&R.isFunction(d.entries)){const y={};return R.forEachEntry(d,(S,C)=>{X(xn(S),C,y,0)}),y}return null}function Ln(d,X,y){if(R.isString(d))try{return(X||JSON.parse)(d),R.trim(d)}catch(S){if(S.name!=="SyntaxError")throw S}return(y||JSON.stringify)(d)}const kr={transitional:ai,adapter:["xhr","http","fetch"],transformRequest:[function(X,y){const S=y.getContentType()||"",C=S.indexOf("application/json")>-1,w=R.isObject(X);if(w&&R.isHTMLForm(X)&&(X=new FormData(X)),R.isFormData(X))return C?JSON.stringify(ci(X)):X;if(R.isArrayBuffer(X)||R.isBuffer(X)||R.isStream(X)||R.isFile(X)||R.isBlob(X)||R.isReadableStream(X))return X;if(R.isArrayBufferView(X))return X.buffer;if(R.isURLSearchParams(X))return y.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),X.toString();let L;if(w){if(S.indexOf("application/x-www-form-urlencoded")>-1)return On(X,this.formSerializer).toString();if((L=R.isFileList(X))||S.indexOf("multipart/form-data")>-1){const H=this.env&&this.env.FormData;return kt(L?{"files[]":X}:X,H&&new H,this.formSerializer)}}return w||C?(y.setContentType("application/json",!1),Ln(X)):X}],transformResponse:[function(X){const y=this.transitional||kr.transitional,S=y&&y.forcedJSONParsing,C=this.responseType==="json";if(R.isResponse(X)||R.isReadableStream(X))return X;if(X&&R.isString(X)&&(S&&!this.responseType||C)){const T=!(y&&y.silentJSONParsing)&&C;try{return JSON.parse(X,this.parseReviver)}catch(L){if(T)throw L.name==="SyntaxError"?j.from(L,j.ERR_BAD_RESPONSE,this,null,this.response):L}}return X}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ue.classes.FormData,Blob:ue.classes.Blob},validateStatus:function(X){return X>=200&&X<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};R.forEach(["delete","get","head","post","put","patch"],d=>{kr.headers[d]={}});var Er=kr;const Nn=R.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);var Un=d=>{const X={};let y,S,C;return d&&d.split(`
`).forEach(function(T){C=T.indexOf(":"),y=T.substring(0,C).trim().toLowerCase(),S=T.substring(C+1).trim(),!(!y||X[y]&&Nn[y])&&(y==="set-cookie"?X[y]?X[y].push(S):X[y]=[S]:X[y]=X[y]?X[y]+", "+S:S)}),X};const ui=Symbol("internals");function lt(d){return d&&String(d).trim().toLowerCase()}function Et(d){return d===!1||d==null?d:R.isArray(d)?d.map(Et):String(d)}function Dn(d){const X=Object.create(null),y=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let S;for(;S=y.exec(d);)X[S[1]]=S[2];return X}const Fn=d=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(d.trim());function Tr(d,X,y,S,C){if(R.isFunction(S))return S.call(this,X,y);if(C&&(X=y),!!R.isString(X)){if(R.isString(S))return X.indexOf(S)!==-1;if(R.isRegExp(S))return S.test(X)}}function qn(d){return d.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(X,y,S)=>y.toUpperCase()+S)}function Hn(d,X){const y=R.toCamelCase(" "+X);["get","set","has"].forEach(S=>{Object.defineProperty(d,S+y,{value:function(C,w,T){return this[S].call(this,X,C,w,T)},configurable:!0})})}class Tt{constructor(X){X&&this.set(X)}set(X,y,S){const C=this;function w(L,H,D){const N=lt(H);if(!N)throw new Error("header name must be a non-empty string");const V=R.findKey(C,N);(!V||C[V]===void 0||D===!0||D===void 0&&C[V]!==!1)&&(C[V||H]=Et(L))}const T=(L,H)=>R.forEach(L,(D,N)=>w(D,N,H));if(R.isPlainObject(X)||X instanceof this.constructor)T(X,y);else if(R.isString(X)&&(X=X.trim())&&!Fn(X))T(Un(X),y);else if(R.isObject(X)&&R.isIterable(X)){let L={},H,D;for(const N of X){if(!R.isArray(N))throw TypeError("Object iterator must return a key-value pair");L[D=N[0]]=(H=L[D])?R.isArray(H)?[...H,N[1]]:[H,N[1]]:N[1]}T(L,y)}else X!=null&&w(y,X,S);return this}get(X,y){if(X=lt(X),X){const S=R.findKey(this,X);if(S){const C=this[S];if(!y)return C;if(y===!0)return Dn(C);if(R.isFunction(y))return y.call(this,C,S);if(R.isRegExp(y))return y.exec(C);throw new TypeError("parser must be boolean|regexp|function")}}}has(X,y){if(X=lt(X),X){const S=R.findKey(this,X);return!!(S&&this[S]!==void 0&&(!y||Tr(this,this[S],S,y)))}return!1}delete(X,y){const S=this;let C=!1;function w(T){if(T=lt(T),T){const L=R.findKey(S,T);L&&(!y||Tr(S,S[L],L,y))&&(delete S[L],C=!0)}}return R.isArray(X)?X.forEach(w):w(X),C}clear(X){const y=Object.keys(this);let S=y.length,C=!1;for(;S--;){const w=y[S];(!X||Tr(this,this[w],w,X,!0))&&(delete this[w],C=!0)}return C}normalize(X){const y=this,S={};return R.forEach(this,(C,w)=>{const T=R.findKey(S,w);if(T){y[T]=Et(C),delete y[w];return}const L=X?qn(w):String(w).trim();L!==w&&delete y[w],y[L]=Et(C),S[L]=!0}),this}concat(...X){return this.constructor.concat(this,...X)}toJSON(X){const y=Object.create(null);return R.forEach(this,(S,C)=>{S!=null&&S!==!1&&(y[C]=X&&R.isArray(S)?S.join(", "):S)}),y}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([X,y])=>X+": "+y).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(X){return X instanceof this?X:new this(X)}static concat(X,...y){const S=new this(X);return y.forEach(C=>S.set(C)),S}static accessor(X){const S=(this[ui]=this[ui]={accessors:{}}).accessors,C=this.prototype;function w(T){const L=lt(T);S[L]||(Hn(C,T),S[L]=!0)}return R.isArray(X)?X.forEach(w):w(X),this}}Tt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),R.reduceDescriptors(Tt.prototype,({value:d},X)=>{let y=X[0].toUpperCase()+X.slice(1);return{get:()=>d,set(S){this[y]=S}}}),R.freezeMethods(Tt);var Ge=Tt;function Ir(d,X){const y=this||Er,S=X||y,C=Ge.from(S.headers);let w=S.data;return R.forEach(d,function(L){w=L.call(y,w,C.normalize(),X?X.status:void 0)}),C.normalize(),w}function li(d){return!!(d&&d.__CANCEL__)}function tt(d,X,y){j.call(this,d??"canceled",j.ERR_CANCELED,X,y),this.name="CanceledError"}R.inherits(tt,j,{__CANCEL__:!0});function hi(d,X,y){const S=y.config.validateStatus;!y.status||!S||S(y.status)?d(y):X(new j("Request failed with status code "+y.status,[j.ERR_BAD_REQUEST,j.ERR_BAD_RESPONSE][Math.floor(y.status/100)-4],y.config,y.request,y))}function Yn(d){const X=/^([-+\w]{1,25})(:?\/\/|:)/.exec(d);return X&&X[1]||""}function Wn(d,X){d=d||10;const y=new Array(d),S=new Array(d);let C=0,w=0,T;return X=X!==void 0?X:1e3,function(H){const D=Date.now(),N=S[w];T||(T=D),y[C]=H,S[C]=D;let V=w,ie=0;for(;V!==C;)ie+=y[V++],V=V%d;if(C=(C+1)%d,C===w&&(w=(w+1)%d),D-T<X)return;const le=N&&D-N;return le?Math.round(ie*1e3/le):void 0}}function Vn(d,X){let y=0,S=1e3/X,C,w;const T=(D,N=Date.now())=>{y=N,C=null,w&&(clearTimeout(w),w=null),d(...D)};return[(...D)=>{const N=Date.now(),V=N-y;V>=S?T(D,N):(C=D,w||(w=setTimeout(()=>{w=null,T(C)},S-V)))},()=>C&&T(C)]}const It=(d,X,y=3)=>{let S=0;const C=Wn(50,250);return Vn(w=>{const T=w.loaded,L=w.lengthComputable?w.total:void 0,H=T-S,D=C(H),N=T<=L;S=T;const V={loaded:T,total:L,progress:L?T/L:void 0,bytes:H,rate:D||void 0,estimated:D&&L&&N?(L-T)/D:void 0,event:w,lengthComputable:L!=null,[X?"download":"upload"]:!0};d(V)},y)},di=(d,X)=>{const y=d!=null;return[S=>X[0]({lengthComputable:y,total:d,loaded:S}),X[1]]},pi=d=>(...X)=>R.asap(()=>d(...X));var zn=ue.hasStandardBrowserEnv?((d,X)=>y=>(y=new URL(y,ue.origin),d.protocol===y.protocol&&d.host===y.host&&(X||d.port===y.port)))(new URL(ue.origin),ue.navigator&&/(msie|trident)/i.test(ue.navigator.userAgent)):()=>!0,$n=ue.hasStandardBrowserEnv?{write(d,X,y,S,C,w){const T=[d+"="+encodeURIComponent(X)];R.isNumber(y)&&T.push("expires="+new Date(y).toGMTString()),R.isString(S)&&T.push("path="+S),R.isString(C)&&T.push("domain="+C),w===!0&&T.push("secure"),document.cookie=T.join("; ")},read(d){const X=document.cookie.match(new RegExp("(^|;\\s*)("+d+")=([^;]*)"));return X?decodeURIComponent(X[3]):null},remove(d){this.write(d,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Kn(d){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(d)}function jn(d,X){return X?d.replace(/\/?\/$/,"")+"/"+X.replace(/^\/+/,""):d}function mi(d,X,y){let S=!Kn(X);return d&&(S||y==!1)?jn(d,X):X}const Xi=d=>d instanceof Ge?{...d}:d;function We(d,X){X=X||{};const y={};function S(D,N,V,ie){return R.isPlainObject(D)&&R.isPlainObject(N)?R.merge.call({caseless:ie},D,N):R.isPlainObject(N)?R.merge({},N):R.isArray(N)?N.slice():N}function C(D,N,V,ie){if(R.isUndefined(N)){if(!R.isUndefined(D))return S(void 0,D,V,ie)}else return S(D,N,V,ie)}function w(D,N){if(!R.isUndefined(N))return S(void 0,N)}function T(D,N){if(R.isUndefined(N)){if(!R.isUndefined(D))return S(void 0,D)}else return S(void 0,N)}function L(D,N,V){if(V in X)return S(D,N);if(V in d)return S(void 0,D)}const H={url:w,method:w,data:w,baseURL:T,transformRequest:T,transformResponse:T,paramsSerializer:T,timeout:T,timeoutMessage:T,withCredentials:T,withXSRFToken:T,adapter:T,responseType:T,xsrfCookieName:T,xsrfHeaderName:T,onUploadProgress:T,onDownloadProgress:T,decompress:T,maxContentLength:T,maxBodyLength:T,beforeRedirect:T,transport:T,httpAgent:T,httpsAgent:T,cancelToken:T,socketPath:T,responseEncoding:T,validateStatus:L,headers:(D,N,V)=>C(Xi(D),Xi(N),V,!0)};return R.forEach(Object.keys({...d,...X}),function(N){const V=H[N]||C,ie=V(d[N],X[N],N);R.isUndefined(ie)&&V!==L||(y[N]=ie)}),y}var gi=d=>{const X=We({},d);let{data:y,withXSRFToken:S,xsrfHeaderName:C,xsrfCookieName:w,headers:T,auth:L}=X;if(X.headers=T=Ge.from(T),X.url=ni(mi(X.baseURL,X.url,X.allowAbsoluteUrls),d.params,d.paramsSerializer),L&&T.set("Authorization","Basic "+btoa((L.username||"")+":"+(L.password?unescape(encodeURIComponent(L.password)):""))),R.isFormData(y)){if(ue.hasStandardBrowserEnv||ue.hasStandardBrowserWebWorkerEnv)T.setContentType(void 0);else if(R.isFunction(y.getHeaders)){const H=y.getHeaders(),D=["content-type","content-length"];Object.entries(H).forEach(([N,V])=>{D.includes(N.toLowerCase())&&T.set(N,V)})}}if(ue.hasStandardBrowserEnv&&(S&&R.isFunction(S)&&(S=S(X)),S||S!==!1&&zn(X.url))){const H=C&&w&&$n.read(w);H&&T.set(C,H)}return X},Qn=typeof XMLHttpRequest<"u"&&function(d){return new Promise(function(y,S){const C=gi(d);let w=C.data;const T=Ge.from(C.headers).normalize();let{responseType:L,onUploadProgress:H,onDownloadProgress:D}=C,N,V,ie,le,U;function $(){le&&le(),U&&U(),C.cancelToken&&C.cancelToken.unsubscribe(N),C.signal&&C.signal.removeEventListener("abort",N)}let Y=new XMLHttpRequest;Y.open(C.method.toUpperCase(),C.url,!0),Y.timeout=C.timeout;function ae(){if(!Y)return;const ce=Ge.from("getAllResponseHeaders"in Y&&Y.getAllResponseHeaders()),Ce={data:!L||L==="text"||L==="json"?Y.responseText:Y.response,status:Y.status,statusText:Y.statusText,headers:ce,config:d,request:Y};hi(function(ye){y(ye),$()},function(ye){S(ye),$()},Ce),Y=null}"onloadend"in Y?Y.onloadend=ae:Y.onreadystatechange=function(){!Y||Y.readyState!==4||Y.status===0&&!(Y.responseURL&&Y.responseURL.indexOf("file:")===0)||setTimeout(ae)},Y.onabort=function(){Y&&(S(new j("Request aborted",j.ECONNABORTED,d,Y)),Y=null)},Y.onerror=function(de){const Ce=de&&de.message?de.message:"Network Error",Ve=new j(Ce,j.ERR_NETWORK,d,Y);Ve.event=de||null,S(Ve),Y=null},Y.ontimeout=function(){let de=C.timeout?"timeout of "+C.timeout+"ms exceeded":"timeout exceeded";const Ce=C.transitional||ai;C.timeoutErrorMessage&&(de=C.timeoutErrorMessage),S(new j(de,Ce.clarifyTimeoutError?j.ETIMEDOUT:j.ECONNABORTED,d,Y)),Y=null},w===void 0&&T.setContentType(null),"setRequestHeader"in Y&&R.forEach(T.toJSON(),function(de,Ce){Y.setRequestHeader(Ce,de)}),R.isUndefined(C.withCredentials)||(Y.withCredentials=!!C.withCredentials),L&&L!=="json"&&(Y.responseType=C.responseType),D&&([ie,U]=It(D,!0),Y.addEventListener("progress",ie)),H&&Y.upload&&([V,le]=It(H),Y.upload.addEventListener("progress",V),Y.upload.addEventListener("loadend",le)),(C.cancelToken||C.signal)&&(N=ce=>{Y&&(S(!ce||ce.type?new tt(null,d,Y):ce),Y.abort(),Y=null)},C.cancelToken&&C.cancelToken.subscribe(N),C.signal&&(C.signal.aborted?N():C.signal.addEventListener("abort",N)));const fe=Yn(C.url);if(fe&&ue.protocols.indexOf(fe)===-1){S(new j("Unsupported protocol "+fe+":",j.ERR_BAD_REQUEST,d));return}Y.send(w||null)})},Jn=(d,X)=>{const{length:y}=d=d?d.filter(Boolean):[];if(X||y){let S=new AbortController,C;const w=function(D){if(!C){C=!0,L();const N=D instanceof Error?D:this.reason;S.abort(N instanceof j?N:new tt(N instanceof Error?N.message:N))}};let T=X&&setTimeout(()=>{T=null,w(new j(`timeout ${X} of ms exceeded`,j.ETIMEDOUT))},X);const L=()=>{d&&(T&&clearTimeout(T),T=null,d.forEach(D=>{D.unsubscribe?D.unsubscribe(w):D.removeEventListener("abort",w)}),d=null)};d.forEach(D=>D.addEventListener("abort",w));const{signal:H}=S;return H.unsubscribe=()=>R.asap(L),H}};const Zn=function*(d,X){let y=d.byteLength;if(y<X){yield d;return}let S=0,C;for(;S<y;)C=S+X,yield d.slice(S,C),S=C},eo=async function*(d,X){for await(const y of to(d))yield*Zn(y,X)},to=async function*(d){if(d[Symbol.asyncIterator]){yield*d;return}const X=d.getReader();try{for(;;){const{done:y,value:S}=await X.read();if(y)break;yield S}}finally{await X.cancel()}},fi=(d,X,y,S)=>{const C=eo(d,X);let w=0,T,L=H=>{T||(T=!0,S&&S(H))};return new ReadableStream({async pull(H){try{const{done:D,value:N}=await C.next();if(D){L(),H.close();return}let V=N.byteLength;if(y){let ie=w+=V;y(ie)}H.enqueue(new Uint8Array(N))}catch(D){throw L(D),D}},cancel(H){return L(H),C.return()}},{highWaterMark:2})},yi=64*1024,{isFunction:wt}=R,ro=(({Request:d,Response:X})=>({Request:d,Response:X}))(R.global),{ReadableStream:vi,TextEncoder:bi}=R.global,Si=(d,...X)=>{try{return!!d(...X)}catch{return!1}},io=d=>{d=R.merge.call({skipUndefined:!0},ro,d);const{fetch:X,Request:y,Response:S}=d,C=X?wt(X):typeof fetch=="function",w=wt(y),T=wt(S);if(!C)return!1;const L=C&&wt(vi),H=C&&(typeof bi=="function"?(U=>$=>U.encode($))(new bi):async U=>new Uint8Array(await new y(U).arrayBuffer())),D=w&&L&&Si(()=>{let U=!1;const $=new y(ue.origin,{body:new vi,method:"POST",get duplex(){return U=!0,"half"}}).headers.has("Content-Type");return U&&!$}),N=T&&L&&Si(()=>R.isReadableStream(new S("").body)),V={stream:N&&(U=>U.body)};C&&["text","arrayBuffer","blob","formData","stream"].forEach(U=>{!V[U]&&(V[U]=($,Y)=>{let ae=$&&$[U];if(ae)return ae.call($);throw new j(`Response type '${U}' is not supported`,j.ERR_NOT_SUPPORT,Y)})});const ie=async U=>{if(U==null)return 0;if(R.isBlob(U))return U.size;if(R.isSpecCompliantForm(U))return(await new y(ue.origin,{method:"POST",body:U}).arrayBuffer()).byteLength;if(R.isArrayBufferView(U)||R.isArrayBuffer(U))return U.byteLength;if(R.isURLSearchParams(U)&&(U=U+""),R.isString(U))return(await H(U)).byteLength},le=async(U,$)=>{const Y=R.toFiniteNumber(U.getContentLength());return Y??ie($)};return async U=>{let{url:$,method:Y,data:ae,signal:fe,cancelToken:ce,timeout:de,onDownloadProgress:Ce,onUploadProgress:Ve,responseType:ye,headers:Pr,withCredentials:Ot="same-origin",fetchOptions:wi}=gi(U),_i=X||fetch;ye=ye?(ye+"").toLowerCase():"text";let xt=Jn([fe,ce&&ce.toAbortSignal()],de),ht=null;const ze=xt&&xt.unsubscribe&&(()=>{xt.unsubscribe()});let Ri;try{if(Ve&&D&&Y!=="get"&&Y!=="head"&&(Ri=await le(Pr,ae))!==0){let Ue=new y($,{method:"POST",body:ae,duplex:"half"}),rt;if(R.isFormData(ae)&&(rt=Ue.headers.get("content-type"))&&Pr.setContentType(rt),Ue.body){const[Or,Bt]=di(Ri,It(pi(Ve)));ae=fi(Ue.body,yi,Or,Bt)}}R.isString(Ot)||(Ot=Ot?"include":"omit");const _e=w&&"credentials"in y.prototype,Ai={...wi,signal:xt,method:Y.toUpperCase(),headers:Pr.normalize().toJSON(),body:ae,duplex:"half",credentials:_e?Ot:void 0};ht=w&&new y($,Ai);let Ne=await(w?_i(ht,wi):_i($,Ai));const Pi=N&&(ye==="stream"||ye==="response");if(N&&(Ce||Pi&&ze)){const Ue={};["status","statusText","headers"].forEach(Oi=>{Ue[Oi]=Ne[Oi]});const rt=R.toFiniteNumber(Ne.headers.get("content-length")),[Or,Bt]=Ce&&di(rt,It(pi(Ce),!0))||[];Ne=new S(fi(Ne.body,yi,Or,()=>{Bt&&Bt(),ze&&ze()}),Ue)}ye=ye||"text";let ho=await V[R.findKey(V,ye)||"text"](Ne,U);return!Pi&&ze&&ze(),await new Promise((Ue,rt)=>{hi(Ue,rt,{data:ho,headers:Ge.from(Ne.headers),status:Ne.status,statusText:Ne.statusText,config:U,request:ht})})}catch(_e){throw ze&&ze(),_e&&_e.name==="TypeError"&&/Load failed|fetch/i.test(_e.message)?Object.assign(new j("Network Error",j.ERR_NETWORK,U,ht),{cause:_e.cause||_e}):j.from(_e,_e&&_e.code,U,ht)}}},so=new Map,Gi=d=>{let X=d?d.env:{};const{fetch:y,Request:S,Response:C}=X,w=[S,C,y];let T=w.length,L=T,H,D,N=so;for(;L--;)H=w[L],D=N.get(H),D===void 0&&N.set(H,D=L?new Map:io(X)),N=D;return D};Gi();const wr={http:Sn,xhr:Qn,fetch:{get:Gi}};R.forEach(wr,(d,X)=>{if(d){try{Object.defineProperty(d,"name",{value:X})}catch{}Object.defineProperty(d,"adapterName",{value:X})}});const Ci=d=>`- ${d}`,no=d=>R.isFunction(d)||d===null||d===!1;var Mi={getAdapter:(d,X)=>{d=R.isArray(d)?d:[d];const{length:y}=d;let S,C;const w={};for(let T=0;T<y;T++){S=d[T];let L;if(C=S,!no(S)&&(C=wr[(L=String(S)).toLowerCase()],C===void 0))throw new j(`Unknown adapter '${L}'`);if(C&&(R.isFunction(C)||(C=C.get(X))))break;w[L||"#"+T]=C}if(!C){const T=Object.entries(w).map(([H,D])=>`adapter ${H} `+(D===!1?"is not supported by the environment":"is not available in the build"));let L=y?T.length>1?`since :
`+T.map(Ci).join(`
`):" "+Ci(T[0]):"as no adapter specified";throw new j("There is no suitable adapter to dispatch the request "+L,"ERR_NOT_SUPPORT")}return C},adapters:wr};function _r(d){if(d.cancelToken&&d.cancelToken.throwIfRequested(),d.signal&&d.signal.aborted)throw new tt(null,d)}function ki(d){return _r(d),d.headers=Ge.from(d.headers),d.data=Ir.call(d,d.transformRequest),["post","put","patch"].indexOf(d.method)!==-1&&d.headers.setContentType("application/x-www-form-urlencoded",!1),Mi.getAdapter(d.adapter||Er.adapter,d)(d).then(function(S){return _r(d),S.data=Ir.call(d,d.transformResponse,S),S.headers=Ge.from(S.headers),S},function(S){return li(S)||(_r(d),S&&S.response&&(S.response.data=Ir.call(d,d.transformResponse,S.response),S.response.headers=Ge.from(S.response.headers))),Promise.reject(S)})}const Ei="1.12.2",_t={};["object","boolean","number","function","string","symbol"].forEach((d,X)=>{_t[d]=function(S){return typeof S===d||"a"+(X<1?"n ":" ")+d}});const Ti={};_t.transitional=function(X,y,S){function C(w,T){return"[Axios v"+Ei+"] Transitional option '"+w+"'"+T+(S?". "+S:"")}return(w,T,L)=>{if(X===!1)throw new j(C(T," has been removed"+(y?" in "+y:"")),j.ERR_DEPRECATED);return y&&!Ti[T]&&(Ti[T]=!0,console.warn(C(T," has been deprecated since v"+y+" and will be removed in the near future"))),X?X(w,T,L):!0}},_t.spelling=function(X){return(y,S)=>(console.warn(`${S} is likely a misspelling of ${X}`),!0)};function oo(d,X,y){if(typeof d!="object")throw new j("options must be an object",j.ERR_BAD_OPTION_VALUE);const S=Object.keys(d);let C=S.length;for(;C-- >0;){const w=S[C],T=X[w];if(T){const L=d[w],H=L===void 0||T(L,w,d);if(H!==!0)throw new j("option "+w+" must be "+H,j.ERR_BAD_OPTION_VALUE);continue}if(y!==!0)throw new j("Unknown option "+w,j.ERR_BAD_OPTION)}}var Rt={assertOptions:oo,validators:_t};const we=Rt.validators;class At{constructor(X){this.defaults=X||{},this.interceptors={request:new oi,response:new oi}}async request(X,y){try{return await this._request(X,y)}catch(S){if(S instanceof Error){let C={};Error.captureStackTrace?Error.captureStackTrace(C):C=new Error;const w=C.stack?C.stack.replace(/^.+\n/,""):"";try{S.stack?w&&!String(S.stack).endsWith(w.replace(/^.+\n.+\n/,""))&&(S.stack+=`
`+w):S.stack=w}catch{}}throw S}}_request(X,y){typeof X=="string"?(y=y||{},y.url=X):y=X||{},y=We(this.defaults,y);const{transitional:S,paramsSerializer:C,headers:w}=y;S!==void 0&&Rt.assertOptions(S,{silentJSONParsing:we.transitional(we.boolean),forcedJSONParsing:we.transitional(we.boolean),clarifyTimeoutError:we.transitional(we.boolean)},!1),C!=null&&(R.isFunction(C)?y.paramsSerializer={serialize:C}:Rt.assertOptions(C,{encode:we.function,serialize:we.function},!0)),y.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?y.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:y.allowAbsoluteUrls=!0),Rt.assertOptions(y,{baseUrl:we.spelling("baseURL"),withXsrfToken:we.spelling("withXSRFToken")},!0),y.method=(y.method||this.defaults.method||"get").toLowerCase();let T=w&&R.merge(w.common,w[y.method]);w&&R.forEach(["delete","get","head","post","put","patch","common"],U=>{delete w[U]}),y.headers=Ge.concat(T,w);const L=[];let H=!0;this.interceptors.request.forEach(function($){typeof $.runWhen=="function"&&$.runWhen(y)===!1||(H=H&&$.synchronous,L.unshift($.fulfilled,$.rejected))});const D=[];this.interceptors.response.forEach(function($){D.push($.fulfilled,$.rejected)});let N,V=0,ie;if(!H){const U=[ki.bind(this),void 0];for(U.unshift(...L),U.push(...D),ie=U.length,N=Promise.resolve(y);V<ie;)N=N.then(U[V++],U[V++]);return N}ie=L.length;let le=y;for(;V<ie;){const U=L[V++],$=L[V++];try{le=U(le)}catch(Y){$.call(this,Y);break}}try{N=ki.call(this,le)}catch(U){return Promise.reject(U)}for(V=0,ie=D.length;V<ie;)N=N.then(D[V++],D[V++]);return N}getUri(X){X=We(this.defaults,X);const y=mi(X.baseURL,X.url,X.allowAbsoluteUrls);return ni(y,X.params,X.paramsSerializer)}}R.forEach(["delete","get","head","options"],function(X){At.prototype[X]=function(y,S){return this.request(We(S||{},{method:X,url:y,data:(S||{}).data}))}}),R.forEach(["post","put","patch"],function(X){function y(S){return function(w,T,L){return this.request(We(L||{},{method:X,headers:S?{"Content-Type":"multipart/form-data"}:{},url:w,data:T}))}}At.prototype[X]=y(),At.prototype[X+"Form"]=y(!0)});var Pt=At;class Rr{constructor(X){if(typeof X!="function")throw new TypeError("executor must be a function.");let y;this.promise=new Promise(function(w){y=w});const S=this;this.promise.then(C=>{if(!S._listeners)return;let w=S._listeners.length;for(;w-- >0;)S._listeners[w](C);S._listeners=null}),this.promise.then=C=>{let w;const T=new Promise(L=>{S.subscribe(L),w=L}).then(C);return T.cancel=function(){S.unsubscribe(w)},T},X(function(w,T,L){S.reason||(S.reason=new tt(w,T,L),y(S.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(X){if(this.reason){X(this.reason);return}this._listeners?this._listeners.push(X):this._listeners=[X]}unsubscribe(X){if(!this._listeners)return;const y=this._listeners.indexOf(X);y!==-1&&this._listeners.splice(y,1)}toAbortSignal(){const X=new AbortController,y=S=>{X.abort(S)};return this.subscribe(y),X.signal.unsubscribe=()=>this.unsubscribe(y),X.signal}static source(){let X;return{token:new Rr(function(C){X=C}),cancel:X}}}var ao=Rr;function co(d){return function(y){return d.apply(null,y)}}function uo(d){return R.isObject(d)&&d.isAxiosError===!0}const Ar={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ar).forEach(([d,X])=>{Ar[X]=d});var lo=Ar;function Ii(d){const X=new Pt(d),y=p(Pt.prototype.request,X);return R.extend(y,Pt.prototype,X,{allOwnKeys:!0}),R.extend(y,X,null,{allOwnKeys:!0}),y.create=function(C){return Ii(We(d,C))},y}const oe=Ii(Er);return oe.Axios=Pt,oe.CanceledError=tt,oe.CancelToken=ao,oe.isCancel=li,oe.VERSION=Ei,oe.toFormData=kt,oe.AxiosError=j,oe.Cancel=oe.CanceledError,oe.all=function(X){return Promise.all(X)},oe.spread=co,oe.isAxiosError=uo,oe.mergeConfig=We,oe.AxiosHeaders=Ge,oe.formToJSON=d=>ci(R.isHTMLForm(d)?new FormData(d):d),oe.getAdapter=Mi.getAdapter,oe.HttpStatusCode=lo,oe.default=oe,Lr=oe,Lr}var Nr,Fi;function Xa(){if(Fi)return Nr;Fi=1;var p={};pa().config();const e=ma();class t{#e;#r;#t;constructor(i){this.#r=i,this.#e=`https://${p.PLAYFAB_TITLE_ID}.playfabapi.com`,this.#i()}async#i(){const i=`${this.#e}/client/LoginWithCustomID`,s={CustomId:this.#r,CreateAccount:!0,TitleId:p.PLAYFAB_TITLE_ID},o={headers:{"Content-Type":"application/json"}};await e.post(i,s,o).then(u=>{this.#t=u?.data?.data?.PlayFabId,console.log("Login successful: "+this.#t)}).catch(u=>console.error("Login failed:",u))}async postAction(i){const s=`${this.#e}/server/WritePlayerEvent`,o={PlayFabId:this.#t,EventName:p.PLAYFAB_EVENT_NAME,Body:i},u={headers:{"Content-Type":"application/json","X-SecretKey":p.PLAYFAB_SECRET_KEY}};await e.post(s,o,u).then(l=>console.log("Event posted successfully:",l.data)).catch(l=>console.log("Error posting event:",l)).finally(()=>console.log("Action Event Finished!"))}}return Nr={PlayFabSDK:t},Nr}var dt=Xa();const ve="PlayFab";class ga{constructor(e){dt.settings.titleId="1BFF70",this.customId=e}_getMetaVarName(e){return`${e}-meta`}init(e){logger.info(ve,"Init"),this.login(e),setInterval(()=>this.login(),432e5)}login(e){logger.info(ve,"Login");const t={CustomId:this.customId,CreateAccount:!0};dt.ClientApi.LoginWithCustomID(t,(r,i)=>{r&&r.code===200?(logger.info(ve,"Logged in!",[r,i]),e&&e()):(logger.error(ve,"init failed!",[r,i]),e&&e())})}load(e,t){const r={Keys:[e,this._getMetaVarName(e)]};dt.ClientApi.GetUserData(r,(i,s)=>{if(logger.info(ve,"Loaded!",[i,s]),i&&i.code===200)try{const o=JSON.parse(i.data.Data[this._getMetaVarName(e)].Value),u=i.data.Data[e].Value;t({meta:o,data:u});return}catch(o){logger.error(ve,"load parse failed",o)}logger.error(ve,"load failed!",[i,s]),t(null)})}save(e,t,r){const i={Data:{[e]:t.data,[this._getMetaVarName(e)]:JSON.stringify(t.meta)}};dt.ClientApi.UpdateUserData(i,(s,o)=>{s&&s.code===200?(logger.info(ve,`Saved ${e}`,[s,o]),r(!0)):(logger.error(ve,"Save failed!",[s,o]),r(!1))})}submitStatistic(){}getSavesInfo(e,t){const i={Keys:e.map(s=>this._getMetaVarName(s))};dt.ClientApi.GetUserData(i,(s,o)=>{if(s&&s.code===200){logger.info(ve,"getSavesInfo loaded!",[s,o]);const u={};for(const l of e){const m=this._getMetaVarName(l);try{s.data.Data[m]?.Value&&(u[l]=JSON.parse(s.data.Data[m].Value))}catch(h){logger.error(ve,"getSavesInfo parse failed",h)}}t(u);return}logger.error(ve,"getSavesInfo failed!",[s,o]),t({})})}}class fa{constructor(e,t,r){this.em=new Ct(ge,"ApiWeb"),this.serverApi=new na(e,t,r),this.playFabApi=new ga(e)}getEventManager(){return this.em}getKey(){return"web"}getTimestamp(e){this.serverApi.getTimestamp(e)}init(e){this.playFabApi.init(()=>{this.serverApi.init(()=>{e()})})}destroy(){}purchase(e,t){this.serverApi.purchase(e,t)}loadPurchases(e){this.serverApi.loadPurchases(e)}setConsumed(e,t){this.serverApi.setConsumed(e,t)}submitStatistic(){}getSavesInfo(e,t){this.playFabApi.getSavesInfo(e,t)}load(e,t){this.playFabApi.load(e,t)}save(e,t,r){this.playFabApi.save(e,t,r)}initializeIncentivizedAds(){return!1}showIncentivizedAd(){return!1}}const ya=(p,e)=>{switch(p){case"localhost":return Q.info("ApiFactory","Local API loaded"),new sa(e,qe.api.local.storageKey,p);default:return Q.info("ApiFactory","Web API loaded"),new fa(e,qe.api.server.url,p)}};class va{constructor(e){this.serverTs=0,this.localTs=0,this.timeDif=0,this.loaderFunction=e}init(){return new Promise(e=>{this.loaderFunction(t=>{this.serverTs=t&&!isNaN(Number(t))?Number(t):Math.round(Date.now()/1e3),this.localTs=Math.round(Date.now()/1e3),this.timeDif=this.serverTs-this.localTs,Q.info("Ts",`Loaded ${t} Used: ${this.serverTs} Dif: ${this.timeDif}`),e()})})}getConfirmedNow(){return Math.round(Date.now()/1e3)+this.timeDif}}class Ns{constructor(e){this.game=e}getMessage(){return`Show ad for ${Se.main.incentivizedAdBonusTicks} bonus ticks`}complete(){Q.info("IncentivizedAdCompletedAction",`Incentivized ad completed, added ${Se.main.incentivizedAdBonusTicks} bonus ticks`),this.game.getTicker().addBonusTicks(Se.main.incentivizedAdBonusTicks)}}class ba{constructor(){this.userHash=null,this.api=null,this.saveManager=null,this.purchasesManager=null,this.confirmedTimestamp=null,this.game=null}getMeta(){return Se}getGame(){return this.game}getSaveManager(){return this.saveManager}getPurchasesManager(){return this.purchasesManager}getApi(){return this.api}getUserHash(){return this.userHash}isDevMode(){return Xr.identifySite()==="localhost"}async init(e=!1,t=()=>{}){try{console.log("Play: Starting initialization..."),console.log("Play: Initializing UserHash..."),this.userHash=new ra(qe.userHash.key),await this.userHash.init(),console.log("Play: UserHash initialized"),console.log("Play: Initializing API..."),this.api=ya(Xr.identifySite(),this.userHash.getUserHash()),await this.api.init(),console.log("Play: API initialized"),this.api.getEventManager().addListener("Play",ge.INCENTIVIZED_AD_COMPLETED,()=>new Ns(this.getGame()).complete()),console.log("Play: Initializing confirmed timestamp..."),this.confirmedTimestamp=new va(this.api.getTimestamp.bind(this.api)),await this.confirmedTimestamp.init(),console.log("Play: Confirmed timestamp initialized"),console.log("Play: Initializing Game..."),this.game=new Jo(qe.meta.main,this.confirmedTimestamp),Ee.game=this.game,console.log("Play: Game instance created"),console.log("Play: Initializing SaveManager..."),this.saveManager=this._createSaveManager(),await this.saveManager.init(e),console.log("Play: SaveManager initialized"),console.log("Play: Initializing PurchasesManager..."),this.purchasesManager=new ta(this),await this.purchasesManager.init(),console.log("Play: PurchasesManager initialized"),console.log("Play: Initializing game logic..."),this.game.init(),console.log("Play: Game logic initialized"),Q.info("Play","Initialized"),t()}catch(r){throw console.error("Play: Initialization failed:",r),r}}_createSaveManager(){return new ea(this.api,this.userHash,"FactoryIdleSave").setGetSaveDataCallback(()=>({meta:{ver:this.game.getTicker().getNoOfTicks(),timestamp:Math.round(Date.now()/1e3),date:new Date().toISOString()},data:gr.encode(this.exportToWriter().getBuffer())})).setUpdateGameFromLoadedDataCallback(e=>{try{this.importFromReader(new Gt(gr.decode(e.data))),this.game.getTicker().addOfflineGains(),Q.info("Play","Game loaded from save")}catch(t){Q.error("Play","Could not update game from save data",t.message)}})}destroy(){this.game?.destroy(),this.api?.destroy(),this.saveManager?.destroy(),this.purchasesManager?.destroy()}exportToWriter(){return this.game.exportToWriter()}importFromReader(e){this.game.importFromReader(e)}}class Sa{constructor(e){this.path=e,this.imagesData={},this.images={},this.noOfImagesLoaded=0}addImages(e){for(const[t,r]of Object.entries(e))this.imagesData[t]||(this.imagesData[t]=this.path+r);return this}async loadAllAsync(){const e=Object.entries(this.imagesData);e.length!==0&&(this.noOfImagesLoaded=0,await Promise.all(e.map(([t,r])=>new Promise(i=>{const s=new Image;s.onload=()=>{this.noOfImagesLoaded++,i()},s.onerror=()=>{console.warn(`ImageMap: Failed to load image: ${r}`),this.noOfImagesLoaded++,i()},s.src=`${r}?x=${Math.random()}`,this.images[t]=s}))))}getImage(e){return this.images[e]||null}get totalImages(){return Object.keys(this.imagesData).length}get loadedImages(){return this.noOfImagesLoaded}get isAllLoaded(){return this.noOfImagesLoaded===this.totalImages}get loadingProgress(){return this.totalImages===0?100:Math.round(this.noOfImagesLoaded/this.totalImages*100)}}const Ga=new Sa(qe.imageMap.path).addImages({yellowSelection:"mouse/yellow.png",greenSelection:"mouse/green.png",redSelection:"mouse/red.png",blueSelection:"mouse/selected.png",cantPlace:"mouse/cantPlace.png",terrains:"terrains.png",components:"components.png",componentIcons:"componentIcons.png",transportLine:"transportLine.png",resources:"resources.png"});var Ft={exports:{}},qt={exports:{}},Me={},pe={},qi;function me(){if(qi)return pe;qi=1,pe.__esModule=!0,pe.extend=i,pe.indexOf=l,pe.escapeExpression=m,pe.isEmpty=h,pe.createFrame=f,pe.blockParams=c,pe.appendContextPath=a;var p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},e=/[&<>"'`=]/g,t=/[&<>"'`=]/;function r(n){return p[n]}function i(n){for(var g=1;g<arguments.length;g++)for(var v in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],v)&&(n[v]=arguments[g][v]);return n}var s=Object.prototype.toString;pe.toString=s;var o=function(g){return typeof g=="function"};o(/x/)&&(pe.isFunction=o=function(n){return typeof n=="function"&&s.call(n)==="[object Function]"}),pe.isFunction=o;var u=Array.isArray||function(n){return n&&typeof n=="object"?s.call(n)==="[object Array]":!1};pe.isArray=u;function l(n,g){for(var v=0,G=n.length;v<G;v++)if(n[v]===g)return v;return-1}function m(n){if(typeof n!="string"){if(n&&n.toHTML)return n.toHTML();if(n==null)return"";if(!n)return n+"";n=""+n}return t.test(n)?n.replace(e,r):n}function h(n){return!n&&n!==0?!0:!!(u(n)&&n.length===0)}function f(n){var g=i({},n);return g._parent=n,g}function c(n,g){return n.path=g,n}function a(n,g){return(n?n+".":"")+g}return pe}var Ht={exports:{}},Hi;function Te(){return Hi||(Hi=1,(function(p,e){e.__esModule=!0;var t=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function r(i,s){var o=s&&s.loc,u=void 0,l=void 0,m=void 0,h=void 0;o&&(u=o.start.line,l=o.end.line,m=o.start.column,h=o.end.column,i+=" - "+u+":"+m);for(var f=Error.prototype.constructor.call(this,i),c=0;c<t.length;c++)this[t[c]]=f[t[c]];Error.captureStackTrace&&Error.captureStackTrace(this,r);try{o&&(this.lineNumber=u,this.endLineNumber=l,Object.defineProperty?(Object.defineProperty(this,"column",{value:m,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:h,enumerable:!0})):(this.column=m,this.endColumn=h))}catch{}}r.prototype=new Error,e.default=r,p.exports=e.default})(Ht,Ht.exports)),Ht.exports}var pt={},Yt={exports:{}},Yi;function Ca(){return Yi||(Yi=1,(function(p,e){e.__esModule=!0;var t=me();e.default=function(r){r.registerHelper("blockHelperMissing",function(i,s){var o=s.inverse,u=s.fn;if(i===!0)return u(this);if(i===!1||i==null)return o(this);if(t.isArray(i))return i.length>0?(s.ids&&(s.ids=[s.name]),r.helpers.each(i,s)):o(this);if(s.data&&s.ids){var l=t.createFrame(s.data);l.contextPath=t.appendContextPath(s.data.contextPath,s.name),s={data:l}}return u(i,s)})},p.exports=e.default})(Yt,Yt.exports)),Yt.exports}var Wt={exports:{}},Wi;function Ma(){return Wi||(Wi=1,(function(p,e){e.__esModule=!0;function t(o){return o&&o.__esModule?o:{default:o}}var r=me(),i=Te(),s=t(i);e.default=function(o){o.registerHelper("each",function(u,l){if(!l)throw new s.default("Must pass iterator to #each");var m=l.fn,h=l.inverse,f=0,c="",a=void 0,n=void 0;l.data&&l.ids&&(n=r.appendContextPath(l.data.contextPath,l.ids[0])+"."),r.isFunction(u)&&(u=u.call(this)),l.data&&(a=r.createFrame(l.data));function g(b,k,_){a&&(a.key=b,a.index=k,a.first=k===0,a.last=!!_,n&&(a.contextPath=n+b)),c=c+m(u[b],{data:a,blockParams:r.blockParams([u[b],b],[n+b,null])})}if(u&&typeof u=="object")if(r.isArray(u))for(var v=u.length;f<v;f++)f in u&&g(f,f,f===u.length-1);else if(typeof Symbol=="function"&&u[Symbol.iterator]){for(var G=[],M=u[Symbol.iterator](),A=M.next();!A.done;A=M.next())G.push(A.value);u=G;for(var v=u.length;f<v;f++)g(f,f,f===u.length-1)}else(function(){var b=void 0;Object.keys(u).forEach(function(k){b!==void 0&&g(b,f-1),b=k,f++}),b!==void 0&&g(b,f-1,!0)})();return f===0&&(c=h(this)),c})},p.exports=e.default})(Wt,Wt.exports)),Wt.exports}var Vt={exports:{}},Vi;function ka(){return Vi||(Vi=1,(function(p,e){e.__esModule=!0;function t(s){return s&&s.__esModule?s:{default:s}}var r=Te(),i=t(r);e.default=function(s){s.registerHelper("helperMissing",function(){if(arguments.length!==1)throw new i.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},p.exports=e.default})(Vt,Vt.exports)),Vt.exports}var zt={exports:{}},zi;function Ea(){return zi||(zi=1,(function(p,e){e.__esModule=!0;function t(o){return o&&o.__esModule?o:{default:o}}var r=me(),i=Te(),s=t(i);e.default=function(o){o.registerHelper("if",function(u,l){if(arguments.length!=2)throw new s.default("#if requires exactly one argument");return r.isFunction(u)&&(u=u.call(this)),!l.hash.includeZero&&!u||r.isEmpty(u)?l.inverse(this):l.fn(this)}),o.registerHelper("unless",function(u,l){if(arguments.length!=2)throw new s.default("#unless requires exactly one argument");return o.helpers.if.call(this,u,{fn:l.inverse,inverse:l.fn,hash:l.hash})})},p.exports=e.default})(zt,zt.exports)),zt.exports}var $t={exports:{}},$i;function Ta(){return $i||($i=1,(function(p,e){e.__esModule=!0,e.default=function(t){t.registerHelper("log",function(){for(var r=[void 0],i=arguments[arguments.length-1],s=0;s<arguments.length-1;s++)r.push(arguments[s]);var o=1;i.hash.level!=null?o=i.hash.level:i.data&&i.data.level!=null&&(o=i.data.level),r[0]=o,t.log.apply(t,r)})},p.exports=e.default})($t,$t.exports)),$t.exports}var Kt={exports:{}},Ki;function Ia(){return Ki||(Ki=1,(function(p,e){e.__esModule=!0,e.default=function(t){t.registerHelper("lookup",function(r,i,s){return r&&s.lookupProperty(r,i)})},p.exports=e.default})(Kt,Kt.exports)),Kt.exports}var jt={exports:{}},ji;function wa(){return ji||(ji=1,(function(p,e){e.__esModule=!0;function t(o){return o&&o.__esModule?o:{default:o}}var r=me(),i=Te(),s=t(i);e.default=function(o){o.registerHelper("with",function(u,l){if(arguments.length!=2)throw new s.default("#with requires exactly one argument");r.isFunction(u)&&(u=u.call(this));var m=l.fn;if(r.isEmpty(u))return l.inverse(this);var h=l.data;return l.data&&l.ids&&(h=r.createFrame(l.data),h.contextPath=r.appendContextPath(l.data.contextPath,l.ids[0])),m(u,{data:h,blockParams:r.blockParams([u],[h&&h.contextPath])})})},p.exports=e.default})(jt,jt.exports)),jt.exports}var Qi;function Us(){if(Qi)return pt;Qi=1,pt.__esModule=!0,pt.registerDefaultHelpers=g,pt.moveHelperToHooks=v;function p(G){return G&&G.__esModule?G:{default:G}}var e=Ca(),t=p(e),r=Ma(),i=p(r),s=ka(),o=p(s),u=Ea(),l=p(u),m=Ta(),h=p(m),f=Ia(),c=p(f),a=wa(),n=p(a);function g(G){t.default(G),i.default(G),o.default(G),l.default(G),h.default(G),c.default(G),n.default(G)}function v(G,M,A){G.helpers[M]&&(G.hooks[M]=G.helpers[M],A||delete G.helpers[M])}return pt}var Qt={},Jt={exports:{}},Ji;function _a(){return Ji||(Ji=1,(function(p,e){e.__esModule=!0;var t=me();e.default=function(r){r.registerDecorator("inline",function(i,s,o,u){var l=i;return s.partials||(s.partials={},l=function(m,h){var f=o.partials;o.partials=t.extend({},f,s.partials);var c=i(m,h);return o.partials=f,c}),s.partials[u.args[0]]=u.fn,l})},p.exports=e.default})(Jt,Jt.exports)),Jt.exports}var Zi;function Ra(){if(Zi)return Qt;Zi=1,Qt.__esModule=!0,Qt.registerDefaultDecorators=r;function p(i){return i&&i.__esModule?i:{default:i}}var e=_a(),t=p(e);function r(i){t.default(i)}return Qt}var Zt={exports:{}},es;function Ds(){return es||(es=1,(function(p,e){e.__esModule=!0;var t=me(),r={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(s){if(typeof s=="string"){var o=t.indexOf(r.methodMap,s.toLowerCase());o>=0?s=o:s=parseInt(s,10)}return s},log:function(s){if(s=r.lookupLevel(s),typeof console<"u"&&r.lookupLevel(r.level)<=s){var o=r.methodMap[s];console[o]||(o="log");for(var u=arguments.length,l=Array(u>1?u-1:0),m=1;m<u;m++)l[m-1]=arguments[m];console[o].apply(console,l)}}};e.default=r,p.exports=e.default})(Zt,Zt.exports)),Zt.exports}var it={},er={},ts;function Aa(){if(ts)return er;ts=1,er.__esModule=!0,er.createNewLookupObject=e;var p=me();function e(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];return p.extend.apply(void 0,[Object.create(null)].concat(r))}return er}var rs;function Fs(){if(rs)return it;rs=1,it.__esModule=!0,it.createProtoAccessControl=s,it.resultIsAllowed=o,it.resetLoggedProperties=m;function p(h){return h&&h.__esModule?h:{default:h}}var e=Aa(),t=Ds(),r=p(t),i=Object.create(null);function s(h){var f=Object.create(null);f.constructor=!1,f.__defineGetter__=!1,f.__defineSetter__=!1,f.__lookupGetter__=!1;var c=Object.create(null);return c.__proto__=!1,{properties:{whitelist:e.createNewLookupObject(c,h.allowedProtoProperties),defaultValue:h.allowProtoPropertiesByDefault},methods:{whitelist:e.createNewLookupObject(f,h.allowedProtoMethods),defaultValue:h.allowProtoMethodsByDefault}}}function o(h,f,c){return u(typeof h=="function"?f.methods:f.properties,c)}function u(h,f){return h.whitelist[f]!==void 0?h.whitelist[f]===!0:h.defaultValue!==void 0?h.defaultValue:(l(f),!1)}function l(h){i[h]!==!0&&(i[h]=!0,r.default.log("error",'Handlebars: Access has been denied to resolve the property "'+h+`" because it is not an "own property" of its parent.
You can add a runtime option to disable the check or this warning:
See https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details`))}function m(){Object.keys(i).forEach(function(h){delete i[h]})}return it}var is;function $r(){if(is)return Me;is=1,Me.__esModule=!0,Me.HandlebarsEnvironment=n;function p(v){return v&&v.__esModule?v:{default:v}}var e=me(),t=Te(),r=p(t),i=Us(),s=Ra(),o=Ds(),u=p(o),l=Fs(),m="4.7.8";Me.VERSION=m;var h=8;Me.COMPILER_REVISION=h;var f=7;Me.LAST_COMPATIBLE_COMPILER_REVISION=f;var c={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};Me.REVISION_CHANGES=c;var a="[object Object]";function n(v,G,M){this.helpers=v||{},this.partials=G||{},this.decorators=M||{},i.registerDefaultHelpers(this),s.registerDefaultDecorators(this)}n.prototype={constructor:n,logger:u.default,log:u.default.log,registerHelper:function(G,M){if(e.toString.call(G)===a){if(M)throw new r.default("Arg not supported with multiple helpers");e.extend(this.helpers,G)}else this.helpers[G]=M},unregisterHelper:function(G){delete this.helpers[G]},registerPartial:function(G,M){if(e.toString.call(G)===a)e.extend(this.partials,G);else{if(typeof M>"u")throw new r.default('Attempting to register a partial called "'+G+'" as undefined');this.partials[G]=M}},unregisterPartial:function(G){delete this.partials[G]},registerDecorator:function(G,M){if(e.toString.call(G)===a){if(M)throw new r.default("Arg not supported with multiple decorators");e.extend(this.decorators,G)}else this.decorators[G]=M},unregisterDecorator:function(G){delete this.decorators[G]},resetLoggedPropertyAccesses:function(){l.resetLoggedProperties()}};var g=u.default.log;return Me.log=g,Me.createFrame=e.createFrame,Me.logger=u.default,Me}var tr={exports:{}},ss;function Pa(){return ss||(ss=1,(function(p,e){e.__esModule=!0;function t(r){this.string=r}t.prototype.toString=t.prototype.toHTML=function(){return""+this.string},e.default=t,p.exports=e.default})(tr,tr.exports)),tr.exports}var xe={},rr={},ns;function Oa(){if(ns)return rr;ns=1,rr.__esModule=!0,rr.wrapHelper=p;function p(e,t){if(typeof e!="function")return e;var r=function(){var s=arguments[arguments.length-1];return arguments[arguments.length-1]=t(s),e.apply(this,arguments)};return r}return rr}var os;function xa(){if(os)return xe;os=1,xe.__esModule=!0,xe.checkRevision=h,xe.template=f,xe.wrapProgram=c,xe.resolvePartial=a,xe.invokePartial=n,xe.noop=g;function p(b){return b&&b.__esModule?b:{default:b}}function e(b){if(b&&b.__esModule)return b;var k={};if(b!=null)for(var _ in b)Object.prototype.hasOwnProperty.call(b,_)&&(k[_]=b[_]);return k.default=b,k}var t=me(),r=e(t),i=Te(),s=p(i),o=$r(),u=Us(),l=Oa(),m=Fs();function h(b){var k=b&&b[0]||1,_=o.COMPILER_REVISION;if(!(k>=o.LAST_COMPATIBLE_COMPILER_REVISION&&k<=o.COMPILER_REVISION))if(k<o.LAST_COMPATIBLE_COMPILER_REVISION){var E=o.REVISION_CHANGES[_],P=o.REVISION_CHANGES[k];throw new s.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+E+") or downgrade your runtime to an older version ("+P+").")}else throw new s.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+b[1]+").")}function f(b,k){if(!k)throw new s.default("No environment passed to template");if(!b||!b.main)throw new s.default("Unknown template object: "+typeof b);b.main.decorator=b.main_d,k.VM.checkRevision(b.compiler);var _=b.compiler&&b.compiler[0]===7;function E(O,x,B){B.hash&&(x=r.extend({},x,B.hash),B.ids&&(B.ids[0]=!0)),O=k.VM.resolvePartial.call(this,O,x,B);var q=r.extend({},B,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),z=k.VM.invokePartial.call(this,O,x,q);if(z==null&&k.compile&&(B.partials[B.name]=k.compile(O,b.compilerOptions,k),z=B.partials[B.name](x,q)),z!=null){if(B.indent){for(var re=z.split(`
`),ee=0,ne=re.length;ee<ne&&!(!re[ee]&&ee+1===ne);ee++)re[ee]=B.indent+re[ee];z=re.join(`
`)}return z}else throw new s.default("The partial "+B.name+" could not be compiled when running in runtime-only mode")}var P={strict:function(x,B,q){if(!x||!(B in x))throw new s.default('"'+B+'" not defined in '+x,{loc:q});return P.lookupProperty(x,B)},lookupProperty:function(x,B){var q=x[B];if(q==null||Object.prototype.hasOwnProperty.call(x,B)||m.resultIsAllowed(q,P.protoAccessControl,B))return q},lookup:function(x,B){for(var q=x.length,z=0;z<q;z++){var re=x[z]&&P.lookupProperty(x[z],B);if(re!=null)return x[z][B]}},lambda:function(x,B){return typeof x=="function"?x.call(B):x},escapeExpression:r.escapeExpression,invokePartial:E,fn:function(x){var B=b[x];return B.decorator=b[x+"_d"],B},programs:[],program:function(x,B,q,z,re){var ee=this.programs[x],ne=this.fn(x);return B||re||z||q?ee=c(this,x,ne,B,q,z,re):ee||(ee=this.programs[x]=c(this,x,ne)),ee},data:function(x,B){for(;x&&B--;)x=x._parent;return x},mergeIfNeeded:function(x,B){var q=x||B;return x&&B&&x!==B&&(q=r.extend({},B,x)),q},nullContext:Object.seal({}),noop:k.VM.noop,compilerInfo:b.compiler};function F(O){var x=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],B=x.data;F._setup(x),!x.partial&&b.useData&&(B=v(O,B));var q=void 0,z=b.useBlockParams?[]:void 0;b.useDepths&&(x.depths?q=O!=x.depths[0]?[O].concat(x.depths):x.depths:q=[O]);function re(ee){return""+b.main(P,ee,P.helpers,P.partials,B,z,q)}return re=G(b.main,re,P,x.depths||[],B,z),re(O,x)}return F.isTop=!0,F._setup=function(O){if(O.partial)P.protoAccessControl=O.protoAccessControl,P.helpers=O.helpers,P.partials=O.partials,P.decorators=O.decorators,P.hooks=O.hooks;else{var x=r.extend({},k.helpers,O.helpers);M(x,P),P.helpers=x,b.usePartial&&(P.partials=P.mergeIfNeeded(O.partials,k.partials)),(b.usePartial||b.useDecorators)&&(P.decorators=r.extend({},k.decorators,O.decorators)),P.hooks={},P.protoAccessControl=m.createProtoAccessControl(O);var B=O.allowCallsToHelperMissing||_;u.moveHelperToHooks(P,"helperMissing",B),u.moveHelperToHooks(P,"blockHelperMissing",B)}},F._child=function(O,x,B,q){if(b.useBlockParams&&!B)throw new s.default("must pass block params");if(b.useDepths&&!q)throw new s.default("must pass parent depths");return c(P,O,b[O],x,0,B,q)},F}function c(b,k,_,E,P,F,O){function x(B){var q=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],z=O;return O&&B!=O[0]&&!(B===b.nullContext&&O[0]===null)&&(z=[B].concat(O)),_(b,B,b.helpers,b.partials,q.data||E,F&&[q.blockParams].concat(F),z)}return x=G(_,x,b,O,E,F),x.program=k,x.depth=O?O.length:0,x.blockParams=P||0,x}function a(b,k,_){return b?!b.call&&!_.name&&(_.name=b,b=_.partials[b]):_.name==="@partial-block"?b=_.data["partial-block"]:b=_.partials[_.name],b}function n(b,k,_){var E=_.data&&_.data["partial-block"];_.partial=!0,_.ids&&(_.data.contextPath=_.ids[0]||_.data.contextPath);var P=void 0;if(_.fn&&_.fn!==g&&(function(){_.data=o.createFrame(_.data);var F=_.fn;P=_.data["partial-block"]=function(x){var B=arguments.length<=1||arguments[1]===void 0?{}:arguments[1];return B.data=o.createFrame(B.data),B.data["partial-block"]=E,F(x,B)},F.partials&&(_.partials=r.extend({},_.partials,F.partials))})(),b===void 0&&P&&(b=P),b===void 0)throw new s.default("The partial "+_.name+" could not be found");if(b instanceof Function)return b(k,_)}function g(){return""}function v(b,k){return(!k||!("root"in k))&&(k=k?o.createFrame(k):{},k.root=b),k}function G(b,k,_,E,P,F){if(b.decorator){var O={};k=b.decorator(k,O,_,E&&E[0],P,F,E),r.extend(k,O)}return k}function M(b,k){Object.keys(b).forEach(function(_){var E=b[_];b[_]=A(E,k)})}function A(b,k){var _=k.lookupProperty;return l.wrapHelper(b,function(E){return r.extend({lookupProperty:_},E)})}return xe}var ir={exports:{}},as;function qs(){return as||(as=1,(function(p,e){e.__esModule=!0,e.default=function(t){(function(){typeof globalThis!="object"&&(Object.prototype.__defineGetter__("__magic__",function(){return this}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__)})();var r=globalThis.Handlebars;t.noConflict=function(){return globalThis.Handlebars===t&&(globalThis.Handlebars=r),t}},p.exports=e.default})(ir,ir.exports)),ir.exports}var cs;function Ba(){return cs||(cs=1,(function(p,e){e.__esModule=!0;function t(M){return M&&M.__esModule?M:{default:M}}function r(M){if(M&&M.__esModule)return M;var A={};if(M!=null)for(var b in M)Object.prototype.hasOwnProperty.call(M,b)&&(A[b]=M[b]);return A.default=M,A}var i=$r(),s=r(i),o=Pa(),u=t(o),l=Te(),m=t(l),h=me(),f=r(h),c=xa(),a=r(c),n=qs(),g=t(n);function v(){var M=new s.HandlebarsEnvironment;return f.extend(M,s),M.SafeString=u.default,M.Exception=m.default,M.Utils=f,M.escapeExpression=f.escapeExpression,M.VM=a,M.template=function(A){return a.template(A,M)},M}var G=v();G.create=v,g.default(G),G.default=G,e.default=G,p.exports=e.default})(qt,qt.exports)),qt.exports}var sr={exports:{}},us;function Hs(){return us||(us=1,(function(p,e){e.__esModule=!0;var t={helpers:{helperExpression:function(i){return i.type==="SubExpression"||(i.type==="MustacheStatement"||i.type==="BlockStatement")&&!!(i.params&&i.params.length||i.hash)},scopedId:function(i){return/^\.|this\b/.test(i.original)},simpleId:function(i){return i.parts.length===1&&!t.helpers.scopedId(i)&&!i.depth}}};e.default=t,p.exports=e.default})(sr,sr.exports)),sr.exports}var st={},nr={exports:{}},ls;function La(){return ls||(ls=1,(function(p,e){e.__esModule=!0;var t=(function(){var r={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(u,l,m,h,f,c,a){var n=c.length-1;switch(f){case 1:return c[n-1];case 2:this.$=h.prepareProgram(c[n]);break;case 3:this.$=c[n];break;case 4:this.$=c[n];break;case 5:this.$=c[n];break;case 6:this.$=c[n];break;case 7:this.$=c[n];break;case 8:this.$=c[n];break;case 9:this.$={type:"CommentStatement",value:h.stripComment(c[n]),strip:h.stripFlags(c[n],c[n]),loc:h.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:c[n],value:c[n],loc:h.locInfo(this._$)};break;case 11:this.$=h.prepareRawBlock(c[n-2],c[n-1],c[n],this._$);break;case 12:this.$={path:c[n-3],params:c[n-2],hash:c[n-1]};break;case 13:this.$=h.prepareBlock(c[n-3],c[n-2],c[n-1],c[n],!1,this._$);break;case 14:this.$=h.prepareBlock(c[n-3],c[n-2],c[n-1],c[n],!0,this._$);break;case 15:this.$={open:c[n-5],path:c[n-4],params:c[n-3],hash:c[n-2],blockParams:c[n-1],strip:h.stripFlags(c[n-5],c[n])};break;case 16:this.$={path:c[n-4],params:c[n-3],hash:c[n-2],blockParams:c[n-1],strip:h.stripFlags(c[n-5],c[n])};break;case 17:this.$={path:c[n-4],params:c[n-3],hash:c[n-2],blockParams:c[n-1],strip:h.stripFlags(c[n-5],c[n])};break;case 18:this.$={strip:h.stripFlags(c[n-1],c[n-1]),program:c[n]};break;case 19:var g=h.prepareBlock(c[n-2],c[n-1],c[n],c[n],!1,this._$),v=h.prepareProgram([g],c[n-1].loc);v.chained=!0,this.$={strip:c[n-2].strip,program:v,chain:!0};break;case 20:this.$=c[n];break;case 21:this.$={path:c[n-1],strip:h.stripFlags(c[n-2],c[n])};break;case 22:this.$=h.prepareMustache(c[n-3],c[n-2],c[n-1],c[n-4],h.stripFlags(c[n-4],c[n]),this._$);break;case 23:this.$=h.prepareMustache(c[n-3],c[n-2],c[n-1],c[n-4],h.stripFlags(c[n-4],c[n]),this._$);break;case 24:this.$={type:"PartialStatement",name:c[n-3],params:c[n-2],hash:c[n-1],indent:"",strip:h.stripFlags(c[n-4],c[n]),loc:h.locInfo(this._$)};break;case 25:this.$=h.preparePartialBlock(c[n-2],c[n-1],c[n],this._$);break;case 26:this.$={path:c[n-3],params:c[n-2],hash:c[n-1],strip:h.stripFlags(c[n-4],c[n])};break;case 27:this.$=c[n];break;case 28:this.$=c[n];break;case 29:this.$={type:"SubExpression",path:c[n-3],params:c[n-2],hash:c[n-1],loc:h.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:c[n],loc:h.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:h.id(c[n-2]),value:c[n],loc:h.locInfo(this._$)};break;case 32:this.$=h.id(c[n-1]);break;case 33:this.$=c[n];break;case 34:this.$=c[n];break;case 35:this.$={type:"StringLiteral",value:c[n],original:c[n],loc:h.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(c[n]),original:Number(c[n]),loc:h.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:c[n]==="true",original:c[n]==="true",loc:h.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:h.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:h.locInfo(this._$)};break;case 40:this.$=c[n];break;case 41:this.$=c[n];break;case 42:this.$=h.preparePath(!0,c[n],this._$);break;case 43:this.$=h.preparePath(!1,c[n],this._$);break;case 44:c[n-2].push({part:h.id(c[n]),original:c[n],separator:c[n-1]}),this.$=c[n-2];break;case 45:this.$=[{part:h.id(c[n]),original:c[n]}];break;case 46:this.$=[];break;case 47:c[n-1].push(c[n]);break;case 48:this.$=[];break;case 49:c[n-1].push(c[n]);break;case 50:this.$=[];break;case 51:c[n-1].push(c[n]);break;case 58:this.$=[];break;case 59:c[n-1].push(c[n]);break;case 64:this.$=[];break;case 65:c[n-1].push(c[n]);break;case 70:this.$=[];break;case 71:c[n-1].push(c[n]);break;case 78:this.$=[];break;case 79:c[n-1].push(c[n]);break;case 82:this.$=[];break;case 83:c[n-1].push(c[n]);break;case 86:this.$=[];break;case 87:c[n-1].push(c[n]);break;case 90:this.$=[];break;case 91:c[n-1].push(c[n]);break;case 94:this.$=[];break;case 95:c[n-1].push(c[n]);break;case 98:this.$=[c[n]];break;case 99:c[n-1].push(c[n]);break;case 100:this.$=[c[n]];break;case 101:c[n-1].push(c[n]);break}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(u,l){throw new Error(u)},parse:function(u){var l=this,m=[0],h=[null],f=[],c=this.table,a="",n=0,g=0;this.lexer.setInput(u),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc>"u"&&(this.lexer.yylloc={});var v=this.lexer.yylloc;f.push(v);var G=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);function M(){var q;return q=l.lexer.lex()||1,typeof q!="number"&&(q=l.symbols_[q]||q),q}for(var A,b,k,_,E={},P,F,O,x;;){if(b=m[m.length-1],this.defaultActions[b]?k=this.defaultActions[b]:((A===null||typeof A>"u")&&(A=M()),k=c[b]&&c[b][A]),typeof k>"u"||!k.length||!k[0]){var B="";{x=[];for(P in c[b])this.terminals_[P]&&P>2&&x.push("'"+this.terminals_[P]+"'");this.lexer.showPosition?B="Parse error on line "+(n+1)+`:
`+this.lexer.showPosition()+`
Expecting `+x.join(", ")+", got '"+(this.terminals_[A]||A)+"'":B="Parse error on line "+(n+1)+": Unexpected "+(A==1?"end of input":"'"+(this.terminals_[A]||A)+"'"),this.parseError(B,{text:this.lexer.match,token:this.terminals_[A]||A,line:this.lexer.yylineno,loc:v,expected:x})}}if(k[0]instanceof Array&&k.length>1)throw new Error("Parse Error: multiple actions possible at state: "+b+", token: "+A);switch(k[0]){case 1:m.push(A),h.push(this.lexer.yytext),f.push(this.lexer.yylloc),m.push(k[1]),A=null,g=this.lexer.yyleng,a=this.lexer.yytext,n=this.lexer.yylineno,v=this.lexer.yylloc;break;case 2:if(F=this.productions_[k[1]][1],E.$=h[h.length-F],E._$={first_line:f[f.length-(F||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(F||1)].first_column,last_column:f[f.length-1].last_column},G&&(E._$.range=[f[f.length-(F||1)].range[0],f[f.length-1].range[1]]),_=this.performAction.call(E,a,g,n,this.yy,k[1],h,f),typeof _<"u")return _;F&&(m=m.slice(0,-1*F*2),h=h.slice(0,-1*F),f=f.slice(0,-1*F)),m.push(this.productions_[k[1]][0]),h.push(E.$),f.push(E._$),O=c[m[m.length-2]][m[m.length-1]],m.push(O);break;case 3:return!0}}return!0}},i=(function(){var o={EOF:1,parseError:function(l,m){if(this.yy.parser)this.yy.parser.parseError(l,m);else throw new Error(l)},setInput:function(l){return this._input=l,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var l=this._input[0];this.yytext+=l,this.yyleng++,this.offset++,this.match+=l,this.matched+=l;var m=l.match(/(?:\r\n?|\n).*/g);return m?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),l},unput:function(l){var m=l.length,h=l.split(/(?:\r\n?|\n)/g);this._input=l+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-m-1),this.offset-=m;var f=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),h.length-1&&(this.yylineno-=h.length-1);var c=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:h?(h.length===f.length?this.yylloc.first_column:0)+f[f.length-h.length].length-h[0].length:this.yylloc.first_column-m},this.options.ranges&&(this.yylloc.range=[c[0],c[0]+this.yyleng-m]),this},more:function(){return this._more=!0,this},less:function(l){this.unput(this.match.slice(l))},pastInput:function(){var l=this.matched.substr(0,this.matched.length-this.match.length);return(l.length>20?"...":"")+l.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var l=this.match;return l.length<20&&(l+=this._input.substr(0,20-l.length)),(l.substr(0,20)+(l.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var l=this.pastInput(),m=new Array(l.length+1).join("-");return l+this.upcomingInput()+`
`+m+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var l,m,h,f,c;this._more||(this.yytext="",this.match="");for(var a=this._currentRules(),n=0;n<a.length&&(h=this._input.match(this.rules[a[n]]),!(h&&(!m||h[0].length>m[0].length)&&(m=h,f=n,!this.options.flex)));n++);return m?(c=m[0].match(/(?:\r\n?|\n).*/g),c&&(this.yylineno+=c.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+m[0].length},this.yytext+=m[0],this.match+=m[0],this.matches=m,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(m[0].length),this.matched+=m[0],l=this.performAction.call(this,this.yy,this,a[f],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),l||void 0):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var l=this.next();return typeof l<"u"?l:this.lex()},begin:function(l){this.conditionStack.push(l)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(l){this.begin(l)}};return o.options={},o.performAction=function(l,m,h,f){function c(a,n){return m.yytext=m.yytext.substring(a,m.yyleng-n+a)}switch(h){case 0:if(m.yytext.slice(-2)==="\\\\"?(c(0,1),this.begin("mu")):m.yytext.slice(-1)==="\\"?(c(0,1),this.begin("emu")):this.begin("mu"),m.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),this.conditionStack[this.conditionStack.length-1]==="raw"?15:(c(5,9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(m.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return m.yytext=c(1,2).replace(/\\"/g,'"'),80;case 32:return m.yytext=c(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return m.yytext=m.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},o.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],o.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},o})();r.lexer=i;function s(){this.yy={}}return s.prototype=r,r.Parser=s,new s})();e.default=t,p.exports=e.default})(nr,nr.exports)),nr.exports}var or={exports:{}},ar={exports:{}},hs;function Ys(){return hs||(hs=1,(function(p,e){e.__esModule=!0;function t(m){return m&&m.__esModule?m:{default:m}}var r=Te(),i=t(r);function s(){this.parents=[]}s.prototype={constructor:s,mutating:!1,acceptKey:function(h,f){var c=this.accept(h[f]);if(this.mutating){if(c&&!s.prototype[c.type])throw new i.default('Unexpected node type "'+c.type+'" found when accepting '+f+" on "+h.type);h[f]=c}},acceptRequired:function(h,f){if(this.acceptKey(h,f),!h[f])throw new i.default(h.type+" requires "+f)},acceptArray:function(h){for(var f=0,c=h.length;f<c;f++)this.acceptKey(h,f),h[f]||(h.splice(f,1),f--,c--)},accept:function(h){if(h){if(!this[h.type])throw new i.default("Unknown type: "+h.type,h);this.current&&this.parents.unshift(this.current),this.current=h;var f=this[h.type](h);if(this.current=this.parents.shift(),!this.mutating||f)return f;if(f!==!1)return h}},Program:function(h){this.acceptArray(h.body)},MustacheStatement:o,Decorator:o,BlockStatement:u,DecoratorBlock:u,PartialStatement:l,PartialBlockStatement:function(h){l.call(this,h),this.acceptKey(h,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:o,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(h){this.acceptArray(h.pairs)},HashPair:function(h){this.acceptRequired(h,"value")}};function o(m){this.acceptRequired(m,"path"),this.acceptArray(m.params),this.acceptKey(m,"hash")}function u(m){o.call(this,m),this.acceptKey(m,"program"),this.acceptKey(m,"inverse")}function l(m){this.acceptRequired(m,"name"),this.acceptArray(m.params),this.acceptKey(m,"hash")}e.default=s,p.exports=e.default})(ar,ar.exports)),ar.exports}var ds;function Na(){return ds||(ds=1,(function(p,e){e.__esModule=!0;function t(h){return h&&h.__esModule?h:{default:h}}var r=Ys(),i=t(r);function s(){var h=arguments.length<=0||arguments[0]===void 0?{}:arguments[0];this.options=h}s.prototype=new i.default,s.prototype.Program=function(h){var f=!this.options.ignoreStandalone,c=!this.isRootSeen;this.isRootSeen=!0;for(var a=h.body,n=0,g=a.length;n<g;n++){var v=a[n],G=this.accept(v);if(G){var M=o(a,n,c),A=u(a,n,c),b=G.openStandalone&&M,k=G.closeStandalone&&A,_=G.inlineStandalone&&M&&A;G.close&&l(a,n,!0),G.open&&m(a,n,!0),f&&_&&(l(a,n),m(a,n)&&v.type==="PartialStatement"&&(v.indent=/([ \t]+$)/.exec(a[n-1].original)[1])),f&&b&&(l((v.program||v.inverse).body),m(a,n)),f&&k&&(l(a,n),m((v.inverse||v.program).body))}}return h},s.prototype.BlockStatement=s.prototype.DecoratorBlock=s.prototype.PartialBlockStatement=function(h){this.accept(h.program),this.accept(h.inverse);var f=h.program||h.inverse,c=h.program&&h.inverse,a=c,n=c;if(c&&c.chained)for(a=c.body[0].program;n.chained;)n=n.body[n.body.length-1].program;var g={open:h.openStrip.open,close:h.closeStrip.close,openStandalone:u(f.body),closeStandalone:o((a||f).body)};if(h.openStrip.close&&l(f.body,null,!0),c){var v=h.inverseStrip;v.open&&m(f.body,null,!0),v.close&&l(a.body,null,!0),h.closeStrip.open&&m(n.body,null,!0),!this.options.ignoreStandalone&&o(f.body)&&u(a.body)&&(m(f.body),l(a.body))}else h.closeStrip.open&&m(f.body,null,!0);return g},s.prototype.Decorator=s.prototype.MustacheStatement=function(h){return h.strip},s.prototype.PartialStatement=s.prototype.CommentStatement=function(h){var f=h.strip||{};return{inlineStandalone:!0,open:f.open,close:f.close}};function o(h,f,c){f===void 0&&(f=h.length);var a=h[f-1],n=h[f-2];if(!a)return c;if(a.type==="ContentStatement")return(n||!c?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(a.original)}function u(h,f,c){f===void 0&&(f=-1);var a=h[f+1],n=h[f+2];if(!a)return c;if(a.type==="ContentStatement")return(n||!c?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(a.original)}function l(h,f,c){var a=h[f==null?0:f+1];if(!(!a||a.type!=="ContentStatement"||!c&&a.rightStripped)){var n=a.value;a.value=a.value.replace(c?/^\s+/:/^[ \t]*\r?\n?/,""),a.rightStripped=a.value!==n}}function m(h,f,c){var a=h[f==null?h.length-1:f-1];if(!(!a||a.type!=="ContentStatement"||!c&&a.leftStripped)){var n=a.value;return a.value=a.value.replace(c?/\s+$/:/[ \t]+$/,""),a.leftStripped=a.value!==n,a.leftStripped}}e.default=s,p.exports=e.default})(or,or.exports)),or.exports}var Xe={},ps;function Ua(){if(ps)return Xe;ps=1,Xe.__esModule=!0,Xe.SourceLocation=i,Xe.id=s,Xe.stripFlags=o,Xe.stripComment=u,Xe.preparePath=l,Xe.prepareMustache=m,Xe.prepareRawBlock=h,Xe.prepareBlock=f,Xe.prepareProgram=c,Xe.preparePartialBlock=a;function p(n){return n&&n.__esModule?n:{default:n}}var e=Te(),t=p(e);function r(n,g){if(g=g.path?g.path.original:g,n.path.original!==g){var v={loc:n.path.loc};throw new t.default(n.path.original+" doesn't match "+g,v)}}function i(n,g){this.source=n,this.start={line:g.first_line,column:g.first_column},this.end={line:g.last_line,column:g.last_column}}function s(n){return/^\[.*\]$/.test(n)?n.substring(1,n.length-1):n}function o(n,g){return{open:n.charAt(2)==="~",close:g.charAt(g.length-3)==="~"}}function u(n){return n.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function l(n,g,v){v=this.locInfo(v);for(var G=n?"@":"",M=[],A=0,b=0,k=g.length;b<k;b++){var _=g[b].part,E=g[b].original!==_;if(G+=(g[b].separator||"")+_,!E&&(_===".."||_==="."||_==="this")){if(M.length>0)throw new t.default("Invalid path: "+G,{loc:v});_===".."&&A++}else M.push(_)}return{type:"PathExpression",data:n,depth:A,parts:M,original:G,loc:v}}function m(n,g,v,G,M,A){var b=G.charAt(3)||G.charAt(2),k=b!=="{"&&b!=="&",_=/\*/.test(G);return{type:_?"Decorator":"MustacheStatement",path:n,params:g,hash:v,escaped:k,strip:M,loc:this.locInfo(A)}}function h(n,g,v,G){r(n,v),G=this.locInfo(G);var M={type:"Program",body:g,strip:{},loc:G};return{type:"BlockStatement",path:n.path,params:n.params,hash:n.hash,program:M,openStrip:{},inverseStrip:{},closeStrip:{},loc:G}}function f(n,g,v,G,M,A){G&&G.path&&r(n,G);var b=/\*/.test(n.open);g.blockParams=n.blockParams;var k=void 0,_=void 0;if(v){if(b)throw new t.default("Unexpected inverse block on decorator",v);v.chain&&(v.program.body[0].closeStrip=G.strip),_=v.strip,k=v.program}return M&&(M=k,k=g,g=M),{type:b?"DecoratorBlock":"BlockStatement",path:n.path,params:n.params,hash:n.hash,program:g,inverse:k,openStrip:n.strip,inverseStrip:_,closeStrip:G&&G.strip,loc:this.locInfo(A)}}function c(n,g){if(!g&&n.length){var v=n[0].loc,G=n[n.length-1].loc;v&&G&&(g={source:v.source,start:{line:v.start.line,column:v.start.column},end:{line:G.end.line,column:G.end.column}})}return{type:"Program",body:n,strip:{},loc:g}}function a(n,g,v,G){return r(n,v),{type:"PartialBlockStatement",name:n.path,params:n.params,hash:n.hash,program:g,openStrip:n.strip,closeStrip:v&&v.strip,loc:this.locInfo(G)}}return Xe}var ms;function Da(){if(ms)return st;ms=1,st.__esModule=!0,st.parseWithoutProcessing=h,st.parse=f;function p(c){if(c&&c.__esModule)return c;var a={};if(c!=null)for(var n in c)Object.prototype.hasOwnProperty.call(c,n)&&(a[n]=c[n]);return a.default=c,a}function e(c){return c&&c.__esModule?c:{default:c}}var t=La(),r=e(t),i=Na(),s=e(i),o=Ua(),u=p(o),l=me();st.parser=r.default;var m={};l.extend(m,u);function h(c,a){if(c.type==="Program")return c;r.default.yy=m,m.locInfo=function(g){return new m.SourceLocation(a&&a.srcName,g)};var n=r.default.parse(c);return n}function f(c,a){var n=h(c,a),g=new s.default(a);return g.accept(n)}return st}var nt={},Xs;function Fa(){if(Xs)return nt;Xs=1,nt.__esModule=!0,nt.Compiler=u,nt.precompile=l,nt.compile=m;function p(c){return c&&c.__esModule?c:{default:c}}var e=Te(),t=p(e),r=me(),i=Hs(),s=p(i),o=[].slice;function u(){}u.prototype={compiler:u,equals:function(a){var n=this.opcodes.length;if(a.opcodes.length!==n)return!1;for(var g=0;g<n;g++){var v=this.opcodes[g],G=a.opcodes[g];if(v.opcode!==G.opcode||!h(v.args,G.args))return!1}n=this.children.length;for(var g=0;g<n;g++)if(!this.children[g].equals(a.children[g]))return!1;return!0},guid:0,compile:function(a,n){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=n,this.stringParams=n.stringParams,this.trackIds=n.trackIds,n.blockParams=n.blockParams||[],n.knownHelpers=r.extend(Object.create(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},n.knownHelpers),this.accept(a)},compileProgram:function(a){var n=new this.compiler,g=n.compile(a,this.options),v=this.guid++;return this.usePartial=this.usePartial||g.usePartial,this.children[v]=g,this.useDepths=this.useDepths||g.useDepths,v},accept:function(a){if(!this[a.type])throw new t.default("Unknown type: "+a.type,a);this.sourceNode.unshift(a);var n=this[a.type](a);return this.sourceNode.shift(),n},Program:function(a){this.options.blockParams.unshift(a.blockParams);for(var n=a.body,g=n.length,v=0;v<g;v++)this.accept(n[v]);return this.options.blockParams.shift(),this.isSimple=g===1,this.blockParams=a.blockParams?a.blockParams.length:0,this},BlockStatement:function(a){f(a);var n=a.program,g=a.inverse;n=n&&this.compileProgram(n),g=g&&this.compileProgram(g);var v=this.classifySexpr(a);v==="helper"?this.helperSexpr(a,n,g):v==="simple"?(this.simpleSexpr(a),this.opcode("pushProgram",n),this.opcode("pushProgram",g),this.opcode("emptyHash"),this.opcode("blockValue",a.path.original)):(this.ambiguousSexpr(a,n,g),this.opcode("pushProgram",n),this.opcode("pushProgram",g),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(a){var n=a.program&&this.compileProgram(a.program),g=this.setupFullMustacheParams(a,n,void 0),v=a.path;this.useDecorators=!0,this.opcode("registerDecorator",g.length,v.original)},PartialStatement:function(a){this.usePartial=!0;var n=a.program;n&&(n=this.compileProgram(a.program));var g=a.params;if(g.length>1)throw new t.default("Unsupported number of partial arguments: "+g.length,a);g.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):g.push({type:"PathExpression",parts:[],depth:0}));var v=a.name.original,G=a.name.type==="SubExpression";G&&this.accept(a.name),this.setupFullMustacheParams(a,n,void 0,!0);var M=a.indent||"";this.options.preventIndent&&M&&(this.opcode("appendContent",M),M=""),this.opcode("invokePartial",G,v,M),this.opcode("append")},PartialBlockStatement:function(a){this.PartialStatement(a)},MustacheStatement:function(a){this.SubExpression(a),a.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(a){this.DecoratorBlock(a)},ContentStatement:function(a){a.value&&this.opcode("appendContent",a.value)},CommentStatement:function(){},SubExpression:function(a){f(a);var n=this.classifySexpr(a);n==="simple"?this.simpleSexpr(a):n==="helper"?this.helperSexpr(a):this.ambiguousSexpr(a)},ambiguousSexpr:function(a,n,g){var v=a.path,G=v.parts[0],M=n!=null||g!=null;this.opcode("getContext",v.depth),this.opcode("pushProgram",n),this.opcode("pushProgram",g),v.strict=!0,this.accept(v),this.opcode("invokeAmbiguous",G,M)},simpleSexpr:function(a){var n=a.path;n.strict=!0,this.accept(n),this.opcode("resolvePossibleLambda")},helperSexpr:function(a,n,g){var v=this.setupFullMustacheParams(a,n,g),G=a.path,M=G.parts[0];if(this.options.knownHelpers[M])this.opcode("invokeKnownHelper",v.length,M);else{if(this.options.knownHelpersOnly)throw new t.default("You specified knownHelpersOnly, but used the unknown helper "+M,a);G.strict=!0,G.falsy=!0,this.accept(G),this.opcode("invokeHelper",v.length,G.original,s.default.helpers.simpleId(G))}},PathExpression:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth);var n=a.parts[0],g=s.default.helpers.scopedId(a),v=!a.depth&&!g&&this.blockParamIndex(n);v?this.opcode("lookupBlockParam",v,a.parts):n?a.data?(this.options.data=!0,this.opcode("lookupData",a.depth,a.parts,a.strict)):this.opcode("lookupOnContext",a.parts,a.falsy,a.strict,g):this.opcode("pushContext")},StringLiteral:function(a){this.opcode("pushString",a.value)},NumberLiteral:function(a){this.opcode("pushLiteral",a.value)},BooleanLiteral:function(a){this.opcode("pushLiteral",a.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(a){var n=a.pairs,g=0,v=n.length;for(this.opcode("pushHash");g<v;g++)this.pushParam(n[g].value);for(;g--;)this.opcode("assignToHash",n[g].key);this.opcode("popHash")},opcode:function(a){this.opcodes.push({opcode:a,args:o.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(a){a&&(this.useDepths=!0)},classifySexpr:function(a){var n=s.default.helpers.simpleId(a.path),g=n&&!!this.blockParamIndex(a.path.parts[0]),v=!g&&s.default.helpers.helperExpression(a),G=!g&&(v||n);if(G&&!v){var M=a.path.parts[0],A=this.options;A.knownHelpers[M]?v=!0:A.knownHelpersOnly&&(G=!1)}return v?"helper":G?"ambiguous":"simple"},pushParams:function(a){for(var n=0,g=a.length;n<g;n++)this.pushParam(a[n])},pushParam:function(a){var n=a.value!=null?a.value:a.original||"";if(this.stringParams)n.replace&&(n=n.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),a.depth&&this.addDepth(a.depth),this.opcode("getContext",a.depth||0),this.opcode("pushStringParam",n,a.type),a.type==="SubExpression"&&this.accept(a);else{if(this.trackIds){var g=void 0;if(a.parts&&!s.default.helpers.scopedId(a)&&!a.depth&&(g=this.blockParamIndex(a.parts[0])),g){var v=a.parts.slice(1).join(".");this.opcode("pushId","BlockParam",g,v)}else n=a.original||n,n.replace&&(n=n.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",a.type,n)}this.accept(a)}},setupFullMustacheParams:function(a,n,g,v){var G=a.params;return this.pushParams(G),this.opcode("pushProgram",n),this.opcode("pushProgram",g),a.hash?this.accept(a.hash):this.opcode("emptyHash",v),G},blockParamIndex:function(a){for(var n=0,g=this.options.blockParams.length;n<g;n++){var v=this.options.blockParams[n],G=v&&r.indexOf(v,a);if(v&&G>=0)return[n,G]}}};function l(c,a,n){if(c==null||typeof c!="string"&&c.type!=="Program")throw new t.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+c);a=a||{},"data"in a||(a.data=!0),a.compat&&(a.useDepths=!0);var g=n.parse(c,a),v=new n.Compiler().compile(g,a);return new n.JavaScriptCompiler().compile(v,a)}function m(c,a,n){if(a===void 0&&(a={}),c==null||typeof c!="string"&&c.type!=="Program")throw new t.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+c);a=r.extend({},a),"data"in a||(a.data=!0),a.compat&&(a.useDepths=!0);var g=void 0;function v(){var M=n.parse(c,a),A=new n.Compiler().compile(M,a),b=new n.JavaScriptCompiler().compile(A,a,void 0,!0);return n.template(b)}function G(M,A){return g||(g=v()),g.call(this,M,A)}return G._setup=function(M){return g||(g=v()),g._setup(M)},G._child=function(M,A,b,k){return g||(g=v()),g._child(M,A,b,k)},G}function h(c,a){if(c===a)return!0;if(r.isArray(c)&&r.isArray(a)&&c.length===a.length){for(var n=0;n<c.length;n++)if(!h(c[n],a[n]))return!1;return!0}}function f(c){if(!c.path.parts){var a=c.path;c.path={type:"PathExpression",data:!1,depth:0,parts:[a.original+""],original:a.original+"",loc:a.loc}}}return nt}var cr={exports:{}},ur={exports:{}},mt={},Ur={},lr={},hr={},gs;function qa(){if(gs)return hr;gs=1;var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return hr.encode=function(e){if(0<=e&&e<p.length)return p[e];throw new TypeError("Must be between 0 and 63: "+e)},hr.decode=function(e){var t=65,r=90,i=97,s=122,o=48,u=57,l=43,m=47,h=26,f=52;return t<=e&&e<=r?e-t:i<=e&&e<=s?e-i+h:o<=e&&e<=u?e-o+f:e==l?62:e==m?63:-1},hr}var fs;function Ws(){if(fs)return lr;fs=1;var p=qa(),e=5,t=1<<e,r=t-1,i=t;function s(u){return u<0?(-u<<1)+1:(u<<1)+0}function o(u){var l=(u&1)===1,m=u>>1;return l?-m:m}return lr.encode=function(l){var m="",h,f=s(l);do h=f&r,f>>>=e,f>0&&(h|=i),m+=p.encode(h);while(f>0);return m},lr.decode=function(l,m,h){var f=l.length,c=0,a=0,n,g;do{if(m>=f)throw new Error("Expected more digits in base 64 VLQ value.");if(g=p.decode(l.charCodeAt(m++)),g===-1)throw new Error("Invalid base64 digit: "+l.charAt(m-1));n=!!(g&i),g&=r,c=c+(g<<a),a+=e}while(n);h.value=o(c),h.rest=m},lr}var Dr={},ys;function Mt(){return ys||(ys=1,(function(p){function e(b,k,_){if(k in b)return b[k];if(arguments.length===3)return _;throw new Error('"'+k+'" is a required argument.')}p.getArg=e;var t=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(b){var k=b.match(t);return k?{scheme:k[1],auth:k[2],host:k[3],port:k[4],path:k[5]}:null}p.urlParse=i;function s(b){var k="";return b.scheme&&(k+=b.scheme+":"),k+="//",b.auth&&(k+=b.auth+"@"),b.host&&(k+=b.host),b.port&&(k+=":"+b.port),b.path&&(k+=b.path),k}p.urlGenerate=s;function o(b){var k=b,_=i(b);if(_){if(!_.path)return b;k=_.path}for(var E=p.isAbsolute(k),P=k.split(/\/+/),F,O=0,x=P.length-1;x>=0;x--)F=P[x],F==="."?P.splice(x,1):F===".."?O++:O>0&&(F===""?(P.splice(x+1,O),O=0):(P.splice(x,2),O--));return k=P.join("/"),k===""&&(k=E?"/":"."),_?(_.path=k,s(_)):k}p.normalize=o;function u(b,k){b===""&&(b="."),k===""&&(k=".");var _=i(k),E=i(b);if(E&&(b=E.path||"/"),_&&!_.scheme)return E&&(_.scheme=E.scheme),s(_);if(_||k.match(r))return k;if(E&&!E.host&&!E.path)return E.host=k,s(E);var P=k.charAt(0)==="/"?k:o(b.replace(/\/+$/,"")+"/"+k);return E?(E.path=P,s(E)):P}p.join=u,p.isAbsolute=function(b){return b.charAt(0)==="/"||t.test(b)};function l(b,k){b===""&&(b="."),b=b.replace(/\/$/,"");for(var _=0;k.indexOf(b+"/")!==0;){var E=b.lastIndexOf("/");if(E<0||(b=b.slice(0,E),b.match(/^([^\/]+:\/)?\/*$/)))return k;++_}return Array(_+1).join("../")+k.substr(b.length+1)}p.relative=l;var m=(function(){var b=Object.create(null);return!("__proto__"in b)})();function h(b){return b}function f(b){return a(b)?"$"+b:b}p.toSetString=m?h:f;function c(b){return a(b)?b.slice(1):b}p.fromSetString=m?h:c;function a(b){if(!b)return!1;var k=b.length;if(k<9||b.charCodeAt(k-1)!==95||b.charCodeAt(k-2)!==95||b.charCodeAt(k-3)!==111||b.charCodeAt(k-4)!==116||b.charCodeAt(k-5)!==111||b.charCodeAt(k-6)!==114||b.charCodeAt(k-7)!==112||b.charCodeAt(k-8)!==95||b.charCodeAt(k-9)!==95)return!1;for(var _=k-10;_>=0;_--)if(b.charCodeAt(_)!==36)return!1;return!0}function n(b,k,_){var E=v(b.source,k.source);return E!==0||(E=b.originalLine-k.originalLine,E!==0)||(E=b.originalColumn-k.originalColumn,E!==0||_)||(E=b.generatedColumn-k.generatedColumn,E!==0)||(E=b.generatedLine-k.generatedLine,E!==0)?E:v(b.name,k.name)}p.compareByOriginalPositions=n;function g(b,k,_){var E=b.generatedLine-k.generatedLine;return E!==0||(E=b.generatedColumn-k.generatedColumn,E!==0||_)||(E=v(b.source,k.source),E!==0)||(E=b.originalLine-k.originalLine,E!==0)||(E=b.originalColumn-k.originalColumn,E!==0)?E:v(b.name,k.name)}p.compareByGeneratedPositionsDeflated=g;function v(b,k){return b===k?0:b===null?1:k===null?-1:b>k?1:-1}function G(b,k){var _=b.generatedLine-k.generatedLine;return _!==0||(_=b.generatedColumn-k.generatedColumn,_!==0)||(_=v(b.source,k.source),_!==0)||(_=b.originalLine-k.originalLine,_!==0)||(_=b.originalColumn-k.originalColumn,_!==0)?_:v(b.name,k.name)}p.compareByGeneratedPositionsInflated=G;function M(b){return JSON.parse(b.replace(/^\)]}'[^\n]*\n/,""))}p.parseSourceMapInput=M;function A(b,k,_){if(k=k||"",b&&(b[b.length-1]!=="/"&&k[0]!=="/"&&(b+="/"),k=b+k),_){var E=i(_);if(!E)throw new Error("sourceMapURL could not be parsed");if(E.path){var P=E.path.lastIndexOf("/");P>=0&&(E.path=E.path.substring(0,P+1))}k=u(s(E),k)}return o(k)}p.computeSourceURL=A})(Dr)),Dr}var Fr={},vs;function Vs(){if(vs)return Fr;vs=1;var p=Mt(),e=Object.prototype.hasOwnProperty,t=typeof Map<"u";function r(){this._array=[],this._set=t?new Map:Object.create(null)}return r.fromArray=function(s,o){for(var u=new r,l=0,m=s.length;l<m;l++)u.add(s[l],o);return u},r.prototype.size=function(){return t?this._set.size:Object.getOwnPropertyNames(this._set).length},r.prototype.add=function(s,o){var u=t?s:p.toSetString(s),l=t?this.has(s):e.call(this._set,u),m=this._array.length;(!l||o)&&this._array.push(s),l||(t?this._set.set(s,m):this._set[u]=m)},r.prototype.has=function(s){if(t)return this._set.has(s);var o=p.toSetString(s);return e.call(this._set,o)},r.prototype.indexOf=function(s){if(t){var o=this._set.get(s);if(o>=0)return o}else{var u=p.toSetString(s);if(e.call(this._set,u))return this._set[u]}throw new Error('"'+s+'" is not in the set.')},r.prototype.at=function(s){if(s>=0&&s<this._array.length)return this._array[s];throw new Error("No element indexed by "+s)},r.prototype.toArray=function(){return this._array.slice()},Fr.ArraySet=r,Fr}var qr={},bs;function Ha(){if(bs)return qr;bs=1;var p=Mt();function e(r,i){var s=r.generatedLine,o=i.generatedLine,u=r.generatedColumn,l=i.generatedColumn;return o>s||o==s&&l>=u||p.compareByGeneratedPositionsInflated(r,i)<=0}function t(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}return t.prototype.unsortedForEach=function(i,s){this._array.forEach(i,s)},t.prototype.add=function(i){e(this._last,i)?(this._last=i,this._array.push(i)):(this._sorted=!1,this._array.push(i))},t.prototype.toArray=function(){return this._sorted||(this._array.sort(p.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},qr.MappingList=t,qr}var Ss;function zs(){if(Ss)return Ur;Ss=1;var p=Ws(),e=Mt(),t=Vs().ArraySet,r=Ha().MappingList;function i(s){s||(s={}),this._file=e.getArg(s,"file",null),this._sourceRoot=e.getArg(s,"sourceRoot",null),this._skipValidation=e.getArg(s,"skipValidation",!1),this._sources=new t,this._names=new t,this._mappings=new r,this._sourcesContents=null}return i.prototype._version=3,i.fromSourceMap=function(o){var u=o.sourceRoot,l=new i({file:o.file,sourceRoot:u});return o.eachMapping(function(m){var h={generated:{line:m.generatedLine,column:m.generatedColumn}};m.source!=null&&(h.source=m.source,u!=null&&(h.source=e.relative(u,h.source)),h.original={line:m.originalLine,column:m.originalColumn},m.name!=null&&(h.name=m.name)),l.addMapping(h)}),o.sources.forEach(function(m){var h=m;u!==null&&(h=e.relative(u,m)),l._sources.has(h)||l._sources.add(h);var f=o.sourceContentFor(m);f!=null&&l.setSourceContent(m,f)}),l},i.prototype.addMapping=function(o){var u=e.getArg(o,"generated"),l=e.getArg(o,"original",null),m=e.getArg(o,"source",null),h=e.getArg(o,"name",null);this._skipValidation||this._validateMapping(u,l,m,h),m!=null&&(m=String(m),this._sources.has(m)||this._sources.add(m)),h!=null&&(h=String(h),this._names.has(h)||this._names.add(h)),this._mappings.add({generatedLine:u.line,generatedColumn:u.column,originalLine:l!=null&&l.line,originalColumn:l!=null&&l.column,source:m,name:h})},i.prototype.setSourceContent=function(o,u){var l=o;this._sourceRoot!=null&&(l=e.relative(this._sourceRoot,l)),u!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[e.toSetString(l)]=u):this._sourcesContents&&(delete this._sourcesContents[e.toSetString(l)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))},i.prototype.applySourceMap=function(o,u,l){var m=u;if(u==null){if(o.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);m=o.file}var h=this._sourceRoot;h!=null&&(m=e.relative(h,m));var f=new t,c=new t;this._mappings.unsortedForEach(function(a){if(a.source===m&&a.originalLine!=null){var n=o.originalPositionFor({line:a.originalLine,column:a.originalColumn});n.source!=null&&(a.source=n.source,l!=null&&(a.source=e.join(l,a.source)),h!=null&&(a.source=e.relative(h,a.source)),a.originalLine=n.line,a.originalColumn=n.column,n.name!=null&&(a.name=n.name))}var g=a.source;g!=null&&!f.has(g)&&f.add(g);var v=a.name;v!=null&&!c.has(v)&&c.add(v)},this),this._sources=f,this._names=c,o.sources.forEach(function(a){var n=o.sourceContentFor(a);n!=null&&(l!=null&&(a=e.join(l,a)),h!=null&&(a=e.relative(h,a)),this.setSourceContent(a,n))},this)},i.prototype._validateMapping=function(o,u,l,m){if(u&&typeof u.line!="number"&&typeof u.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(o&&"line"in o&&"column"in o&&o.line>0&&o.column>=0&&!u&&!l&&!m)){if(o&&"line"in o&&"column"in o&&u&&"line"in u&&"column"in u&&o.line>0&&o.column>=0&&u.line>0&&u.column>=0&&l)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:o,source:l,original:u,name:m}))}},i.prototype._serializeMappings=function(){for(var o=0,u=1,l=0,m=0,h=0,f=0,c="",a,n,g,v,G=this._mappings.toArray(),M=0,A=G.length;M<A;M++){if(n=G[M],a="",n.generatedLine!==u)for(o=0;n.generatedLine!==u;)a+=";",u++;else if(M>0){if(!e.compareByGeneratedPositionsInflated(n,G[M-1]))continue;a+=","}a+=p.encode(n.generatedColumn-o),o=n.generatedColumn,n.source!=null&&(v=this._sources.indexOf(n.source),a+=p.encode(v-f),f=v,a+=p.encode(n.originalLine-1-m),m=n.originalLine-1,a+=p.encode(n.originalColumn-l),l=n.originalColumn,n.name!=null&&(g=this._names.indexOf(n.name),a+=p.encode(g-h),h=g)),c+=a}return c},i.prototype._generateSourcesContent=function(o,u){return o.map(function(l){if(!this._sourcesContents)return null;u!=null&&(l=e.relative(u,l));var m=e.toSetString(l);return Object.prototype.hasOwnProperty.call(this._sourcesContents,m)?this._sourcesContents[m]:null},this)},i.prototype.toJSON=function(){var o={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(o.file=this._file),this._sourceRoot!=null&&(o.sourceRoot=this._sourceRoot),this._sourcesContents&&(o.sourcesContent=this._generateSourcesContent(o.sources,o.sourceRoot)),o},i.prototype.toString=function(){return JSON.stringify(this.toJSON())},Ur.SourceMapGenerator=i,Ur}var Xt={},Hr={},Gs;function Ya(){return Gs||(Gs=1,(function(p){p.GREATEST_LOWER_BOUND=1,p.LEAST_UPPER_BOUND=2;function e(t,r,i,s,o,u){var l=Math.floor((r-t)/2)+t,m=o(i,s[l],!0);return m===0?l:m>0?r-l>1?e(l,r,i,s,o,u):u==p.LEAST_UPPER_BOUND?r<s.length?r:-1:l:l-t>1?e(t,l,i,s,o,u):u==p.LEAST_UPPER_BOUND?l:t<0?-1:t}p.search=function(r,i,s,o){if(i.length===0)return-1;var u=e(-1,i.length,r,i,s,o||p.GREATEST_LOWER_BOUND);if(u<0)return-1;for(;u-1>=0&&s(i[u],i[u-1],!0)===0;)--u;return u}})(Hr)),Hr}var Yr={},Cs;function Wa(){if(Cs)return Yr;Cs=1;function p(r,i,s){var o=r[i];r[i]=r[s],r[s]=o}function e(r,i){return Math.round(r+Math.random()*(i-r))}function t(r,i,s,o){if(s<o){var u=e(s,o),l=s-1;p(r,u,o);for(var m=r[o],h=s;h<o;h++)i(r[h],m)<=0&&(l+=1,p(r,l,h));p(r,l+1,h);var f=l+1;t(r,i,s,f-1),t(r,i,f+1,o)}}return Yr.quickSort=function(r,i){t(r,i,0,r.length-1)},Yr}var Ms;function Va(){if(Ms)return Xt;Ms=1;var p=Mt(),e=Ya(),t=Vs().ArraySet,r=Ws(),i=Wa().quickSort;function s(m,h){var f=m;return typeof m=="string"&&(f=p.parseSourceMapInput(m)),f.sections!=null?new l(f,h):new o(f,h)}s.fromSourceMap=function(m,h){return o.fromSourceMap(m,h)},s.prototype._version=3,s.prototype.__generatedMappings=null,Object.defineProperty(s.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),s.prototype.__originalMappings=null,Object.defineProperty(s.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),s.prototype._charIsMappingSeparator=function(h,f){var c=h.charAt(f);return c===";"||c===","},s.prototype._parseMappings=function(h,f){throw new Error("Subclasses must implement _parseMappings")},s.GENERATED_ORDER=1,s.ORIGINAL_ORDER=2,s.GREATEST_LOWER_BOUND=1,s.LEAST_UPPER_BOUND=2,s.prototype.eachMapping=function(h,f,c){var a=f||null,n=c||s.GENERATED_ORDER,g;switch(n){case s.GENERATED_ORDER:g=this._generatedMappings;break;case s.ORIGINAL_ORDER:g=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var v=this.sourceRoot;g.map(function(G){var M=G.source===null?null:this._sources.at(G.source);return M=p.computeSourceURL(v,M,this._sourceMapURL),{source:M,generatedLine:G.generatedLine,generatedColumn:G.generatedColumn,originalLine:G.originalLine,originalColumn:G.originalColumn,name:G.name===null?null:this._names.at(G.name)}},this).forEach(h,a)},s.prototype.allGeneratedPositionsFor=function(h){var f=p.getArg(h,"line"),c={source:p.getArg(h,"source"),originalLine:f,originalColumn:p.getArg(h,"column",0)};if(c.source=this._findSourceIndex(c.source),c.source<0)return[];var a=[],n=this._findMapping(c,this._originalMappings,"originalLine","originalColumn",p.compareByOriginalPositions,e.LEAST_UPPER_BOUND);if(n>=0){var g=this._originalMappings[n];if(h.column===void 0)for(var v=g.originalLine;g&&g.originalLine===v;)a.push({line:p.getArg(g,"generatedLine",null),column:p.getArg(g,"generatedColumn",null),lastColumn:p.getArg(g,"lastGeneratedColumn",null)}),g=this._originalMappings[++n];else for(var G=g.originalColumn;g&&g.originalLine===f&&g.originalColumn==G;)a.push({line:p.getArg(g,"generatedLine",null),column:p.getArg(g,"generatedColumn",null),lastColumn:p.getArg(g,"lastGeneratedColumn",null)}),g=this._originalMappings[++n]}return a},Xt.SourceMapConsumer=s;function o(m,h){var f=m;typeof m=="string"&&(f=p.parseSourceMapInput(m));var c=p.getArg(f,"version"),a=p.getArg(f,"sources"),n=p.getArg(f,"names",[]),g=p.getArg(f,"sourceRoot",null),v=p.getArg(f,"sourcesContent",null),G=p.getArg(f,"mappings"),M=p.getArg(f,"file",null);if(c!=this._version)throw new Error("Unsupported version: "+c);g&&(g=p.normalize(g)),a=a.map(String).map(p.normalize).map(function(A){return g&&p.isAbsolute(g)&&p.isAbsolute(A)?p.relative(g,A):A}),this._names=t.fromArray(n.map(String),!0),this._sources=t.fromArray(a,!0),this._absoluteSources=this._sources.toArray().map(function(A){return p.computeSourceURL(g,A,h)}),this.sourceRoot=g,this.sourcesContent=v,this._mappings=G,this._sourceMapURL=h,this.file=M}o.prototype=Object.create(s.prototype),o.prototype.consumer=s,o.prototype._findSourceIndex=function(m){var h=m;if(this.sourceRoot!=null&&(h=p.relative(this.sourceRoot,h)),this._sources.has(h))return this._sources.indexOf(h);var f;for(f=0;f<this._absoluteSources.length;++f)if(this._absoluteSources[f]==m)return f;return-1},o.fromSourceMap=function(h,f){var c=Object.create(o.prototype),a=c._names=t.fromArray(h._names.toArray(),!0),n=c._sources=t.fromArray(h._sources.toArray(),!0);c.sourceRoot=h._sourceRoot,c.sourcesContent=h._generateSourcesContent(c._sources.toArray(),c.sourceRoot),c.file=h._file,c._sourceMapURL=f,c._absoluteSources=c._sources.toArray().map(function(_){return p.computeSourceURL(c.sourceRoot,_,f)});for(var g=h._mappings.toArray().slice(),v=c.__generatedMappings=[],G=c.__originalMappings=[],M=0,A=g.length;M<A;M++){var b=g[M],k=new u;k.generatedLine=b.generatedLine,k.generatedColumn=b.generatedColumn,b.source&&(k.source=n.indexOf(b.source),k.originalLine=b.originalLine,k.originalColumn=b.originalColumn,b.name&&(k.name=a.indexOf(b.name)),G.push(k)),v.push(k)}return i(c.__originalMappings,p.compareByOriginalPositions),c},o.prototype._version=3,Object.defineProperty(o.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function u(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}o.prototype._parseMappings=function(h,f){for(var c=1,a=0,n=0,g=0,v=0,G=0,M=h.length,A=0,b={},k={},_=[],E=[],P,F,O,x,B;A<M;)if(h.charAt(A)===";")c++,A++,a=0;else if(h.charAt(A)===",")A++;else{for(P=new u,P.generatedLine=c,x=A;x<M&&!this._charIsMappingSeparator(h,x);x++);if(F=h.slice(A,x),O=b[F],O)A+=F.length;else{for(O=[];A<x;)r.decode(h,A,k),B=k.value,A=k.rest,O.push(B);if(O.length===2)throw new Error("Found a source, but no line and column");if(O.length===3)throw new Error("Found a source and line, but no column");b[F]=O}P.generatedColumn=a+O[0],a=P.generatedColumn,O.length>1&&(P.source=v+O[1],v+=O[1],P.originalLine=n+O[2],n=P.originalLine,P.originalLine+=1,P.originalColumn=g+O[3],g=P.originalColumn,O.length>4&&(P.name=G+O[4],G+=O[4])),E.push(P),typeof P.originalLine=="number"&&_.push(P)}i(E,p.compareByGeneratedPositionsDeflated),this.__generatedMappings=E,i(_,p.compareByOriginalPositions),this.__originalMappings=_},o.prototype._findMapping=function(h,f,c,a,n,g){if(h[c]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+h[c]);if(h[a]<0)throw new TypeError("Column must be greater than or equal to 0, got "+h[a]);return e.search(h,f,n,g)},o.prototype.computeColumnSpans=function(){for(var h=0;h<this._generatedMappings.length;++h){var f=this._generatedMappings[h];if(h+1<this._generatedMappings.length){var c=this._generatedMappings[h+1];if(f.generatedLine===c.generatedLine){f.lastGeneratedColumn=c.generatedColumn-1;continue}}f.lastGeneratedColumn=1/0}},o.prototype.originalPositionFor=function(h){var f={generatedLine:p.getArg(h,"line"),generatedColumn:p.getArg(h,"column")},c=this._findMapping(f,this._generatedMappings,"generatedLine","generatedColumn",p.compareByGeneratedPositionsDeflated,p.getArg(h,"bias",s.GREATEST_LOWER_BOUND));if(c>=0){var a=this._generatedMappings[c];if(a.generatedLine===f.generatedLine){var n=p.getArg(a,"source",null);n!==null&&(n=this._sources.at(n),n=p.computeSourceURL(this.sourceRoot,n,this._sourceMapURL));var g=p.getArg(a,"name",null);return g!==null&&(g=this._names.at(g)),{source:n,line:p.getArg(a,"originalLine",null),column:p.getArg(a,"originalColumn",null),name:g}}}return{source:null,line:null,column:null,name:null}},o.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(h){return h==null}):!1},o.prototype.sourceContentFor=function(h,f){if(!this.sourcesContent)return null;var c=this._findSourceIndex(h);if(c>=0)return this.sourcesContent[c];var a=h;this.sourceRoot!=null&&(a=p.relative(this.sourceRoot,a));var n;if(this.sourceRoot!=null&&(n=p.urlParse(this.sourceRoot))){var g=a.replace(/^file:\/\//,"");if(n.scheme=="file"&&this._sources.has(g))return this.sourcesContent[this._sources.indexOf(g)];if((!n.path||n.path=="/")&&this._sources.has("/"+a))return this.sourcesContent[this._sources.indexOf("/"+a)]}if(f)return null;throw new Error('"'+a+'" is not in the SourceMap.')},o.prototype.generatedPositionFor=function(h){var f=p.getArg(h,"source");if(f=this._findSourceIndex(f),f<0)return{line:null,column:null,lastColumn:null};var c={source:f,originalLine:p.getArg(h,"line"),originalColumn:p.getArg(h,"column")},a=this._findMapping(c,this._originalMappings,"originalLine","originalColumn",p.compareByOriginalPositions,p.getArg(h,"bias",s.GREATEST_LOWER_BOUND));if(a>=0){var n=this._originalMappings[a];if(n.source===c.source)return{line:p.getArg(n,"generatedLine",null),column:p.getArg(n,"generatedColumn",null),lastColumn:p.getArg(n,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},Xt.BasicSourceMapConsumer=o;function l(m,h){var f=m;typeof m=="string"&&(f=p.parseSourceMapInput(m));var c=p.getArg(f,"version"),a=p.getArg(f,"sections");if(c!=this._version)throw new Error("Unsupported version: "+c);this._sources=new t,this._names=new t;var n={line:-1,column:0};this._sections=a.map(function(g){if(g.url)throw new Error("Support for url field in sections not implemented.");var v=p.getArg(g,"offset"),G=p.getArg(v,"line"),M=p.getArg(v,"column");if(G<n.line||G===n.line&&M<n.column)throw new Error("Section offsets must be ordered and non-overlapping.");return n=v,{generatedOffset:{generatedLine:G+1,generatedColumn:M+1},consumer:new s(p.getArg(g,"map"),h)}})}return l.prototype=Object.create(s.prototype),l.prototype.constructor=s,l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){for(var m=[],h=0;h<this._sections.length;h++)for(var f=0;f<this._sections[h].consumer.sources.length;f++)m.push(this._sections[h].consumer.sources[f]);return m}}),l.prototype.originalPositionFor=function(h){var f={generatedLine:p.getArg(h,"line"),generatedColumn:p.getArg(h,"column")},c=e.search(f,this._sections,function(n,g){var v=n.generatedLine-g.generatedOffset.generatedLine;return v||n.generatedColumn-g.generatedOffset.generatedColumn}),a=this._sections[c];return a?a.consumer.originalPositionFor({line:f.generatedLine-(a.generatedOffset.generatedLine-1),column:f.generatedColumn-(a.generatedOffset.generatedLine===f.generatedLine?a.generatedOffset.generatedColumn-1:0),bias:h.bias}):{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(h){return h.consumer.hasContentsOfAllSources()})},l.prototype.sourceContentFor=function(h,f){for(var c=0;c<this._sections.length;c++){var a=this._sections[c],n=a.consumer.sourceContentFor(h,!0);if(n)return n}if(f)return null;throw new Error('"'+h+'" is not in the SourceMap.')},l.prototype.generatedPositionFor=function(h){for(var f=0;f<this._sections.length;f++){var c=this._sections[f];if(c.consumer._findSourceIndex(p.getArg(h,"source"))!==-1){var a=c.consumer.generatedPositionFor(h);if(a){var n={line:a.line+(c.generatedOffset.generatedLine-1),column:a.column+(c.generatedOffset.generatedLine===a.line?c.generatedOffset.generatedColumn-1:0)};return n}}}return{line:null,column:null}},l.prototype._parseMappings=function(h,f){this.__generatedMappings=[],this.__originalMappings=[];for(var c=0;c<this._sections.length;c++)for(var a=this._sections[c],n=a.consumer._generatedMappings,g=0;g<n.length;g++){var v=n[g],G=a.consumer._sources.at(v.source);G=p.computeSourceURL(a.consumer.sourceRoot,G,this._sourceMapURL),this._sources.add(G),G=this._sources.indexOf(G);var M=null;v.name&&(M=a.consumer._names.at(v.name),this._names.add(M),M=this._names.indexOf(M));var A={source:G,generatedLine:v.generatedLine+(a.generatedOffset.generatedLine-1),generatedColumn:v.generatedColumn+(a.generatedOffset.generatedLine===v.generatedLine?a.generatedOffset.generatedColumn-1:0),originalLine:v.originalLine,originalColumn:v.originalColumn,name:M};this.__generatedMappings.push(A),typeof A.originalLine=="number"&&this.__originalMappings.push(A)}i(this.__generatedMappings,p.compareByGeneratedPositionsDeflated),i(this.__originalMappings,p.compareByOriginalPositions)},Xt.IndexedSourceMapConsumer=l,Xt}var Wr={},ks;function za(){if(ks)return Wr;ks=1;var p=zs().SourceMapGenerator,e=Mt(),t=/(\r?\n)/,r=10,i="$$$isSourceNode$$$";function s(o,u,l,m,h){this.children=[],this.sourceContents={},this.line=o??null,this.column=u??null,this.source=l??null,this.name=h??null,this[i]=!0,m!=null&&this.add(m)}return s.fromStringWithSourceMap=function(u,l,m){var h=new s,f=u.split(t),c=0,a=function(){var M=b(),A=b()||"";return M+A;function b(){return c<f.length?f[c++]:void 0}},n=1,g=0,v=null;return l.eachMapping(function(M){if(v!==null)if(n<M.generatedLine)G(v,a()),n++,g=0;else{var A=f[c]||"",b=A.substr(0,M.generatedColumn-g);f[c]=A.substr(M.generatedColumn-g),g=M.generatedColumn,G(v,b),v=M;return}for(;n<M.generatedLine;)h.add(a()),n++;if(g<M.generatedColumn){var A=f[c]||"";h.add(A.substr(0,M.generatedColumn)),f[c]=A.substr(M.generatedColumn),g=M.generatedColumn}v=M},this),c<f.length&&(v&&G(v,a()),h.add(f.splice(c).join(""))),l.sources.forEach(function(M){var A=l.sourceContentFor(M);A!=null&&(m!=null&&(M=e.join(m,M)),h.setSourceContent(M,A))}),h;function G(M,A){if(M===null||M.source===void 0)h.add(A);else{var b=m?e.join(m,M.source):M.source;h.add(new s(M.originalLine,M.originalColumn,b,A,M.name))}}},s.prototype.add=function(u){if(Array.isArray(u))u.forEach(function(l){this.add(l)},this);else if(u[i]||typeof u=="string")u&&this.children.push(u);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+u);return this},s.prototype.prepend=function(u){if(Array.isArray(u))for(var l=u.length-1;l>=0;l--)this.prepend(u[l]);else if(u[i]||typeof u=="string")this.children.unshift(u);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+u);return this},s.prototype.walk=function(u){for(var l,m=0,h=this.children.length;m<h;m++)l=this.children[m],l[i]?l.walk(u):l!==""&&u(l,{source:this.source,line:this.line,column:this.column,name:this.name})},s.prototype.join=function(u){var l,m,h=this.children.length;if(h>0){for(l=[],m=0;m<h-1;m++)l.push(this.children[m]),l.push(u);l.push(this.children[m]),this.children=l}return this},s.prototype.replaceRight=function(u,l){var m=this.children[this.children.length-1];return m[i]?m.replaceRight(u,l):typeof m=="string"?this.children[this.children.length-1]=m.replace(u,l):this.children.push("".replace(u,l)),this},s.prototype.setSourceContent=function(u,l){this.sourceContents[e.toSetString(u)]=l},s.prototype.walkSourceContents=function(u){for(var l=0,m=this.children.length;l<m;l++)this.children[l][i]&&this.children[l].walkSourceContents(u);for(var h=Object.keys(this.sourceContents),l=0,m=h.length;l<m;l++)u(e.fromSetString(h[l]),this.sourceContents[h[l]])},s.prototype.toString=function(){var u="";return this.walk(function(l){u+=l}),u},s.prototype.toStringWithSourceMap=function(u){var l={code:"",line:1,column:0},m=new p(u),h=!1,f=null,c=null,a=null,n=null;return this.walk(function(g,v){l.code+=g,v.source!==null&&v.line!==null&&v.column!==null?((f!==v.source||c!==v.line||a!==v.column||n!==v.name)&&m.addMapping({source:v.source,original:{line:v.line,column:v.column},generated:{line:l.line,column:l.column},name:v.name}),f=v.source,c=v.line,a=v.column,n=v.name,h=!0):h&&(m.addMapping({generated:{line:l.line,column:l.column}}),f=null,h=!1);for(var G=0,M=g.length;G<M;G++)g.charCodeAt(G)===r?(l.line++,l.column=0,G+1===M?(f=null,h=!1):h&&m.addMapping({source:v.source,original:{line:v.line,column:v.column},generated:{line:l.line,column:l.column},name:v.name})):l.column++}),this.walkSourceContents(function(g,v){m.setSourceContent(g,v)}),{code:l.code,map:m}},Wr.SourceNode=s,Wr}var Es;function $a(){return Es||(Es=1,mt.SourceMapGenerator=zs().SourceMapGenerator,mt.SourceMapConsumer=Va().SourceMapConsumer,mt.SourceNode=za().SourceNode),mt}var Ts;function Ka(){return Ts||(Ts=1,(function(p,e){e.__esModule=!0;var t=me(),r=void 0;try{var i=$a();r=i.SourceNode}catch{}r||(r=function(u,l,m,h){this.src="",h&&this.add(h)},r.prototype={add:function(l){t.isArray(l)&&(l=l.join("")),this.src+=l},prepend:function(l){t.isArray(l)&&(l=l.join("")),this.src=l+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}});function s(u,l,m){if(t.isArray(u)){for(var h=[],f=0,c=u.length;f<c;f++)h.push(l.wrap(u[f],m));return h}else if(typeof u=="boolean"||typeof u=="number")return u+"";return u}function o(u){this.srcFile=u,this.source=[]}o.prototype={isEmpty:function(){return!this.source.length},prepend:function(l,m){this.source.unshift(this.wrap(l,m))},push:function(l,m){this.source.push(this.wrap(l,m))},merge:function(){var l=this.empty();return this.each(function(m){l.add(["  ",m,`
`])}),l},each:function(l){for(var m=0,h=this.source.length;m<h;m++)l(this.source[m])},empty:function(){var l=this.currentLocation||{start:{}};return new r(l.start.line,l.start.column,this.srcFile)},wrap:function(l){var m=arguments.length<=1||arguments[1]===void 0?this.currentLocation||{start:{}}:arguments[1];return l instanceof r?l:(l=s(l,this,m),new r(m.start.line,m.start.column,this.srcFile,l))},functionCall:function(l,m,h){return h=this.generateList(h),this.wrap([l,m?"."+m+"(":"(",h,")"])},quotedString:function(l){return'"'+(l+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(l){var m=this,h=[];Object.keys(l).forEach(function(c){var a=s(l[c],m);a!=="undefined"&&h.push([m.quotedString(c),":",a])});var f=this.generateList(h);return f.prepend("{"),f.add("}"),f},generateList:function(l){for(var m=this.empty(),h=0,f=l.length;h<f;h++)h&&m.add(","),m.add(s(l[h],this));return m},generateArray:function(l){var m=this.generateList(l);return m.prepend("["),m.add("]"),m}},e.default=o,p.exports=e.default})(ur,ur.exports)),ur.exports}var Is;function ja(){return Is||(Is=1,(function(p,e){e.__esModule=!0;function t(c){return c&&c.__esModule?c:{default:c}}var r=$r(),i=Te(),s=t(i),o=me(),u=Ka(),l=t(u);function m(c){this.value=c}function h(){}h.prototype={nameLookup:function(a,n){return this.internalNameLookup(a,n)},depthedLookup:function(a){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(a),")"]},compilerInfo:function(){var a=r.COMPILER_REVISION,n=r.REVISION_CHANGES[a];return[a,n]},appendToBuffer:function(a,n,g){return o.isArray(a)||(a=[a]),a=this.source.wrap(a,n),this.environment.isSimple?["return ",a,";"]:g?["buffer += ",a,";"]:(a.appendToBuffer=!0,a)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(a,n){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",a,",",JSON.stringify(n),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(a,n,g,v){this.environment=a,this.options=n,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!v,this.name=this.environment.name,this.isChild=!!g,this.context=g||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(a,n),this.useDepths=this.useDepths||a.useDepths||a.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||a.useBlockParams;var G=a.opcodes,M=void 0,A=void 0,b=void 0,k=void 0;for(b=0,k=G.length;b<k;b++)M=G[b],this.source.currentLocation=M.loc,A=A||M.loc,this[M.opcode].apply(this,M.args);if(this.source.currentLocation=A,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new s.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),`;
`]),this.decorators.push("return fn;"),v?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend(`function(fn, props, container, depth0, data, blockParams, depths) {
`),this.decorators.push(`}
`),this.decorators=this.decorators.merge()));var _=this.createFunctionContext(v);if(this.isChild)return _;var E={compiler:this.compilerInfo(),main:_};this.decorators&&(E.main_d=this.decorators,E.useDecorators=!0);var P=this.context,F=P.programs,O=P.decorators;for(b=0,k=F.length;b<k;b++)F[b]&&(E[b]=F[b],O[b]&&(E[b+"_d"]=O[b],E.useDecorators=!0));return this.environment.usePartial&&(E.usePartial=!0),this.options.data&&(E.useData=!0),this.useDepths&&(E.useDepths=!0),this.useBlockParams&&(E.useBlockParams=!0),this.options.compat&&(E.compat=!0),v?E.compilerOptions=this.options:(E.compiler=JSON.stringify(E.compiler),this.source.currentLocation={start:{line:1,column:0}},E=this.objectLiteral(E),n.srcName?(E=E.toStringWithSourceMap({file:n.destName}),E.map=E.map&&E.map.toString()):E=E.toString()),E},preamble:function(){this.lastContext=0,this.source=new l.default(this.options.srcName),this.decorators=new l.default(this.options.srcName)},createFunctionContext:function(a){var n=this,g="",v=this.stackVars.concat(this.registers.list);v.length>0&&(g+=", "+v.join(", "));var G=0;Object.keys(this.aliases).forEach(function(b){var k=n.aliases[b];k.children&&k.referenceCount>1&&(g+=", alias"+ ++G+"="+b,k.children[0]="alias"+G)}),this.lookupPropertyFunctionIsUsed&&(g+=", "+this.lookupPropertyFunctionVarDeclaration());var M=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&M.push("blockParams"),this.useDepths&&M.push("depths");var A=this.mergeSource(g);return a?(M.push(A),Function.apply(this,M)):this.source.wrap(["function(",M.join(","),`) {
  `,A,"}"])},mergeSource:function(a){var n=this.environment.isSimple,g=!this.forceBuffer,v=void 0,G=void 0,M=void 0,A=void 0;return this.source.each(function(b){b.appendToBuffer?(M?b.prepend("  + "):M=b,A=b):(M&&(G?M.prepend("buffer += "):v=!0,A.add(";"),M=A=void 0),G=!0,n||(g=!1))}),g?M?(M.prepend("return "),A.add(";")):G||this.source.push('return "";'):(a+=", buffer = "+(v?"":this.initializeBuffer()),M?(M.prepend("return buffer + "),A.add(";")):this.source.push("return buffer;")),a&&this.source.prepend("var "+a.substring(2)+(v?"":`;
`)),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return`
      lookupProperty = container.lookupProperty || function(parent, propertyName) {
        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {
          return parent[propertyName];
        }
        return undefined
    }
    `.trim()},blockValue:function(a){var n=this.aliasable("container.hooks.blockHelperMissing"),g=[this.contextName(0)];this.setupHelperArgs(a,0,g);var v=this.popStack();g.splice(1,0,v),this.push(this.source.functionCall(n,"call",g))},ambiguousBlockValue:function(){var a=this.aliasable("container.hooks.blockHelperMissing"),n=[this.contextName(0)];this.setupHelperArgs("",0,n,!0),this.flushInline();var g=this.topStack();n.splice(1,0,g),this.pushSource(["if (!",this.lastHelper,") { ",g," = ",this.source.functionCall(a,"call",n),"}"])},appendContent:function(a){this.pendingContent?a=this.pendingContent+a:this.pendingLocation=this.source.currentLocation,this.pendingContent=a},append:function(){if(this.isInline())this.replaceStack(function(n){return[" != null ? ",n,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var a=this.popStack();this.pushSource(["if (",a," != null) { ",this.appendToBuffer(a,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(a){this.lastContext=a},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(a,n,g,v){var G=0;!v&&this.options.compat&&!this.lastContext?this.push(this.depthedLookup(a[G++])):this.pushContext(),this.resolvePath("context",a,G,n,g)},lookupBlockParam:function(a,n){this.useBlockParams=!0,this.push(["blockParams[",a[0],"][",a[1],"]"]),this.resolvePath("context",n,1)},lookupData:function(a,n,g){a?this.pushStackLiteral("container.data(data, "+a+")"):this.pushStackLiteral("data"),this.resolvePath("data",n,0,!0,g)},resolvePath:function(a,n,g,v,G){var M=this;if(this.options.strict||this.options.assumeObjects){this.push(f(this.options.strict&&G,this,n,g,a));return}for(var A=n.length;g<A;g++)this.replaceStack(function(b){var k=M.nameLookup(b,n[g],a);return v?[" && ",k]:[" != null ? ",k," : ",b]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(a,n){this.pushContext(),this.pushString(n),n!=="SubExpression"&&(typeof a=="string"?this.pushString(a):this.pushStackLiteral(a))},emptyHash:function(a){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(a?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var a=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(a.ids)),this.stringParams&&(this.push(this.objectLiteral(a.contexts)),this.push(this.objectLiteral(a.types))),this.push(this.objectLiteral(a.values))},pushString:function(a){this.pushStackLiteral(this.quotedString(a))},pushLiteral:function(a){this.pushStackLiteral(a)},pushProgram:function(a){a!=null?this.pushStackLiteral(this.programExpression(a)):this.pushStackLiteral(null)},registerDecorator:function(a,n){var g=this.nameLookup("decorators",n,"decorator"),v=this.setupHelperArgs(n,a);this.decorators.push(["fn = ",this.decorators.functionCall(g,"",["fn","props","container",v])," || fn;"])},invokeHelper:function(a,n,g){var v=this.popStack(),G=this.setupHelper(a,n),M=[];g&&M.push(G.name),M.push(v),this.options.strict||M.push(this.aliasable("container.hooks.helperMissing"));var A=["(",this.itemsSeparatedBy(M,"||"),")"],b=this.source.functionCall(A,"call",G.callParams);this.push(b)},itemsSeparatedBy:function(a,n){var g=[];g.push(a[0]);for(var v=1;v<a.length;v++)g.push(n,a[v]);return g},invokeKnownHelper:function(a,n){var g=this.setupHelper(a,n);this.push(this.source.functionCall(g.name,"call",g.callParams))},invokeAmbiguous:function(a,n){this.useRegister("helper");var g=this.popStack();this.emptyHash();var v=this.setupHelper(0,a,n),G=this.lastHelper=this.nameLookup("helpers",a,"helper"),M=["(","(helper = ",G," || ",g,")"];this.options.strict||(M[0]="(helper = ",M.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",M,v.paramsInit?["),(",v.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",v.callParams)," : helper))"])},invokePartial:function(a,n,g){var v=[],G=this.setupParams(n,1,v);a&&(n=this.popStack(),delete G.name),g&&(G.indent=JSON.stringify(g)),G.helpers="helpers",G.partials="partials",G.decorators="container.decorators",a?v.unshift(n):v.unshift(this.nameLookup("partials",n,"partial")),this.options.compat&&(G.depths="depths"),G=this.objectLiteral(G),v.push(G),this.push(this.source.functionCall("container.invokePartial","",v))},assignToHash:function(a){var n=this.popStack(),g=void 0,v=void 0,G=void 0;this.trackIds&&(G=this.popStack()),this.stringParams&&(v=this.popStack(),g=this.popStack());var M=this.hash;g&&(M.contexts[a]=g),v&&(M.types[a]=v),G&&(M.ids[a]=G),M.values[a]=n},pushId:function(a,n,g){a==="BlockParam"?this.pushStackLiteral("blockParams["+n[0]+"].path["+n[1]+"]"+(g?" + "+JSON.stringify("."+g):"")):a==="PathExpression"?this.pushString(n):a==="SubExpression"?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:h,compileChildren:function(a,n){for(var g=a.children,v=void 0,G=void 0,M=0,A=g.length;M<A;M++){v=g[M],G=new this.compiler;var b=this.matchExistingProgram(v);if(b==null){this.context.programs.push("");var k=this.context.programs.length;v.index=k,v.name="program"+k,this.context.programs[k]=G.compile(v,n,this.context,!this.precompile),this.context.decorators[k]=G.decorators,this.context.environments[k]=v,this.useDepths=this.useDepths||G.useDepths,this.useBlockParams=this.useBlockParams||G.useBlockParams,v.useDepths=this.useDepths,v.useBlockParams=this.useBlockParams}else v.index=b.index,v.name="program"+b.index,this.useDepths=this.useDepths||b.useDepths,this.useBlockParams=this.useBlockParams||b.useBlockParams}},matchExistingProgram:function(a){for(var n=0,g=this.context.environments.length;n<g;n++){var v=this.context.environments[n];if(v&&v.equals(a))return v}},programExpression:function(a){var n=this.environment.children[a],g=[n.index,"data",n.blockParams];return(this.useBlockParams||this.useDepths)&&g.push("blockParams"),this.useDepths&&g.push("depths"),"container.program("+g.join(", ")+")"},useRegister:function(a){this.registers[a]||(this.registers[a]=!0,this.registers.list.push(a))},push:function(a){return a instanceof m||(a=this.source.wrap(a)),this.inlineStack.push(a),a},pushStackLiteral:function(a){this.push(new m(a))},pushSource:function(a){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),a&&this.source.push(a)},replaceStack:function(a){var n=["("],g=void 0,v=void 0,G=void 0;if(!this.isInline())throw new s.default("replaceStack on non-inline");var M=this.popStack(!0);if(M instanceof m)g=[M.value],n=["(",g],G=!0;else{v=!0;var A=this.incrStack();n=["((",this.push(A)," = ",M,")"],g=this.topStack()}var b=a.call(this,g);G||this.popStack(),v&&this.stackSlot--,this.push(n.concat(b,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var a=this.inlineStack;this.inlineStack=[];for(var n=0,g=a.length;n<g;n++){var v=a[n];if(v instanceof m)this.compileStack.push(v);else{var G=this.incrStack();this.pushSource([G," = ",v,";"]),this.compileStack.push(G)}}},isInline:function(){return this.inlineStack.length},popStack:function(a){var n=this.isInline(),g=(n?this.inlineStack:this.compileStack).pop();if(!a&&g instanceof m)return g.value;if(!n){if(!this.stackSlot)throw new s.default("Invalid stack pop");this.stackSlot--}return g},topStack:function(){var a=this.isInline()?this.inlineStack:this.compileStack,n=a[a.length-1];return n instanceof m?n.value:n},contextName:function(a){return this.useDepths&&a?"depths["+a+"]":"depth"+a},quotedString:function(a){return this.source.quotedString(a)},objectLiteral:function(a){return this.source.objectLiteral(a)},aliasable:function(a){var n=this.aliases[a];return n?(n.referenceCount++,n):(n=this.aliases[a]=this.source.wrap(a),n.aliasable=!0,n.referenceCount=1,n)},setupHelper:function(a,n,g){var v=[],G=this.setupHelperArgs(n,a,v,g),M=this.nameLookup("helpers",n,"helper"),A=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})");return{params:v,paramsInit:G,name:M,callParams:[A].concat(v)}},setupParams:function(a,n,g){var v={},G=[],M=[],A=[],b=!g,k=void 0;b&&(g=[]),v.name=this.quotedString(a),v.hash=this.popStack(),this.trackIds&&(v.hashIds=this.popStack()),this.stringParams&&(v.hashTypes=this.popStack(),v.hashContexts=this.popStack());var _=this.popStack(),E=this.popStack();(E||_)&&(v.fn=E||"container.noop",v.inverse=_||"container.noop");for(var P=n;P--;)k=this.popStack(),g[P]=k,this.trackIds&&(A[P]=this.popStack()),this.stringParams&&(M[P]=this.popStack(),G[P]=this.popStack());return b&&(v.args=this.source.generateArray(g)),this.trackIds&&(v.ids=this.source.generateArray(A)),this.stringParams&&(v.types=this.source.generateArray(M),v.contexts=this.source.generateArray(G)),this.options.data&&(v.data="data"),this.useBlockParams&&(v.blockParams="blockParams"),v},setupHelperArgs:function(a,n,g,v){var G=this.setupParams(a,n,g);return G.loc=JSON.stringify(this.source.currentLocation),G=this.objectLiteral(G),v?(this.useRegister("options"),g.push("options"),["options=",G]):g?(g.push(G),""):G}},(function(){for(var c="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),a=h.RESERVED_WORDS={},n=0,g=c.length;n<g;n++)a[c[n]]=!0})(),h.isValidJavaScriptVariableName=function(c){return!h.RESERVED_WORDS[c]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(c)};function f(c,a,n,g,v){var G=a.popStack(),M=n.length;for(c&&M--;g<M;g++)G=a.nameLookup(G,n[g],v);return c?[a.aliasable("container.strict"),"(",G,", ",a.quotedString(n[g]),", ",JSON.stringify(a.source.currentLocation)," )"]:G}e.default=h,p.exports=e.default})(cr,cr.exports)),cr.exports}var ws;function Qa(){return ws||(ws=1,(function(p,e){e.__esModule=!0;function t(M){return M&&M.__esModule?M:{default:M}}var r=Ba(),i=t(r),s=Hs(),o=t(s),u=Da(),l=Fa(),m=ja(),h=t(m),f=Ys(),c=t(f),a=qs(),n=t(a),g=i.default.create;function v(){var M=g();return M.compile=function(A,b){return l.compile(A,b,M)},M.precompile=function(A,b){return l.precompile(A,b,M)},M.AST=o.default,M.Compiler=l.Compiler,M.JavaScriptCompiler=h.default,M.Parser=u.parser,M.parse=u.parse,M.parseWithoutProcessing=u.parseWithoutProcessing,M}var G=v();G.create=v,n.default(G),G.Visitor=c.default,G.default=G,e.default=G,p.exports=e.default})(Ft,Ft.exports)),Ft.exports}var Ja=Qa();const se=aa(Ja),Za=`<div class="headerXX"> \r
    You have <span class="money">$<b id="moneyValue">{{money}}</b></span>  to spend. Isn't that nice. Average total income <span class="money">$<b id="incomeValue">{{income}}</b></span>.<br /> {{#if researchBought}} You have <span\r
        class="research"><b id="researchPoints"></b></span> research points. Avg production <span class="research"><b\r
            id="researchIncome"></b></span> {{/if}}</div>\r
<div class="helpXX">\r
    <div style="float:right"><span id="ticks"></span> ticks/sec</div> Buy more land to create even bigger empire.  \r
    Go ahead, buy some!\r
</div>\r
<div id="factorySelection" class="factories"> {{#each factories}} <div class="factoryButton {{design}}"\r
        data-id="{{id}}">\r
        <div class="name"> {{name}} </div> <span class="paused">{{#if isPaused}}&lt;&lt; Paused\r
            &gt;&gt;{{else}}&nbsp;{{/if}}</span> {{#if isBought}} <div class="productionTitle">Income</div>\r
        <div class="textLine money" data-id="{{id}}" data-key="income">-</div>\r
        <div class="productionTitle">Research</div>\r
        <div class="textLine research" data-id="{{id}}" data-key="researchProduction">-</div>\r
        <div class="button selectButton" data-id="{{id}}">SELECT</div> {{else}} <div class="productionTitle price">Price\r
        </div>\r
        <div class="textLine money">\${{price}}</div>\r
        <div class="button buyButton" data-id="{{id}}">BUY</div> {{/if}}\r
    </div> {{/each}} \r
</div>`,ec=`<div class="alertBg" id="{{idBg}}"></div>\r
<div class="alert" id="{{id}}">\r
  <span class="title">{{title}}</span>\r
  <br />\r
  <span class="message">{{{message}}}</span>\r
  <br />\r
  <span class="button">{{buttonTitle}}</span>\r
</div>`;let tc=0;class vr{constructor(e,t){this.title=e,this.message=t,this.buttonTitle="OK",this.id=`alert${tc++}`,this.idBg=`${this.id}Bg`,this.container=document.body,this.element=null,this.bg=null,this.callback=null}setButtonTitle(e){return this.buttonTitle=e,this}setCallback(e){return this.callback=e,this}display(){this.container.insertAdjacentHTML("beforeend",se.compile(ec)({id:this.id,idBg:this.idBg,title:this.title,message:this.message,buttonTitle:this.buttonTitle})),this.element=document.getElementById(this.id),this.bg=document.getElementById(this.idBg);const e=Math.round((window.innerHeight-this.element.offsetHeight)/2),t=Math.round((window.innerWidth-this.element.offsetWidth)/2);this.element.style.top=`${e}px`,this.element.style.left=`${t}px`;const r=this.element.querySelector(".button");return r&&r.addEventListener("click",()=>{this.hide(),this.callback&&this.callback()}),this.bg.style.opacity=0,this.bg.style.transition="opacity 0.2s ease",this.bg.style.display="block",requestAnimationFrame(()=>this.bg.style.opacity=1),this.element.style.opacity=0,this.element.style.transition="opacity 0.2s ease",this.element.style.display="block",requestAnimationFrame(()=>this.element.style.opacity=1),this}hide(){this.element&&(this.element.style.opacity=0,this.element.addEventListener("transitionend",()=>this.element?.remove(),{once:!0})),this.bg&&(this.bg.style.opacity=0,this.bg.addEventListener("transitionend",()=>this.bg?.remove(),{once:!0}))}}class _s{constructor(e,t){this.game=e,this.factoryMeta=this.game.getMeta().factoriesById[t]}canBuy(){return this.game.getMoney()>=this.factoryMeta.price}buy(){this.game.addMoney(-this.factoryMeta.price);const e=this.game.getFactory(this.factoryMeta.id);e.reset(),e.setIsBought(!0)}}const Pe={KEY_PRESS:"KEY_PRESS",FOCUS:"FOCUS",BLUR:"BLUR",SHOW_MAIN_GAME:"SHOW_MAIN_GAME",SHOW_MISSIONS:"SHOW_MISSIONS",SHOW_MISSION:"SHOW_MISSION",SHOW_SETTINGS:"SHOW_SETTINGS",SHOW_TIME_TRAVEL:"SHOW_TIME_TRAVEL",SHOW_PURCHASES:"SHOW_PURCHASES",SHOW_HELP:"SHOW_HELP",OPEN_SCREENSHOT_VIEW:"SHOW_SCREENSHOT_VIEW"},He=new Ct(Pe,"GlobalMainUiBus");class rc{constructor(e){this.globalUiEm=He,this.gameUiEm=Ee.gameUiBus,this.game=e,this.statistics=e.getStatistics(),this.container=null}display(e){this.container=e;const t=[],r=this.game.getMeta().factories;for(const i of r){const s=this.game.getFactory(i.id);t.push({id:i.id,name:i.name,price:K.format(i.price),isBought:s.getIsBought(),isPaused:s.getIsPaused()})}this.container.innerHTML=se.compile(Za)({factories:t,researchBought:!!this.game.getResearchManager().getResearch("researchCenter")}),this.container.querySelectorAll(".selectButton").forEach(i=>{i.addEventListener("click",s=>{const o=s.target.dataset.id;this.gameUiEm.invokeEvent(Z.SHOW_FACTORY,o)})}),this.container.querySelectorAll(".buyButton").forEach(i=>{i.addEventListener("click",s=>{const o=s.target.dataset.id,u=new _s(this.game,o);u.canBuy()?(u.buy(),this.gameUiEm.invokeEvent(Z.SHOW_FACTORY,o)):new vr("","You don't have enough money to buy this factory!").display()})}),this.game.getEventManager().addListener("factoriesUi",Z.GAME_TICK,()=>this.update()),this.update()}updateText(e,t){const r=this.container.querySelector(e);r&&(r.textContent=t)}update(){this.updateText("#moneyValue",this.game.getMoney()),this.updateText("#researchPoints",this.game.getResearchPoints());const e=this.statistics.getAvgProfit();this.updateText("#incomeValue",e?K.formatNumber(e):" ? ");const t=this.statistics.getAvgResearchPointsProduction();this.updateText("#researchIncome",t?K.formatNumber(t):" ? "),this.container.querySelectorAll(".factoryButton").forEach(r=>{const i=r.getAttribute("data-id"),s=this.statistics.getFactoryAvgProfit(i);this.updateText(".money[data-key='income']",s?K.formatNumberPlus(s):" ? ");const o=this.statistics.getFactoryAvgResearchPointsProduction(i);this.updateText(".research[data-key='researchProduction']",o?K.formatNumberPlus(o):" ? ");const u=new _s(this.game,i).canBuy(),l=r.querySelector(".buyButton");l&&(u?(l.classList.remove("cantBuy"),l.textContent="BUY"):(l.classList.add("cantBuy"),l.textContent="TOO EXPENSIVE"))}),this.updateText("#ticks",K.formatNumber(this.game.getTicker().getActualTicksPerSec()))}destroy(){this.globalUiEm.removeListenerForType("factoriesUi"),this.gameUiEm.removeListenerForType("factoriesUi"),this.game.getEventManager().removeListenerForType("factoriesUi"),this.container&&(this.container.textContent="",this.container=null)}}const ic=`<table class="factoryBox" width="100%" cellspacing="0" cellpadding="0" border="0">\r
\r
    <tr>\r
        <td class="overviewArea" valign="top">\r
            <div class="overviewContainer">\r
\r
            </div>\r
        </td>\r
        <td class="topArea" valign="top">\r
            <div class="topContainer">\r
                <div class="menuContainer"></div>\r
                <div class="infoContainer"></div>\r
                <div class="controlsContainer"></div>\r
            </div>\r
        </td>\r
    </tr>\r
    <tr>\r
        <td class="componentsArea" valign="top">\r
            <div class="componentsContainer"></div>\r
            <div class="mapToolsContainer"></div>\r
            <div class="incentivizedAd"></div>\r
        </td>\r
        <td class="mapArea" valign="top">\r
            <div class="mapContainer"></div>\r
        </td>\r
    </tr>\r
</table>\r
`,sc=`<div class="menuBox">\r
    <a href="javascript:void(0);" id="factoriesButton">Factories</a> {{#if hasStatistics}}\r
    <a href="javascript:void(0);" id="statisticsButton">Statistics</a> {{/if}} {{#if hasResearch}}\r
    <a href="javascript:void(0);" id="researchButton">Research</a> {{/if}} {{#if hasUpgrades}}\r
    <a href="javascript:void(0);" id="upgradesButton">Upgrades</a> {{/if}} {{#if hasAchievements}}\r
    <a href="javascript:void(0);" id="achievementsButton">Achievements</a> {{/if}}\r
  <a href="javascript:void(0);" id="extraButton">Extra</a>\r
  <a href="javascript:void(0);" id="timeTravelButton">Time travel</a>\r
  <a href="javascript:void(0);" id="settingsButton">Settings</a>\r
  <a href="javascript:void(0);" id="helpButton">Help</a>\r
</div>`;class nc{constructor(e){this.globalUiEm=He,this.game=e.getGame(),this.gameUiEm=this.game.getEventManager(),this.factory=e}display(e){this.container=e,this.container.insertAdjacentHTML("beforeend",se.compile(sc)({hasResearch:this.game.getMeta().research.length>0,hasUpgrades:this.game.getMeta().upgrades.length>0,hasAchievements:this.game.getMeta().achievements.length>0,hasStatistics:!0})),this.container.querySelector("#factoriesButton").addEventListener("click",()=>{this.gameUiEm.invokeEvent(Z.SHOW_FACTORIES)}),this.container.querySelector("#researchButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(Z.SHOW_RESEARCH,this.factory.getMeta().id)),this.container.querySelector("#upgradesButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(Z.SHOW_UPGRADES,this.factory.getMeta().id)),this.container.querySelector("#achievementsButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(Z.SHOW_ACHIEVEMENTS,this.factory.getMeta().id)),this.container.querySelector("#helpButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(Z.SHOW_HELP)),this.container.querySelector("#statisticsButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(Z.SHOW_STATISTICS)),this.container.querySelector("#extraButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(Z.SHOW_PURCHASES)),this.container.querySelector("#settingsButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(Z.SHOW_SETTINGS)),this.container.querySelector("#timeTravelButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(Z.SHOW_TIME_TRAVEL)),this.gameUiEm.addListener("factoryMenuUi",J.GAME_TICK,()=>{this.updateButtons()}),this.updateButtons()}updateButtons(){const e=this.factory.getGame().getAchievementsManager();this.toggleVisibility("#researchButton",e.getAchievement("makingProfit")),this.toggleVisibility("#upgradesButton",e.getAchievement("gettingSmarter")),this.toggleVisibility("#statisticsButton",e.getAchievement("collectingCash2"));const t=e.getAchievement("collectingCash");this.toggleVisibility("#extraButton",t),this.toggleVisibility("#timeTravelButton",t),[{selector:"#researchButton",achievement:"makingProfit"},{selector:"#upgradesButton",achievement:"gettingSmarter"},{selector:"#statisticsButton",achievement:"collectingCash2"},{selector:"#extraButton",achievement:"collectingCash"},{selector:"#timeTravelButton",achievement:"collectingCash"}].forEach(({selector:i,achievement:s})=>{const o=e.getAchievement(s);this.toggleVisibility(i,o)})}toggleVisibility(e,t){const r=this.container.querySelector(e);r&&r.classList.toggle("hidden",!t)}destroy(){this.gameUiEm.removeListenerForType("factoryMenuUi"),this.globalUiEm.removeListenerForType("factoryMenuUi"),this.container.innerHTML="",this.container=null}}class oc{constructor(e,t,r){this.imageMap=e,this.factory=t,this.tileSize=r.tileSize,this.tilesX=t.getMeta().tilesX,this.tilesY=t.getMeta().tilesY,this.game=t.getGame(),this.shouldDrawBuildableAreas=!1}display(e){this.container=e,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.width=this.tilesX*this.tileSize,this.canvas.height=this.tilesY*this.tileSize,e.append(this.canvas),this.sprite=this.imageMap.getImage("terrains"),this.redraw();const t=this.factory.getEventManager();t.addListener("LayerBackground",W.TILE_TYPE_CHANGED,()=>this.redraw()),t.addListener("LayerBackground",W.MAP_TOOL_SELECTED,r=>{this.shouldDrawBuildableAreas=!!r,this.redraw()})}getCanvas(){return this.canvas}redraw(){const e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height);const t={undefined:{y:0,tiles:6},grass:{y:0,tiles:6},floor:{y:1,tiles:6},wall:{y:1,tiles:6},road:{y:0,tiles:6}};this.drawTerrain(e,t);for(const r of this.factory.getTiles())switch(r.getTerrain()){case"wall":this.drawTerrainBorders(e,r,7,1,{grass:!0,road:!0}),this.drawTerrainBorders(e,r,10,6,{floor:!0,grass:!0,road:!0});break;case"floor":this.drawTerrainBorders(e,r,7,1,{grass:!0,road:!0});break;case"road":this.drawRoad(e,r,2,{road:!0});break}this.shouldDrawBuildableAreas&&this.drawBuildableAreas()}drawBuildableAreas(){const e=this.canvas.getContext("2d"),t={" ":"greenSelection","-":"yellowSelection",X:"redSelection"};for(const r of this.factory.getTiles()){const i=this.imageMap.getImage(t[r.getBuildableType()]),s=r.getX()*this.tileSize,o=r.getY()*this.tileSize;e.drawImage(i,s,o,this.tileSize,this.tileSize)}}drawTerrain(e,t){for(const r of this.factory.getTiles()){const i=r.getX()*this.tileSize,s=r.getY()*this.tileSize,o=t[r.getTerrain()],u=r.getX()*73893^r.getY()*19349663,m=Math.abs(u)%o.tiles*(this.tileSize+1),h=o.y*(this.tileSize+1);e.drawImage(this.sprite,m,h,this.tileSize,this.tileSize,i,s,this.tileSize,this.tileSize)}}drawTerrainBorders(e,t,r,i,s){const o=this.tileSize,u=o+1,l=t.getX()*this.tileSize,m=t.getY()*this.tileSize,h=r*u,f=(r+1)*u,c=(r+2)*u,a=t.getX()*73893^t.getY()*19349663,n=Math.abs(Math.floor(a%i)*u),g=B=>{const q=t.getTileInDirection(B);return!q||s[q.getTerrain()]},v=g("top"),G=g("right"),M=g("bottom"),A=g("left"),b=g("top_right"),k=g("top_left"),_=g("bottom_right"),E=g("bottom_left");v&&G&&e.drawImage(this.sprite,3*u+10,c,11,11,l+10,m,11,11),v&&A&&e.drawImage(this.sprite,3*u,c,11,11,l,m,11,11),M&&G&&e.drawImage(this.sprite,3*u+10,c+10,11,11,l+10,m+10,11,11),M&&A&&e.drawImage(this.sprite,3*u,c+10,11,11,l,m+10,11,11),b&&!v&&!G&&e.drawImage(this.sprite,0*u+10,c,11,11,l+10,m,11,11),k&&!v&&!A&&e.drawImage(this.sprite,0*u,c,11,11,l,m,11,11),_&&!M&&!G&&e.drawImage(this.sprite,0*u+10,c+10,11,11,l+10,m+10,11,11),E&&!M&&!A&&e.drawImage(this.sprite,0*u,c+10,11,11,l,m+10,11,11);const P=A?10:0,F=G?10:0,O=v?10:0,x=M?10:0;v&&e.drawImage(this.sprite,n+P,h,o-P-F,11,l+P,m,o-P-F,11),M&&e.drawImage(this.sprite,n+P,h+10,o-P-F,11,l+P,m+10,o-P-F,11),G&&e.drawImage(this.sprite,n+10,f+O,11,o-O-x,l+10,m+O,11,o-O-x),A&&e.drawImage(this.sprite,n,f+O,11,o-O-x,l,m+O,11,o-O-x)}drawRoad(e,t,r,i){const s=h=>{const f=t.getTileInDirection(h);return!f||i[f.getTerrain()]},o=`${s("top")?"1":"0"}${s("right")?"1":"0"}${s("bottom")?"1":"0"}${s("left")?"1":"0"}`,u={"0000":[0,0],1e3:[1,0],"0100":[2,0],"0010":[3,0],"0001":[4,0],1010:[0,1],"0101":[0,2],1100:[0,3],"0110":[1,3],"0011":[2,3],1001:[3,3],1111:[4,4],1110:[0,4],"0111":[1,4],1011:[2,4],1101:[3,4]},[l,m]=u[o];e.drawImage(this.sprite,l*(this.tileSize+1),(r+m)*(this.tileSize+1),this.tileSize,this.tileSize,t.getX()*this.tileSize,t.getY()*this.tileSize,this.tileSize,this.tileSize)}destroy(){this.factory.getEventManager().removeListenerForType("LayerBackground"),this.container&&(this.container.innerHTML="",this.container=null)}}class ac{constructor(e,{tileSize:t}){this.imageMap=e,this.tileSize=t}drawComponentLayer(e,t){if(!t.isMainComponentContainer())return;const r=t.getComponent().getMeta(),i=this.imageMap.getImage("components"),s=r.spriteX*(this.tileSize+1),o=r.spriteY*(this.tileSize+1),u=t.getX()*this.tileSize,l=t.getY()*this.tileSize,m=this.tileSize*r.width,h=this.tileSize*r.height;e.drawImage(i,s,o,m,h,u,l,m,h)}}class cc{constructor(e,t){this.imageMap=e,this.tileSize=t.tileSize,this.drawMap=this._getDrawMap()}drawComponentLayer(e,t){if(t.isMainComponentContainer()){const r=t.getComponent().getMeta(),i=this._getDrawParameters(t);let s=this.imageMap.getImage(r.id);s||(s=this.imageMap.getImage("transportLine"));const o=i.n*this.tileSize,u=0,l=this.tileSize*r.width,m=this.tileSize*r.height,h=t.getX()*this.tileSize,f=t.getY()*this.tileSize,c=this.tileSize*r.width,a=this.tileSize*r.height,n=i.rotation,g=i.flip;this._drawImage(e,s,o,u,l,m,h,f,c,a,n,g),e.font="9px Arial",e.textAlign="center"}}_getDrawParameters(e){const t=e.getInputOutputManager().getInputsByDirection(),r=e.getInputOutputManager().getOutputsByDirection(),i=(t.top?"1":"0")+(t.right?"1":"0")+(t.bottom?"1":"0")+(t.left?"1":"0"),s=(r.top?"1":"0")+(r.right?"1":"0")+(r.bottom?"1":"0")+(r.left?"1":"0");return this.drawMap[i]&&this.drawMap[i][s]?this.drawMap[i][s]:this.drawMap.error}_drawImage(e,t,r,i,s,o,u,l,m,h,f,c){e.save();let a=f*Math.PI/180;c||(a=2*Math.PI-a),e.translate(u+m/2,l+h/2),e.rotate(a),c&&e.scale(-1,1),e.drawImage(t,r,i+1,s,o,-m/2,-h/2,m,h),e.restore()}_getDrawMap(){return{error:{n:17,rotation:0,flip:!1},"0000":{"0000":{n:0,rotation:0,flip:!1},1e3:{n:1,rotation:0,flip:!1},"0100":{n:1,rotation:-90,flip:!1},"0010":{n:1,rotation:180,flip:!1},"0001":{n:1,rotation:90,flip:!1}},1e3:{"0000":{n:2,rotation:0,flip:!1},"0100":{n:4,rotation:0,flip:!1},"0010":{n:3,rotation:0,flip:!1},"0001":{n:4,rotation:0,flip:!0},"0110":{n:5,rotation:0,flip:!0},"0101":{n:6,rotation:0,flip:!1},"0011":{n:5,rotation:0,flip:!1},"0111":{n:7,rotation:0,flip:!1}},"0100":{"0000":{n:2,rotation:270,flip:!1},1e3:{n:4,rotation:90,flip:!0},"0010":{n:4,rotation:270,flip:!1},"0001":{n:3,rotation:270,flip:!1},1010:{n:6,rotation:270,flip:!1},1001:{n:5,rotation:270,flip:!1},"0011":{n:5,rotation:90,flip:!0},1011:{n:7,rotation:270,flip:!1}},"0010":{"0000":{n:2,rotation:180,flip:!1},1e3:{n:3,rotation:180,flip:!1},"0100":{n:4,rotation:180,flip:!0},"0001":{n:4,rotation:180,flip:!1},1100:{n:5,rotation:180,flip:!1},1001:{n:5,rotation:180,flip:!0},"0101":{n:6,rotation:180,flip:!1},1101:{n:7,rotation:180,flip:!1}},"0001":{"0000":{n:2,rotation:90,flip:!1},1e3:{n:4,rotation:90,flip:!1},"0100":{n:3,rotation:90,flip:!1},"0010":{n:4,rotation:270,flip:!0},1100:{n:5,rotation:270,flip:!0},1010:{n:6,rotation:90,flip:!1},"0110":{n:5,rotation:90,flip:!1},1110:{n:7,rotation:90,flip:!1}},1100:{"0000":{n:8,rotation:0,flip:!1},"0010":{n:10,rotation:0,flip:!0},"0001":{n:10,rotation:270,flip:!1},"0011":{n:13,rotation:270,flip:!1}},1010:{"0000":{n:9,rotation:0,flip:!1},"0100":{n:11,rotation:90,flip:!1},"0001":{n:11,rotation:270,flip:!1},"0101":{n:12,rotation:90,flip:!0}},1001:{"0000":{n:8,rotation:90,flip:!1},"0100":{n:10,rotation:270,flip:!0},"0010":{n:10,rotation:0,flip:!1},"0110":{n:13,rotation:0,flip:!1}},"0110":{"0000":{n:8,rotation:270,flip:!1},1e3:{n:10,rotation:180,flip:!1},"0001":{n:10,rotation:90,flip:!0},1001:{n:13,rotation:180,flip:!1}},"0101":{"0000":{n:9,rotation:90,flip:!1},1e3:{n:11,rotation:180,flip:!1},"0010":{n:11,rotation:0,flip:!1},1010:{n:12,rotation:0,flip:!1}},"0011":{"0000":{n:8,rotation:180,flip:!1},1e3:{n:10,rotation:180,flip:!0},"0100":{n:10,rotation:90,flip:!1},1100:{n:13,rotation:90,flip:!1}},1110:{"0000":{n:15,rotation:270,flip:!1},"0001":{n:14,rotation:270,flip:!1}},1101:{"0000":{n:15,rotation:0,flip:!1},"0010":{n:14,rotation:0,flip:!1}},1011:{"0000":{n:15,rotation:90,flip:!1},"0100":{n:14,rotation:90,flip:!1}},"0111":{"0000":{n:15,rotation:180,flip:!1},1e3:{n:14,rotation:180,flip:!1}},1111:{"0000":{n:16,rotation:0,flip:!1}}}}}class uc{constructor(e,t,r){this.imageMap=e,this.factory=t,this.game=t.getGame(),this.tileSize=r.tileSize,this.tilesX=t.getMeta().tilesX,this.tilesY=t.getMeta().tilesY,this.canvas=null,this.strategies={default:new ac(this.imageMap,{tileSize:this.tileSize}),track:new cc(this.imageMap,{tileSize:this.tileSize})},this.tilesWithComponentCache=[]}getCanvas(){return this.canvas}display(e){this.container=e,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.width=this.tilesX*this.tileSize,this.canvas.height=this.tilesY*this.tileSize,e.append(this.canvas),this.factory.getEventManager().addListener("LayerComponent",W.FACTORY_COMPONENTS_CHANGED,()=>{this.buildCache(),this.redraw()}),this.factory.getEventManager().addListener("LayerComponent",W.FACTORY_TICK,()=>{this.game.getTicker().getIsFocused()}),this.buildCache(),this.redraw()}buildCache(){this.tilesWithComponentCache=[];const e=this.factory.getTiles();for(const t of e)t.getComponent()&&this.tilesWithComponentCache.push(t);this.tilesWithComponentCache.filter(t=>t.isMainComponentContainer()).length}redraw(){const e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height),this.imageMap.getImage("components")||console.warn("ComponentLayer: components image not loaded");for(const r of this.tilesWithComponentCache){if(!r.isMainComponentContainer())continue;const i=this.factory.getAreasManager?.();if(i&&!i.canBuildAt(r.getX(),r.getY(),r.getComponent().getMeta().width,r.getComponent().getMeta().height))continue;const s=r.getComponent().getMeta().drawStrategy||"default";this.strategies[s].drawComponentLayer(e,r)}}destroy(){this.factory.getEventManager().removeListenerForType("LayerComponent"),this.container.innerHTML="",this.container=null,this.canvas=null}}class lc{constructor(e,t,r){this.imageMap=e,this.factory=t,this.game=t.getGame(),this.tileSize=r.tileSize,this.packageSize=15;const i=this.packageSize/3;this.tilesX=t.getMeta().tilesX,this.tilesY=t.getMeta().tilesY,this.resourcesMeta=this.factory.getGame().getMeta().resourcesById,this.firstPackageLocation={top:{top:-this.packageSize+i,bottom:-this.tileSize/2-i},bottom:{top:this.tileSize/2-this.packageSize+i,bottom:-i},right:{right:-i,left:this.tileSize/2-this.packageSize+i},left:{right:-this.tileSize/2-i,left:-this.packageSize+i}},this.movementDirectionCoefficient={top:{top:-5,bottom:5},bottom:{top:-5,bottom:5},right:{right:5,left:-5},left:{right:5,left:-5}},this.canvas=null,this.queuesCache=[]}getCanvas(){return this.canvas}display(e){this.container=e,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.width=this.tilesX*this.tileSize,this.canvas.height=this.tilesY*this.tileSize,e.append(this.canvas),this.factory.getEventManager().addListener("LayerPackage",W.FACTORY_TICK,()=>{this.game.getTicker().getIsFocused()&&this.redraw()}),this.factory.getEventManager().addListener("LayerPackage",W.FACTORY_COMPONENTS_CHANGED,()=>{this.buildCache(),this.redraw()}),this.buildCache(),this.redraw()}buildCache(){this.queuesCache=[];const e=this.factory.getTiles();for(const t of e){const r=t.getComponent();if(r&&r.getMeta().strategy.type==="transport"){const i=r.getStrategy(),s=i.getInputQueues(),o=i.getOutputQueues();this._addQueueToCache(t,s.top,"top","bottom"),this._addQueueToCache(t,o.top,"top","top"),this._addQueueToCache(t,o.left,"left","left"),this._addQueueToCache(t,s.left,"left","right"),this._addQueueToCache(t,s.right,"right","left"),this._addQueueToCache(t,o.right,"right","right"),this._addQueueToCache(t,o.bottom,"bottom","bottom"),this._addQueueToCache(t,s.bottom,"bottom","top")}}}_addQueueToCache(e,t,r,i){t&&this.queuesCache.push({tile:e,queue:t,posDir:r,moveDir:i})}redraw(){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height);for(const t of this.queuesCache)this.drawQueue(t.tile,t.queue,t.posDir,t.moveDir)}drawQueue(e,t,r,i){const s=this.canvas.getContext("2d"),o=e.getX()*this.tileSize+this.tileSize/2,u=e.getY()*this.tileSize+this.tileSize/2;for(let l=0;l<t.getLength();l++){let m=l;(i==="top"||i==="left")&&(m=t.getLength()-m-1);const h=t.get(m);if(!h)continue;const f=this.resourcesMeta[h.getResourceId()],c=f.spriteX*(this.packageSize+1),a=f.spriteY*(this.packageSize+1);let n,g;r==="left"||r==="right"?(n=o+this.firstPackageLocation[r][i]+this.movementDirectionCoefficient[r][i]*m+h.getOffset()/2,g=u-this.packageSize/2+h.getOffset()):(n=o-this.packageSize/2+h.getOffset(),g=u+this.firstPackageLocation[r][i]+this.movementDirectionCoefficient[r][i]*m+h.getOffset()/2),s.drawImage(this.imageMap.getImage("resources"),c,a,this.packageSize,this.packageSize,Math.round(n)+2,Math.round(g)+2,this.packageSize-4,this.packageSize-4)}}destroy(){this.factory.getEventManager().removeListenerForType("LayerPackage"),this.container.innerHTML="",this.container=null,this.canvas=null}}class $s{constructor(e,t=1,r=1){this.tile=e,this.factory=e.getFactory(),this.width=t,this.height=r}canSell(){return!0}sell(){for(let e=0;e<this.width;e++)for(let t=0;t<this.height;t++){const r=this.factory.getTile(this.tile.getX()+e,this.tile.getY()+t);this._sellTile(r)}}_sellTile(e){const t=e.getComponent();if(!t)return;const r=t.getMeta(),i=t.getX(),s=t.getY();let o=!0;for(let u of this.factory.getMeta().startComponents)u.id===r.id&&u.x===i&&u.y===s&&(o=!1);for(let u=0;u<r.width;u++)for(let l=0;l<r.height;l++)this.factory.getTile(i+u,s+l).setComponent(null);this.factory.getEventManager().invokeEvent(W.FACTORY_COMPONENTS_CHANGED,e),o&&this.factory.getGame().addMoney(r.price*r.priceRefund)}}class hc{constructor(e,t){this.tile=e,this.factory=e.getFactory(),this.toolId=t}canUpdate(){return!!this.toolId}update(){if(!this.toolId)return;const[e,t]=this.toolId.split("-");e==="terrain"?(this.tile.setTerrain(t),this.tile.getFactory().getMeta().buildableTerrains[t]?this.tile.setBuildableType(Ae.BUILDABLE_YES):this.tile.setBuildableType(Ae.BUILDABLE_NO)):e==="buildable"&&t==="road"&&this.tile.setBuildableType(Ae.BUILDABLE_PARTIAL),this.factory.getEventManager().invokeEvent(W.TILE_TYPE_CHANGED,this.tile)}}const dc='<div id="{{id}}" class="tip">{{content}}</div>';let pc=0;class Ks{constructor(e,t){this.initElement=e,this.content=typeof t=="string"?t:null,this.element=typeof t!="string"?t:null,this.isVisible=!1,this.mouseMove=r=>{this.updateLocation(r),this.display()},this.mouseOut=()=>{this.hide()}}init(){if(!this.element){this.id=`tip${pc++}`;const e=document.createElement("div");e.innerHTML=se.compile(dc)({id:this.id,content:this.content}),this.element=e.firstElementChild,document.body.appendChild(this.element)}return Object.assign(this.element.style,{position:"absolute",display:"none"}),this.initElement.addEventListener("mousemove",this.mouseMove),this.initElement.addEventListener("mouseout",this.mouseOut),this}destroy(){return this.hide(),this.initElement.removeEventListener("mousemove",this.mouseMove),this.initElement.removeEventListener("mouseout",this.mouseOut),this}display(){this.isVisible||(this.isVisible=!0,this.element.style.display="block",this.element.style.opacity="1")}updateLocation(e){const t=this.element.getBoundingClientRect(),r=t.width,i=t.height;let s=e.pageX-r/2,o=e.pageY+15;const u=window.innerWidth,l=window.innerHeight,m=window.scrollX,h=window.scrollY;s-m<10&&(s=m+10),s+r-m>u-20&&(s=u+m-r-20),o+i-h>l-20&&(o=e.pageY-i-20),this.element.style.left=`${s}px`,this.element.style.top=`${o}px`}hide(){this.isVisible&&(this.element.style.display="none",this.isVisible=!1)}}class mc{container=null;lastTip=null;mouseSelectionElement=null;cantPlaceElement=null;componentSelectedElement=null;constructor(e,t,r){this.factory=e,this.game=e.getGame(),this.imageMap=t,this.tileSize=r}display(e){this.container=e}destroy(){this.container=null,this.turnOffBuildMode(),this.turnOffCantBuildMode(),this.turnOffComponentSelected(),this.turnOffNotEnoughMoneyTip()}updateMouseInformationModes(e,t){if(!e||!t){this.turnOffBuildMode(),this.turnOffCantBuildMode(),this.turnOffNotEnoughMoneyTip();return}const r=this.game.getMeta().componentsById[e],i=this.factory.getTile(t.x,t.y),s=new ut(i,r),o=!this.factory.isOnMap(t.x,t.y,r.width,r.height),u=this.factory.isPossibleToBuildOnTypeWithSize(t.x,t.y,r.width,r.height,r),l=this.factory.getAreasManager().canBuildAt(t.x,t.y,r.width,r.height);o?this.turnOffBuildMode():this.updateBuildMode(e,t),u&&l||o?s.canBuy()?(this.turnOffCantBuildMode(),this.turnOffNotEnoughMoneyTip()):(this.updateCantBuildMode(e,t),this.updateNotEnoughMoneyTip()):(this.updateCantBuildMode(e,t),this.turnOffNotEnoughMoneyTip())}updateComponentSelected(e){if(!e)return this.turnOffComponentSelected();const t=e.getMeta();this.componentSelectedElement||(this.componentSelectedElement=this.createImageElement(this.imageMap.getImage("blueSelection")),this.container.appendChild(this.componentSelectedElement)),this.setElementStyle(this.componentSelectedElement,{left:e.getX()*this.tileSize+"px",top:e.getY()*this.tileSize+"px",width:this.tileSize*t.width+"px",height:this.tileSize*t.height+"px",opacity:.5,pointerEvents:"none",position:"absolute"})}turnOffComponentSelected(){this.componentSelectedElement&&(this.componentSelectedElement.remove(),this.componentSelectedElement=null)}updateBuildMode(e,t){const r=this.game.getMeta().componentsById[e];this.mouseSelectionElement||(this.mouseSelectionElement=this.createImageElement(this.imageMap.getImage("yellowSelection")),this.container.appendChild(this.mouseSelectionElement)),this.setElementStyle(this.mouseSelectionElement,{left:t.x*this.tileSize+"px",top:t.y*this.tileSize+"px",width:this.tileSize*r.width+"px",height:this.tileSize*r.height+"px",opacity:.5,pointerEvents:"none",position:"absolute"})}turnOffBuildMode(){this.mouseSelectionElement&&(this.mouseSelectionElement.remove(),this.mouseSelectionElement=null)}updateCantBuildMode(e,t){const r=this.game.getMeta().componentsById[e];this.cantPlaceElement||(this.cantPlaceElement=this.createImageElement(this.imageMap.getImage("cantPlace")),this.container.appendChild(this.cantPlaceElement)),this.setElementStyle(this.cantPlaceElement,{left:t.x*this.tileSize+"px",top:t.y*this.tileSize+"px",width:this.tileSize*r.width+"px",height:this.tileSize*r.height+"px",opacity:.5,pointerEvents:"none",position:"absolute"})}turnOffCantBuildMode(){this.cantPlaceElement&&(this.cantPlaceElement.remove(),this.cantPlaceElement=null)}updateNotEnoughMoneyTip(){this.lastTip||(this.lastTip=new Ks(this.container,`<span class="red">You don't have enough money!</span>`).init(),document.body.style.cursor="no-drop")}turnOffNotEnoughMoneyTip(){this.lastTip&&(this.lastTip.destroy(),this.lastTip=null,document.body.style.cursor="")}createImageElement(e){const t=document.createElement("img");return t.src=e.src,t.style.position="absolute",t.style.pointerEvents="none",t.style.opacity=.5,t}setElementStyle(e,t){Object.assign(e.style,t)}}const De="LayerMouse";class Xc{constructor(e,t,r){this.imageMap=e,this.factory=t,this.game=t.getGame(),this.tileSize=r.tileSize,this.tilesX=t.getMeta().tilesX,this.tilesY=t.getMeta().tilesY,this.selectedComponentMetaId=null,this.selectedMapToolId=null,this.clickedComponent=null,this.mouseInfoHelper=new mc(t,e,r.tileSize)}display(e){this.selectedComponentMetaId=null,this.container=e,this.tilesX*this.tileSize,this.element=document.createElement("div"),Object.assign(this.element.style,{position:"absolute",width:`${this.tilesX*this.tileSize}px`,height:`${this.tilesY*this.tileSize}px`}),this.container.append(this.element),this._setupNativePointerEvents(),this._setupMouseListeners(),this.mouseInfoHelper.display(e)}_setupMouseListeners(){let e=null,t=null,r=null;this.factory.getEventManager().addListener(De,W.FACTORY_MOUSE_MOVE,i=>{if(e&&e.altKeyDown)this.updateTileMeta(e),this.updateTileMeta(i);else if(this.selectedComponentMetaId){this.mouseInfoHelper.updateMouseInformationModes(this.selectedComponentMetaId,i);const s=this.game.getMeta().componentsById[this.selectedComponentMetaId];e&&i.leftMouseDown&&!e.shiftKeyDown&&s.buildByDragging?(this.buyComponent(e),this.buyComponent(i),this.connectComponents(t,i)):e&&(i.leftMouseDown&&e.shiftKeyDown||i.rightMouseDown)&&(this.sellComponent(e),this.sellComponent(i))}else e&&(i.leftMouseDown&&e.shiftKeyDown||i.rightMouseDown)&&(this.sellComponent(e),this.sellComponent(i));t=i}),this.factory.getEventManager().addListener(De,W.FACTORY_MOUSE_OUT,()=>{this.mouseInfoHelper.turnOffBuildMode(),this.mouseInfoHelper.turnOffCantBuildMode(),e=null,t=null}),this.factory.getEventManager().addListener(De,W.FACTORY_MOUSE_DOWN,i=>{e=i}),this.factory.getEventManager().addListener(De,W.FACTORY_MOUSE_UP,i=>{if(e&&e.x===i.x&&e.y===i.y){let s=this.factory.getTile(i.x,i.y).getComponent();e.altKeyDown?this.updateTileMeta(i):this.selectedComponentMetaId?e.leftMouseDown&&!e.shiftKeyDown?this.buyComponent(e):(e.leftMouseDown&&e.shiftKeyDown||e.rightMouseDown)&&this.sellComponent(e):!this.selectedComponentMetaId&&(e.leftMouseDown&&e.shiftKeyDown||e.rightMouseDown)?this.sellComponent(e):s&&(r===s&&(s=null),this.factory.getEventManager().invokeEvent(W.COMPONENT_SELECTED,s),r=s)}e=null}),this.factory.getEventManager().addListener(De,W.COMPONENT_META_SELECTED,i=>{this.factory.getEventManager().invokeEvent(W.COMPONENT_SELECTED,null),this.selectedComponentMetaId=i,this.mouseInfoHelper.updateMouseInformationModes(i,t),r=null}),this.factory.getEventManager().addListener(De,W.MAP_TOOL_SELECTED,i=>{this.factory.getEventManager().invokeEvent(W.COMPONENT_SELECTED,null),this.selectedMapToolId=i,r=null}),this.factory.getEventManager().addListener(De,W.COMPONENT_SELECTED,i=>{this.mouseInfoHelper.updateComponentSelected(i)})}updateTileMeta(e){const t=new hc(this.factory.getTile(e.x,e.y),this.selectedMapToolId);t.canUpdate()&&t.update()}buyComponent(e){const t=new ut(this.factory.getTile(e.x,e.y),this.game.getMeta().componentsById[this.selectedComponentMetaId]);t.canBuy()&&t.buy()}sellComponent(e){const t=this.game.getMeta().componentsById[this.selectedComponentMetaId],r=new $s(this.factory.getTile(e.x,e.y),t?t.width:1,t?t.height:1);r.canSell()&&r.sell()}connectComponents(e,t){const r=new Bs(this.factory.getTile(e.x,e.y),this.factory.getTile(t.x,t.y));r.canUpdate()&&r.update()}_setupNativePointerEvents(){let e=null;const t=this.element;t.addEventListener("pointerout",()=>{this.factory.getEventManager().invokeEvent(W.FACTORY_MOUSE_OUT,e),e=null}),t.addEventListener("pointermove",r=>{let i={width:1,height:1};this.selectedComponentMetaId&&(i=this.game.getMeta().componentsById[this.selectedComponentMetaId]);const s=t.getBoundingClientRect(),o=r.clientX-s.left-this.tileSize*i.width/2,u=r.clientY-s.top-this.tileSize*i.height/2,l={x:Math.round(o/this.tileSize),y:Math.round(u/this.tileSize),leftMouseDown:r.buttons===1,rightMouseDown:r.buttons===2,shiftKeyDown:r.shiftKey,altKeyDown:r.altKey,pointerType:r.pointerType};l.x=Math.min(this.tilesX-i.width,Math.max(0,l.x)),l.y=Math.min(this.tilesY-i.height,Math.max(0,l.y)),(!e||e.x!==l.x||e.y!==l.y)&&(this.factory.getEventManager().invokeEvent(W.FACTORY_MOUSE_MOVE,l),e=l)}),t.addEventListener("pointerdown",r=>{this.factory.getEventManager().invokeEvent(W.FACTORY_MOUSE_DOWN,{x:e?.x??0,y:e?.y??0,leftMouseDown:r.buttons===1,rightMouseDown:r.buttons===2,shiftKeyDown:r.shiftKey,altKeyDown:r.altKey,pointerType:r.pointerType})}),t.addEventListener("pointerup",()=>{this.factory.getEventManager().invokeEvent(W.FACTORY_MOUSE_UP,e)})}destroy(){this.mouseInfoHelper.destroy(),this.factory.getEventManager().removeListenerForType(De),this.container.innerHTML="",this.container=null}}class Rs{constructor(e,t){this.factory=e,this.areaId=t,this.areaMeta=e.getMeta().areasById[t]}canBuy(){return this.areaMeta.price<=this.factory.getGame().getMoney()}buy(){this.factory.getGame().addMoney(-this.areaMeta.price),this.factory.getAreasManager().setAreaBought(this.areaId,!0)}}const gc=`<div class="confirmBg" id="{{idBg}}"></div>\r
<div class="confirm" id="{{id}}">\r
  <span class="title">{{title}}</span>\r
  <br />\r
  <span class="message">{{{message}}}</span>\r
  <br />\r
  <span class="cancelButton">{{cancelTitle}}</span>\r
  <span class="okButton">{{okTitle}}</span>\r
</div>`;let fc=0;class fr{title;message;okTitle="Ok";cancelTitle="Cancel";okCallback;cancelCallback;element;bg;constructor(e,t){this.title=e,this.message=t,this.id=`confirm${fc++}`,this.idBg=`${this.id}Bg`}setOkTitle(e){return this.okTitle=e,this}setCancelTitle(e){return this.cancelTitle=e,this}setOkCallback(e){return this.okCallback=e,this}setCancelCallback(e){return this.cancelCallback=e,this}display(){const e=se.compile(gc)({id:this.id,idBg:this.idBg,title:this.title,message:this.message,okTitle:this.okTitle,cancelTitle:this.cancelTitle});if(document.body.insertAdjacentHTML("beforeend",e),this.element=document.getElementById(this.id),this.bg=document.getElementById(this.idBg),!this.element||!this.bg)return this;const t=()=>{const{innerWidth:r,innerHeight:i}=window,{offsetWidth:s,offsetHeight:o}=this.element;this.element.style.left=`${Math.round((r-s)/2)}px`,this.element.style.top=`${Math.round((i-o)/2)}px`};return t(),window.addEventListener("resize",t),this.element.querySelector(".okButton")?.addEventListener("click",()=>{this.hide(),this.okCallback?.()}),this.element.querySelector(".cancelButton")?.addEventListener("click",()=>{this.hide(),this.cancelCallback?.()}),this.bg.style.opacity=0,this.element.style.opacity=0,this.bg.style.display="block",this.element.style.display="block",requestAnimationFrame(()=>{this.bg.style.transition="opacity 0.2s ease",this.element.style.transition="opacity 0.2s ease",this.bg.style.opacity=1,this.element.style.opacity=1}),this}hide(){if(this.element&&this.bg){const e=t=>{t.style.transition="opacity 0.2s ease",t.style.opacity=0,t.addEventListener("transitionend",()=>t.remove(),{once:!0})};e(this.element),e(this.bg)}}}class yc{constructor(e,t,{tileSize:r}){this.imageMap=e,this.factory=t,this.game=t.getGame(),this.tileSize=r,this.tilesX=t.getMeta().tilesX,this.tilesY=t.getMeta().tilesY}display(e){this.container=e,this.container.insertAdjacentHTML("beforeend",'<div id="areasLayer" style="position:absolute"></div>'),this.factory.getEventManager().addListener("AreasLayer",W.FACTORY_COMPONENTS_CHANGED,()=>this.redraw()),this.area=this.container.querySelector("#areasLayer"),this.redraw()}redraw(){this.area.innerHTML="";const e=this.factory.getMeta(),t=this.factory.getAreasManager();e.areas.forEach(s=>{t.getIsAreaBought(s.id)||s.locations.forEach((o,u)=>{const l=document.createElement("div");if(l.className="mapBuyArea",l.dataset.id=s.id,Object.assign(l.style,{left:`${this.tileSize*o.x}px`,top:`${this.tileSize*o.y}px`,width:`${this.tileSize*o.width}px`,height:`${this.tileSize*o.height}px`,position:"absolute"}),this.area.appendChild(l),u===0){const m=document.createElement("div");m.className="mapBuyAreaTitle money",m.innerHTML=`
            ${s.name}<br />
            Buy for <br />
            <b>$${K.formatNumber(s.price)}`,Object.assign(m.style,{left:`${this.tileSize*o.x}px`,top:`${this.tileSize*o.y}px`,width:`${this.tileSize*o.width}px`,marginTop:`${this.tileSize*o.height/2-23}px`,position:"absolute"}),this.area.appendChild(m)}})});let r=null,i=!1;this.factory.getEventManager().addListener("AreasLayer",W.FACTORY_SCROLL_START,()=>{i=!0}),this.factory.getEventManager().addListener("AreasLayer",W.FACTORY_SCROLL_END,()=>{setTimeout(()=>i=!1,100)}),this.area.querySelectorAll(".mapBuyArea").forEach(s=>{s.addEventListener("pointerover",o=>{const u=o.currentTarget.dataset.id;r!==u&&(this.area.querySelectorAll(".mapBuyArea").forEach(l=>l.classList.remove("mapBuyAreaOver")),this.area.querySelectorAll(`.mapBuyArea[data-id="${u}"]`).forEach(l=>l.classList.add("mapBuyAreaOver"))),r=u}),s.addEventListener("pointerout",()=>{this.area.querySelectorAll(".mapBuyArea").forEach(o=>o.classList.remove("mapBuyAreaOver")),r=null}),s.addEventListener("click",o=>{if(i)return;const u=o.currentTarget.dataset.id,l=e.areasById[u];new Rs(this.factory,u).canBuy()?new fr("",`<center>Are you sure you want to buy this area for <br />
            <b class="money" style="font-size:1.1em">$${K.formatNumber(l.price)}</b></center>`).setOkTitle("Yes, buy").setCancelTitle("No").setOkCallback(()=>{const h=new Rs(this.factory,u);h.canBuy()&&(h.buy(),this.redraw())}).display():new vr("","<center>You don't have enough money to buy selected area</center>").display()})})}destroy(){this.factory.getEventManager().removeListenerForType("AreasLayer"),this.container.innerHTML="",this.container=null,this.canvas=null}}class vc{constructor(e,{tileSize:t},r,i,s){this.tileSize=t,this.tilesX=e.getMeta().tilesX,this.tilesY=e.getMeta().tilesY,this.backgroundCanvas=r,this.componentsCanvas=i,this.packagesCanvas=s}open(){this.canvas=document.createElement("canvas"),this.canvas.width=this.tilesX*this.tileSize,this.canvas.height=this.tilesY*this.tileSize;const e=this.canvas.getContext("2d");e.drawImage(this.backgroundCanvas,0,0),e.drawImage(this.componentsCanvas,0,0),e.drawImage(this.packagesCanvas,0,0),window.open("about:blank","image from canvas").document.write(`
        <html>
          <body style="text-align:center; background-color:black; color:orangered; font-weight:bold;">
            <div style="margin: 0 0 8px 0;">
              For sharing copy or save image to disk. Or just make a screenshot, if your monitor is big enough :p
            </div>
            <img src="${this.canvas.toDataURL("image/png")}" alt="from canvas"/>
          </body>
        </html>
      `)}}class bc{constructor(e,t){this.globalUiEm=He,this.imageMap=t,this.factory=e,this.game=e.getGame(),this.tileSize=21,this.backgroundLayer=new oc(this.imageMap,e,{tileSize:this.tileSize}),this.componentLayer=new uc(this.imageMap,e,{tileSize:this.tileSize}),this.packageLayer=new lc(this.imageMap,e,{tileSize:this.tileSize}),this.mouseLayer=new Xc(this.imageMap,e,{tileSize:this.tileSize}),this.areasLayer=new yc(this.imageMap,e,{tileSize:this.tileSize})}display(e){this.container=e;const t=this.container.clientWidth,r=this.container.clientHeight,i=this.factory.getMeta().tilesX*this.tileSize,s=this.factory.getMeta().tilesY*this.tileSize;this.overlay=document.createElement("div"),Object.assign(this.overlay.style,{overflow:"hidden",margin:"0",width:`${Math.min(t,i)}px`,height:`${Math.min(r,s)}px`,position:"relative"}),this.element=document.createElement("div"),Object.assign(this.element.style,{position:"absolute",width:`${i}px`,height:`${s}px`,left:"0px",top:"0px"}),this.overlay.append(this.element),this.container.append(this.overlay),this.setupMapDragging(),this.backgroundLayer.display(this.element),this.componentLayer.display(this.element),this.packageLayer.display(this.element),this.mouseLayer.display(this.element),this.areasLayer.display(this.element),this.globalUiEm.addListener("FactoryMapUi",W.OPEN_SCREENSHOT_VIEW,()=>{new vc(this.factory,{tileSize:this.tileSize},this.backgroundLayer.getCanvas(),this.componentLayer.getCanvas(),this.packageLayer.getCanvas()).open()})}setupMapDragging(){let e=!0;this.factory.getEventManager().addListener("FactoryMapUi",W.COMPONENT_META_SELECTED,h=>{const f=this.game.getMeta().componentsById[h];e=!f||!f.buildByDragging});let t,r,i,s;const o=h=>{const f=h.pageX-t,c=h.pageY-r;this.setElementOffset(i+f,s+c),this.factory.getEventManager().invokeEvent(W.FACTORY_SCROLL_START)},u=()=>{document.body.removeEventListener("pointermove",o),document.body.removeEventListener("pointerup",u),this.factory.getEventManager().invokeEvent(W.FACTORY_SCROLL_END)};this.element.addEventListener("pointerdown",h=>{h.button===0&&!h.shiftKey&&!h.altKey&&e&&(t=h.pageX,r=h.pageY,this.element.getBoundingClientRect(),i=parseInt(this.element.style.left||"0",10),s=parseInt(this.element.style.top||"0",10),document.body.addEventListener("pointermove",o),document.body.addEventListener("pointerup",u))});const l=-this.factory.getMeta().startX*this.tileSize,m=-this.factory.getMeta().startY*this.tileSize;this.setElementOffset(l,m)}setElementOffset(e,t){const r=this.clampOffset(e,t);this.element.style.left=`${r.left}px`,this.element.style.top=`${r.top}px`}clampOffset(e,t){this.overlay.getBoundingClientRect(),this.element.getBoundingClientRect();const r=0,i=this.overlay.clientWidth-this.element.offsetWidth,s=0,o=this.overlay.clientHeight-this.element.offsetHeight;return{left:Math.min(Math.max(e,i),r),top:Math.min(Math.max(t,o),s)}}destroy(){this.factory.getEventManager().removeListenerForType("FactoryMapUi"),this.backgroundLayer.destroy(),this.componentLayer.destroy(),this.packageLayer.destroy(),this.mouseLayer.destroy(),this.areasLayer.destroy(),this.container.innerHTML="",this.container=null}}const Sc=`<div class="componentsBox">\r
  <div class="title">Components</div>\r
  <table cellspacing="0" cellpadding="0" border="0"> \r
    {{#each components}} <tr> \r
      {{#each sub}} <td>\r
        <div class="buttonArea"> \r
          {{#if name}} <div class="button but{{id}} {{#if isNoComponent}}buttonSelected{{/if}}" data-id="{{id}}">\r
            <div class="icon" data-id="{{id}}" style="{{style}}"></div>\r
          </div> {{/if}} \r
        </div>\r
      </td> {{/each}} \r
    </tr> {{/each}} \r
  </table>\r
  <div style="text-align:center; margin: 10px 0 10px 0;"> <a href="javascript:void(0);" id="makeScreenShotButton"\r
      style="color:white; font-size:0.9em;">Show whole map</a> </div>\r
</div>`;class Gc{constructor(e){this.globalUiEm=He,this.factory=e,this.game=e.getGame(),this.lastSelectedComponentId=null,this.selectedComponentId=null}display(e){this.container=e;const t=this.game.getMeta().componentsSelection.map(i=>({sub:i.map(s=>{const o=this.game.getMeta().componentsById[s];return o&&ut.possibleToBuy(this.factory,o)?{id:o.id,name:o.name,style:`background-position: -${26*o.iconX}px -${26*o.iconY}px`}:s==="noComponent"?{name:"No component",style:"background-position: 0px 0px"}:{}})}));this.container.insertAdjacentHTML("beforeend",se.compile(Sc)({components:t})),this.factory.getEventManager().addListener("componentsUi",W.COMPONENT_META_SELECTED,i=>{this.container.querySelectorAll(".button").forEach(s=>s.classList.remove("buttonSelected")),this.selectedComponentId===i?this.selectedComponentId=null:(this.container.querySelectorAll(`.but${i}`).forEach(s=>s.classList.add("buttonSelected")),this.selectedComponentId=i)}),this.container.addEventListener("pointerdown",i=>{const s=i.target.closest(".button");if(!s)return;const o=s.dataset.id??null;this.factory.getEventManager().invokeEvent(W.COMPONENT_META_SELECTED,o)}),this.container.addEventListener("pointerenter",i=>{const s=i.target.closest(".button");if(!s)return;const o=s.dataset.id??null;this.factory.getEventManager().invokeEvent(W.HOVER_COMPONENT_META,o)},!0),this.container.addEventListener("pointerleave",i=>{i.target.closest(".button")&&this.factory.getEventManager().invokeEvent(W.HOVER_COMPONENT_META,null)},!0),this.globalUiEm.addListener("componentsUi",Pe.KEY_PRESS,i=>{i.code==="Space"&&(this.factory.getEventManager().invokeEvent(W.COMPONENT_META_SELECTED,this.selectedComponentId?null:this.lastSelectedComponentId),i.preventDefault())}),this.container.querySelector("#makeScreenShotButton")?.addEventListener("click",()=>{this.globalUiEm.invokeEvent(W.OPEN_SCREENSHOT_VIEW)}),this.factory.getEventManager().invokeEvent(W.COMPONENT_META_SELECTED,null)}destroy(){this.factory.getEventManager().removeListenerForType("componentsUi"),this.game.getEventManager().removeListenerForType("componentsUi"),this.globalUiEm.removeListenerForType("componentsUi"),this.container&&(this.container.innerHTML="",this.container=null)}}const Cc=`<div class="componentControls"></div>\r
<div class="componentInfo"></div>`,As=`<div class="componentGraph"></div>\r
<div class="componentInfoArea">\r
  <span class="title">{{component.name}}</span>\r
  <br /> {{#if isMeta}}Price: <b class="money">{{component.priceStr}}</b> &nbsp;&nbsp; {{/if}} {{#if component.runningCostStr}}Costs: \r
  <b class="money">{{component.runningCostStr}}</b>{{/if}} {{#if component.effectivenessStr}}\r
  <span class="effectiveness">Efficiency: <b class="effectiveness">{{component.effectivenessStr}}</b>\r
  </span>{{/if}}\r
  <br />\r
  <div class="specialInfo"> {{#if component.description}}\r
    <span class="description">{{component.description}}</span>{{/if}} {{#if component.isBuyer}} Buys\r
    {{{component.buyStr}}} {{#if component.purchasePrice}}for <b class="money">\${{component.purchasePrice}}</b>{{/if}}\r
    after every <b>{{component.interval}}</b> ticks and sends it to conveyors. Should have\r
    <b>{{component.noOfOutputs}}</b> out conveyor(s). <br /> {{/if}} {{#if component.isConverter}} After every\r
    <b>{{component.interval}}</b> ticks uses {{{component.inputStr}}} to produce {{{component.outputStr}}}. Should have\r
    at least <b>{{component.noOfOutputs}}</b> out conveyor(s). <br /> {{/if}} {{#if component.isSeller}} Sells\r
    {{{component.sellStr}}} for <b class="money">\${{component.sellPrice}}</b> after every <b>{{component.interval}}</b>\r
    ticks {{#if component.bonusStr}}\r
    <br />Bonus: {{{component.bonusStr}}}{{/if}}\r
    <br /> {{/if}} {{#if component.isGarbage}} After every <b>{{component.interval}}</b> ticks removes\r
    <b>{{component.removeAmount}}</b> items. <br /> {{#if isLocation}} Stock\r
    <b>{{component.noOfItems}}</b>/{{component.max}} items {{/if}} {{/if}} {{#if component.isSorter}} Takes in any\r
    element and sorts them to different outputs. {{/if}} {{#if component.isResearchCenter}} Produces <span\r
      class="research">{{{component.productionStr}}}</span> after every <b>{{component.interval}}</b> ticks. <br />\r
    Production bonus of each {{{component.bonusStr}}} <br /> {{/if}} {{#if component.isLab}} Produces\r
    <b>{{{component.outputStr}}}</b> after every <b>{{component.interval}}</b> ticks <br /> Production bonus of each\r
    {{{component.bonusStr}}} <br /> {{/if}} {{#if component.isTransport}} Transports items from one component to\r
    another. Can take in 1 item/tick. {{/if}} {{#if component.stock}}\r
    <b>Stock</b> {{#each component.stock}}\r
    <span class="{{resourceId}}">{{resourceName}}: </span>\r
    <b class="{{resource}}">{{amount}}</b>/{{max}} {{/each}} {{/if}}\r
  </div>\r
</div>`,Mc=`{{#each locations}}{{name}}\r
  <select data-id="{{id}}"> {{#each resources}}\r
      <option value="{{id}}">{{name}}</option>\r
    {{/each}}\r
  </select>\r
  <br />{{/each}}`;class kc{constructor(e,t,r,i){this.component=e,this.factory=e.getFactory(),this.offsetX=t,this.offsetY=r,this.resource=i}canUpdate(){return this.component.getMeta().strategy.type==="sorter"}update(){this.component.getStrategy().setSortingResource(this.offsetX,this.offsetY,this.resource),this.factory.getEventManager().invokeEvent(FactoryEvent.FACTORY_COMPONENTS_CHANGED,this.tile),this.factory.getEventManager().invokeEvent(FactoryEvent.REFRESH_COMPONENT_INFO)}}class Ec{constructor(e){this.component=e,this.strategy=e.getStrategy(),this.container=null}display(e){this.container=e;const t=[{id:null,name:"all other"},...this.component.getFactory().getGame().getMeta().resources.map(s=>({id:s.id,name:s.name}))],r=this.strategy.getSortingIndex(),i=Object.keys(r).map(s=>({id:s,name:s,resources:t,selected:r[s]}));this.container.html(Handlebars.compile(Mc)({locations:i})),this.container.find("select").each((s,o)=>{const[u,l]=o.getAttribute("data-id").split(":");o.value=this.strategy.getSortingResource(u,l),o.addEventListener("change",m=>{const[h,f]=m.target.getAttribute("data-id").split(":"),c=m.target.value,a=new kc(this.component,h,f,c);a.canUpdate()&&a.update()})})}destroy(){this.container.innerHTML="",this.container=null}}const Fe=25,Ps=1,gt=Fe/2,Os=33;class js{constructor(e,t){this.rootNode=e,this.imageMap=t,this.positions={},this.maxLevel=0,this.canvas=null}display(e){const t={node:this.rootNode,width:0};this.positions[this.rootNode.getId()]=t,this.calculateWidths(this.rootNode),t.y=0,t.x=t.width/2-gt,t.sx=0,this.calculatePositions(this.rootNode);const r=document.createElement("canvas");r.style.position="absolute",r.width=t.width+gt,r.height=Os*(this.maxLevel+1),this.canvas=r,this.ctx=this.canvas.getContext("2d"),this.drawElements(this.rootNode),e.innerHTML="",e.appendChild(r),Object.assign(e.style,{width:`${r.width}px`})}calculateWidths(e){const t=e.getChildren();for(const r in t){const i=t[r];this.positions[i.getId()]={node:i,width:0},this.calculateWidths(i),this.positions[e.getId()].width+=this.positions[i.getId()].width}this.positions[e.getId()].width||(this.positions[e.getId()].width+=40)}calculatePositions(e){this.maxLevel=Math.max(this.maxLevel,e.getLevel());const t=this.positions[e.getId()],r=e.getChildren();let i=t.sx;for(const s in r){const o=r[s],u=this.positions[o.getId()];u.y=Os*o.getLevel(),u.x=i+u.width/2-gt,u.sx=i,i+=u.width,this.calculatePositions(o)}}drawComponentIcon(e,t,r){const i=this.imageMap.getImage("componentIcons");if(!i){console.warn("ProductionGraphUi: Missing sprite for componentIcons");return}const s=e.getComponentMeta();this.ctx.drawImage(i,(Fe+Ps)*s.iconX,(Fe+Ps)*s.iconY,Fe,Fe,t,r,Fe,Fe)}drawElements(e){const t=e.getChildren(),r=this.positions[e.getId()];for(const i in t){const s=t[i],o=this.positions[s.getId()];this.drawLine(r.x+gt,r.y+Fe,o.x+gt,o.y),this.drawElements(s)}this.drawComponentIcon(e,r.x,r.y),this.writeToNode(r.x+27,r.y+16.5,e.amount)}drawLine(e,t,r,i){this.ctx.beginPath(),this.ctx.strokeStyle="rgb(201,201,201)",this.ctx.lineWidth=1,this.ctx.moveTo(e,t),this.ctx.lineTo(r,i),this.ctx.stroke()}writeToNode(e,t,r){this.ctx.font="11px Arial",this.ctx.textAlign="left",this.ctx.fillStyle="#FFFFFF",this.ctx.fillText(r,e,t)}}class xs{constructor(e,t,r){this.id=Math.random(),this.componentMeta=e,this.amount=t,this.level=r,this.parent=null,this.children={}}getId(){return this.id}setAmount(e){this.amount=e}getAmount(){return this.amount}getComponentMeta(){return this.componentMeta}getLevel(){return this.level}getParent(){return this.parent}setParent(e){this.parent=e}getChildren(){return this.children}hasChildren(){return Object.keys(this.children).length>0}addChild(e,t){this.children[e]=t}getRoot(){return this.parent?this.parent.getRoot():this}multiplyAmount(e){this.amount*=e;for(const t in this.children)this.children[t].multiplyAmount(e)}toGraph(e,t){const r={id:this.id,label:`${this.componentMeta.name}(${this.amount})`,shape:"box",level:this.level};e.push(r),this.parent&&t.push({from:this.parent.getId(),to:this.id});for(const i in this.children)this.children[i].toGraph(e,t)}findLeastCommonMultiplier(e,t){if(!e||!t)return 0;let r=Math.abs(e),i=Math.abs(t);for(;i;){const s=i;i=r%i,r=s}return Math.abs(e*t/r)}}class Qs{constructor(e){this.factory=e,this.meta=e.getGame().getMeta()}buildTree(e,t){const r=new xs(this.meta.componentsById[e],1,0);return this._buildTree(r,t),r}_buildTree(e,t){if(t<=0)return;const r=this.meta.productionTree[e.getComponentMeta().id]||{};for(const i in r){const s=r[i],o=new xs(this.meta.componentsById[s],1,e.getLevel()+1);this._balanceNode(e,o,i),o.setParent(e),e.addChild(i,o),this._buildTree(o,t-1)}}_balanceNode(e,t,r){const i=this.getConsumption(this.meta.componentsById[e.getComponentMeta().id],r),s=this.getProduction(this.meta.componentsById[t.getComponentMeta().id],r),o=this.findLeastCommonMultiple(i*e.getAmount(),s),u=Math.round(o/i),l=Math.round(o/s);if(u>e.getAmount()){const m=u/e.getAmount();e.getRoot().multiplyAmount(m)}t.setAmount(l)}findLeastCommonMultiple(e,t){if(!e||!t)return 0;let r=Math.abs(e),i=Math.abs(t);for(;i;){const s=i;i=r%i,r=s}return Math.abs(e*t/r)}getProduction(e,t){let r=0;const i=mr.getStrategyClass(e.strategy.type);return e.strategy.type==="buyer"?r=i.getMetaBuyAmount(e,t,this.factory):e.strategy.type==="converter"&&(r=i.getMetaProduceAmount(e,t,this.factory)),r/e.strategy.interval*10}getConsumption(e,t){let r=0;const i=mr.getStrategyClass(e.strategy.type);return e.strategy.type==="converter"?r=i.getMetaUseAmount(e,t,this.factory):e.strategy.type==="seller"&&(r=i.getMetaSellAmount(e,t,this.factory)),r/e.strategy.interval*10}}class Js{constructor(e,t){this.game=e,this.seconds=t;const r=this.game.getTicker().getNormalTicksPerSec();this.ticks=this.seconds*r;const i=this.game.getStatistics();this.profit=i.getAvgProfit()*this.ticks,this.researchPoints=i.getAvgResearchPointsProduction()*this.ticks}getTicks(){return this.ticks}getProfit(){return this.profit}getResearchPoints(){return this.researchPoints}canPassTime(){return this.game.getTicker().getTimeTravelTickets()>0}passTime(){const e=this.game.getTicker();this.game.addMoney(this.profit),this.game.addResearchPoints(this.researchPoints),e.addNoOfTicks(this.ticks),e.getTimeTravelTickets()>0&&e.addTimeTravelTickets(-1)}}class Tc{constructor(e,t,r,i){this.factory=e,this.game=e.getGame(),this.statistics=t,this.play=r,this.imageMap=i,this.selectedPosition=null,this.hoveredComponentMetaId=null,this.selectedComponentMetaId=null,this.selectedComponent=null,this.componentStrategies={sorter:Ec},this.displayedStrategy=null,this.displayedStrategyComponent=null,this.container=null,this.infoContainer=null,this.controlsContainer=null,this.listenerKey="componentInfoUi"}display(e){this.container=e,this.container.insertAdjacentHTML("beforeend",se.compile(Cc)({})),this.infoContainer=this.container.querySelector(".componentInfo"),this.controlsContainer=this.container.querySelector(".componentControls");const t=this.factory.getEventManager();t.addListener(this.listenerKey,W.FACTORY_MOUSE_MOVE,r=>{this.selectedPosition=r,this.checkWhatShouldBeDisplayed(!1)}),t.addListener(this.listenerKey,W.FACTORY_MOUSE_OUT,()=>{this.selectedPosition=null,this.checkWhatShouldBeDisplayed(!1)}),t.addListener(this.listenerKey,W.FACTORY_TICK,()=>{this.checkWhatShouldBeDisplayed(!0)}),t.addListener(this.listenerKey,W.REFRESH_COMPONENT_INFO,()=>{this.checkWhatShouldBeDisplayed(!1)}),t.addListener(this.listenerKey,W.HOVER_COMPONENT_META,r=>{this.hoveredComponentMetaId=r,this.checkWhatShouldBeDisplayed(!1)}),t.addListener(this.listenerKey,W.COMPONENT_META_SELECTED,r=>{this.selectedComponentMetaId=r,this.selectedComponent=null,this.checkWhatShouldBeDisplayed(!1)}),t.addListener(this.listenerKey,W.COMPONENT_SELECTED,r=>{this.selectedComponent=r,this.checkWhatShouldBeDisplayed(!1)})}checkWhatShouldBeDisplayed(e=!1){this.hoveredComponentMetaId&&!e?(this.showComponentMetaInfo(this.hoveredComponentMetaId),this.hideComponentStrategy()):this.selectedComponent?(this.showComponentInfo(this.selectedComponent),this.showComponentStrategy(this.selectedComponent)):this.selectedComponentMetaId&&!e?(this.showComponentMetaInfo(this.selectedComponentMetaId),this.hideComponentStrategy()):this.selectedPosition?(this.showLocationInfo(this.selectedPosition.x,this.selectedPosition.y),this.hideComponentStrategy()):e&&this.showDefaultInfo()}showComponentInfo(e){this.showLocationInfo(e.getX(),e.getY())}showLocationInfo(e,t){const r=this.factory.getTile(e,t),i={isLocation:!0,tile:{x:r.getX(),y:r.getY(),terrain:r.getTerrain(),buildableType:r.getBuildableType()},component:r.getComponent()?r.getComponent().getDescriptionData():{}};this.infoContainer.innerHTML=se.compile(As)(i)}showComponentStrategy(e){if(this.displayedStrategyComponent===e)return;const t=this.componentStrategies[e.getMeta().strategy.type];t?(this.displayedStrategyComponent=e,this.displayedStrategy=new t(e),this.displayedStrategy.display(this.controlsContainer),this.controlsContainer.style.display="block"):this.hideComponentStrategy()}hideComponentStrategy(){this.displayedStrategy&&(this.displayedStrategy.destroy(),this.displayedStrategy=null,this.displayedStrategyComponent=null),this.controlsContainer.innerHTML="",this.controlsContainer.style.display="none"}showComponentMetaInfo(e){const t=this.game.getMeta().componentsById[e],r={isMeta:!0,component:St.getMetaDescriptionData(t,this.factory)};this.infoContainer.innerHTML=se.compile(As)(r);const i=new Qs(this.factory).buildTree(e,1);if(i.hasChildren()){const s=new js(i,this.imageMap),o=this.infoContainer.querySelector(".componentGraph");s.display(o);const u=this.infoContainer.querySelector(".componentInfoArea");u&&o&&(u.style.width=`${u.offsetWidth-o.offsetWidth}px`)}}hideInfo(){this.hideComponentStrategy(),this.infoContainer.innerHTML=""}showDefaultInfo(){if(!this.play.isDevMode()){this.hideInfo();return}this.showIncomesData()}showIncomesData(){this.hideInfo();const e=this.statistics.getFactoryAvgResearchPointsProduction(this.factory.getMeta().id)*this.game.getTicker().getTicksPerSec()||0,t=this.statistics.getFactoryAvgProfit(this.factory.getMeta().id)*this.game.getTicker().getTicksPerSec()||0,r=(s,o,u="")=>`
      <tr>
        <td align="center"><b class="${u}">${s}</b></td>
        ${o.map(l=>`<td align="center" class="${u}">${l}</td>`).join("")}
      </tr>`,i=`
      <table cellspacing="0" cellpadding="0" border="0">
        <tr>
          <td width="100"></td>
          <td width="100"><b>15min</b></td>
          <td width="100"><b>1h</b></td>
          <td width="100"><b>24h</b></td>
          <td width="100"><b>1 week</b></td>
        </tr>
        ${r("Research:",[K.formatNumber(900*e),K.formatNumber(3600*e),K.formatNumber(1440*60*e),K.formatNumber(10080*60*e)],"research")}
        ${r("Money",[`$${K.formatNumber(900*t)}`,`$${K.formatNumber(3600*t)}`,`$${K.formatNumber(1440*60*t)}`,`$${K.formatNumber(10080*60*t)}`],"money")}
        <tr>
          <td></td>
          <td><a href="#" class="passTime" data-amount="15">PASS</a></td>
          <td><a href="#" class="passTime" data-amount="60">PASS</a></td>
          <td><a href="#" class="passTime" data-amount="1440">PASS</a></td>
          <td><a href="#" class="passTime" data-amount="10080">PASS</a></td>
        </tr>
      </table>`;this.infoContainer.insertAdjacentHTML("beforeend",i),this.infoContainer.querySelectorAll(".passTime").forEach(s=>{s.addEventListener("click",o=>{o.preventDefault();const u=parseInt(o.target.dataset.amount,10);new Js(this.game,60*u).passTime()})})}destroy(){this.factory.getEventManager().removeListenerForType(this.listenerKey),this.container.innerHTML="",this.container=null}}const Ic=`<div class="controlsBox">\r
  <a href="javascript:void(0);" id="clearPackages" class="button clearPackagesButton">Clear tracks</a>\r
  <a href="javascript:void(0);" id="resetFactory" class="button resetFactoryButton">Reset</a>\r
  <br style="clear:both" />\r
  <a href="javascript:void(0);" class="button stopButton" id="stopButton">Pause</a>\r
  <a href="javascript:void(0);" class="button playButton" id="playButton">Play</a>\r
  <a href="javascript:void(0);" class="button playFastButton" id="playFastButton">Fast &gt;&gt;</a>\r
  <a href="javascript:void(0);" class="button playNormalButton" id="playNormalButton">Normal</a>\r
  <div id="bonusTicks" class="bonusTicks">Bonus ticks: <span></span>\r
  </div>\r
</div>`;class wc{constructor(e){this.factory=e}canClear(){return!0}clear(){const e=this.factory.getTiles();for(let t of e){const r=t.getComponent();r&&r.getStrategy().clearContents()}this.factory.getEventManager().invokeEvent(W.FACTORY_COMPONENTS_CHANGED,e)}}class _c{constructor(e){this.factory=e}canReset(){return!0}reset(){console.log("Resetting");const e=this.factory.getTiles();for(let t of e){const r=new $s(t,1,1);r.canSell()&&r.sell()}this.factory.reset()}}const dr="factoryControlsUi";class Rc{constructor(e){this.factory=e,this.game=e.getGame(),this.container=null,this.pauseButton=null,this.playButton=null,this.playFastButton=null,this.playNormalButton=null,this.bonusTicks=null,this.clearPackagesButton=null,this.resetFactoryButton=null}updateControlButtons(){const e=this.game.getTicker();e.getBonusTicks()?(this.bonusTicks.style.display="block",e.getIsFastActive()?(this.playFastButton.style.display="none",this.playNormalButton.style.display="block"):(this.playFastButton.style.display="block",this.playNormalButton.style.display="none")):(this.bonusTicks.style.display="none",this.playFastButton.style.display="none",this.playNormalButton.style.display="none"),this.factory.getIsPaused()?(this.playButton.style.display="block",this.pauseButton.style.display="none"):(this.playButton.style.display="none",this.pauseButton.style.display="block")}updateBonusTicksValue(){const e=this.bonusTicks.querySelector("span");e&&(e.textContent=K.formatNumber(this.game.getTicker().getBonusTicks())),this.updateControlButtons()}display(e){this.container=e,this.container.insertAdjacentHTML("beforeend",se.compile(Ic)());const t=this.game.getTicker();this.pauseButton=this.container.querySelector("#stopButton"),this.playButton=this.container.querySelector("#playButton"),this.playFastButton=this.container.querySelector("#playFastButton"),this.playNormalButton=this.container.querySelector("#playNormalButton"),this.bonusTicks=this.container.querySelector("#bonusTicks"),this.clearPackagesButton=this.container.querySelector("#clearPackages"),this.resetFactoryButton=this.container.querySelector("#resetFactory"),this.updateControlButtons(),this.updateBonusTicksValue();const r=(i,s=!1)=>{s?t.startFast():t.stopFast(),this.factory.setIsPaused(i),this.updateControlButtons()};this.pauseButton.addEventListener("pointerdown",()=>r(!0)),this.playButton.addEventListener("pointerdown",()=>r(!1)),this.playFastButton.addEventListener("pointerdown",()=>r(!1,!0)),this.playNormalButton.addEventListener("pointerdown",()=>r(!1)),this.clearPackagesButton.addEventListener("pointerdown",()=>{const i=new wc(this.factory);i.canClear()&&i.clear()}),this.resetFactoryButton.addEventListener("pointerdown",()=>{new fr("Are you sure?","This will remove all components from the map").setOkCallback(()=>{const i=new _c(this.factory);i.canReset()&&i.reset()}).display()}),this.game.getEventManager().addListener(dr,J.TICKS_STARTED,()=>this.updateControlButtons()),this.game.getEventManager().addListener(dr,J.TICKS_STOPPED,()=>this.updateControlButtons()),this.game.getEventManager().addListener(dr,J.BONUS_TICKS_UPDATED,()=>this.updateBonusTicksValue())}destroy(){this.game.getEventManager().removeListenerForType(dr),this.container&&(this.container.innerHTML=""),this.container=null}}const Ac=`<div class="mapToolsBox">\r
  <div class="location"></div>\r
  <div class="title">Map tools</div>\r
  <div class="help">Press ALT to draw</div>\r
  <div class="button buttonSelected but" data-id="">Nothing</div> {{#each tools}} {{#if showBreak}}\r
      <br style="clear:both" /> {{/if}}\r
    <div class="button but{{id}}" data-id="{{id}}">\r
      <div class="mapTool {{id}}" data-id="{{id}}">{{name}}</div>\r
    </div>\r
  {{/each}}\r
  <br style="clear:both" />\r
  <br />\r
  <div class="title">Map data</div>\r
  <textArea id="mapData"></textArea>\r
  <br />\r
</div>`,ft="factoryMapToolsUi";class Pc{constructor(e){this.factory=e,this.game=e.getGame(),this.selectedToolId=null,this.container=null}display(e){this.container=e;const t=[{id:"buildable-road",name:"Partial buildable area",showBreak:!1},...Object.values(this.factory.getMeta().terrains).map(i=>({id:`terrain-${i}`,name:i,showBreak:!1}))];this.container.insertAdjacentHTML("beforeend",se.compile(Ac)({tools:t})),this.locationElement=this.container.querySelector(".location"),this.mapDataElement=this.container.querySelector("#mapData"),this.buttons=this.container.querySelectorAll(".button"),this.updateMapData();const r=this.factory.getEventManager();r.addListener(ft,W.FACTORY_MOUSE_MOVE,i=>{this.locationElement&&(this.locationElement.textContent=`${i.x}:${i.y}`)}),r.addListener(ft,W.TILE_TYPE_CHANGED,()=>{this.updateMapData()}),r.addListener(ft,W.MAP_TOOL_SELECTED,i=>{this.selectedToolId=i,this.buttons.forEach(s=>{s.classList.toggle("buttonSelected",s.dataset.id===i)})}),r.addListener(ft,W.COMPONENT_META_SELECTED,()=>{this.factory.getEventManager().invokeEvent(W.MAP_TOOL_SELECTED,null)}),this.buttons.forEach(i=>{i.addEventListener("pointerdown",s=>{const o=s.target.dataset.id;r.invokeEvent(W.COMPONENT_META_SELECTED,null),r.invokeEvent(W.MAP_TOOL_SELECTED,o??null)})})}updateMapData(){const{tiles:e}=this.factory,{terrains:t}=this.factory.getMeta(),r=Object.fromEntries(Object.entries(t).map(([o,u])=>[u,o])),i="terrainMap: '"+e.map(o=>r[o.getTerrain()]).join("")+`',\r
`,s="buildMap: '"+e.map(o=>o.getBuildableType()).join("")+`',\r
`;this.mapDataElement&&(this.mapDataElement.textContent=i+s)}destroy(){this.factory.getEventManager().removeListenerForType(ft),this.container&&(this.container.innerHTML="",this.container=null),this.buttons.forEach(e=>{e.replaceWith(e.cloneNode(!0))})}}const Oc=`<div class="overviewBox">\r
  <span class="miniText">Money:</span>\r
  <span class="money">$<b id="money"></b>\r
  </span>\r
  <br />\r
  <span class="miniText">Income:</span>\r
  <span class="money smallText">$<span id="income"></span>\r
  </span>\r
  <span class="smallText">/tick (avg)</span>\r
  <br />\r
  <br /> {{#if researchBought}}\r
    <span class="miniText">Research:</span>\r
    <span class="research smallText">\r
      <span id="research"></span>\r
    </span>\r
    <br />\r
    <span class="miniText">Income:</span>\r
    <span class="research smallText">\r
      <span id="researchIncome"></span>\r
    </span>\r
    <span class="smallText">/tick (avg)</span>\r
    <br /> {{/if}}\r
  <span class="miniText ticks">\r
    <span id="ticks"></span> ticks/sec </span>\r
  <br />\r
</div>`;class xc{constructor(e,t){this.factory=e,this.game=e.getGame(),this.statistics=t,this.container=null}display(e){this.container=e,this.container.insertAdjacentHTML("beforeend",se.compile(Oc)({researchBought:!!this.game.getResearchManager().getResearch("researchCenter")})),this.game.getEventManager().addListener("factoryOverviewUi",J.GAME_TICK,()=>{this.update()}),this.update()}update(){if(!this.container)return;const{game:e,statistics:t,factory:r,container:i}=this,s=this.container.querySelector("#money");s.textContent=K.formatNumber(this.game.getMoney());const o=this.container.querySelector("#research");o&&e.getResearchPoints()&&(o.textContent=K.formatNumber(e.getResearchPoints()));const u=t.getFactoryAvgProfit(r.getMeta().id),l=u*e.getTicker().getTicksPerSec(),m=i.querySelector("#income");m&&(m.textContent=K.formatNumber(u));const h=i.querySelector("#incomePerSec");h&&(h.textContent=K.formatNumber(l));const f=t.getFactoryAvgResearchPointsProduction(r.getMeta().id),c=i.querySelector("#researchIncome");c&&(c.textContent=K.formatNumber(f));const a=i.querySelector("#ticks");a&&(a.textContent=K.formatNumber(e.getTicker().getActualTicksPerSec()))}destroy(){this.game.getEventManager().removeListenerForType("factoryOverviewUi"),this.container&&(this.container.innerHTML="",this.container=null)}}const Bc=`<div class="incentivizedAdBox">\r
    <div class="button {{#if isAvailable}}available{{/if}}"> \r
        {{#if isAvailable}} {{message}} {{else}} No ad to show currently {{/if}} </div>\r
  </div>`;class Lc{constructor(e){this.play=e,this.apiEm=e.getApi().getEventManager(),this.isAdAvailable=null,this.designInterval=null,this.element=null,this.container=null}display(e){this.container=e,this.apiEm.addListener("IncentivizedAd",ge.INCENTIVIZED_AD_STATUS,t=>{this.isAdAvailable=t,this.update()}),this.apiEm.addListener("IncentivizedAd",ge.INCENTIVIZED_AD_ABANDONED,()=>{new vr("Incentivized ad","You left too quickly, watch the ad till the end to get the bonus! :)").display()}),this.apiEm.invokeEvent(ge.INCENTIVIZED_AD_CHECK_STATUS),this.container.addEventListener("pointerdown",t=>{t.target.closest(".incentivizedAdBox")&&this.apiEm.invokeEvent(ge.INCENTIVIZED_AD_SHOW)}),this.update()}update(){if(this.container&&this.isAdAvailable!=null){const e=new Ns(this.play.getGame());this.render(e.getMessage())}}render(e){this.container.innerHTML=se.compile(Bc)({isAvailable:this.isAdAvailable,message:e})}destroy(){this.container&&(this.container.innerHTML=""),this.apiEm.removeListenerForType("IncentivizedAd"),this.designInterval&&clearInterval(this.designInterval)}}class Nc{constructor(e,t,r){this.globalUiEm=He,this.play=t,this.factory=e,this.game=e.getGame(),this.gameUiEm=this.game.getEventManager(),this.statistics=this.game.getStatistics(),this.imageMap=r,this.menuUi=new nc(e),this.mapUi=new bc(e,this.imageMap),this.componentsUi=new Gc(e),this.mapToolsUi=new Pc(e),this.infoUi=new Tc(e,this.statistics,t,this.imageMap),this.controlsUi=new Rc(e),this.overviewUi=new xc(e,this.statistics),this.incentivizedAdButtonUi=new Lc(t)}display(e){if(this.container=e,this.container.addEventListener("contextmenu",t=>{t.preventDefault()}),this.container.insertAdjacentHTML("beforeend",se.compile(ic)()),this.mainContainer=document.querySelector(".main"),this.game.getIsPremium()){this.mainContainer.classList.toggle("fullScreen",!0);const t=this.container.querySelector(".mapContainer");t.style.width=`${window.innerWidth-250}px`,t.style.height=`${window.innerHeight-150}px`}this.menuUi.display(this.container.querySelector(".menuContainer")),this.mapUi.display(this.container.querySelector(".mapContainer")),this.componentsUi.display(this.container.querySelector(".componentsContainer")),this.infoUi.display(this.container.querySelector(".infoContainer")),this.controlsUi.display(this.container.querySelector(".controlsContainer")),this.overviewUi.display(this.container.querySelector(".overviewContainer")),this.play.isDevMode()&&this.mapToolsUi.display(this.container.querySelector(".mapToolsContainer")),this.incentivizedAdButtonUi.display(this.container.querySelector(".incentivizedAd"))}destroy(){this.mapUi.destroy(),this.componentsUi.destroy(),this.infoUi.destroy(),this.controlsUi.destroy(),this.overviewUi.destroy(),this.mapToolsUi.destroy(),this.incentivizedAdButtonUi.destroy(),this.mainContainer&&this.mainContainer.classList.toggle("fullScreen",!1),this.game.getEventManager().removeListenerForType("FactoryUi"),this.container.innerHTML="",this.container=null}}const Uc=`<div class="researchBox">\r
  <span class="backButton" id="backToReactor">Back to factory</span>\r
  <div class="header"> You have <b id="researchPoints" class="research">????</b> research points and <b class="money">$ <span id="money"></span>\r
    </b>. Use it wisely! You have researched <b>{{have}} of {{max}}</b> technologies. <br />\r
    <span class="miniText">Research applies to every factory.</span>\r
  </div>\r
  <br /> {{#each research}} {{#if changeGroup}}\r
      <br style="clear:left" />\r
      <br /> {{/if}}\r
    <div class="researchItem" data-id="{{id}}">\r
      <div class="icon">\r
        <div class="iconSelf" "{{iconStyle}}"></div>\r
      </div>\r
      <div class="buyButton" data-id="{{id}}">BUY</div> {{name}} {{#if showBoughtAndMax}}\r
        <span class="bought"></span>/{{max}} {{/if}} &nbsp;&nbsp;&nbsp;&nbsp; {{#if price}}\r
        <span class="priceTitle">Price:</span>\r
        <span class="money">{{price}}</span> {{/if}} {{#if priceResearchPoints}}\r
        <span class="priceTitle">Research:</span>\r
        <span class="research">{{priceResearchPoints}}</span> {{/if}}\r
      <br />\r
      <div class="description"> {{description}} </div>\r
    </div>\r
  {{/each}}\r
</div>`;class Dc{constructor(e,t){this.game=e,this.researchId=t}canBuy(){return this.game.getResearchManager().canPurchase(this.researchId)}buy(){const e=this.game.getResearchManager();this.game.addMoney(-e.getPrice(this.researchId)),this.game.addResearchPoints(-e.getPriceResearchPoints(this.researchId)),e.addResearch(this.researchId,1),this.game.getEventManager().invokeEvent(GameEvent.RESEARCH_BOUGHT,this.researchId)}}class Fc{constructor(e){this.gameUiEm=Ee.gameUiBus,this.game=e,this.container=null}display(e){this.container=e;const t=this.game.getResearchManager();let r=0,i=0;for(const u of this.game.getMeta().research)r+=u.max||0,i+=t.getResearch(u.id);const s=[];for(const u of this.game.getMeta().research)if(t.isVisible(u.id)){const l=!u.max||t.getResearch(u.id)<u.max;s.push({id:u.id,name:u.name,description:u.description,price:l?K.formatNumber(t.getPrice(u.id)):null,priceResearchPoints:l?K.formatNumber(t.getPriceResearchPoints(u.id)):null,max:u.max,showBoughtAndMax:u.max>1,iconStyle:`background-position: -${26*u.iconX}px -${26*u.iconY}px`})}this.container.insertAdjacentHTML("beforeend",se.compile(Uc)({research:s,max:r,have:i})),this.onBackButtonClick=()=>{this.gameUiEm.invokeEvent(Z.SHOW_FACTORY)};const o=this.container.querySelector(".backButton");o&&(o.removeEventListener("pointerdown",this.onBackButtonClick),o.addEventListener("pointerdown",this.onBackButtonClick)),this.buyResearch=u=>{const l=new Dc(this.game,u);l.canBuy()&&(l.buy(),this.refreshView())},this.container.querySelectorAll(".researchItem").forEach(u=>{const l=u.dataset.id;u.removeEventListener("pointerdown",this.buyResearch),u.addEventListener("pointerdown",()=>this.buyResearch(l))}),this.game.getEventManager().addListener("researchUi",J.GAME_TICK,()=>this.update()),this.update()}refreshView(){const e=this.container;this.destroy(),this.display(e)}update(){const e=this.container.querySelector("#researchPoints");e.textContent=K.formatNumber(this.game.getResearchPoints());const t=this.container.querySelector("#money");t.textContent=K.formatNumber(this.game.getMoney()),this.container.querySelectorAll(".researchItem").forEach(r=>{const i=r.dataset.id;r.querySelector(".bought");const s=r.querySelector(".buyButton"),o=this.game.getResearchManager().couldPurchase(i);s.style.display=o?"":"none";const u=this.game.getResearchManager().canPurchase(i);s.classList.toggle("cantBuy",!u)})}destroy(){this.game.getEventManager().removeListenerForType("researchUi"),this.gameUiEm.removeListenerForType("researchUi"),this.container&&(this.container.innerHTML=""),this.container=null}}const qc=`<div class="upgradesBox">\r
  <span class="backButton" id="backToReactor">Back to factory</span>\r
  <div class="header"> You have <b class="money">$ <span id="money"></span>\r
    </b> to spend. Make it count! <br />\r
    <span class="miniText">Upgrades apply only to this area.</span>\r
  </div>\r
  <br /> {{#each groups}} {{#if isBreak}}\r
      <br style="clear:both" />\r
    {{else}}\r
      <div class="upgradeGroup">\r
        <div class="head">\r
          <div class="buildingIcon">\r
            <div class="buildingIconSelf" style="{{iconStyle}}"></div>\r
          </div>\r
          <div class="text">{{name}}</div> {{#each upgrades}} {{#if isSeparator}}\r
              <div style="width:10px; height:10px; float:right;"></div>\r
            {{else}}\r
              <div class="upgradeItem upgradeItem_{{action}}" data-id="{{id}}" data-action="{{action}}">\r
                <div class="upgradeIcon" style="{{iconStyle}}"></div>\r
                <div class="upgradePopup smallText">\r
                  <b>{{title}}</b> {{#if isSell}}( <u>sell</u>){{/if}}\r
                  <br />\r
                  <span>Bought: </span>\r
                  <b class="bought green"></b>{{#if max}}\r
                    <b class="red">/{{max}}</b>{{/if}}\r
                  <br /> {{#if isBuy}} {{#if isMaxed}}\r
                      <b class="red">Maxed!</b>\r
                      <br />\r
                    {{else}}\r
                      <span class="priceTitle">Buy for:</span>\r
                      <b class="money">\${{buyPrice}}</b>\r
                      <br /> {{/if}}\r
                    <br /> {{{description}}} {{/if}} {{#if isSell}} {{#if canSell}}\r
                      <span class="priceTitle">Sell for:</span>\r
                      <b class="money">\${{sellPrice}}</b>\r
                      <span class="miniText">(refunds {{refund}})</span>\r
                      <br />\r
                    {{else}}\r
                      <b class="red">You haven't bought any, can't sell</b>\r
                      <br /> {{/if}} {{/if}}\r
                </div>\r
              </div>\r
            {{/if}} {{/each}}\r
        </div>\r
      </div>\r
    {{/if}} {{/each}}\r
</div>`;class Hc{constructor(e,t){this.factory=e,this.game=e.getGame(),this.upgradeId=t}canBuy(){return this.factory.getUpgradesManager().canPurchase(this.upgradeId)}buy(){const e=this.factory.getUpgradesManager().getPrice(this.upgradeId);this.game.addMoney(-e),this.factory.getUpgradesManager().addUpgrade(this.upgradeId,1),this.factory.getEventManager().invokeEvent(FactoryEvent.UPGRADE_BOUGHT,this.upgradeId)}}class Yc{constructor(e,t){this.factory=e,this.game=e.getGame(),this.upgradeId=t}canSell(){return this.factory.getUpgradesManager().canSell(this.upgradeId)}sell(){const e=this.factory.getUpgradesManager().getSellPrice(this.upgradeId);this.game.addMoney(e),this.factory.getUpgradesManager().addUpgrade(this.upgradeId,-1)}}class Wc{constructor(e){this.gameUiEm=Ee.gameUiBus,this.factory=e,this.game=e.getGame(),this.container=null}display(e){this.container=e;const t=this.factory.getUpgradesManager(),r=[];for(const s of this.game.getMeta().upgradesLayout){if(s.type==="break"){r.push({isBreak:!0});continue}const o=[];for(const u of s.items){if(u==="_")continue;const l=this.game.getMeta().upgradesById[u];if(!l){console.error(`Group item with id ${u} not found!`);continue}if(!t.isVisible(l.id))continue;const m=t.getStrategy(l.id);l.refund&&o.push({id:l.id,action:"sell",isSell:!0,canSell:t.canSell(l.id),sellPrice:K.formatNumber(t.getSellPrice(l.id)),refund:`${100*l.refund}%`,title:m.getTitle(),description:m.getDescription(),iconStyle:`background-position: -${26*l.iconX}px -${26*l.iconY}px`}),o.push({id:l.id,action:"buy",isBuy:!0,isMaxed:!t.couldPurchase(l.id),buyPrice:K.formatNumber(t.getPrice(l.id)),title:m.getTitle(),description:m.getDescription(),iconStyle:`background-position: -${26*l.iconX}px -${26*l.iconY}px`})}o.length>0&&(o.reverse(),r.push({name:s.name,upgrades:o,iconStyle:`background-position: -${26*s.iconX}px -${26*s.iconY}px`}))}this.container.innerHTML=se.compile(qc)({groups:r});const i=this.container.querySelector(".backButton");i&&i.addEventListener("pointerdown",()=>{this.gameUiEm.invokeEvent(Z.SHOW_FACTORY)}),this.container.querySelectorAll(".upgradeItem").forEach(s=>{const o=s.dataset.id,u=s.dataset.action;new Ks(s,s.querySelector(".upgradePopup")).init(),s.addEventListener("pointerdown",()=>{if(u==="sell"){const l=new Yc(this.factory,o);l.canSell()&&l.sell()}else if(u==="buy"){const l=new Hc(this.factory,o);l.canBuy()&&l.buy()}this.refreshView()})}),this.game.getEventManager().addListener("upgradeUi",J.GAME_TICK,()=>this.update()),this.update()}refreshView(){const e=this.container;this.destroy(),this.display(e)}update(){const e=document.querySelector("#money");e&&(e.textContent=K.formatNumber(this.game.getMoney())),this.container.querySelectorAll(".upgradeItem").forEach(t=>{const r=t.dataset.id,i=t.dataset.action,s=this.factory.getUpgradesManager(),o=s.getUpgrade(r),u=t.querySelector(".upgradeIcon"),l=t.querySelector(".upgradePopup .bought");u&&(u.textContent=o),l&&(l.textContent=o),i==="buy"?s.couldPurchase(r)?(t.classList.remove("upgradeItemMaxed"),s.canPurchase(r)?t.classList.remove("upgradeItemCantBuy"):t.classList.add("upgradeItemCantBuy")):t.classList.add("upgradeItemMaxed"):i==="sell"&&(s.canSell(r)?t.classList.remove("upgradeItemCantSell"):t.classList.add("upgradeItemCantSell"))})}destroy(){this.game.getEventManager().removeListenerForType("upgradeUi"),this.gameUiEm.removeListenerForType("upgradeUi"),this.container&&(this.container.innerHTML=""),this.container=null}}const Vc=`<div class="achievementsBox"> <span class="backButton" id="backToReactor">Back to factory</span> <br /> {{#each achievements}} {{#if changeGroup}} <br style="clear:left" /><br /> {{/if}} <div class="item" data-id="{{id}}">\r
        <div class="icon {{icon}}" style="float:left;"></div>\r
        <div class="bonus">{{{bonus}}}</div>\r
        <div class="name"> {{name}} </div> <br />\r
        <div class="requirements"> {{{requirements}}} </div>\r
    </div> {{/each}}</div>`;class zc{constructor(e){this.gameUiEm=Ee.gameUiBus,this.game=e,this.manager=this.game.getAchievementsManager(),this.container=null}display(e){this.container=e;const t=[],r=this.game.getMeta().achievements;for(const s of r)this.manager.isVisible(s.id)&&t.push({id:s.id,name:s.name,requirements:this.manager.getTesterDescriptionText(s.id),bonus:this.manager.getBonusDescriptionText(s.id)});this.container.innerHTML=se.compile(Vc)({achievements:t});const i=this.container.querySelector(".backButton");i&&i.addEventListener("pointerdown",()=>this.gameUiEm.invokeEvent(Z.SHOW_FACTORY)),this.game.getEventManager().addListener("achievementsUi",J.ACHIEVEMENT_RECEIVED,()=>this.update()),this.update()}update(){this.container.querySelectorAll(".item").forEach(t=>{const r=t.dataset.id;this.manager.getAchievement(r)?t.classList.add("achieved"):t.classList.remove("achieved")})}destroy(){this.game.getEventManager().removeListenerForType("achievementsUi"),this.gameUiEm.removeListenerForType("achievementsUi"),this.container&&(this.container.innerHTML="",this.container=null)}}const $c='<div class="achievementPopup" id="{{idStr}}">    <span class="name">{{name}}</span>    <span class="bonus">{{{bonus}}}</span>    <br/>    <span class="requirements">{{{requirement}}}</span></div>';let yt=0;class Kr{static counter=1;constructor(e,t){this.game=e,this.achievementId=t,this.id=`achievementPopup${Kr.counter++}`,this.timeoutId=null,this.container=document.body,this.element=null}display(){const e=this.game.getMeta().achievementsById[this.achievementId],t=se.compile($c)({idStr:this.id,name:e.name,requirement:this.game.getAchievementsManager().getTesterDescriptionText(e.id),bonus:this.game.getAchievementsManager().getBonusDescriptionText(e.id)});this.container.insertAdjacentHTML("beforeend",t),this.element=document.getElementById(this.id),this.element.classList.add("popup-hidden"),this.element.addEventListener("click",()=>this.hide()),this.timeoutId=setTimeout(()=>this.hide(),8e3);const r=window.innerWidth/2-this.element.offsetWidth/2,i=150+yt*(this.element.offsetHeight+10);Object.assign(this.element.style,{left:`${r}px`,top:`${i}px`,zIndex:1e3+yt}),requestAnimationFrame(()=>{this.element.classList.remove("popup-hidden"),this.element.classList.add("popup-visible")}),yt++}hide(){this.element&&(this.element.classList.remove("popup-visible"),this.element.classList.add("popup-hidden"),this.element.addEventListener("transitionend",()=>{this.element?.remove(),this.element=null},{once:!0}),clearTimeout(this.timeoutId),yt=Math.max(0,yt-1))}}const Kc=`<div id="helpBg"></div>\r
<div id="help">\r
  <a href="javascript:void(0);" class="closeButton" style="float:right; display:block;">Close</a>\r
  <div class="menu">\r
    <a href="javascript:void(0);" data-id="gettingStarted">1. Getting started</a>\r
    <a href="javascript:void(0);" data-id="ironProduction">2. Setting up iron production</a>\r
    <a href="javascript:void(0);" data-id="labProduction">3. Setting up lab production</a>\r
    <a href="javascript:void(0);" data-id="plasticProduction">4. Setting up plastic</a>\r
    <a href="javascript:void(0);" data-id="sorter">5. Setting up sorter</a>\r
    <a href="javascript:void(0);" data-id="proTips">6. Pro tips</a>\r
    <a href="javascript:void(0);" data-id="faq">7. Frequent questions</a>\r
    <br />\r
    <br />\r
    <a href="javascript:void(0);" data-id="updates">UPDATES</a>\r
  </div>\r
  <div class="section" id="gettingStarted">\r
    <b class="title">Getting started</b>\r
    <br />\r
    <img src="img/tutorial/start.png" align="left" style="margin: 3px 6px 3px 0;" /> * <span style="color:lightblue; text-decoration:underline">Left panel contains components.</span> Click on one and then click on the map to where you would like to place it. <br />\r
    <br /> * <span style="color:lightblue; text-decoration:underline">Use conveyors</span> to connect components, so they start producing stuff. <br />\r
    <br /> * <span style="color:lightblue; text-decoration:underline">Make conveyors by click dragging</span> from inside the component to the component you want the conveyor to drop off. <br />\r
    <br /> * <span style="color:lightblue; text-decoration:underline">Sell components</span> by selecting any component from left panel and right clicking on the map to clear its footprint. <br />\r
    <br /> * <span style="color:lightblue; text-decoration:underline">Drag the map around</span> and read stats using the cursor "component". <br />\r
    <br style="clear:both" />\r
    <b class="title">Keys</b>\r
    <br /> * <u>Left click</u> - most actions, buy component etc. <br /> * <u>Right click OR SHIFT + left click/drag</u> - Sell components by selecting any component from left panel and right clicking on the map to clear its footprint. (You can hold down mouse and move around to clear whole area quickly.) <br /> * <u>SPACE</u> - Toggle mouse to last selected component and back <br />\r
    <br />\r
    <b class="title">What to expect?</b>\r
    <br /> * More challenging game play as time goes on! <br /> * Bigger and more complicated factories consisting of complicated product chains. <br /> * Joy and happiness when you make a mess! :) <br />\r
    <br />\r
    <b class="title">Offline progress?</b>\r
    <br /> If game is closed you will get bonus ticks that allow the game to be run really fast. <br />\r
    <br />\r
  </div>\r
  <div class="section" id="ironProduction">\r
    <b class="title">Setting up iron production</b>\r
    <br />\r
    <img src="img/tutorial/iron.png" align="left" style="margin: 3px 6px 3px 0;" />\r
    <br /> In the start you should produce <b class="iron">iron</b> from <b class="ironOre">iron ore</b>\r
    <br />\r
    <br /> For a 100% effective layout you need 4 iron buyers, 2 iron foundry and 1 seller. <br />\r
    <br /> Later as you research more technologies, these relationships change. For each component a chart shows how much of everything you need. <br />\r
    <br /> Depending on your upgrades, these numbers may be very odd, then use your best judgement to get the best layout :) (Like in other places you don\\'t need good judgement :p) <br />\r
    <br /> Have fun! <br style="clear:both" />\r
  </div>\r
  <div class="section" id="labProduction">\r
    <b class="title">Setting up lab production</b>\r
    <br />\r
    <img src="img/tutorial/lab.png" align="left" style="margin: 3px 6px 3px 0;" /> Labs give huge bonus to research centers, so use them as many as you can afford if you want to research new more advanced technologies. <br />\r
    <br /> Luckily for you, setting up a lab can be quite a task. Labs require many different resources to be effective, but at the same time make production chain quite costly. <br />\r
    <br style="clear:both" />\r
  </div>\r
  <div class="section" id="plasticProduction">\r
    <b class="title">Setting up plastic production</b>\r
    <br />\r
    <img src="img/tutorial/plastic.png" align="left" style="margin: 3px 6px 3px 0;" /> Plastic production is a bit more complicated, as it also produces waste. <br />\r
    <br /> Resources come out clockwise starting from top left: plastic, waste, plastic, waste and so on. Using this piece of information, you can design your layout. <br />\r
    <br /> Later sorters will help to organize waste handling, additionally you can research clean production that will remove waste completely after you get electronics. <br />\r
    <br style="clear:both" />\r
  </div>\r
  <div class="section" id="sorter">\r
    <b class="title">Sorter</b>\r
    <br />\r
    <img src="img/tutorial/sorter2.png" style="margin: 3px 6px 3px 0;" />\r
    <br />\r
    <img src="img/tutorial/sorter.png" align="left" style="margin: 3px 6px 3px 0;" />\r
    <br /> * Sorter is a safe way to sort out waste in your production lines. <br />\r
    <br /> * Sorter needs to be configured - <b>click on the sorter</b> and set which exit should transport waste (or some other resource) <br />\r
    <br />\r
  </div>\r
  <div class="section" id="proTips">\r
    <b class="title">Pro tips</b>\r
    <br />\r
    <img src="img/tutorial/orderWithNumbers.png" align="left" style="margin: 3px 6px 3px 0;" /> * Order of outputs/inputs and conveyor crossings is always <b>top -> right -> bottom -> left (clockwise)</b>. This rule works everywhere. <br />\r
    <br /> * You can construct multiple input/output lines from/to same component. Very useful if component produces more than one resource per tick. <br />\r
    <br /> * Producing 20 items over 10 ticks means you need two output lines to get 100% efficiency. <br />\r
    <br />\r
    <br style="clear:both" />\r
    <img src="img/tutorial/split.png" align="right" style="margin: 3px 6px 3px 0;" /> * Splitting conveyor path can be used to sort resources, but has limited throughput. <br />\r
    <br /> * Multiple outputs from same component can also be used for sorting, but may jam if line gets full. <br />\r
    <br /> * Ultimately you can use sorter component, but it also has its flaws. <br />\r
    <br />\r
    <br style="clear:both" />\r
  </div>\r
  <div class="section" id="faq">\r
    <b class="title">Frequently asked questions</b>\r
    <br />\r
    <b style="color:lightblue; text-decoration:underline">I found a bug</b>\r
    <br /> * You probably didn\\'t :) Think through your setup 3 times, if still seems like a bug, ask forums for a solution. Don\\'t forget that this game is designed to be more difficult and challenging than an average game in the same category. <br />\r
    <br />\r
    <b style="color:lightblue; text-decoration:underline">Why can\\'t I get 100% efficiency for a buyer</b>\r
    <br /> Check that you actually transport everything out from buyer. Sometimes one exit conveyor is not enough. <br />\r
    <br />\r
    <b style="color:lightblue; text-decoration:underline">Waste & plastic switched order</b>\r
    <br /> * It can happen if one of the lines gets full, therefore all resources would be sent to another output lines. <br />\r
    <br />\r
    <b style="color:lightblue; text-decoration:underline">Upgrade is useless.</b>\r
    <br /> Some upgrades may seem useless at some points - just don\\'t buy them yet - they will be useful later. It is wise to think which upgrades are good for you and which are not. For example sometimes buying 3 upgrades at once would mean you don\\'t need to change your layout. But buying one of them would mean you have to redesign a lot. <br /> If you bought an upgrade that changes production in a way you don\\'t like, just sell it and all good. <br />\r
    <br />\r
  </div>\r
  <div class="section" id="updates">\r
    <b class="title">Updates</b>\r
    <br />\r
    <div style="height:500px; overflow-y:scroll">\r
      <b>V1.07</b>\r
      <br /> Quite a huge update that adds a lot of new content to the game! <br /> + New very big factory - Terafactory! <br /> + A lot more upgrades... like a lot! <br /> + New late game production <br /> + New research center with new quite fun to setup production cycle. <br />\r
      <br /> As balancing late game is quite hard because of different ways how you can setup things - what do you think about the balance of new stuff? Is it too easy/too hard? <br /> Let me know at Reddit/Kongregate - what do you think! <br />\r
      <br /> If anyone wants a challenge - fit research center 4 to first map! That should be quite a challenge to do :) <br />\r
      <br />\r
      <b>V1.06</b>\r
      <br /> This is a huge balancing update! I have received a lot of feedback that it is an idle game, but still felt a bit too slow. Well now this update makes the game progress a lot faster! Depending on your progress, it can be up to 3x faster <br /> * Profits of most sellers increased a bit. <br /> * Most research is now cheaper to get. <br /> * Lots of more upgrades for late game. <br /> * 8x more offline bonus ticks. <br /> * Bonus tick purchase amounts doubled. <br /> * Fixed text/image errors in help pages. <br /> * All updates are now shown in the game help section "Updates" <br /> * If clicking load game, it will ask for confirmation <br />\r
      <br /> Premium version for factoryidle.com <br /> Acquired with any new purchase after this release or older non consumable purchases <br /> * Uses up whole screen. <br /> * No adds if you make a purchase at factoryidle.com <br />\r
      <br />\r
      <b>V1.05</b>\r
      <br /> * Metals lab and gas&oil lab does not produce waste anymore. Check your builds, as probably you are sending now some stuff to waste. <br /> * Late game balancing updates. (diesel sells with much better price, rockets research cheaper.) <br />\r
      <br />\r
      <b>V1.04</b>\r
      <br /> * background mode delay changed to 15sec. Previously was 2 minutes. <br /> * smaller UI fixes <br /> * Safari bugfix <br /> * Fixed bug with avg calculation that caused it to overshoot often and then stabilizing a bit later to lower value. Special thanks to Tiogshi who actually debugged and pointed this out! Wow! <br />\r
      <br />\r
      <b>V1.03</b>\r
      <br /> * If output/input of the component is changed, it clears its contents. This makes output order of items less random (though it never was random) <br /> * button that opens whole map on new tab for screenshot or just for viewing. <br /> * Game tells how many output conveyors element should have. Should make planning easier. <br /> * new components and lots of new upgrades. Seriously, lots of upgrades added. New final component is rockets.. really, rockets! <br />\r
      <br />\r
      <b>V1.02</b>\r
      <br /> * Max stock of all elements except research related is increased by 4 times. Components store maximum of 20 production cycles worth of items, in most cases 200 ticks. <br /> * Sorters are 2x more effective, basically one sorter can handle one fully loaded line. This is experimental, lets see how it works out. It is still more effective to use splits as they use less room. <br /> * Cursor component will sell if right clicked. <br /> * Increased add watching bonus ticks amount to 1000 <br /> * When running bonus ticks, it will show actual ticks/sec value. As in many cases UI makes it slower, added ticks per sec value to factories view also for longer bonus ticks runs. <br /> * Fixed not seeing saved games. It happened because session key expired if game was running more than 24 hours straight and after that cloud save didnt work + you didnt see your saves. It now automatically refreshes session. <br />\r
    </div>\r
  </div>\r
</div>`;class jc{constructor(e){this.gameUiEm=Ee.gameUiBus,this.game=e,this.isVisible=!1,this.helpElement=null,this.helpBg=null,this.menuSections={}}init(){return this.gameUiEm.addListener("help",Z.SHOW_HELP,()=>this.display()),this}display(){if(this.isVisible)return;if(this.isVisible=!0,!this.helpElement){if(document.body.insertAdjacentHTML("beforeend",se.compile(Kc)({})),this.helpElement=document.getElementById("help"),this.helpBg=document.getElementById("helpBg"),!this.helpElement||!this.helpBg)return;const t=document.documentElement.offsetWidth;this.helpElement.style.left=`${(t-this.helpElement.offsetWidth)/2}px`;const r=this.helpElement.querySelector(".closeButton");r&&r.addEventListener("click",()=>this.hide()),this.helpElement.querySelectorAll(".menu a").forEach(s=>{const o=s.getAttribute("data-id"),u=this.helpElement.querySelector(`#${o}`);u&&(this.menuSections[o]=u,s.addEventListener("click",()=>{Object.values(this.menuSections).forEach(l=>l.classList.remove("visible")),u.classList.add("visible")}))}),this.helpBg.addEventListener("click",()=>this.hide())}this.helpElement.style.display="block",this.helpElement.style.opacity="1",this.helpBg&&(this.helpBg.style.display="block",this.helpBg.style.opacity="1");const e=this.helpElement.querySelector("#gettingStarted");e&&e.classList.add("visible")}hide(){!this.isVisible||!this.helpElement||(this.isVisible=!1,Object.values(this.menuSections).forEach(e=>e.classList.remove("visible")),this.helpBg&&(this.helpBg.style.opacity="0",this.helpBg.style.display="none"),this.helpElement.style.opacity="0",this.helpElement.style.display="none")}destroy(){this.helpElement&&(this.helpElement.remove(),this.helpElement=null),this.helpBg&&(this.helpBg.remove(),this.helpBg=null),this.menuSections={},this.game.getEventManager().removeListenerForType("help"),this.gameUiEm.removeListenerForType("help")}}const Qc=`<div class="statisticsBox">\r
  <span class="backButton" id="backToReactor">Back to factory</span> Expenses <table>\r
    <tr>\r
      <td>Component</td>\r
      <td>Count</td>\r
      <td>Avg effectiveness</td>\r
      <td>Running costs</td>\r
      <td>Purchases</td>\r
    </tr>\r
  </table> Income <table>\r
    <tr>\r
      <td>Component</td>\r
      <td>Count</td>\r
      <td>Avg efficiency</td>\r
      <td>Sales</td>\r
    </tr>\r
  </table> Resources <table>\r
    <tr>\r
      <td>Resource</td>\r
      <td>Total produced</td>\r
    </tr>\r
  </table>\r
  <div class="graph" style="height:900px;"></div>\r
</div>`;class Jc{constructor(e,t){this.gameUiEm=Ee.gameUiBus,this.factory=e,this.imageMap=t,this.game=e.getGame(),this.manager=this.game.getAchievementsManager(),this.container=null}display(e){this.container=e,this.container.insertAdjacentHTML("beforeend",se.compile(Qc)({})),this.container.querySelector(".backButton").addEventListener("pointerdown",()=>{this.gameUiEm.invokeEvent(Z.SHOW_FACTORY)}),this.game.getEventManager().addListener("statisticsUi",J.GAME_TICK,()=>{this.update()});const t=new Qs(this.factory).buildTree("ironSeller",100);new js(t,this.imageMap).display(this.container.querySelector(".graph")),this.update()}update(){}destroy(){this.game.getEventManager().removeListenerForType("statisticsUi"),this.gameUiEm.removeListenerForType("statisticsUi"),this.container&&(this.container.innerHTML="",this.container=null)}}const Zc=`<div id="purchasesBg"></div>\r
<div id="purchases">\r
  <a href="javascript:void(0);" class="closeButton" style="float:right; display:block;">Close</a>\r
  <b>Extra</b>\r
  <br />\r
  <br /> I really like making games and have been building them from my free time for a very long time. (Check my games) <br /> But as making games is very time consuming (I have two young children and a full time job at a startup. So if you can relate, imagine that :p), I highly appreciate any support - would it be ideas, comments, criticism or monetary! <br /> With this game I have good ideas on what features to add and if you like this game, I kindly ask you to show your support by making a purchase. I don\\'t expect these games to pay a salary, but to cover at least some of the time I put into making them. :) <br /> I really don\\'t like monetizing strategies games use nowadays - pay for every freaking move, so most certainly I will not follow them. <br />\r
  <br /> {{#if mainSiteVersion}}\r
    <b>Any purchase will remove ads and scales game to use whole screen. (Only if played at factoryidle.com)</b>\r
    <br /> {{/if}}\r
  <br style="clear:both" />\r
  <div class="specials"> {{#each specials}}\r
      <div class="item {{#if isBought}}boughtItem{{/if}}" data-id="{{id}}">\r
        <div class="name">{{name}}</div>\r
        <div class="description">{{{description}}}</div>\r
        <div class="buy"> {{#if isBought}}\r
            <span class="bought">Bought</span>\r
          {{else}}\r
            <a href="javascript:void(0);" data-purchaseId="{{id}}" class="button">Get it!</a> {{/if}}\r
        </div>\r
        <div class="price">{{#if isBought}}&nbsp;{{else}}{{priceStr}}{{/if}}</div>\r
      </div>\r
    {{/each}}\r
  </div>\r
  <br style="clear:both;" />\r
  <table class="timeTravelTable listTable">\r
    <tr>\r
      <td colspan="4" class="title">Time travel</td>\r
    </tr>\r
    <tr>\r
      <td colspan="4" class="description">Each ticket gives you <b>3 hour</b> income and research points. <br />You can use them any time you like after the purchase. </td>\r
    </tr> {{#each timeTravelTickets}}\r
      <tr class="item" data-id="{{id}}">\r
        <td width="150">{{name}}</td>\r
        <td width="40">{{priceStr}}</td>\r
        <td class="comment">{{description}}</td>\r
        <td width="50">\r
          <a href="javascript:void(0);" data-purchaseId="{{id}}" class="button">Get it!</a>\r
        </td>\r
      </tr>\r
    {{/each}}\r
  </table>\r
  <table class="bonusTicksTable listTable">\r
    <tr>\r
      <td colspan="4" class="title">\r
        <b>Bonus ticks</b>\r
      </td>\r
    </tr>\r
    <tr>\r
      <td colspan="4" class="description">Makes game ticks run really fast - <b>up to 200ticks/sec</b>\r
        <br />(Ticks run fastest if game runs in background mode - not focused)\r
      </td>\r
    </tr> {{#each bonusTicks}}\r
      <tr class="item" data-id="{{id}}">\r
        <td width="150">{{name}}</td>\r
        <td width="40">{{priceStr}}</td>\r
        <td class="comment">{{description}}</td>\r
        <td width="50">\r
          <a href="javascript:void(0);" data-purchaseId="{{id}}" class="button">Get it!</a>\r
        </td>\r
      </tr>\r
    {{/each}}\r
  </table>\r
  <br style="clear:both" />\r
  <br />\r
  <span style="font-size:0.9em; color:gray">* If you have problems with purchases, write to <a href="mailto:factoryidle@inditel.ee" style="color:gray" target="_blank">factoryidle@inditel.ee</a>. Please attach your user key. </span>\r
</div>`;class eu{constructor(e){this.gameUiEm=Ee.gameUiBus,this.play=e,this.purchasesManager=this.play.getPurchasesManager(),this.bg=null,this.element=null}init(){return this.gameUiEm.addListener("purchases",Z.SHOW_PURCHASES,()=>{this.display()}),this}display(){const e=Xr.identifySite(),t=this.play.getMeta(),r={mainSiteVersion:e==="localhost"||e==="direct"};for(const i in t.productsLayout){const s=t.productsLayout[i];r[i]=[];for(const o of s){const u=t.productsById[o];this.purchasesManager.isVisible(u.id)&&r[i].push({isItem:!0,id:u.id,name:u.name,description:u.description,priceStr:u.priceStr[this.purchasesManager.getPriceKey()],isBought:this.purchasesManager.getIsUnlocked(u.id)})}}document.body.insertAdjacentHTML("beforeend",se.compile(Zc)(r)),this.bg=document.getElementById("purchasesBg"),this.element=document.getElementById("purchases"),this.element.style.left=`${(document.documentElement.offsetWidth-this.element.offsetWidth)/2}px`,this.element.querySelector(".closeButton").addEventListener("click",()=>this.hide()),this.element.querySelectorAll(".item").forEach(i=>{i.addEventListener("click",s=>{const o=s.currentTarget.getAttribute("data-id");this.purchasesManager.getIsUnlocked(o)||this.purchasesManager.startPurchase(o,()=>{this.hide(),this.display()})})}),this.bg.addEventListener("click",()=>this.hide())}hide(){this.element&&(this.element.remove(),this.element=null),this.bg&&(this.bg.remove(),this.bg=null)}destroy(){this.hide(),this.gameUiEm.removeListenerForType("purchases")}}const tu=`<div id="settingsBg"></div>\r
<div id="settings">\r
  <a href="javascript:void(0);" class="closeButton" style="float:right; display:block;">Close</a>\r
  <b class="title">User key</b>\r
  <br /> This is your unique user key. Keep it safe and have a backup! <br /> There is no way to restore your game if this key gets lost! <br />\r
  <input type="text" class="userHash" id="userHash" value="{{userHash}}" name="userHash" readonly="readonly" />\r
  <a href="javascript:void(0)" id="copyToClipboardButton">Click here to copy to clipboard</a> or select user id and press CTRL+C (windows) or CMD+C (mac) to copy it. <br />\r
  <br />\r
  <b class="title">Save </b>\r
  <br /> Use manual save if you want to experiment and might need to get your game back to earlier state. Game <b>auto saves</b> to your computer every {{localSaveInterval}} and to cloud every {{cloudSaveInterval}}. <br /> {{#each saveSlots}}\r
    <div class="saveSlot">\r
      <b>{{name}}</b>\r
      <br />\r
      <input type="button" class="saveToSlot" data-id="{{id}}" value="Save" />\r
      <br />\r
      <br />\r
      {{#if hasSave}} {{lastSave}}\r
        <br /> Ticks: <b>{{ticks}}</b>\r
        <br />\r
        <input type="button" class="loadSlot" data-id="{{id}}" value="Load" />\r
      {{else}} No save exists on <br /> this slot yet <br />\r
      {{/if}}\r
    </div>\r
  {{/each}}\r
  <br style="clear:both" /> {{#if devMode}}\r
    <b class="title">Load from data</b>\r
    <br />\r
    <input type="text" id="loadData" />\r
    <input type="button" id="loadDataButton" value="Load data">\r
    <br style="clear:both" /> {{/if}}\r
  <br />\r
  <b class="title">Switch user key</b>\r
  <br /> If you have existing user key, copy it here and click update. <br /> This will reload the page with new account. <br />\r
  <br />\r
  <input type="text" class="updateUserHash" id="updateUserHash" value="" name="updateUserHash" />\r
  <input type="button" name="updateUserHashButton" id="updateUserHashButton" value="Update" />\r
  <br />\r
  <br />\r
  <b class="title">Reset</b>\r
  <br />\r
  <b class="red">Resets the game. </b> You have been warned! <br /> Notice that: <br /> * Manual saves will not be deleted and can be used to restore the game <br /> * If you have made purchases, you keep unlocks like faster ticks, but lose consumed items like bonus ticks <br />\r
  <br />\r
  <input type="button" name="resetGame" id="resetGame" value="Reset whole game - you lose all progress!" />\r
  <div style="float:right">Version 1.07</div>\r
  <br />\r
</div>`,ru='<div class="loadingBg" id="{{idBg}}"></div><div class="loading" id="{{id}}">    <center>    <img src="img/loader.gif" class="icon"/><br />    <span class="message">{{{title}}}</span>    </center></div>';class iu{static centerElement(e,t={vertical:!0,horizontal:!0}){const r=window.innerWidth,i=window.innerHeight;t.horizontal&&(e.style.left=`${Math.round((r-e.offsetWidth)/2)}px`),t.vertical&&(e.style.top=`${Math.round((i-e.offsetHeight)/2)}px`)}}let su=0;class nu{constructor(e="Loading..."){this.title=e,this.id=`loading${su++}`,this.idBg=`${this.id}Bg`,this.container=null,this.element=null,this.bg=null,this.clickCallback=null}setClickCallback(e){return this.clickCallback=e,this}display(){return document.body.insertAdjacentHTML("beforeend",se.compile(ru)({id:this.id,idBg:this.idBg,title:this.title})),this.element=document.getElementById(this.id),this.bg=document.getElementById(this.idBg),iu.centerElement(this.element),requestAnimationFrame(()=>{this.element.classList.add("visible"),this.bg.classList.add("visible")}),this.clickCallback&&this.bg.addEventListener("click",()=>{this.clickCallback(),this.hide()}),this}hide(){if(!this.element||!this.bg)return;this.element.classList.remove("visible"),this.bg.classList.remove("visible");const e=t=>{if(!t)return;const r=parseFloat(getComputedStyle(t).transitionDuration)*1e3;setTimeout(()=>t.remove(),r)};e(this.element),e(this.bg)}}function ou(p,e=!1){if(!p)return"";let t=p.getFullYear(),r=p.getMonth()+1,i=p.getDate(),s=p.getHours(),o=p.getMinutes(),u=p.getSeconds();e&&(t=p.getUTCFullYear(),r=p.getUTCMonth()+1,i=p.getUTCDate(),s=p.getUTCHours(),o=p.getUTCMinutes(),u=p.getUTCSeconds());const l=m=>m<10?"0"+m:m;return`${t}.${l(r)}.${l(i)} ${l(s)}:${l(o)}:${l(u)}`}class au{constructor(e,t,r,i){this.play=e,this.game=t,this.gameUiEm=this.game.getEventManager(),this.userHash=r,this.saveManager=i,this.isVisible=!1,this.bg=null,this.element=null}init(){return this.gameUiEm.addListener("settingsUi",Z.SHOW_SETTINGS,()=>{this.display()}),this}display(){if(this.isVisible)return;let e=!1;const t=new nu().setClickCallback(()=>{e=!0}).display();this.saveManager.getSavesInfo(["slot1","slot2","slot3"],r=>{e||(t.hide(),this._display(r))})}_display(e){const t=Array.from({length:3},(r,i)=>{const s=i+1,o=e[`slot${s}`];return{id:`slot${s}`,name:`Slot ${s}`,hasSave:!!o,lastSave:o?ou(new Date(o.timestamp*1e3),!1):"-",ticks:o?o.ver:"-"}});document.body.insertAdjacentHTML("beforeend",se.compile(tu)({userHash:this.userHash.toString(),cloudSaveInterval:Math.ceil(this.saveManager.getCloudSaveInterval()/6e4)+" minutes",localSaveInterval:Math.ceil(this.saveManager.getLocalSaveInterval()/1e3)+" seconds",saveSlots:t,devMode:this.play.isDevMode()})),this.bg=document.getElementById("settingsBg"),this.element=document.getElementById("settings"),this.isVisible=!0,this.element.style.left=`${(document.documentElement.offsetWidth-this.element.offsetWidth)/2}px`,this.element.querySelector(".closeButton").addEventListener("click",()=>this.hide()),this.element.querySelector("#userHash").addEventListener("click",r=>{r.target.setSelectionRange(0,r.target.value.length)}),this.element.querySelector("#updateUserHashButton").addEventListener("click",()=>{const r=this.element.querySelector("#updateUserHash").value;r&&(this.userHash.updateUserHash(r),window.location.reload())}),this.element.querySelector("#copyToClipboardButton").addEventListener("click",async()=>{const r=this.element.querySelector("#userHash");r.select();try{await navigator.clipboard.writeText(r.value),console.log("Copied to clipboard successfully!")}catch(i){console.log("Failed to copy: ",i)}}),this.element.querySelectorAll(".saveToSlot").forEach(r=>{r.addEventListener("click",i=>{const s=i.currentTarget.dataset.id;this.saveManager.saveManual(s,()=>this.hide())})}),this.element.addEventListener("click",r=>{const i=r.target.closest(".loadSlot");if(!i)return;const s=i.dataset.id;new fr("Load game","Are you sure you want to load game?").setCancelTitle("Yes, load game").setOkTitle("Nooooo!!!").setCancelCallback(()=>{this.saveManager.loadManual(s,()=>{this.hide(),this.gameUiEm.invokeEvent(Z.SHOW_FACTORIES)})}).display()}),this.element.querySelector("#loadDataButton").addEventListener("click",()=>{const r=this.element.querySelector("#loadData").value;this.saveManager.updateGameFromSaveData({data:r}),this.hide(),this.gameUiEm.invokeEvent(Z.SHOW_FACTORIES)}),this.element.querySelector("#resetGame").addEventListener("click",()=>{new fr("Reset game","Are you sure you want to reset the game?").setCancelTitle("Yes, RESET GAME").setOkTitle("Nooooo!!!").setCancelCallback(()=>{ke.reset(!0),this.destroy()}).display()}),this.bg.addEventListener("click",()=>this.hide())}hide(){this.isVisible=!1,this.element?.remove(),this.bg?.remove()}destroy(){this.hide(),this.game.getEventManager().removeListenerForType("settingsUi"),this.gameUiEm.removeListenerForType("settingsUi")}}const cu=`<div id="timeTravelBg"></div>\r
<div id="timeTravel">\r
  <a href="javascript:void(0);" class="closeButton" style="float:right; display:block;">Close</a>\r
  <b>Time travel</b>\r
  <br />\r
  <br /> Travel quickly through space and time to build your empire faster. <br /> Each ticket will give you <b>3 hour</b> income and research points. <br />\r
  <br /> You have <b class="tickets">{{tickets}}</b> tickets for time travel! <br />\r
  <a href="javascript:void(0);" class="getMore">Get more tickets</a>\r
  <br style="clear:both" />\r
  <br /> If you travel now you will pass <b>{{ticks}}</b> ticks and get: <br />\r
  <span class="money">\r
    <b>\${{profit}}</b> ( <b>\${{profitPerTick}}</b> per tick) </span>\r
  <br />\r
  <span class="research">\r
    <b>{{researchPoints}}</b> research points ( <b>{{researchPointsPerTick}}</b> per tick) </span>\r
  <br />\r
  <span class="comment"> These are your combined avg incomes from all factories. <br /> It might be wise to wait until your factories balance <a href="javascript:void(0)" class="refresh">refresh</a>\r
  </span>\r
  <br /> {{#if hasTickets}}\r
    <br />\r
    <a href="javascript:void(0);" class="travel">Use 1 ticket and travel to the future!</a>\r
    <br style="clear:both" />\r
  {{else}}\r
    <br /> Unfortunately you don\\'t have any tickets... {{/if}}\r
</div>`;class uu{constructor(e){this.gameUiEm=Ee.gameUiBus,this.play=e,this.game=e.getGame(),this.isVisible=!1,this.element=null,this.bg=null}init(){return this.gameUiEm.addListener("timeTravelUi",Z.SHOW_TIME_TRAVEL,()=>this.display()),this}display(){if(this.isVisible)return;const e=new Js(this.game,3600*this.play.getMeta().timeTravelTicketValue);if(document.body.insertAdjacentHTML("beforeend",se.compile(cu)({tickets:this.game.getTicker().getTimeTravelTickets(),hasTickets:this.game.getTicker().getTimeTravelTickets()>0,ticks:K.formatNumber(e.getTicks()),profit:K.formatNumber(e.getProfit()),profitPerTick:K.formatNumber(Math.round(e.getProfit()/e.getTicks())),researchPoints:K.formatNumber(e.getResearchPoints()),researchPointsPerTick:K.formatNumber(Math.round(e.getResearchPoints()/e.getTicks()))})),this.isVisible=!0,this.element=document.getElementById("timeTravel"),this.bg=document.getElementById("timeTravelBg"),!this.element)return;const t=document.documentElement.offsetWidth;this.element.style.left=`${(t-this.element.offsetWidth)/2}px`;const r=this.element.querySelector(".getMore");r&&r.addEventListener("click",()=>{this.gameUiEm.invokeEvent(Z.SHOW_PURCHASES),this.hide()});const i=this.element.querySelector(".travel");i&&i.addEventListener("click",()=>{e.canPassTime()?(e.passTime(),this.hide(),this.display()):alert("You don't have a ticket for time travel!")});const s=this.element.querySelector(".refresh");s&&s.addEventListener("click",()=>{this.hide(),this.display()});const o=this.element.querySelector(".closeButton");o&&o.addEventListener("click",()=>this.hide()),this.bg&&this.bg.addEventListener("click",()=>this.hide())}hide(){this.isVisible&&(this.isVisible=!1,this.element&&(this.element.remove(),this.element=null),this.bg&&(this.bg.remove(),this.bg=null))}destroy(){this.hide(),this.game.getEventManager().removeListenerForType("timeTravelUi"),this.gameUiEm.removeListenerForType("timeTravelUi")}}class lu{constructor(e,t){this.globalUiEm=He,this.gameUiEm=Ee.gameUiBus,this.play=e,this.game=e.getGame(),this.imageMap=t,this.focusInterval=null,this.currentUi=null}display(e){this.game.getMeta().isMission&&this.game.init(),this.container=e,this.setupEvents(),this.helpUi=new jc().init(),this.purchasesUi=new eu(this.play).init(),this.settingsUi=new au(this.play,this.game,this.play.getUserHash(),this.play.getSaveManager()).init(),this.timeTravelUi=new uu(this.play).init(),this._showUi("factories"),this.game.getMeta().isMission&&this.gameUiEm.invokeEvent(Z.SHOW_FACTORY,"mission")}setupEvents(){let e=null;this.gameUiEm.addListener("GameUi",Z.SHOW_FACTORY,t=>{t??=e,e=t,this._showUi("factory",t)}),this.gameUiEm.addListener("GameUi",Z.SHOW_FACTORIES,()=>this._showUi("factories")),this.gameUiEm.addListener("GameUi",Z.SHOW_RESEARCH,()=>this._showUi("research")),this.gameUiEm.addListener("GameUi",Z.SHOW_UPGRADES,t=>{t??=e,e=t,this._showUi("upgrades",t)}),this.gameUiEm.addListener("GameUi",Z.SHOW_ACHIEVEMENTS,()=>this._showUi("achievements")),this.gameUiEm.addListener("GameUi",Z.SHOW_STATISTICS,()=>this._showUi("statistics",e)),this.game.getEventManager().addListener("GameUi",J.ACHIEVEMENT_RECEIVED,t=>{new Kr(this.game,t).display()}),this.globalUiEm.addListener("GameUi",Pe.FOCUS,()=>this.game.getEventManager().invokeEvent(J.FOCUS)),this.globalUiEm.addListener("GameUi",Pe.BLUR,()=>this.game.getEventManager().invokeEvent(J.BLUR))}_showUi(e,t){switch(this._destroyCurrentUi(),e){case"factory":this.currentUi=new Nc(this.game.getFactory(t),this.play,this.imageMap);break;case"factories":this.currentUi=new rc(this.game);break;case"research":this.currentUi=new Fc(this.game);break;case"upgrades":this.currentUi=new Wc(this.game.getFactory(t));break;case"achievements":this.currentUi=new zc(this.game);break;case"statistics":this.currentUi=new Jc(this.game.getFactory(t),this.imageMap);break}this.currentUi?.display(this.container)}_destroyCurrentUi(){this.currentUi&&(this.currentUi.destroy(),this.currentUi=null)}destroy(){this._destroyCurrentUi(),this.helpUi?.destroy(),this.purchasesUi?.destroy(),this.settingsUi?.destroy(),this.timeTravelUi?.destroy(),this.game.getMeta().isMission&&this.game.destroy(),this.globalUiEm.removeListenerForType("GameUi"),this.gameUiEm.removeListenerForType("GameUi"),this.game.getEventManager().removeListenerForType("GameUi"),this.container=null,this.focusInterval&&clearInterval(this.focusInterval)}}const hu=`<div class="runningInBackgroundInfoUiBg" id="runningInBackgroundInfoUi"></div>\r
<div class="runningInBackgroundInfoUi"> <b>Background mode active</b><br /> <br /> Don\\'t worry, game runs at <b\r
        class="green">normal speed</b>, just uses a lot less CPU (power) thanks to not updating some graphical\r
    elements.<br /> <br /> <span class="green">Just focus (click) the game to deactivate</span></div>`;class du{constructor(){this.globalUiEm=He,this.timer=null,this.container=null,this.containerElement=null,this.backgroundElement=null,this.templateHtml=null}init(){this.globalUiEm.addListener("RunningInBackgroundInfoUi",Pe.FOCUS,()=>this.hide()),this.globalUiEm.addListener("RunningInBackgroundInfoUi",Pe.BLUR,()=>this.delayedDisplay())}destroy(){this.globalUiEm.removeListenerForType("RunningInBackgroundInfoUi")}delayedDisplay(e=15e5){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>this.display(),e)}display(e={}){this.container=document.body;const t=se.compile(hu)(e),r=document.createElement("div");r.innerHTML=t,this.container.appendChild(r),this.backgroundElement=r.querySelector(".runningInBackgroundInfoUiBg"),this.containerElement=r.querySelector(".runningInBackgroundInfoUi");const i=this.container.offsetWidth/2-this.containerElement.offsetWidth/2;Object.assign(this.containerElement.style,{position:"absolute",left:`${i}px`,top:"150px"}),this.backgroundElement.style.display="none",this.containerElement.style.display="none",this.backgroundElement.style.transition="opacity 0.5s",this.containerElement.style.transition="opacity 0.5s",requestAnimationFrame(()=>{this.backgroundElement.style.display="",this.backgroundElement.style.opacity=1,this.containerElement.style.display="",this.containerElement.style.opacity=1})}hide(){this.timer&&clearTimeout(this.timer),this.backgroundElement&&(this.backgroundElement.remove(),this.backgroundElement=null),this.containerElement&&(this.containerElement.remove(),this.containerElement=null)}}const pu=`<div id="introBg"></div>\r
<div id="intro">\r
  <b class="title">FACTORY IDLE</b>\r
\r
  <p>\r
 Welcome to the crazy world of <b>factory idle</b>!\r
  </p>\r
\r
  <p>\r
    Your goal here is to build an <b style="color:greenyellow">automated factory</b> \r
    with many <b style="color:greenyellow">production chains</b>. \r
    You start with simple stuff and later produce \r
    <b style="color:rgb(150,181,134)">high quality military technology</b>, like tanks and rockets! Seriously, high quality!\r
  </p>\r
\r
  <p>\r
    Path to complicated products is <u style="color:red">not an easy one</u> though, so be warned! \r
    There will be great challenges ahead waiting for you! Check <b style="color:yellow">help section</b> for good ideas.\r
  </p>\r
\r
  <p>\r
    <b>Disclaimer</b>: This game is <b style="color:red; text-decoration:underline">harder than an average</b> idle game \r
    and requires you to turn on a <u style="color:orange">brain</u>. If you have more than one, turn them all ON! Overheat warning!\r
  </p>\r
\r
  <a href="javascript:void(0);" class="closeButton">Ok, got it and I will not sue anyone!</a>\r
  <span class="note">(except factory workers, always sue them for messing up your conveyors!)</span>\r
</div>\r
`;class mu{constructor(){this.isVisible=!1,this.container=document.body,this.templateHtml=null,this.menuMap={}}display(e={}){if(this.isVisible)return;document.body.insertAdjacentHTML("beforeend",se.compile(pu)(e)),this.isVisible=!0;const t=document.querySelector("#intro"),r=document.querySelector("#introBg"),i=(document.documentElement.clientWidth-t.offsetWidth)/2;t.style.position="absolute",t.style.left=`${i}px`;const s=t.querySelector(".closeButton");s&&s.addEventListener("pointerdown",()=>this.hide()),t.querySelectorAll(".menu a").forEach(l=>{const m=l.dataset.id,h=t.querySelector(`#${m}`);!m||!h||(this.menuMap[m]=h,l.addEventListener("pointerdown",()=>{Object.values(this.menuMap).forEach(f=>f.style.display="none"),h.style.display="block"}))});const u=t.querySelector("#gettingStarted");u&&(u.style.display="block"),r&&r.addEventListener("click",()=>this.hide())}hide(){if(!this.isVisible)return;const e=document.querySelector("#intro"),t=document.querySelector("#introBg");e&&e.remove(),t&&t.remove(),this.isVisible=!1,this.menuMap={}}destroy(){this.hide(),this.game?.getEventManager&&this.game.getEventManager().removeListenerForType("intro"),this.gameUiEm?.removeListenerForType&&this.gameUiEm.removeListenerForType("intro")}}class Xu{constructor(e,t){this.play=e,this.imageMap=t,this.globalUiEm=He}setupFocusChecker(){let e=document.hasFocus();this.focusInterval=setInterval(()=>{const t=document.hasFocus();e!==t&&(e=t,e?this.globalUiEm.invokeEvent(Pe.FOCUS):this.globalUiEm.invokeEvent(Pe.BLUR))},200)}display(e){this.container=e,this.runningInBackgroundInfoUi=new du(this.globalUiEm),this.runningInBackgroundInfoUi.init();const t=this.play.getGame().getTicker(),r=new mu,i=Date.now(),s=()=>{const o=Date.now()-i;t.getNoOfTicks()<1e3&&o>=100&&(r.display(),this.play.getGame().getEventManager().removeListener("MainUi",J.TICKS_STARTED,s))};this.play.getGame().getEventManager().addListener("MainUi",J.TICKS_STARTED,s),this.setupFocusChecker(),this.play.getGame().getIsPremium()&&console.info("MainUi: Premium version, skipping loading ads"),window.addEventListener("keypress",o=>{this.globalUiEm.invokeEvent(Pe.KEY_PRESS,o)}),window.addEventListener("beforeunload",()=>{this.play.getSaveManager().saveAuto()}),this.globalUiEm.addListener("MainUi",Pe.SHOW_MAIN_GAME,()=>{this._showUi("mainGame")}),this.play.getGame().getEventManager().addListener("MainUi",J.GAME_TICK,()=>{const o=this.play.getGame().getTicker().getNoOfTicks();if(qe.meta.warnToStoreUserHashAfterTicks[o]){const u=`userHashTmpAlert${Math.round(1e10*Math.random())}`,l=`
                    You seem to be enjoying the game! Here is a good tip that maybe will save the day once!<br/>
                    Make a copy of your user hash. User hash is used to find your save game and purchases if you have any.<br/>
                    Your user hash: 
                    <input type="text" readonly id="${u}" value="${this.play.getUserHash()}" 
                        style="border:1px solid red; background:black; color:red; font-weight:bold; padding:4px; margin:3px; width:280px; font-size:0.9em; text-align:center;"/><br/>
                    Ignore this reminder if you already did and have fun!<br/>
                `;new vr("SAVE USER HASH TO A SAFE PLACE!",l).display();const m=document.getElementById(u);m.addEventListener("click",()=>{m.setSelectionRange(0,m.value.length)})}}),this._showUi("mainGame")}_showUi(e,t){this._destroyCurrentUi(),e==="mainGame"&&(this.currentUi=new lu(this.play,this.imageMap)),this.currentUi.display(this.container)}_destroyCurrentUi(){this.currentUi&&(this.currentUi.destroy(),this.currentUi=null)}destroy(){this.runningInBackgroundInfoUi.destroy(),this.globalUiEm.removeListenerForType("MainUi"),this.play.getGame().getEventManager().removeListenerForType("MainUi"),this.container=null,clearInterval(this.focusInterval)}}class gu{constructor(){this.play=null,this.imageMap=Ga,this.mainUi=null}async init(e=!1){try{console.log("Main: Starting initialization..."),console.log("Main: Loading images..."),await this.imageMap.loadAllAsync(),console.log("Main: Images loaded successfully"),console.log("Main: Initializing Play..."),this.play=new ba,await new Promise(t=>this.play.init(e,t)),console.log("Main: Play initialized successfully"),this.play.isDevMode(),console.log("Main: Initializing UI..."),this.mainUi=new Xu(this.play,this.imageMap),this.mainUi.display(document.getElementById("gameArea")),console.log("Main: UI initialized successfully")}catch(t){throw console.error("Main: Initialization failed:",t),t}}destroy(){console.log("Main destroyed1",this),this.mainUi?.destroy(),this.play?.destroy(),console.log("Main destroyed2",this)}}class ke{static mainInstance=null;static async init(e=!1){return this.mainInstance?console.log("MainSingleton.init called but instance already exists"):(this.mainInstance=new gu,await this.mainInstance.init(e)),this.mainInstance}static getInstance(){if(!ke.mainInstance)throw new Error("MainSingleton not initialized yet. Call init() first.");return ke.mainInstance}static destroy(){try{const e=ke.mainInstance;if(!e)return;console.log("MainSingleton: Destroying..."),document.querySelectorAll("#intro, #introBg").forEach(t=>t.remove()),e.mainUi?.destroy(),e.play?.destroy(),e.globalUiEm?.removeAllListeners?.(),e.play?.em?.removeAllListeners?.(),e.focusInterval&&clearInterval(e.focusInterval),e.saveManager?.destroy?.(),e.runningInBackgroundInfoUi?.destroy?.(),ke.mainInstance=null}catch{console.log("MainSingleton.destroy failed")}}static async reset(e=!1){return console.log(ke.mainInstance),console.log("MainSingleton.reset called"),ke.destroy(),console.log(ke.mainInstance),await ke.init(e)}}const pr={get messageEl(){return document.getElementById("loadingMessage")},get bgEl(){return document.getElementById("initialLoaderBg")},get loaderEl(){return document.getElementById("initialLoader")},showMessage(p){this.messageEl&&(this.messageEl.textContent=p)},hide(){this.loaderEl&&(this.loaderEl.style.display="none"),this.bgEl&&(this.bgEl.style.display="none")}};function fu(){const p=document.createElement("canvas");return p.getContext&&p.getContext("2d")}window.addEventListener("DOMContentLoaded",async()=>{try{if(!fu()){pr.showMessage(" Your browser is too old and does not support canvas. Please update!");return}pr.showMessage("Loading game please wait"),await ke.init(!1),pr.hide(),console.log(" Game initialized successfully!")}catch(p){console.error(" Game failed to start:",p),pr.showMessage("Failed to load game modules. Check console for details.")}});
