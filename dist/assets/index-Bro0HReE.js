(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();const yt={timeTravelTicketValue:3,layout:{specials:["researchproduction","researchproduction2","extraticks","extraprofit"],bonusTicks:["bonusticks1","bonusticks2","bonusticks3","bonusticks4","bonusticks5"],timeTravelTickets:["timetravel1","timetravel2","timetravel3","timetravel4","timetravel5"]},items:[{id:"bonusticks1",idNum:1,name:"80 000 bonus ticks",description:"Getting there faster",consumable:!0,strategy:{type:"bonusTicks",amount:8e4},priceStr:{local:"1u",web:"$2.99",kongregate:"25 Kreds"}},{id:"bonusticks2",idNum:2,name:"240 000 bonus ticks",description:"+50% more",consumable:!0,strategy:{type:"bonusTicks",amount:24e4},priceStr:{local:"2u",web:"$5.99",kongregate:"50 Kreds"}},{id:"bonusticks3",idNum:3,name:"800 000 bonus ticks",description:"+200% more",consumable:!0,strategy:{type:"bonusTicks",amount:8e5},priceStr:{local:"3u",web:"$9.99",kongregate:"110 Kreds"}},{id:"bonusticks4",idNum:4,name:"2 400 000 bonus ticks",description:"+350% more",consumable:!0,strategy:{type:"bonusTicks",amount:24e5},priceStr:{local:"4u",web:"$19.99",kongregate:"225 Kreds"}},{id:"bonusticks5",idNum:5,name:"12 000 000 bonus ticks",description:"+650% more",consumable:!0,strategy:{type:"bonusTicks",amount:12e6},priceStr:{local:"5u",web:"$59.99",kongregate:"565 Kreds"}},{id:"bonusticks6",idNum:6,name:"40 000 000 bonus ticks",description:"+1145% more",consumable:!0,strategy:{type:"bonusTicks",amount:4e7},priceStr:{local:"6u",web:"$119.99",kongregate:"1150 Kreds"}},{id:"timetravel1",idNum:7,name:"1 ticket (3h)",description:"Wow, really?",consumable:!0,strategy:{type:"timeTravelTickets",amount:1},priceStr:{local:"1u",web:"$2.99",kongregate:"25 Kreds"}},{id:"timetravel2",idNum:8,name:"3 tickets  (3x3h)",description:"50% cheaper!",consumable:!0,strategy:{type:"timeTravelTickets",amount:3},priceStr:{local:"2u",web:"$5.99",kongregate:"50 Kreds"}},{id:"timetravel3",idNum:9,name:"8 tickets  (8x3h)",description:"140% cheaper!",consumable:!0,strategy:{type:"timeTravelTickets",amount:8},priceStr:{local:"3u",web:"$9.99",kongregate:"110 Kreds"}},{id:"timetravel4",idNum:10,name:"25 tickets (25x3h)",description:"270% cheaper!",consumable:!0,strategy:{type:"timeTravelTickets",amount:25},priceStr:{local:"4u",web:"$19.99",kongregate:"225 Kreds"}},{id:"timetravel5",idNum:11,name:"100 tickets (100x3h)",description:"400% cheaper!",consumable:!0,strategy:{type:"timeTravelTickets",amount:100},priceStr:{local:"5u",web:"$59.99",kongregate:"565 Kreds"}},{id:"timetravel6",idNum:12,name:"300 tickets (300x3h)",description:"650% cheaper!",consumable:!0,strategy:{type:"timeTravelTickets",amount:300},priceStr:{local:"6u",web:"$119.99",kongregate:"1150 Kreds"}},{id:"researchproduction",idNum:13,name:"Evolved brain",description:"3x research points production",consumable:!1,strategy:{type:"researchProductionBonus",bonus:3},priceStr:{local:"6u",web:"$9.99",kongregate:"110 Kreds"}},{id:"researchproduction2",idNum:14,name:"Alien brain",description:"4x research points production",consumable:!1,requiresProduct:"researchproduction",strategy:{type:"researchProductionBonus",bonus:4},priceStr:{local:"6u",web:"$9.99",kongregate:"110 Kreds"}},{id:"extraticks",idNum:15,name:"Chronobooster",description:"+8 extra ticks per second",consumable:!1,strategy:{type:"extraTicks",bonus:8},priceStr:{local:"7u",web:"$19.99",kongregate:"225 Kreds"}},{id:"extraprofit",idNum:16,name:"Tax evasion",description:"3x profit!",consumable:!1,requiresProduct:"extraticks",strategy:{type:"extraProfit",bonus:3},priceStr:{local:"7u",web:"$19.99",kongregate:"225 Kreds"}},{id:"starter1",idNum:18,name:"Starter pack",description:"8 time travel tickets + 300 000 bonus ticks",consumable:!0,special:!0,strategy:{type:"starter",timeTravelTickets:8,bonusTicks:3e5},priceStr:{local:"3u",web:"$9.99",kongregate:"110 Kreds"}},{id:"starter2",idNum:17,name:"Fun pack",description:"3 time travel tickets + 60 000 bonus ticks",consumable:!0,special:!0,strategy:{type:"starter",timeTravelTickets:3,bonusTicks:6e4},priceStr:{local:"2u",web:"$5.99",kongregate:"50 Kreds"}}]};class ve{constructor(e,t){this.componentsById=e,this.sourceBuildings=t,this.strategies={buyer:{selfCost:(i,r)=>i.strategy.interval*i.runningCostPerTick/ve.getSumOfProduction(i.strategy.purchaseResources)+i.strategy.purchaseResources[r].price,inputCost:(i,r)=>1},converter:{selfCost:i=>i.strategy.interval*i.runningCostPerTick/ve.getSumOfProduction(i.strategy.production),inputCost:(i,r)=>{const s=ve.getSumOfProduction(i.strategy.production);if(!i.strategy.inputResources[r])throw new Error(`${i.id} can't handle resources: ${r}`);return i.strategy.inputResources[r].perOutputResource/s}},seller:{selfCost:i=>i.strategy.interval*i.runningCostPerTick/ve.getSumOfProduction(i.strategy.resources),inputCost:(i,r)=>1}}}static getSumOfProduction(e){let t=0;for(const i in e)i==="waste"||e[i].bonus||(t+=e[i].amount);return t}calculateCostFor(e,t,i){const r=this.componentsById[e];let s=this.sourceBuildings[e]||{};const a=this.strategies[r.strategy.type];let u=0;const l=a.selfCost(r,t);if(r.strategy.type==="seller"){if(u+=this.calculateCostFor(s[t],t,i),r.strategy.resources[t].bonus)return i[`${e}-${t}`]={self:0,input:u,total:u},u}else for(const[h,m]of Object.entries(s))u+=this.calculateCostFor(m,h,i)*a.inputCost(r,h);const p=l+u;return i[`${e}-${t}`]={self:l,input:u,total:p},p}}const O=(d,e)=>d*Math.pow(1e3,e),be={selection:[["noComponent","transportLine","garbageCollector","sorterVertical","sorterHorizontal"],["ironBuyer","ironFoundry","ironSeller",null,"coalBuyer","steelFoundry","steelSeller"],["oilBuyer","gasBuyer","plasticMaker","plasticSeller","siliconBuyer","electronicsMaker","electronicsSeller"],["explosivesBuyer","bulletMaker","gunMaker","gunSeller"],["aluminiumBuyer","engineMaker","engineSeller"],["tankHullMaker","tankTurretMaker","tankAssembler","tankSeller","dieselRefinery"],["jetFuelRefinery","rocketHullMaker","rocketWarheadMaker","rocketAssembler"],["droneMaker","droneControlRoom","droneSeller"],["metalsLab","gasAndOilLab","analystCenter","qualityLab"],["researchCenter","researchCenter2","researchCenter3","researchCenter4"]],productionTree:{ironFoundry:{ironOre:"ironBuyer"},ironSeller:{iron:"ironFoundry"},steelFoundry:{iron:"ironFoundry",coal:"coalBuyer"},steelSeller:{steel:"steelFoundry"},plasticMaker:{oil:"oilBuyer",coal:"coalBuyer",gas:"gasBuyer"},plasticSeller:{plastic:"plasticMaker"},electronicsMaker:{silicon:"siliconBuyer",plastic:"plasticMaker"},electronicsSeller:{electronics:"electronicsMaker"},engineMaker:{aluminium:"aluminiumBuyer",steel:"steelFoundry",electronics:"electronicsMaker"},engineSeller:{engine:"engineMaker"},bulletMaker:{steel:"steelFoundry",explosives:"explosivesBuyer"},gunMaker:{steel:"steelFoundry",bullets:"bulletMaker"},gunSeller:{guns:"gunMaker"},tankHullMaker:{steel:"steelFoundry",aluminium:"aluminiumBuyer",electronics:"electronicsMaker"},tankTurretMaker:{steel:"steelFoundry",guns:"gunMaker"},tankAssembler:{tankHull:"tankHullMaker",tankTurret:"tankTurretMaker",engine:"engineMaker"},tankSeller:{tank:"tankAssembler",diesel:"dieselRefinery",rocket:"rocketAssembler"},dieselRefinery:{oil:"oilBuyer"},rocketHullMaker:{aluminium:"aluminiumBuyer",engine:"engineMaker"},rocketWarheadMaker:{aluminium:"aluminiumBuyer",electronics:"electronicsMaker",explosives:"explosivesBuyer"},rocketAssembler:{warhead:"rocketWarheadMaker",rocketHull:"rocketHullMaker",jetFuel:"jetFuelRefinery"},droneMaker:{aluminium:"aluminiumBuyer",plastic:"plasticMaker",electronics:"electronicsMaker",engine:"engineMaker",guns:"gunMaker"},droneControlRoom:{steel:"steelFoundry",electronics:"electronicsMaker"},droneSeller:{drone:"droneMaker",droneControlRoom:"droneControlRoom",jetFuel:"jetFuelRefinery",rocket:"rocketAssembler"},jetFuelRefinery:{gas:"gasBuyer"}},components:[{id:"transportLine",idNum:1,name:"Conveyor",width:1,height:1,spriteX:0,spriteY:0,iconX:1,iconY:0,drawStrategy:"track",buildByDragging:!0,canBuildToPartial:!0,runningCostPerTick:0,price:10,priceRefund:1,strategy:{type:"transport",queueSize:2}},{id:"garbageCollector",idNum:25,name:"Garbage",description:"Accepts any item and discards it as garbage.",width:1,height:1,spriteX:3,spriteY:2,iconX:2,iconY:3,runningCostPerTick:0,requiresResearch:"metalsLab",price:2500,priceRefund:.5,strategy:{type:"garbage",max:15,removeAmount:5,interval:10}},{id:"sorterVertical",idNum:36,name:"Sorter",width:1,height:3,spriteX:6,spriteY:8,iconX:7,iconY:3,runningCostPerTick:2,requiresResearch:"sorter",price:4e5,priceRefund:1,allowedInputs:{"0:1:left":!0,"0:1:right":!0},allowedOutputs:{"0:0":!0,"0:1":!0,"0:2":!0},strategy:{type:"sorter",interval:1}},{id:"sorterHorizontal",idNum:37,name:"Sorter",width:3,height:1,spriteX:3,spriteY:8,iconX:6,iconY:3,runningCostPerTick:2,requiresResearch:"sorter",price:4e5,priceRefund:1,allowedInputs:{"1:0:top":!0,"1:0:bottom":!0},allowedOutputs:{"0:0":!0,"1:0":!0,"2:0":!0},strategy:{type:"sorter",interval:1}},{id:"ironBuyer",idNum:2,name:"Iron ore buyer",width:2,height:2,spriteX:4,spriteY:0,iconX:2,iconY:0,runningCostPerTick:0,price:50,priceRefund:1,strategy:{type:"buyer",purchaseResources:{ironOre:{price:0,amount:1}},outputResourcesOrder:["ironOre"],interval:10}},{id:"ironFoundry",idNum:3,name:"Iron foundry",width:4,height:2,spriteX:0,spriteY:0,iconX:3,iconY:0,runningCostPerTick:0,price:150,priceRefund:1,requiresResearch:null,strategy:{type:"converter",inputResources:{ironOre:{perOutputResource:2}},production:{iron:{amount:1}},outputResourcesOrder:["iron"],interval:10}},{id:"ironSeller",idNum:4,name:"Iron seller",width:1,height:2,spriteX:6,spriteY:0,iconX:4,iconY:0,runningCostPerTick:0,price:100,priceRefund:1,requiresResearch:null,strategy:{type:"seller",resources:{iron:{amount:2,sellPrice:2.5,sellMargin:0}},interval:10}},{id:"coalBuyer",idNum:5,name:"Coal buyer",width:2,height:1,spriteX:0,spriteY:2,iconX:5,iconY:0,runningCostPerTick:1,price:1e3,priceRefund:1,requiresResearch:"steelComponents",strategy:{type:"buyer",purchaseResources:{coal:{price:5,amount:2}},outputResourcesOrder:["coal"],interval:10}},{id:"steelFoundry",idNum:6,name:"Steel foundry",width:3,height:3,spriteX:0,spriteY:3,iconX:6,iconY:0,runningCostPerTick:4,price:4e3,priceRefund:1,requiresResearch:"steelComponents",strategy:{type:"converter",inputResources:{iron:{perOutputResource:4},coal:{perOutputResource:4}},production:{steel:{amount:1}},outputResourcesOrder:["steel"],interval:10}},{id:"steelSeller",idNum:7,name:"Steel seller",width:2,height:2,spriteX:3,spriteY:3,iconX:7,iconY:0,runningCostPerTick:1,price:1500,priceRefund:1,requiresResearch:"steelComponents",strategy:{type:"seller",resources:{steel:{amount:2,sellPrice:0,sellMargin:.6}},interval:10}},{id:"oilBuyer",idNum:8,name:"Oil buyer",width:1,height:3,spriteX:0,spriteY:6,iconX:8,iconY:0,runningCostPerTick:8,price:4e4,priceRefund:1,requiresResearch:"plasticComponents",strategy:{type:"buyer",purchaseResources:{oil:{price:200,amount:1}},outputResourcesOrder:["oil"],interval:10}},{id:"gasBuyer",idNum:30,name:"Gas buyer",width:2,height:1,spriteX:6,spriteY:15,iconX:0,iconY:3,runningCostPerTick:6,price:6e4,priceRefund:1,requiresResearch:"plasticComponents",strategy:{type:"buyer",purchaseResources:{gas:{price:80,amount:1}},outputResourcesOrder:["gas"],interval:10}},{id:"plasticMaker",idNum:9,name:"Plastic maker",width:2,height:3,spriteX:1,spriteY:6,iconX:9,iconY:0,runningCostPerTick:20,price:24e4,priceRefund:1,requiresResearch:"plasticComponents",strategy:{type:"converter",inputResources:{oil:{perOutputResource:4},coal:{perOutputResource:4},gas:{perOutputResource:2}},production:{plastic:{amount:1},waste:{amount:1}},productionRemoveResearch:{waste:"cleanPlastic"},outputResourcesOrder:["plastic","waste"],interval:10}},{id:"plasticSeller",idNum:10,name:"Plastic seller",width:2,height:2,spriteX:3,spriteY:6,iconX:0,iconY:1,runningCostPerTick:12,price:18e4,priceRefund:1,requiresResearch:"plasticComponents",strategy:{type:"seller",resources:{plastic:{amount:1,sellPrice:0,sellMargin:.6}},interval:10}},{id:"siliconBuyer",idNum:11,name:"Silicon buyer",width:1,height:2,spriteX:0,spriteY:9,iconX:1,iconY:1,runningCostPerTick:120,price:O(50,2),priceRefund:1,requiresResearch:"electronicsComponents",strategy:{type:"buyer",purchaseResources:{silicon:{price:400,amount:1}},outputResourcesOrder:["silicon"],interval:10}},{id:"electronicsMaker",idNum:12,name:"Electronics maker",width:2,height:2,spriteX:1,spriteY:9,iconX:2,iconY:1,runningCostPerTick:300,price:O(200,2),priceRefund:1,requiresResearch:"electronicsComponents",strategy:{type:"converter",inputResources:{silicon:{perOutputResource:2},plastic:{perOutputResource:4}},production:{electronics:{amount:1},waste:{amount:1}},productionRemoveResearch:{waste:"cleanElectronics"},outputResourcesOrder:["electronics","waste"],interval:10}},{id:"electronicsSeller",idNum:13,name:"Electronics seller",width:2,height:2,spriteX:3,spriteY:9,iconX:3,iconY:1,runningCostPerTick:90,price:O(80,2),priceRefund:1,requiresResearch:"electronicsComponents",strategy:{type:"seller",resources:{electronics:{amount:1,sellPrice:0,sellMargin:2.1}},interval:10}},{id:"explosivesBuyer",idNum:17,name:"Explosives buyer",width:2,height:1,spriteX:0,spriteY:13,iconX:7,iconY:1,runningCostPerTick:1900,price:O(500,2),priceRefund:1,requiresResearch:"gunComponents",strategy:{type:"buyer",purchaseResources:{explosives:{price:900,amount:1}},outputResourcesOrder:["explosives"],interval:20}},{id:"bulletMaker",idNum:18,name:"Bullet maker",width:1,height:1,spriteX:2,spriteY:2,iconX:8,iconY:1,runningCostPerTick:3900,price:O(800,2),priceRefund:1,requiresResearch:"gunComponents",strategy:{type:"converter",inputResources:{steel:{perOutputResource:3},explosives:{perOutputResource:2}},production:{bullets:{amount:2}},outputResourcesOrder:["bullets"],interval:20}},{id:"gunMaker",idNum:19,name:"Gun maker",width:3,height:2,spriteX:0,spriteY:14,iconX:9,iconY:1,runningCostPerTick:5900,price:O(1,3),priceRefund:1,requiresResearch:"gunComponents",strategy:{type:"converter",inputResources:{steel:{perOutputResource:3},bullets:{perOutputResource:2}},production:{guns:{amount:2}},outputResourcesOrder:["guns"],interval:20}},{id:"gunSeller",idNum:20,name:"Gun seller",width:2,height:2,spriteX:3,spriteY:14,iconX:0,iconY:2,runningCostPerTick:1100,price:O(400,2),priceRefund:1,requiresResearch:"gunComponents",strategy:{type:"seller",resources:{guns:{amount:2,sellPrice:0,sellMargin:2.1}},interval:20}},{id:"aluminiumBuyer",idNum:14,name:"Aluminium buyer",width:2,height:2,spriteX:0,spriteY:11,iconX:4,iconY:1,runningCostPerTick:48e3,price:O(3,3),priceRefund:1,requiresResearch:"engineComponents",strategy:{type:"buyer",purchaseResources:{aluminium:{price:1400,amount:1}},outputResourcesOrder:["aluminium"],interval:10}},{id:"engineMaker",idNum:15,name:"Engine maker",width:4,height:3,spriteX:2,spriteY:11,iconX:5,iconY:1,runningCostPerTick:12e4,price:O(32,3),priceRefund:1,requiresResearch:"engineComponents",strategy:{type:"converter",inputResources:{aluminium:{perOutputResource:4},steel:{perOutputResource:6},electronics:{perOutputResource:3}},production:{engine:{amount:1},waste:{amount:1}},productionRemoveResearch:{waste:"cleanEngines"},outputResourcesOrder:["engine","waste"],interval:10}},{id:"engineSeller",idNum:16,name:"Engine seller",width:2,height:2,spriteX:6,spriteY:11,iconX:6,iconY:1,runningCostPerTick:8e4,price:O(8,3),priceRefund:1,requiresResearch:"engineComponents",strategy:{type:"seller",resources:{engine:{amount:1,sellPrice:0,sellMargin:2.1}},interval:10}},{id:"tankHullMaker",idNum:21,name:"Tank hull maker",width:5,height:3,spriteX:0,spriteY:16,iconX:1,iconY:2,runningCostPerTick:16e5,price:O(400,3),priceRefund:1,requiresResearch:"tankComponents",strategy:{type:"converter",inputResources:{electronics:{perOutputResource:3},steel:{perOutputResource:6},aluminium:{perOutputResource:2}},production:{tankHull:{amount:1}},outputResourcesOrder:["tankHull"],interval:10}},{id:"tankTurretMaker",idNum:22,name:"Tank turret maker",width:3,height:2,spriteX:5,spriteY:16,iconX:2,iconY:2,runningCostPerTick:2e6,price:O(800,3),priceRefund:1,requiresResearch:"tankComponents",strategy:{type:"converter",inputResources:{guns:{perOutputResource:4},steel:{perOutputResource:6}},production:{tankTurret:{amount:1}},outputResourcesOrder:["tankTurret"],interval:10}},{id:"tankAssembler",idNum:23,name:"Tank assembly",width:2,height:4,spriteX:8,spriteY:16,iconX:3,iconY:2,runningCostPerTick:18e5,price:O(700,3),priceRefund:1,requiresResearch:"tankComponents",strategy:{type:"converter",inputResources:{tankHull:{perOutputResource:1},tankTurret:{perOutputResource:1},engine:{perOutputResource:1}},production:{tank:{amount:1}},outputResourcesOrder:["tank"],interval:10}},{id:"tankSeller",idNum:26,name:"Tank seller",width:2,height:2,spriteX:5,spriteY:18,iconX:4,iconY:2,runningCostPerTick:24e5,price:O(500,3),priceRefund:1,requiresResearch:"tankComponents",strategy:{type:"seller",resources:{tank:{amount:1,sellPrice:0,sellMargin:2.1},diesel:{amount:8,sellPrice:0,sellMargin:2.6,bonus:!0,requiresResearch:"dieselRefinery"},rocket:{amount:1,sellPrice:0,sellMargin:2.6,bonus:!0,requiresResearch:"rocketComponents"}},interval:10}},{id:"dieselRefinery",idNum:32,name:"Diesel refinery",width:3,height:2,spriteX:5,spriteY:6,iconX:5,iconY:2,runningCostPerTick:18e6,price:O(15,4),priceRefund:1,requiresResearch:"dieselRefinery",strategy:{type:"converter",inputResources:{oil:{perOutputResource:96}},production:{diesel:{amount:16},waste:{amount:8}},outputResourcesOrder:["diesel","diesel","waste"],interval:10}},{id:"jetFuelRefinery",idNum:31,name:"Jet fuel refinery",width:2,height:2,spriteX:6,spriteY:13,iconX:1,iconY:3,runningCostPerTick:1e8,price:O(35,4),priceRefund:1,requiresResearch:"rocketComponents",strategy:{type:"converter",inputResources:{gas:{perOutputResource:24}},production:{jetFuel:{amount:8},waste:{amount:4}},outputResourcesOrder:["jetFuel","jetFuel","waste"],interval:10}},{id:"rocketHullMaker",idNum:27,name:"Rocket hull maker",width:3,height:2,spriteX:0,spriteY:19,iconX:6,iconY:2,runningCostPerTick:15e7,price:O(60,4),priceRefund:1,requiresResearch:"rocketComponents",strategy:{type:"converter",inputResources:{aluminium:{perOutputResource:8},engine:{perOutputResource:1}},production:{rocketHull:{amount:1,max:3}},outputResourcesOrder:["rocketHull"],interval:10}},{id:"rocketWarheadMaker",idNum:28,name:"Warhead maker",width:2,height:3,spriteX:3,spriteY:19,iconX:7,iconY:2,runningCostPerTick:12e7,price:O(130,4),priceRefund:1,requiresResearch:"rocketComponents",strategy:{type:"converter",inputResources:{aluminium:{perOutputResource:4},electronics:{perOutputResource:3},explosives:{perOutputResource:8}},production:{warhead:{amount:1}},outputResourcesOrder:["warhead"],interval:10}},{id:"rocketAssembler",idNum:29,name:"Rocket assembly",width:2,height:2,spriteX:5,spriteY:20,iconX:8,iconY:2,runningCostPerTick:19e6,price:O(110,4),priceRefund:1,requiresResearch:"rocketComponents",strategy:{type:"converter",inputResources:{rocketHull:{perOutputResource:2},warhead:{perOutputResource:2},jetFuel:{perOutputResource:8}},production:{rocket:{amount:2}},outputResourcesOrder:["rocket"],interval:10}},{id:"droneMaker",idNum:41,name:"Drone maker",width:2,height:6,spriteX:8,spriteY:9,iconX:5,iconY:4,runningCostPerTick:1e9,price:O(6,5),priceRefund:1,requiresResearch:"droneComponents",strategy:{type:"converter",inputResources:{aluminium:{perOutputResource:64},plastic:{perOutputResource:48},electronics:{perOutputResource:24},engine:{perOutputResource:8},guns:{perOutputResource:32}},production:{drone:{amount:8}},outputResourcesOrder:["drone"],interval:20}},{id:"droneControlRoom",idNum:42,name:"Drone control room",width:3,height:5,spriteX:10,spriteY:11,iconX:6,iconY:4,runningCostPerTick:15e8,price:O(6,5),priceRefund:1,requiresResearch:"droneComponents",strategy:{type:"converter",inputResources:{steel:{perOutputResource:96},electronics:{perOutputResource:24}},production:{droneControlRoom:{amount:4}},outputResourcesOrder:["droneControlRoom"],interval:20}},{id:"droneSeller",idNum:43,name:"Drone seller",width:2,height:2,spriteX:10,spriteY:16,iconX:7,iconY:4,runningCostPerTick:3e9,price:O(4,5),priceRefund:1,requiresResearch:"droneComponents",strategy:{type:"seller",resources:{drone:{amount:4,sellPrice:0,sellMargin:1.9},droneControlRoom:{amount:2,sellPrice:0,sellMargin:1.9},rocket:{amount:8,sellPrice:0,bonus:!0,sellMargin:6},jetFuel:{amount:32,sellPrice:0,bonus:!0,sellMargin:3}},interval:20}},{id:"researchCenter",idNum:33,name:"Research center",width:4,height:4,spriteX:5,spriteY:2,iconX:3,iconY:3,runningCostPerTick:4,price:1e3,priceRefund:1,requiresResearch:"researchCenter",strategy:{type:"researchCenter",researchProduction:1,resources:{report1:{max:4,bonus:2}},interval:10}},{id:"metalsLab",idNum:34,name:"Metals lab",width:3,height:2,spriteX:7,spriteY:0,iconX:5,iconY:3,runningCostPerTick:8,price:4e4,priceRefund:1,requiresResearch:"metalsLab",strategy:{type:"lab",inputResources:{iron:{perOutputResource:1,max:25,bonus:4},steel:{perOutputResource:1,max:25,bonus:6},aluminium:{perOutputResource:1,max:25,bonus:5}},production:{report1:{amount:1,max:25}},outputResourcesOrder:["report1"],interval:20}},{id:"gasAndOilLab",idNum:35,name:"Gas&Oil lab",width:2,height:3,spriteX:8,spriteY:6,iconX:4,iconY:3,runningCostPerTick:200,price:6e5,priceRefund:1,requiresResearch:"gasAndOilLab",strategy:{type:"lab",inputResources:{gas:{perOutputResource:1,max:25,bonus:2},oil:{perOutputResource:1,max:25,bonus:3},plastic:{perOutputResource:1,max:25,bonus:10},diesel:{perOutputResource:1,max:3,bonus:8},jetFuel:{perOutputResource:1,max:3,bonus:8}},production:{report2:{amount:1,max:25}},outputResourcesOrder:["report2"],interval:20}},{id:"researchCenter2",idNum:38,name:"Research center 2",width:4,height:4,spriteX:10,spriteY:0,iconX:2,iconY:4,runningCostPerTick:200,price:6e5,priceRefund:1,requiresResearch:"gasAndOilLab",applyUpgradesFrom:"researchCenter",strategy:{type:"researchCenter",researchProduction:4,resources:{report2:{max:4,bonus:3}},interval:20}},{id:"analystCenter",idNum:39,name:"Analytics center",width:3,height:3,spriteX:10,spriteY:8,iconX:4,iconY:4,runningCostPerTick:12e3,price:O(2,3),priceRefund:1,requiresResearch:"analystCenter",strategy:{type:"converter",inputResources:{report1:{perOutputResource:32,max:256,bonus:10},report2:{perOutputResource:32,max:256,bonus:10}},production:{report3:{amount:20,max:100},waste:{amount:20,max:100}},outputResourcesOrder:["report3","waste"],interval:40}},{id:"researchCenter3",idNum:40,name:"Research center 3",width:4,height:4,spriteX:10,spriteY:4,iconX:3,iconY:4,runningCostPerTick:35e3,price:O(6,3),priceRefund:1,requiresResearch:"analystCenter",applyUpgradesFrom:"researchCenter",strategy:{type:"researchCenter",researchProduction:20,resources:{report3:{max:4,bonus:16}},interval:40}},{id:"qualityLab",idNum:44,name:"Quality lab",width:4,height:2,spriteX:12,spriteY:16,iconX:0,iconY:4,runningCostPerTick:O(400,2),price:O(3,5),priceRefund:1,requiresResearch:"qualityCenter",strategy:{type:"lab",inputResources:{tank:{perOutputResource:1,max:25,bonus:21},rocket:{perOutputResource:1,max:25,bonus:16},engine:{perOutputResource:1,max:25,bonus:10},guns:{perOutputResource:1,max:3,bonus:6},drone:{perOutputResource:1,max:3,bonus:24}},production:{report4:{amount:1,max:1e3}},outputResourcesOrder:["report4"],interval:5}},{id:"researchCenter4",idNum:45,name:"Research center 4",width:4,height:4,spriteX:10,spriteY:18,iconX:1,iconY:4,runningCostPerTick:O(50,2),price:O(2,5),priceRefund:1,requiresResearch:"qualityCenter",applyUpgradesFrom:"researchCenter",strategy:{type:"researchCenter",researchProduction:100,resources:{report4:{max:64,bonus:100}},interval:40}}]};(()=>{const d={};for(const t of be.components)d[t.id]=t;const e=new ve(d,be.productionTree);for(const t of be.components){if(t.strategy?.type==="seller")for(const i in t.strategy.resources){const r={},s=e.calculateCostFor(t.id,i,r);s>0&&(t.strategy.resources[i].sellPrice=Math.ceil(s))}if(t.strategy?.type==="buyer")for(const i in t.strategy.purchaseResources)t.strategy.purchaseResources[i].max=20*t.strategy.purchaseResources[i].amount;else if(t.strategy?.type==="converter"){for(const i in t.strategy.inputResources)t.strategy.inputResources[i].max=20*t.strategy.inputResources[i].perOutputResource;for(const i in t.strategy.production)t.strategy.production[i].max=20*t.strategy.production[i].amount}else if(t.strategy?.type==="seller")for(const i in t.strategy.resources)t.strategy.resources[i].max=20*t.strategy.resources[i].amount}})();const zi=[{id:"ironOre",idNum:1,name:"Iron ore",nameShort:"Iron ore",spriteX:0,spriteY:0},{id:"iron",idNum:2,name:"Iron",nameShort:"Iron",spriteX:1,spriteY:0},{id:"coal",idNum:3,name:"Coal",nameShort:"Coal",spriteX:2,spriteY:0},{id:"steel",idNum:4,name:"Steel",nameShort:"Steel",spriteX:3,spriteY:0},{id:"oil",idNum:5,name:"Oil",nameShort:"Oil",spriteX:4,spriteY:0},{id:"plastic",idNum:6,name:"Plastic",nameShort:"Plastic",spriteX:5,spriteY:0},{id:"silicon",idNum:7,name:"Silicon",nameShort:"Silicon",spriteX:6,spriteY:0},{id:"electronics",idNum:8,name:"Electronics",nameShort:"Electronics",spriteX:7,spriteY:0},{id:"aluminium",idNum:9,name:"Aluminium",nameShort:"Alu",spriteX:0,spriteY:1},{id:"engine",idNum:10,name:"Engine",nameShort:"Engine",spriteX:1,spriteY:1},{id:"explosives",idNum:11,name:"Explosives",nameShort:"Explosives",spriteX:2,spriteY:1},{id:"bullets",idNum:12,name:"Bullets",nameShort:"Bullets",spriteX:3,spriteY:1},{id:"guns",idNum:13,name:"Guns",nameShort:"Guns",spriteX:4,spriteY:1},{id:"tankHull",idNum:14,name:"Tank hull",nameShort:"Tank hull",spriteX:5,spriteY:1},{id:"tankTurret",idNum:15,name:"Tank turret",nameShort:"Tank turret",spriteX:6,spriteY:1},{id:"tank",idNum:16,name:"Tank",nameShort:"Tank",spriteX:7,spriteY:1},{id:"rocketHull",idNum:17,name:"Rocket hull",nameShort:"Rocket hull",spriteX:1,spriteY:2},{id:"warhead",idNum:18,name:"Warhead",nameShort:"Warhead",spriteX:2,spriteY:2},{id:"rocket",idNum:19,name:"Rocket",nameShort:"Rocket",spriteX:3,spriteY:2},{id:"waste",idNum:20,name:"Waste",nameShort:"Waste",spriteX:4,spriteY:2},{id:"gas",idNum:21,name:"Gas",nameShort:"Gas",spriteX:6,spriteY:2},{id:"jetFuel",idNum:22,name:"Jet fuel",nameShort:"Jet fuel",spriteX:7,spriteY:2},{id:"diesel",idNum:23,name:"Diesel",nameShort:"Diesel",spriteX:5,spriteY:2},{id:"drone",idNum:27,name:"Drone",nameShort:"Drone",spriteX:4,spriteY:3},{id:"droneControlRoom",idNum:28,name:"Drone control rooms",nameShort:"Drone CR",spriteX:5,spriteY:3},{id:"report1",idNum:24,name:"Metal report",nameShort:"Metal report",spriteX:0,spriteY:3},{id:"report2",idNum:25,name:"Gas&oil report",nameShort:"Gas&oil report",spriteX:1,spriteY:3},{id:"report3",idNum:26,name:"Big report",nameShort:"Big report",spriteX:2,spriteY:3},{id:"report4",idNum:29,name:"Quality report",nameShort:"Quality report",spriteX:3,spriteY:3}],Vi=[{id:"level1",idNum:1,name:"Factory",tilesX:68,tilesY:38,startX:8,startY:10,price:100,terrains:{G:"grass",X:"wall",".":"road"," ":"floor"},buildableTerrains:{floor:!0},terrainMap:"XXXXXXXXXXXX.GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG.GGGGGGGGGG.GGGGGGGGGGX          X.XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXG.GXXXXXXXXX.XXXXXXXXXGX          X.X        X         X           XG.GX        .        XGX           .         X         X            G.G         .        XGX           .         X                      G.G       XX.XX      XGX          X.X        X                     XG.GX      XG.GX      XGX          X.X        X                     XG.GXXX XXXXG.GX      XGX          X.X      X XX X                  XG.GX      XXXXX      XGX           .       X    X      X           XG.GX                 XGXXXX    XXXX.X      X    X      X           XG.GX                 XG.............X      X    X      XXXXXXXXXXXXXG.GXXXXXXXXXX  XXX  XXGXXXX    XXXX.X      X    X      X...................................X          X.X      X    X      X.GGGGGGXXXXXXXXXXXXXXX.XX  XXX  XXXX          X.X                  X.GGGGGGX              .           XX          X.XXX   XXXXXXXXX   XX.GGGGGGX             X.X          XX          X......................GGGGGGXX           XX.XX         XX          X.XXX   XXXXXXXXX   XX.GGGGGGGX           XG.GX         XX     X    X.X                  X.GGGGGGXX           XX.XX         XX     X    X.X                  X.GGGGGGX              .           XX     X    X.X            X     X.GGGGGGX             X.X          XX     XXXXXX.X            X     X.GGGGGGXX           XX.XX         XX         XG.X            X     X.GGGGGGGX           XG.GX         XXX         G.             X     X.GGGGGGXX           XX.XX         XGX         G.             X     X.GGGGGGX              .           XGX         G.             X     X.XXXGXXX             X.X          XGX         G.             X     X.X XXX              XX.XX         XGX        XG.X                   .                   XG.GX         XGXXXX  XXXXG.X                   .                   XX.XX         XGGGGGGGGGGGG.XXXXXXXX   XXX   XXX.X                    .           X...................GGGGGGGGGGGGGG.X                    .           XGGGGX  XXXXG.XXXXX................X                    .           XGXXXX     XX.X   XXXX   XXX   XXX.X                    .           XGX          .       X           X.X                  XX.X          XGX          .                    .                   X..X          XGX          .                    .      XXXXXXXX     X.XX          XGX        XX.X      X            .      XGGGGGGX     X.X           XGXXXXXXXXXXG.X      X           X.XXXXXXXGGGGGGXXXXXXX.X           XGGGGGGGGGGGG.XXXXXXXXXXXXXXXXXXXX.GGGGGGGGGGGGGGGGGGGG.XXXXXXXXXXXXX",buildMap:"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX          XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX          XXX        X         X           XXXXX        -        XXX           -         X         X            ---         -        XXX           -         X                      ---       XXXXX      XXX          XXX        X                     XXXXX      XXXXX      XXX          XXX        X                     XXXXXXX XXXXXXXX      XXX          XXX      X XX X                  XXXXX      XXXXX      XXX           -       X    X      X           XXXXX                 XXXXXX    XXXXXX      X    X      X           XXXXX                 XXXXXX----XXXXXX      X    X      XXXXXXXXXXXXXXXXXXXXXXXXXX  XXX  XXXXXXX    XXXXXX      X    X      XXXXXXXXXXXXXXXXXXXXXXXXXX--XXX--XXXX          XXX      X    X      XXXXXXXXXXXXXXXXXXXXXXXXXX  XXX  XXXX          XXX                  XXXXXXXXX              -           XX          XXXXX   XXXXXXXXX   XXXXXXXXXX             XXX          XX          XXXXX---XXXXXXXXX---XXXXXXXXXXX           XXXXX         XX          XXXXX   XXXXXXXXX   XXXXXXXXXXX           XXXXX         XX     X    XXX                  XXXXXXXXXX           XXXXX         XX     X    XXX                  XXXXXXXXX              -           XX     X    XXX            X     XXXXXXXXX             XXX          XX     XXXXXXXX            X     XXXXXXXXXX           XXXXX         XX         XXXX            X     XXXXXXXXXX           XXXXX         XXX         --             X     XXXXXXXXXX           XXXXX         XXX         --             X     XXXXXXXXX              -           XXX         --             X     XXXXXXXXX             XXX          XXX         --             X     XXX XXX              XXXXX         XXX        X-XX                   -                   XXXXX         XXXXXX  XXXX-XX                   -                   XXXXX         XXXXXX-------XXXXXXXXX   XXX   XXXXX                    -           XXXXXX--XXXXXXXXXXXX--------------XX                    -           XXXXXX  XXXXXXXXXXXXXX---XXX---XXXXX                    -           XXXXXX     XXXX   XXXX   XXX   XXXXX                    -           XXX          -       X           XXX                  XXXX          XXX          -                    -                   XXXX          XXX          -                    -      XXXXXXXX     XXXX          XXX        XXXX      X            -      XXXXXXXX     XXX           XXXXXXXXXXXXXXX      X           XXXXXXXXXXXXXXXXXXXXXXXX           XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",areas:[{id:"a2",name:"A2",idNum:1,price:1200,locations:[{x:0,y:0,x2:11,y2:9}]},{id:"a4",name:"A4",idNum:2,price:25e4,locations:[{x:0,y:11,x2:11,y2:27}]},{id:"a1",name:"A1",idNum:3,price:700,locations:[{x:0,y:30,x2:11,y2:37}]},{id:"a5",name:"A5",idNum:4,price:26e6,locations:[{x:13,y:1,x2:32,y2:14}]},{id:"a6",name:"A6",idNum:5,price:32e6,locations:[{x:33,y:1,x2:44,y2:10}]},{id:"a3",name:"A3",idNum:6,price:12e3,locations:[{x:13,y:31,x2:32,y2:37},{x:13,y:30,x2:17,y2:30}]},{id:"a7",name:"A7",idNum:7,price:14e7,locations:[{x:48,y:1,x2:66,y2:10}]},{id:"a9",name:"A9",idNum:8,price:4e10,locations:[{x:34,y:12,x2:53,y2:36},{x:54,y:12,x2:54,y2:32}]},{id:"a8",name:"A8",idNum:9,price:29e8,locations:[{x:56,y:12,x2:67,y2:37},{x:55,y:34,x2:55,y2:37}]}],startComponents:[{id:"ironBuyer",x:15,y:18},{id:"ironFoundry",x:19,y:18},{id:"ironSeller",x:25,y:18},{id:"transportLine",x:17,y:18},{id:"transportLine",x:18,y:18},{id:"transportLine",x:23,y:18},{id:"transportLine",x:24,y:18}],transportLineConnections:[{fromX:16,fromY:18,toX:17,toY:18},{fromX:17,fromY:18,toX:18,toY:18},{fromX:18,fromY:18,toX:19,toY:18},{fromX:22,fromY:18,toX:23,toY:18},{fromX:23,fromY:18,toX:24,toY:18},{fromX:24,fromY:18,toX:25,toY:18}]},{id:"level2",idNum:2,name:"Kilofactory",tilesX:50,tilesY:35,startX:12,startY:0,price:1e9,terrains:{G:"grass",X:"wall",".":"road"," ":"floor"},buildableTerrains:{floor:!0},terrainMap:"GGGGGGGGGGGGGGG.GGGGGGGGGGGGGGGGGGGG.GGGGGGGGGGGGGGXXXXXXXXXXXXGG.GXXXXXXXXXXXXXXXXXXX.XXXXXXXXXXXXGGX          XGG.GX                 X.X          XGGX          XGG.GX                 X.X          XGGX          XGG.GX                 X.X          XGGX          XGG.GX                 X.X          XGGX           GG.G                   .           XGGX          XGG.GX                 X.X          XGGX           GG.G                   .           XGGX          XGG.GX                 X.X          XGGX           GG.G                   .           XGGX          XGG.GX                 X.X          XGGX           GG.G                   .           XGGX          XGG.GX                 X.X          XGGX           GG.G                   .           XGGX          XGG.GX                 X.X          XGGX          XGG.GX                 X.X          XGGX          XGG.GX                 X.X          XGGXXXX    XXXXGG.GXXXXX  X  XXX  X  X.XXXXXXXXXXXXG................GGGGGG  G  GGG  G  G.GGGGGGGGGGGGGGXXXX    XXXXGG.GGGGGGGGGGGGGGGGGGGG.GGGGGGGGGGGGGGX          XGG......................GGGGGGG GGGGGGX          XGG.GGGGGG  G  G.G  G  GGGGGGGG   GGGGGX          XGG.GXXXXX  X  X.X  X  XXXXXGGGG GGGGGGX          XGG.GX         X.X         XGGGGGGGGGGGX          XGG.GX         X.X         XGGGGGGGGGGGX          XGG.GX         X.X         XGGGG GGGGGGX          XGG.GX         X.X         XGGG   GGGGGX          XGG.GX         X.X         XGGGG GGGGGGX          XGG.GX         X.X         XGGGGGGGGGGGX          XGG.GX         X.X         XGGGGGGGGGGGX          XGG.GX        XX.XX        XGGGG GGGGGGX          XGG.GX        XG.GX        XGGG   GGGGGXXXXXXXXXXXXGG.GXXXXXXXXXXG.GXXXXXXXXXXGGGG GGGGGGGGGGGGGGGGGGGG.GGGGGGGGGGGG.GGGGGGGGGGGGGGGGGGGGG",buildMap:"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX          XXXXXX                 XXX          XXXX          XXXXXX                 XXX          XXXX          XXXXXX                 XXX          XXXX          XXXXXX                 XXX          XXXX           ----                   -           XXXX          X----X                 X-X          XXXX           ----                   -           XXXX          X----X                 X-X          XXXX           ----                   -           XXXX          X----X                 X-X          XXXX           ----                   -           XXXX          X----X                 X-X          XXXX           ----                   -           XXXX          XXXXXX                 XXX          XXXX          XXXXXX                 XXX          XXXX          XXXXXX                 XXX          XXXXXXX    XXXXXXXXXXXXX  X  XXX  X  XXXXXXXXXXXXXXXXXXXX----XXXXXXXXXXXXX  -  XXX  -  XXXXXXXXXXXXXXXXXXXX    XXXXXXXXXXXXX-----XXX-----XXXXXXXXXXXXXXXXX          XXXXXXXXXX-----XXX-----XXXXXXXXX XXXXXXX          XXXXXXXXXX  -  XXX  -  XXXXXXXX   XXXXXX          XXXXXXXXXX  X  XXX  X  XXXXXXXXX XXXXXXX          XXXXXX         XXX         XXXXXXXXXXXXX          XXXXXX         XXX         XXXXXXXXXXXXX          XXXXXX         XXX         XXXXX XXXXXXX          XXXXXX         XXX         XXXX   XXXXXX          XXXXXX         XXX         XXXXX XXXXXXX          XXXXXX         XXX         XXXXXXXXXXXXX          XXXXXX         XXX         XXXXXXXXXXXXX          XXXXXX        XXXXX        XXXXX XXXXXXX          XXXXXX        XXXXX        XXXX   XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",areas:[{id:"b3",name:"B3",idNum:1,price:12e9,locations:[{x:1,y:1,x2:12,y2:18}]},{id:"b1",name:"B1",idNum:2,price:25e8,locations:[{x:16,y:22,x2:27,y2:34}]},{id:"b2",name:"B2",idNum:3,price:25e8,locations:[{x:29,y:22,x2:39,y2:34}]},{id:"b5",name:"B5",idNum:4,price:8e11,locations:[{x:37,y:1,x2:48,y2:18}]},{id:"b4",name:"B4",idNum:5,price:26e10,locations:[{x:1,y:20,x2:12,y2:33}]}]},{id:"level3",idNum:3,name:"Megafactory",tilesX:68,tilesY:42,startX:10,startY:3,price:5e12,terrains:{G:"grass",X:"wall",".":"road"," ":"floor"},buildableTerrains:{floor:!0},terrainMap:"GGGGGGGGGGGGGGGGGGGGGGG.GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGXXXXXXXXXXXXXXXXXXXXXX.GXXXXXXXXXXXXXXXXXXGGXXXXXXXXXXXXXXXXXXXXXXGGX                     .G                 XGGX                    XGGX                     .G                  GG                     XGGX                    X.GX                 GG                     XGGX                    X.GX                 GG                     XGGX                    X.GX                 GG                     XGGX                    X.GX                 GG                     XGGX                    X.GX                 GG                     XGGX                    X.GX                 GG                     XGGX                    X.GX                XGGX                    XGGX                    X.GX          XXXXXXXGGXXX                  XGGX                    X.GX          XGGGGGGGGGGX                  XGGX             XXX    X.GX          XGGGGGGGGGGX                  XGGX             X........GX          XGGGGGGGGGGX                  XGGX             X.X    XXXX          XGGGGGGGGGGX                  XGGX             X.X                  XGGGGGGGGGGXXXX   XXX  XXX   XXGGX             X.X                  XGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGX             X.X                  XGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGXXXX   XXXXXXXX.X                  XGG..............................................X                  XGG.GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG.X                  XGG.GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG.X                  XGG.GGXXXXXXXXX   XXX  XXX   XXGGGGGGGGGGGGGGGGG.X                  XGG.GGX                       XGGXXXX   XXXXXGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X    XXXXXXXXXX    XGG.GGX                       XGGX          XGGG........................GGX                       XGGX          XGGG.X    XXXXXXXXXX    XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                   GG.GG                        XGGX          XGGG.X                   GG.GG                        XGGX          XGGG.X                  XGG.GGX                       XGGX          XGGG.X                  XGG.GGX                       XGGXXXXXXXXXXXXGGG.X                  XGG.GGXXXXXXXXXXXXXXXXXXXXXXXXXGGGGGGGGGGGGGGGGG.XXXXXXXXXXXXXXXXXXXXGG.GGGGGGGGGGGGGGGGGGGGGGGGGGGG",buildMap:"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX                     --                 XXXX                    XXXX                     --                  --                     XXXX                    XXXX                 --                     XXXX                    XXXX                 --                     XXXX                    XXXX                 --                     XXXX                    XXXX                 --                     XXXX                    XXXX                 --                     XXXX                    XXXX                 --                     XXXX                    XXXX                XXXX                    XXXX                    XXXX          XXXXXXXXXXXX                  XXXX                    XXXX          XXXXXXXXXXXX                  XXXX             XXX    XXXX          XXXXXXXXXXXX                  XXXX             XXX----XXXX          XXXXXXXXXXXX                  XXXX             XXX    XXXX          XXXXXXXXXXXX                  XXXX             XXX                  XXXXXXXXXXXXXXX   XXX  XXX   XXXXX             XXX                  XXXXXXXXXXXXXXX--------------XXXXX             XXX                  XXXXXXXXXXXXXXX---XXX--XXX---XXXXXXXX   XXXXXXXXXX                  XXXXXXXXXXXXXXX---XXX--XXX---XXXXXXXX---XXXXXXXXXX                  XXXXXXXXXXXXXXX---XXX--XXX---XXXXXXXX---XXXXXXXXXX                  XXXXXXXXXXXXXXX--------------XXXXXXXX---XXXXXXXXXX                  XXXXXXXXXXXXXXX   XXX  XXX   XXXXXXXX---XXXXXXXXXX                  XXXXXXX                       XXXXXXX   XXXXXXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX    XXXXXXXXXX    XXXXXXX                       XXXX          XXXXXX----XXXXXXXXXX----XXXXXXX                       XXXX          XXXXXX    XXXXXXXXXX    XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                   -----                        XXXX          XXXXXX                   -----                        XXXX          XXXXXX                  XXXXXXX                       XXXX          XXXXXX                  XXXXXXX                       XXXXXXXXXXXXXXXXXXXX                  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",areas:[{id:"c3",name:"C3",idNum:1,price:2e12,locations:[{x:1,y:1,x2:15,y2:19},{x:16,y:1,x2:22,y2:13}]},{id:"c2",name:"C2",idNum:2,price:15e12,locations:[{x:1,y:24,x2:12,y2:40}]},{id:"c1",name:"C1",idNum:3,price:7e12,locations:[{x:17,y:31,x2:36,y2:41}]},{id:"c4",name:"C4",idNum:4,price:15e13,locations:[{x:42,y:22,x2:66,y2:40}]},{id:"c5",name:"C5",idNum:5,price:6e13,locations:[{x:47,y:1,x2:66,y2:16},{x:45,y:1,x2:46,y2:11}]}]},{id:"level4",idNum:4,name:"Gigafactory",tilesX:50,tilesY:40,startX:9,startY:8,price:1e15,terrains:{G:"grass",X:"wall",".":"road"," ":"floor"},buildableTerrains:{floor:!0},terrainMap:"GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXGGGGGXX   X    X    X    X    X    X    X    X   XXGGGXX                                            XXGGX                                              XGGX                                              XGGX                                              XGGXX                                            XXGGX                                              XGGX                                              XGGX                                              XGGX                                              XGGXX                                            XXGGX                                              XGGX                                              XGGX                                              XGGX                                              XGGXX                                            XXGGX                XXX        XXX                XGGX                XGX        XGX                XGGX                XGX        XGX                XGGX                XXX        XXX                XGGXX                                            XXGGX                                              XGGX                                              XGGX                                              XGGX                                              XGGXX                                            XXGGX                                              XGGX                                              XGGX                                              XGGX                                              XGGXX                                            XXGGX                                              XGGX                                              XGGX                                              XGGXX                                            XXGGGXX   X    X    X    X    X    X    X    X   XXGGGGGXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG",buildMap:"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX   X    X    X    X    X    X    X    X   XXXXXXX                                            XXXXX                                              XXXX                                              XXXX                                              XXXXX                                            XXXXX                                              XXXX                                              XXXX                                              XXXX                                              XXXXX                                            XXXXX                                              XXXX                                              XXXX                                              XXXX                                              XXXXX                                            XXXXX                XXX        XXX                XXXX                XXX        XXX                XXXX                XXX        XXX                XXXX                XXX        XXX                XXXXX                                            XXXXX                                              XXXX                                              XXXX                                              XXXX                                              XXXXX                                            XXXXX                                              XXXX                                              XXXX                                              XXXX                                              XXXXX                                            XXXXX                                              XXXX                                              XXXX                                              XXXXX                                            XXXXXXX   X    X    X    X    X    X    X    X   XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",areas:[]},{id:"level5",idNum:5,name:"Terafactory",tilesX:80,tilesY:41,startX:9,startY:8,price:1e18,terrains:{G:"grass",X:"wall",".":"road"," ":"floor"},buildableTerrains:{floor:!0},terrainMap:"XXXXXXXXXXXXXXXXXXXXXXXXXG.GGGGGGGGGGGGGGGGGGGGGGGGGG.GXXXXXXXXXXXXXXXXXXXXXXXXXX                       XG............................GX                       XX                       XG.GXXXXXXXXXX.XX.XXXXXXXXXXG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                        G.G                        G.G                        XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                        G.G                        G.G                        XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                        G.G                        G.G                        XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GX                      XG.GX                       XX                       XG.GXXXXXXXXXXXXXXXXXXXXXXXXG.GX                       XX                       XG.GGGGGGGGGGGGGGGGGGGGGGGGGG.GX                       XXXXXXXXXXXXXXXXXXXXXXXXXXG.GGGGGGGGGGGGGGGGGGGGGGGGGG.GXXXXXXXXXXXXXXXXXXXXXXXXX",buildMap:"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX                       XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX                       XX                       XXXXXXXXXXXXXX-XX-XXXXXXXXXXXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                        ---                        ---                        XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                        ---                        ---                        XX                        ---                        ---                        XX                        ---                        ---                        XX                        ---                        ---                        XX                        ---                        ---                        XX                        ---                        ---                        XX                        ---                        ---                        XX                        ---                        ---                        XX                        ---                        ---                        XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                        ---                        ---                        XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXX                      XXXXX                       XX                       XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX                       XX                       XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX                       XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",areas:[]}],U=(d,e)=>d*Math.pow(1e3,e),$i=[{id:"researchCenter",idNum:13,name:"Research center",iconX:0,iconY:0,description:"Allows researching more technologies",price:900,priceIncrease:1,max:1,requiresResearch:""},{id:"chronometer",idNum:1,name:"Chronometer",iconX:1,iconY:0,description:"Each level gives +1 tick/sec",priceResearchPoints:50,priceIncrease:50,max:10,requiresResearch:"researchCenter"},{id:"steelComponents",idNum:2,name:"Steel components",iconX:2,iconY:0,description:"Allows steel production",priceResearchPoints:200,priceIncrease:1,max:1,requiresResearch:"researchCenter"},{id:"metalsLab",idNum:14,name:"Metals lab",iconX:3,iconY:0,description:"Allows researching metals",priceResearchPoints:2e3,priceIncrease:1,max:1,requiresResearch:"steelComponents"},{id:"plasticComponents",idNum:3,name:"Plastic components",iconX:4,iconY:0,description:"Allows plastic production",priceResearchPoints:U(160,1),priceIncrease:1,max:1,requiresResearch:"steelComponents"},{id:"sorter",idNum:16,name:"Sorter",iconX:5,iconY:0,description:"Sorts resources on lines to different paths",priceResearchPoints:U(120,1),priceIncrease:1,max:1,requiresResearch:"plasticComponents"},{id:"electronicsComponents",idNum:4,name:"Electronics components",iconX:6,iconY:0,description:"Allows electronics production",priceResearchPoints:U(20,2),priceIncrease:1,max:1,requiresResearch:"plasticComponents"},{id:"gasAndOilLab",idNum:15,name:"Gas&Oil lab",iconX:7,iconY:0,description:"Allows researching gas and oil",priceResearchPoints:U(300,1),priceIncrease:1,max:1,requiresResearch:"plasticComponents"},{id:"gunComponents",idNum:8,name:"Gun components",iconX:0,iconY:1,description:"Allows guns production",priceResearchPoints:U(150,2),priceIncrease:1,max:1,requiresResearch:"electronicsComponents"},{id:"cleanPlastic",idNum:5,name:"Clean plastic production",iconX:1,iconY:1,description:"Plastic production will not produce waste",priceResearchPoints:U(15,2),priceIncrease:1,max:1,requiresResearch:"electronicsComponents"},{id:"engineComponents",idNum:6,name:"Engine components",iconX:2,iconY:1,description:"Allows engines production",priceResearchPoints:U(2.5,3),priceIncrease:1,max:1,requiresResearch:"gunComponents"},{id:"analystCenter",idNum:17,name:"Analytics center",iconX:3,iconY:0,description:"Provides higher quality research",priceResearchPoints:U(250,2),priceIncrease:1,max:1,requiresResearch:"gunComponents"},{id:"tankComponents",idNum:9,name:"Tank components",iconX:4,iconY:1,description:"Allows tanks production",priceResearchPoints:U(20,3),priceIncrease:1,max:1,requiresResearch:"engineComponents"},{id:"cleanElectronics",idNum:7,name:"Clean electronics",iconX:5,iconY:1,description:"Electronics production will not produce waste",priceResearchPoints:U(700,2),priceIncrease:1,max:1,requiresResearch:"engineComponents"},{id:"dieselRefinery",idNum:10,name:"Diesel refinery",iconX:5,iconY:1,description:"Diesel increases tanks value.",priceResearchPoints:U(75,3),priceIncrease:1,max:1,requiresResearch:"tankComponents"},{id:"rocketComponents",idNum:11,name:"Rocket components",iconX:6,iconY:1,description:"Allows producing rockets",priceResearchPoints:U(1,4),priceIncrease:1,max:1,requiresResearch:"dieselRefinery"},{id:"qualityCenter",idNum:19,name:"Quality center",iconX:9,iconY:1,description:"Provides higher quality research",priceResearchPoints:U(2,4),priceIncrease:1,max:1,requiresResearch:"rocketComponents"},{id:"cleanEngines",idNum:12,name:"Clean engines",iconX:7,iconY:1,description:"Engine makers production will not produce waste",priceResearchPoints:U(1,4),priceIncrease:1,max:1,requiresResearch:"rocketComponents"},{id:"droneComponents",idNum:18,name:"Drone components",iconX:8,iconY:1,description:"Allows producing drones",priceResearchPoints:U(99,4),priceIncrease:1,max:1,requiresResearch:"rocketComponents"}],S=(d,e)=>d*Math.pow(10,e),Rt={layout:[{name:"Conveyor",iconX:1,iconY:0,items:["packageSize"]},{name:"Research center",iconX:3,iconY:3,items:["analystCenterConvertMore","researchCenterBonus","researchCenterMaxStock"]},{name:"Garbage",iconX:2,iconY:3,items:["garbageRemoveAmount"]},{type:"break"},{type:"break"},{name:"Iron buyer",iconX:2,iconY:0,items:["ironBuyerBuyAmount"]},{name:"Coal buyer",iconX:5,iconY:0,items:["coalBuyerRunningCost","_","coalBuyerBuyAmount"]},{name:"Oil buyer",iconX:8,iconY:0,items:["oilBuyerRunningCost","_","oilBuyerBuyAmount"]},{name:"Gas buyer",iconX:0,iconY:3,items:["gasBuyerRunningCost","_","gasBuyerBuyAmount"]},{name:"Silicon buyer",iconX:1,iconY:1,items:["siliconBuyerRunningCost","_","siliconBuyerBuyAmount"]},{name:"Explosives buyer",iconX:7,iconY:1,items:["explosivesBuyerRunningCost","_","explosivesBuyerBuyAmount"]},{name:"Aluminium buyer",iconX:4,iconY:1,items:["aluminiumBuyerRunningCost","_","aluminiumBuyerBuyAmount"]},{type:"break"},{type:"break"},{name:"Iron foundry",iconX:3,iconY:0,items:["ironFoundryConvertAmount"]},{name:"Steel foundry",iconX:6,iconY:0,items:["steelFoundryConvertMoreAmount","_","steelFoundryRunningCost","_","steelFoundryConvertAmount"]},{name:"Plastic maker",iconX:9,iconY:0,items:["plasticMakerConvertMoreAmount","_","plasticMakerRunningCost","_","plasticMakerConvertAmount"]},{name:"Electronics maker",iconX:2,iconY:1,items:["electronicsMakerConvertMoreAmount","_","electronicsMakerRunningCost","_","electronicsMakerConvertAmount"]},{name:"Bullet maker",iconX:8,iconY:1,items:["bulletMakerRunningCost","_","bulletMakerConvertAmount"]},{name:"Gun maker",iconX:9,iconY:1,items:["gunMakerRunningCost","_","gunMakerConvertAmount"]},{name:"Engine maker",iconX:5,iconY:1,items:["engineMakerRunningCost","_","engineMakerConvertAmount"]},{name:"Tank hull maker",iconX:1,iconY:2,items:["tankHullMakerRunningCost","_","tankHullMakerConvertAmount"]},{name:"Tank turret maker",iconX:2,iconY:2,items:["tankTurretMakerRunningCost","_","tankTurretMakerConvertAmount"]},{name:"Tank assembler",iconX:3,iconY:2,items:["tankAssemblerRunningCost","_","tankAssemblerConvertAmount"]},{name:"Diesel refinery",iconX:5,iconY:2,items:["dieselRefineryRunningCost","_","dieselRefineryConvertAmount"]},{name:"Jet fuel refinery",iconX:1,iconY:3,items:["jetFuelRefineryRunningCost","_","jetFuelRefineryConvertAmount"]},{name:"Rocket hull maker",iconX:6,iconY:2,items:["rocketHullMakerRunningCost","_","rocketHullMakerConvertAmount"]},{name:"Rocket warhead maker",iconX:7,iconY:2,items:["rocketWarheadMakerRunningCost","_","rocketWarheadMakerConvertAmount"]},{name:"Rocket assembler",iconX:8,iconY:2,items:["rocketAssemblerRunningCost","_","rocketAssemblerConvertAmount"]},{type:"break"},{type:"break"},{name:"Iron seller",iconX:4,iconY:0,items:["ironSellerSellPrice","_","ironSellerSellAmount"]},{name:"Steel seller",iconX:7,iconY:0,items:["steelSellerSellPrice","steelSellerRunningCost","_","steelSellerSellAmount"]},{name:"Plastic seller",iconX:0,iconY:1,items:["plasticSellerSellPrice","plasticSellerRunningCost","_","plasticSellerSellAmount"]},{name:"Electronics seller",iconX:3,iconY:1,items:["electronicsSellerSellPrice","electronicsSellerRunningCost","_","electronicsSellerSellAmount"]},{name:"Gun seller",iconX:0,iconY:2,items:["gunSellerSellPrice","gunSellerRunningCost","_","gunSellerSellAmount"]},{name:"Engine seller",iconX:6,iconY:1,items:["engineSellerSellPrice","engineSellerRunningCost","_","engineSellerSellAmount"]},{name:"Tank seller",iconX:4,iconY:2,items:["tankSellerSellPrice","tankSellerRunningCost","_","tankSellerSellAmount"]}],upgrades:[{id:"packageSize",idNum:66,iconX:1,iconY:0,requiresResearch:"engineComponents",type:"packageSize",refund:.8,levels:[{price:S(1,12),bonus:1},{price:S(1,14),bonus:1},{price:S(1,16),bonus:1}]},{id:"ironBuyerBuyAmount",idNum:1,iconX:0,iconY:0,type:"buyer",componentId:"ironBuyer",refund:.8,noRunningCost:!0,levels:[{price:S(8,2),bonus:1},{price:S(8,3),bonus:2},{price:S(8,4),bonus:4},{price:S(5,5),bonus:4},{price:S(12,9),bonus:12},{price:S(1.5,11),bonus:12},{price:S(4,13),bonus:12},{price:S(60,13),bonus:16},{price:S(10,14),bonus:32}]},{id:"ironFoundryConvertAmount",idNum:2,iconX:1,iconY:0,type:"converter",componentId:"ironFoundry",refund:.8,noRunningCost:!0,levels:[{price:S(8,2),bonus:1},{price:S(8,4),bonus:2},{price:S(8,5),bonus:2},{price:S(7,9),bonus:6},{price:S(2,11),bonus:6},{price:S(6,13),bonus:6},{price:S(60,13),bonus:24},{price:S(20,14),bonus:48}]},{id:"ironSellerSellAmount",idNum:3,iconX:2,iconY:0,type:"sellerSellAmount",componentId:"ironSeller",refund:.8,noRunningCost:!0,levels:[{price:S(5,2),bonus:1},{price:S(2,3),bonus:2}]},{id:"ironSellerSellPrice",idNum:4,iconX:3,iconY:0,type:"sellerSellPrice",componentId:"ironSeller",levels:[{price:S(5,2),bonus:.25},{price:S(4,3),bonus:.25}]},{id:"coalBuyerBuyAmount",idNum:5,iconX:0,iconY:0,requiresResearch:"steelComponents",type:"buyer",componentId:"coalBuyer",refund:.8,levels:[{price:S(4,4),bonus:1},{price:S(18,5),bonus:2},{price:S(1,9),bonus:4},{price:S(6,9),bonus:4},{price:S(3,11),bonus:6},{price:S(12.5,13),bonus:6}]},{id:"steelFoundryConvertAmount",idNum:7,iconX:1,iconY:0,requiresResearch:"steelComponents",type:"converter",componentId:"steelFoundry",refund:.8,levels:[{price:S(15,4),bonus:1},{price:S(9,5),bonus:1},{price:S(6,11),bonus:3},{price:S(15,13),bonus:6},{price:S(25,14),bonus:12}]},{id:"steelFoundryConvertMoreAmount",idNum:64,iconX:1,iconY:0,requiresResearch:"engineComponents",type:"converterProduceMore",componentId:"steelFoundry",refund:.8,levels:[{price:S(4,11),bonus:1},{price:S(90,13),bonus:2}]},{id:"steelSellerSellAmount",idNum:9,iconX:2,iconY:0,requiresResearch:"steelComponents",type:"sellerSellAmount",componentId:"steelSeller",refund:.8,levels:[{price:S(5,4),bonus:1},{price:S(3,5),bonus:1}]},{id:"coalBuyerRunningCost",idNum:6,iconX:0,iconY:0,requiresResearch:"steelComponents",type:"runningCost",componentId:"coalBuyer",levels:[{price:S(2,4),bonus:.05},{price:S(9,4),bonus:.1}]},{id:"steelFoundryRunningCost",idNum:8,iconX:4,iconY:0,requiresResearch:"steelComponents",type:"runningCost",componentId:"steelFoundry",levels:[{price:S(3,4),bonus:.05},{price:S(1,5),bonus:.1}]},{id:"steelSellerRunningCost",idNum:11,iconX:4,iconY:0,requiresResearch:"steelComponents",type:"runningCost",componentId:"steelSeller",levels:[{price:S(10,4),bonus:.05},{price:S(50,4),bonus:.1}]},{id:"steelSellerSellPrice",idNum:10,iconX:3,iconY:0,requiresResearch:"steelComponents",type:"sellerSellPrice",componentId:"steelSeller",levels:[{price:S(9,4),bonus:.1},{price:S(4,5),bonus:.1}]},{id:"oilBuyerBuyAmount",idNum:12,iconX:0,iconY:0,requiresResearch:"plasticComponents",type:"buyer",componentId:"oilBuyer",refund:.8,levels:[{price:S(9,5),bonus:1},{price:S(3,8),bonus:6},{price:S(4,9),bonus:4},{price:S(3,11),bonus:12}]},{id:"gasBuyerBuyAmount",idNum:14,iconX:0,iconY:0,requiresResearch:"plasticComponents",type:"buyer",componentId:"gasBuyer",refund:.8,levels:[{price:S(1.2,6),bonus:1},{price:S(4,8),bonus:2},{price:S(8,8),bonus:4},{price:S(2,9),bonus:4},{price:S(2,11),bonus:12}]},{id:"plasticMakerConvertAmount",idNum:16,iconX:1,iconY:0,requiresResearch:"plasticComponents",type:"converter",componentId:"plasticMaker",refund:.8,levels:[{price:S(12,6),bonus:1},{price:S(5,9),bonus:1},{price:S(6,11),bonus:3}]},{id:"plasticMakerConvertMoreAmount",idNum:63,iconX:1,iconY:0,requiresResearch:"engineComponents",type:"converterProduceMore",componentId:"plasticMaker",refund:.8,levels:[{price:S(1,12),bonus:1}]},{id:"plasticSellerSellAmount",idNum:18,iconX:2,iconY:0,requiresResearch:"plasticComponents",type:"sellerSellAmount",componentId:"plasticSeller",refund:.8,levels:[{price:S(1.2,7),bonus:3},{price:S(9.5,9),bonus:2}]},{id:"oilBuyerRunningCost",idNum:13,iconX:4,iconY:0,requiresResearch:"plasticComponents",type:"runningCost",componentId:"oilBuyer",levels:[{price:S(6,5),bonus:.05},{price:S(5,8),bonus:.05}]},{id:"gasBuyerRunningCost",idNum:15,iconX:4,iconY:0,requiresResearch:"plasticComponents",type:"runningCost",componentId:"gasBuyer",levels:[{price:S(4,5),bonus:.05},{price:S(1,8),bonus:.1}]},{id:"plasticMakerRunningCost",idNum:17,iconX:4,iconY:0,requiresResearch:"plasticComponents",type:"runningCost",componentId:"plasticMaker",levels:[{price:S(9,5),bonus:.05},{price:S(6,8),bonus:.1}]},{id:"plasticSellerRunningCost",idNum:20,iconX:4,iconY:0,requiresResearch:"plasticComponents",type:"runningCost",componentId:"plasticSeller",levels:[{price:S(7,5),bonus:.05},{price:S(3,8),bonus:.05}]},{id:"plasticSellerSellPrice",idNum:19,iconX:3,iconY:0,requiresResearch:"plasticComponents",type:"sellerSellPrice",componentId:"plasticSeller",levels:[{price:S(9,6),bonus:.1},{price:S(1,9),bonus:.05}]},{id:"siliconBuyerBuyAmount",idNum:21,iconX:0,iconY:0,requiresResearch:"electronicsComponents",type:"buyer",componentId:"siliconBuyer",refund:.8,levels:[{price:S(8,8),bonus:1},{price:S(1,9),bonus:1},{price:S(5,11),bonus:3},{price:S(3,13),bonus:6}]},{id:"electronicsMakerConvertAmount",idNum:23,iconX:1,iconY:0,requiresResearch:"electronicsComponents",type:"converter",componentId:"electronicsMaker",refund:.8,levels:[{price:S(4,8),bonus:1},{price:S(3,9),bonus:1}]},{id:"electronicsMakerConvertMoreAmount",idNum:65,iconX:1,iconY:0,requiresResearch:"engineComponents",type:"converterProduceMore",componentId:"electronicsMaker",refund:.8,levels:[{price:S(1.5,12),bonus:1}]},{id:"electronicsSellerSellAmount",idNum:25,iconX:2,iconY:0,requiresResearch:"electronicsComponents",type:"sellerSellAmount",componentId:"electronicsSeller",refund:.8,levels:[{price:S(2,8),bonus:1},{price:S(2,9),bonus:1}]},{id:"siliconBuyerRunningCost",idNum:22,iconX:4,iconY:0,requiresResearch:"electronicsComponents",type:"runningCost",componentId:"siliconBuyer",levels:[{price:S(8,8),bonus:.05}]},{id:"electronicsMakerRunningCost",idNum:24,iconX:4,iconY:0,requiresResearch:"electronicsComponents",type:"runningCost",componentId:"electronicsMaker",levels:[{price:S(8,8),bonus:.05}]},{id:"electronicsSellerRunningCost",idNum:26,iconX:4,iconY:0,requiresResearch:"electronicsComponents",type:"runningCost",componentId:"electronicsSeller",levels:[{price:S(12,8),bonus:.05}]},{id:"electronicsSellerSellPrice",idNum:27,iconX:3,iconY:0,requiresResearch:"electronicsComponents",type:"sellerSellPrice",componentId:"electronicsSeller",levels:[{price:S(2,8),bonus:.05},{price:S(4,8),bonus:.05},{price:S(6,8),bonus:.05},{price:S(1,10),bonus:.05}]},{id:"explosivesBuyerBuyAmount",idNum:35,iconX:0,iconY:0,requiresResearch:"gunComponents",type:"buyer",componentId:"explosivesBuyer",refund:.8,levels:[{price:S(99,9),bonus:1},{price:S(500,9),bonus:2},{price:S(80,13),bonus:4},{price:S(120,14),bonus:8}]},{id:"bulletMakerConvertAmount",idNum:37,iconX:1,iconY:0,requiresResearch:"gunComponents",type:"converter",componentId:"bulletMaker",refund:.8,levels:[{price:S(220,9),bonus:1},{price:S(600,9),bonus:2},{price:S(35,13),bonus:4}]},{id:"gunMakerConvertAmount",idNum:39,iconX:1,iconY:0,requiresResearch:"gunComponents",type:"converter",componentId:"gunMaker",refund:.8,levels:[{price:S(450,9),bonus:1},{price:S(250,10),bonus:6},{price:S(90,13),bonus:8}]},{id:"gunSellerSellAmount",idNum:41,iconX:2,iconY:0,requiresResearch:"gunComponents",type:"sellerSellAmount",componentId:"gunSeller",refund:.8,levels:[{price:S(120,9),bonus:1}]},{id:"explosivesBuyerRunningCost",idNum:36,iconX:4,iconY:0,requiresResearch:"gunComponents",type:"runningCost",componentId:"explosivesBuyer",levels:[{price:S(15,9),bonus:.05}]},{id:"bulletMakerRunningCost",idNum:38,iconX:4,iconY:0,requiresResearch:"gunComponents",type:"runningCost",componentId:"bulletMaker",levels:[{price:S(20,9),bonus:.1}]},{id:"gunMakerRunningCost",idNum:40,iconX:4,iconY:0,requiresResearch:"gunComponents",type:"runningCost",componentId:"gunMaker",levels:[{price:S(25,9),bonus:.1}]},{id:"gunSellerRunningCost",idNum:42,iconX:4,iconY:0,requiresResearch:"gunComponents",type:"runningCost",componentId:"gunSeller",levels:[{price:S(15,9),bonus:.1}]},{id:"gunSellerSellPrice",idNum:43,iconX:3,iconY:0,requiresResearch:"gunComponents",type:"sellerSellPrice",componentId:"gunSeller",levels:[{price:S(15,9),bonus:.05}]},{id:"aluminiumBuyerBuyAmount",idNum:28,iconX:0,iconY:0,requiresResearch:"engineComponents",type:"buyer",componentId:"aluminiumBuyer",refund:.8,levels:[{price:S(300,9),bonus:1},{price:S(600,9),bonus:2},{price:S(150,10),bonus:4},{price:S(1,14),bonus:24},{price:S(60,14),bonus:32}]},{id:"engineMakerConvertAmount",idNum:30,iconX:1,iconY:0,requiresResearch:"engineComponents",type:"converter",componentId:"engineMaker",refund:.8,levels:[{price:S(1300,9),bonus:1},{price:S(40,14),bonus:2}]},{id:"engineSellerSellAmount",idNum:32,iconX:2,iconY:0,requiresResearch:"engineComponents",type:"sellerSellAmount",componentId:"engineSeller",refund:.8,levels:[{price:S(800,9),bonus:1}]},{id:"aluminiumBuyerRunningCost",idNum:29,iconX:4,iconY:0,requiresResearch:"engineComponents",type:"runningCost",componentId:"aluminiumBuyer",levels:[{price:S(150,9),bonus:.05},{price:S(450,9),bonus:.05}]},{id:"engineMakerRunningCost",idNum:31,iconX:4,iconY:0,requiresResearch:"engineComponents",type:"runningCost",componentId:"engineMaker",levels:[{price:S(100,9),bonus:.1},{price:S(200,9),bonus:.1}]},{id:"engineSellerRunningCost",idNum:33,iconX:4,iconY:0,requiresResearch:"engineComponents",type:"runningCost",componentId:"engineSeller",levels:[{price:S(50,9),bonus:.1},{price:S(150,9),bonus:.1}]},{id:"engineSellerSellPrice",idNum:34,iconX:3,iconY:0,requiresResearch:"engineComponents",type:"sellerSellPrice",componentId:"engineSeller",levels:[{price:S(150,9),bonus:.05},{price:S(250,9),bonus:.05},{price:S(450,9),bonus:.05}]},{id:"tankHullMakerConvertAmount",idNum:44,iconX:1,iconY:0,requiresResearch:"tankComponents",type:"converter",componentId:"tankHullMaker",refund:.8,levels:[{price:S(600,9),bonus:3},{price:S(150,10),bonus:4}]},{id:"tankTurretMakerConvertAmount",idNum:46,iconX:1,iconY:0,requiresResearch:"tankComponents",type:"converter",componentId:"tankTurretMaker",refund:.8,levels:[{price:S(450,9),bonus:3},{price:S(100,10),bonus:4}]},{id:"tankAssemblerConvertAmount",idNum:48,iconX:1,iconY:0,requiresResearch:"tankComponents",type:"converter",componentId:"tankAssembler",refund:.8,levels:[{price:S(300,9),bonus:1},{price:S(200,10),bonus:2}]},{id:"tankSellerSellAmount",idNum:50,iconX:2,iconY:0,requiresResearch:"tankComponents",type:"sellerSellAmount",componentId:"tankSeller",refund:.8,levels:[{price:S(400,9),bonus:3},{price:S(620,10),bonus:4}]},{id:"tankHullMakerRunningCost",idNum:45,iconX:4,iconY:0,requiresResearch:"tankComponents",type:"runningCost",componentId:"tankHullMaker",levels:[{price:S(400,9),bonus:.05},{price:S(200,10),bonus:.05}]},{id:"tankTurretMakerRunningCost",idNum:47,iconX:4,iconY:0,requiresResearch:"tankComponents",type:"runningCost",componentId:"tankTurretMaker",levels:[{price:S(300,9),bonus:.05},{price:S(200,10),bonus:.05}]},{id:"tankAssemblerRunningCost",idNum:49,iconX:4,iconY:0,requiresResearch:"tankComponents",type:"runningCost",componentId:"tankAssembler",levels:[{price:S(500,9),bonus:.05},{price:S(100,10),bonus:.05}]},{id:"tankSellerRunningCost",idNum:51,iconX:4,iconY:0,requiresResearch:"tankComponents",type:"runningCost",componentId:"tankSeller",levels:[{price:S(350,9),bonus:.05},{price:S(150,10),bonus:.05}]},{id:"tankSellerSellPrice",idNum:52,iconX:3,iconY:0,requiresResearch:"tankComponents",type:"sellerSellPrice",componentId:"tankSeller",levels:[{price:S(400,9),bonus:.1},{price:S(240,10),bonus:.1}]},{id:"dieselRefineryConvertAmount",idNum:53,iconX:1,iconY:0,requiresResearch:"dieselRefinery",type:"converter",componentId:"dieselRefinery",refund:.8,levels:[{price:S(700,9),bonus:1}]},{id:"dieselRefineryRunningCost",idNum:54,iconX:4,iconY:0,requiresResearch:"dieselRefinery",type:"runningCost",componentId:"dieselRefinery",levels:[{price:S(900,9),bonus:.05}]},{id:"jetFuelRefineryConvertAmount",idNum:55,iconX:1,iconY:0,requiresResearch:"rocketComponents",type:"converter",componentId:"jetFuelRefinery",refund:.8,levels:[{price:S(100,10),bonus:1}]},{id:"rocketHullMakerConvertAmount",idNum:57,iconX:1,iconY:0,requiresResearch:"rocketComponents",type:"converter",componentId:"rocketHullMaker",refund:.8,levels:[{price:S(150,10),bonus:1}]},{id:"rocketWarheadMakerConvertAmount",idNum:59,iconX:1,iconY:0,requiresResearch:"rocketComponents",type:"converter",componentId:"rocketWarheadMaker",refund:.8,levels:[{price:S(200,10),bonus:1}]},{id:"rocketAssemblerConvertAmount",idNum:61,iconX:1,iconY:0,requiresResearch:"rocketComponents",type:"converter",componentId:"rocketAssembler",refund:.8,levels:[{price:S(250,10),bonus:1}]},{id:"jetFuelRefineryRunningCost",idNum:56,iconX:4,iconY:0,requiresResearch:"rocketComponents",type:"runningCost",componentId:"jetFuelRefinery",levels:[{price:S(300,10),bonus:.05}]},{id:"rocketHullMakerRunningCost",idNum:58,iconX:4,iconY:0,requiresResearch:"rocketComponents",type:"runningCost",componentId:"rocketHullMaker",levels:[{price:S(350,10),bonus:.05}]},{id:"rocketWarheadMakerRunningCost",idNum:60,iconX:4,iconY:0,requiresResearch:"rocketComponents",type:"runningCost",componentId:"rocketWarheadMaker",levels:[{price:S(250,10),bonus:.05}]},{id:"rocketAssemblerRunningCost",idNum:62,iconX:4,iconY:0,requiresResearch:"rocketComponents",type:"runningCost",componentId:"rocketAssembler",levels:[{price:S(300,10),bonus:.05}]},{id:"garbageRemoveAmount",idNum:99,iconX:5,iconY:0,description:"",requiresResearch:"metalsLab",type:"garbage",componentId:"garbageCollector",levels:[{price:S(5,4),bonus:1},{price:S(3,9),bonus:2}]},{id:"researchCenterBonus",idNum:100,iconX:6,iconY:0,description:"researchCenter",requiresResearch:"metalsLab",type:"researchCenterBonus",componentId:"researchCenter",levels:[{price:S(5,5),bonus:.1},{price:S(5,7),bonus:.2},{price:S(5,8),bonus:.2},{price:S(1.1,10),bonus:.25},{price:S(2.8,10),bonus:.25},{price:S(1.2,11),bonus:.5},{price:S(9.4,11),bonus:.5},{price:S(200,12),bonus:1.5},{price:S(100,13),bonus:1.5},{price:S(10,14),bonus:6}]},{id:"researchCenterMaxStock",idNum:101,iconX:7,iconY:0,description:"Research center max papers",requiresResearch:"metalsLab",type:"researchCenterMaxStock",componentId:"researchCenter",levels:[{price:S(5,5),bonus:1},{price:S(1,8),bonus:1},{price:S(1,9),bonus:1},{price:S(3,9),bonus:2},{price:S(9,9),bonus:2},{price:S(4,11),bonus:4},{price:S(5,13),bonus:3},{price:S(6,14),bonus:5}]},{id:"analystCenterConvertMore",idNum:102,iconX:1,iconY:0,requiresResearch:"engineComponents",type:"converterProduceMore",componentId:"analystCenter",refund:.8,levels:[{price:S(2,11),bonus:1},{price:S(400,13),bonus:2}]}]};class Ki{static generateAll(){const e=[{id:"makingProfit",idNum:0,name:"Making profit!",spriteX:3,spriteY:0,bonus:{type:"custom",description:"Unlocks research"},tests:[{type:"avgMoneyIncome",amount:1.4}]},{id:"collectingCash",idNum:1,name:"Collecting some cash",spriteX:2,spriteY:0,bonus:{type:"custom",description:"Unlocks extras"},tests:[{type:"amountOfMoney",amount:25e3}]},{id:"gettingSmarter",idNum:2,name:"Getting smarter",spriteX:2,spriteY:0,bonus:{type:"custom",description:"Unlocks upgrades"},tests:[{type:"researched",researchId:"researchCenter"}]}];for(let t=1;t<=20;t++)e.push({id:`money${t}`,idNum:2+t,name:"Getting money",spriteX:2,spriteY:0,requiresAchievement:t>1?`money${t-1}`:null,bonus:{type:"money",amount:250*Math.pow(10,t)},tests:[{type:"amountOfMoney",amount:1e3*Math.pow(10,t)}]});return e}}const ji=Ki.generateAll(),Qi={id:0,name:"Main idle",version:1,startingMoney:2e3,minNegativeMoney:-1e4,startingResearchPoints:1,maxBonusTicks:7200,minBonusTicks:50,offlineSlower:5,incentivizedAdBonusTicks:1e3,resources:zi,components:be.components,componentsSelection:be.selection,productionTree:be.productionTree,factories:Vi,research:$i,upgrades:Rt.upgrades,upgradesLayout:Rt.layout,achievements:ji};class Ji{static prepareMeta(e){const t=i=>{if(!i)throw new Error("buildLookup called with null/undefined");if(!Array.isArray(i))throw new Error(`buildLookup expected array but got ${typeof i}:`,i);const r={},s=[];for(const a of i){if(r[a.id])throw new Error(`Duplicate id: ${a.id}`);if(s[a.idNum])throw new Error(`Duplicate idNum: ${a.idNum}`);r[a.id]=a,s[a.idNum]=a}return{byId:r,byIdNum:s}};if(e.components&&({byId:e.componentsById,byIdNum:e.componentsByIdNum}=t(e.components)),e.factories){({byId:e.factoriesById,byIdNum:e.factoriesByIdNum}=t(e.factories));for(const i of e.factories)if(i.areas){({byId:i.areasById,byIdNum:i.areasByIdNum}=t(i.areas));for(const r of i.areas)if(r.locations)for(const s of r.locations)s.width=s.x2-s.x+1,s.height=s.y2-s.y+1}}return e.resources&&({byId:e.resourcesById,byIdNum:e.resourcesByIdNum}=t(e.resources)),e.research&&({byId:e.researchById,byIdNum:e.researchByIdNum}=t(e.research)),e.upgrades&&({byId:e.upgradesById,byIdNum:e.upgradesByIdNum}=t(e.upgrades)),e.achievements&&({byId:e.achievementsById,byIdNum:e.achievementsByIdNum}=t(e.achievements)),e}}const $={main:Ji.prepareMeta(Qi),productsLayout:yt.layout,products:yt.items,timeTravelTicketValue:yt.timeTravelTicketValue};$.productsById={};$.productsByIdNum=[];for(const d of $.products){if($.productsById[d.id])throw new Error(`Purchase with id ${d.id} already exists!`);if($.productsByIdNum[d.idNum])throw new Error(`Purchase with idNum ${d.idNum} already exists!`);$.productsById[d.id]=d,$.productsByIdNum[d.idNum]=d}const ae={userHash:{key:"FactoryIdleUserHash"},imageMap:{path:"img/",files:{yellowSelection:"mouse/yellow.png",greenSelection:"mouse/green.png",redSelection:"mouse/red.png",blueSelection:"mouse/selected.png",cantPlace:"mouse/cantPlace.png",terrains:"terrains.png",components:"components.png",componentIcons:"componentIcons.png",transportLine:"transportLine.png",resources:"resources.png"}},api:{server:{url:"/api/games"},armorGames:{gameKey:""},local:{storageKey:"FactoryIdleLocal"}},saveManager:{cloudSaveIntervalMs:9e5,localSaveIntervalMs:5e3},meta:{...$,warnToStoreUserHashAfterTicks:{1e4:!0,1e5:!0,1e6:!0}}};class Et{constructor(e=0,t=0){typeof e=="number"?(this.buffer=e>>>0,this.length=t||8):(this.buffer=0,this.length=0)}writeAll(...e){for(let t=0;t<8;t++)this.writeBoolean(e[t]);return this}writeBoolean(e){return this.buffer<<=1,this.buffer|=e?1:0,this.length++,this}fillZero(){for(;this.length<8;)this.writeBoolean(0)}readBoolean(){const e=this.buffer&1;return this.buffer>>=1,!!e}getValue(){return this.buffer}reverse(){const e=[];for(let t=0;t<8;t++)e.push(this.readBoolean());for(let t=0;t<8;t++)this.writeBoolean(e[t]);return this}toString(){return this.buffer.toString()}}const Oe={top:"bottom",bottom:"top",left:"right",right:"left"},Le=["top","right","bottom","left"];class Zi{tile;changedCallback;inputsByDirection={};outputsByDirection={};inputsList=[];outputsList=[];constructor(e,t){this.tile=e,this.changedCallback=t,Le.forEach(i=>{this.inputsByDirection[i]=null,this.outputsByDirection[i]=null}),this.reset()}reset(){Le.forEach(e=>{this.clearInput(e),this.clearOutput(e)})}setInput(e){if(!this.inputsByDirection[e]){this.clearOutput(e);const t=this.tile.getTileInDirection(e);if(!t)return;this.inputsByDirection[e]=t,this._updateInputOutputLists(),t.getInputOutputManager().setOutput(Oe[e]),this.changedCallback()}}setOutput(e){if(!this.outputsByDirection[e]){this.clearInput(e);const t=this.tile.getTileInDirection(e);if(!t)return;this.outputsByDirection[e]=t,this._updateInputOutputLists(),t.getInputOutputManager().setInput(Oe[e]),this.changedCallback()}}clearInput(e){const t=this.inputsByDirection[e];t&&(this.inputsByDirection[e]=null,t.getInputOutputManager().clearOutput(Oe[e]),this._updateInputOutputLists(),this.changedCallback())}clearOutput(e){const t=this.outputsByDirection[e];t&&(this.outputsByDirection[e]=null,t.getInputOutputManager().clearInput(Oe[e]),this._updateInputOutputLists(),this.changedCallback())}_updateInputOutputLists(){this.inputsList=Le.map(e=>this.inputsByDirection[e]).filter(Boolean),this.outputsList=Le.map(e=>this.outputsByDirection[e]).filter(Boolean)}getInputsList(){return this.inputsList}getInputsByDirection(){return this.inputsByDirection}getOutputsList(){return this.outputsList}getOutputsByDirection(){return this.outputsByDirection}exportToWriter(e){const t=new Et;t.writeAll(this.inputsByDirection.top,this.inputsByDirection.right,this.inputsByDirection.bottom,this.inputsByDirection.left,this.outputsByDirection.top,this.outputsByDirection.right,this.outputsByDirection.bottom,this.outputsByDirection.left),e.writeBooleanMap(t)}importFromReader(e){const t=e.readBooleanMap();t.readBoolean()&&this.setInput("top"),t.readBoolean()&&this.setInput("right"),t.readBoolean()&&this.setInput("bottom"),t.readBoolean()&&this.setInput("left"),t.readBoolean()&&this.setOutput("top"),t.readBoolean()&&this.setOutput("right"),t.readBoolean()&&this.setOutput("bottom"),t.readBoolean()&&this.setOutput("left")}}class gt{constructor(e,t){this.component=e,this.inputResources=t,this.reset()}reset(){this.resources={},this.inputTileIndex=[];for(const e in this.inputResources)this.resources[e]=0,this.inputTileIndex.push({resource:e,offset:0})}updateWithDescriptionData(e){e.stock||(e.stock=[]);const t=this.component.getFactory().getGame().getMeta().resourcesById;for(const i in this.inputResources){const r=this.inputResources[i];let s=!0;r.requiresResearch&&(s=this.component.getFactory().getGame().getResearchManager().getResearch(r.requiresResearch)>0),s&&e.stock.push({resourceId:i,resourceName:t[i].nameShort,amount:this.resources[i],max:this.getMax(i)})}}getMax(e){const t=this.component.getMeta(),i=this.component.getFactory().getUpgradesManager().getComponentBonuses(t.applyUpgradesFrom??t.id);return this.inputResources[e].max*i.maxStorageBonus}takeIn(){const e=this.component.getSurroundedInputTiles();for(const t of this.inputTileIndex){const i=t.resource;let r=t.offset;for(let s=0;s<e.length&&this.resources[i]<this.getMax(i);s++){const a=e[(r+s)%e.length],u=a.tile.getComponent().getStrategy().getOutputQueue(a.direction),l=u.getLast();l&&l.getResourceId()===i&&(u.unsetLast(),r=(r+s+1)%e.length,this.resources[i]+=l.getAmount())}t.offset=r}for(const t of e)t.tile.getComponent().getStrategy().getOutputQueue(t.direction).forward()}addResource(e,t){this.resources[e]+=t}getResource(e){return this.resources[e]}toString(){let e="IN<br />";for(const t of this.inputTileIndex)e+=`${t.resource}: ${this.resources[t.resource]} (offset:${t.offset})<br />`;return e}exportToWriter(e){e.writeUint8(this.inputTileIndex.length);for(const t of this.inputTileIndex)e.writeUint32(this.resources[t.resource]),e.writeUint8(t.offset)}importFromReader(e){const t=Math.min(this.inputTileIndex.length,e.readUint8());for(let i=0;i<t;i++)this.resources[this.inputTileIndex[i].resource]=e.readUint32(),this.inputTileIndex[i].offset=e.readUint8()}}let vt=[];class z{constructor(e,t,i){if(!i)throw new Error("Missing argument factory");this.resourceId=e,this.meta=i.getGame().getMeta().resourcesById[e],this.offset=Math.round(4*Math.random())-2,this.amount=t}static getNew(e,t,i){return vt.length>0?vt.pop():new z(e,t,i)}static free(e){vt.push(e)}getResourceId(){return this.resourceId}getResourceIdNum(){return this.meta.idNum}getOffset(){return this.offset}getAmount(){return this.amount}toString(){return this.resourceId}static staticExportData(e,t){e?(t.writeUint8(e.getResourceIdNum()),t.writeUint8(e.getAmount())):t.writeUint8(0)}static createFromExport(e,t,i){const r=t.readUint8();if(r===0)return null;const a=(i===void 0?6:Number(i))>=6?t.readUint8():1,u=e.getGame().getMeta().resourcesByIdNum[r];return u?z.getNew(u.id,a,e):null}}class Xe{constructor(e,t,i){this.component=e,this.handledResources=t,this.outputResourcesOrder=i,this.reset()}reset(){this.resources={};for(const e of this.outputResourcesOrder)this.resources[e]=0;this.outResourceSelectionIndex=0,this.distributeTileIndex=0}updateWithDescriptionData(e){e.stock||=[];const t=this.component.getFactory().getGame().getMeta().resourcesById;for(const i in this.resources)e.stock.push({resourceId:i,resourceName:t[i].nameShort,amount:this.resources[i],max:this.getMax(i)})}getMax(e){const t=this.component.getMeta(),i=this.component.getFactory().getUpgradesManager().getComponentBonuses(t.applyUpgradesFrom??t.id);return this.handledResources[e].max*i.maxStorageBonus}static getMetaOutputAmount(e,t){return 1+t.getUpgradesManager().getBonuses().packageSizeBonus+t.getUpgradesManager().getComponentBonuses(e.id).packageSizeBonus}getOutputAmount(){return Xe.getMetaOutputAmount(this.component.getMeta(),this.component.getFactory())}distribute(){const e=this.component.getSurroundedOutputTiles();for(let t=0;t<e.length;t++){const i=this._getNextOutputResource();if(!i)break;const r=e[this.distributeTileIndex];this.distributeTileIndex=(this.distributeTileIndex+1)%e.length;const s=r.tile.getComponent().getStrategy().getInputQueue(r.oppositeDirection);if(!s.getFirst()){const a=this.getOutputAmount();s.setFirst(new z(i,a,this.component.getFactory())),this.resources[i]-=a,this.outResourceSelectionIndex=(this.outResourceSelectionIndex+1)%this.outputResourcesOrder.length}}}_getNextOutputResource(){for(let e=0;e<this.outputResourcesOrder.length;e++){const t=this.outputResourcesOrder[(this.outResourceSelectionIndex+e)%this.outputResourcesOrder.length];if(this.resources[t]>=this.getOutputAmount())return t}return this.outResourceSelectionIndex=0,null}addResource(e,t){this.resources[e]+=t}getResource(e){return this.resources[e]}toString(){let e=`OUT outIndex:${this.distributeTileIndex} resIndex:${this.outResourceSelectionIndex}<br />`;for(const t in this.resources)e+=`${t}: ${this.resources[t]}<br />`;return e}exportToWriter(e){const t=Object.keys(this.resources).length;e.writeUint8(t);for(const i in this.resources)e.writeUint32(this.resources[i]);e.writeUint8(this.outResourceSelectionIndex),e.writeUint8(this.distributeTileIndex)}importFromReader(e){const t=e.readUint8(),i=Object.keys(this.resources);for(let r=0;r<t;r++)this.resources[i[r]]=e.readUint32();this.outResourceSelectionIndex=e.readUint8(),this.distributeTileIndex=e.readUint8()}}class me{constructor(e){this.interval=e,this.calculateEfficiencyInterval=50,this.reset()}reset(){this.timer=0,this.efficiency=null,this.workingTime=0,this.totalTime=0}updateWithDescriptionData(e){e.effectivenessStr=this.efficiency!==null?`${Math.round(this.efficiency)}%`:"-"}canStart(){throw new Error("canStart method should be overwritten")}start(){throw new Error("start method should be overwritten")}finished(){throw new Error("finished method should be overwritten")}getEfficiency(){return this.efficiency}calculate(e){this.timer>0&&(this.timer>=this.interval&&(this.finished(e),this.timer=-1),this.timer++),this.timer===0&&this.canStart()&&(this.start(e),this.timer=1),this.totalTime>=this.calculateEfficiencyInterval&&(this.efficiency=Math.round(100*this.workingTime/this.totalTime),this.totalTime=0,this.workingTime=0),this.totalTime++,this.timer>0&&this.workingTime++}toString(){let e="PRODUCTION<br />";return e+=`Efficiency: ${this.efficiency===null?"...":this.efficiency+"%"}<br />`,e+=this.timer===0?"Idle<br />":`${this.timer}/${this.interval}<br />`,e}exportToWriter(e){e.writeUint8(this.timer)}importFromReader(e){this.timer=e.readUint8()}}function we(d){return!Array.isArray(d)||d.length===0?"":d.length===1?d[0]:d.length===2?`${d[0]} and ${d[1]}`:`${d.slice(0,-1).join(", ")} and ${d[d.length-1]}`}function Se(d){return!d||typeof d!="string"?"":d.charAt(0).toLowerCase()+d.slice(1)}class re{constructor(e,t){this.component=e,this.meta=t,this.inResourcesManager=new gt(e,t.inputResources,t.production),this.outResourcesManager=new Xe(e,t.production,t.outputResourcesOrder),this.producer=new me(t.interval),this.producer.canStart=this.canStartProduction.bind(this),this.producer.start=this.startProduction.bind(this),this.producer.finished=this.finishedProduction.bind(this)}clearContents(){this.inResourcesManager.reset(),this.outResourcesManager.reset(),this.producer.reset()}static getMetaUseAmount(e,t,i){const r=e.strategy.inputResources[t].perOutputResource,s=i.getUpgradesManager().getComponentBonuses(e.id).convertAmountBonus;return r*s}getUseAmount(e){return re.getMetaUseAmount(this.component.getMeta(),e,this.component.getFactory())}static getMetaProduceAmount(e,t,i){const r=e.strategy.production[t],s=i.getUpgradesManager().getComponentBonuses(e.id);return r.amount*s.convertAmountBonus*s.convertProduceMoreBonus}getProduceAmount(e){return re.getMetaProduceAmount(this.component.getMeta(),e,this.component.getFactory())}static isProducing(e,t,i){return!t.productionRemoveResearch||!t.productionRemoveResearch[i]||!e.getResearchManager().getResearch(t.productionRemoveResearch[i])}static getMetaDescriptionData(e,t,i){const r=e.strategy,s=t.getGame().getMeta().resourcesById,a=Object.keys(r.inputResources).map(h=>`<span class='${h}'><b>${re.getMetaUseAmount(e,h,t)}</b> ${Se(s[h].name)}</span>`);let u=0;const l=Object.keys(r.production).filter(h=>re.isProducing(t.getGame(),r,h)).map(h=>{const m=re.getMetaProduceAmount(e,h,t);return u=Math.max(u,m),`<span class='${h}'><b>${m}</b> ${Se(s[h].name)}</span>`}),p=[];return{interval:r.interval,inputStr:we(a),outputStr:we(l),storageStr:we(p),noOfOutputs:Math.ceil(u/r.interval/Xe.getMetaOutputAmount(e,t))}}getDescriptionData(){const e=re.getMetaDescriptionData(this.component.getMeta(),this.component.getFactory(),this);return this.producer.updateWithDescriptionData(e),this.inResourcesManager.updateWithDescriptionData(e),this.outResourcesManager.updateWithDescriptionData(e),e}calculateInputTick(){this.inResourcesManager.takeIn()}calculateOutputTick(){this.producer.calculate(),this.outResourcesManager.distribute()}canStartProduction(){for(const e in this.meta.inputResources)if(this.inResourcesManager.getResource(e)<this.getUseAmount(e))return!1;for(const e in this.meta.production)if(this.outResourcesManager.getResource(e)+this.getProduceAmount(e)>this.outResourcesManager.getMax(e))return!1;return!0}startProduction(){for(const e in this.meta.inputResources)this.inResourcesManager.addResource(e,-this.getUseAmount(e))}finishedProduction(){for(const e in this.meta.production)re.isProducing(this.component.getFactory().getGame(),this.meta,e)&&this.outResourcesManager.addResource(e,this.getProduceAmount(e))}toString(){return`${this.inResourcesManager.toString()}<br />${this.outResourcesManager.toString()}<br />${this.producer.toString()}<br />`}exportToWriter(e){this.outResourcesManager.exportToWriter(e),this.inResourcesManager.exportToWriter(e),this.producer.exportToWriter(e)}importFromReader(e,t){this.outResourcesManager.importFromReader(e,t),this.inResourcesManager.importFromReader(e,t),this.producer.importFromReader(e,t)}}const At={6:" million",9:" billion",12:" trillion",15:" quadrillion",18:" quintillion",21:" sextillion",24:" septillion",27:" octillion",30:" nonillion",33:" decillion",36:" undecillion",39:" duodecillion",42:" tredecillion",45:" quattuordecillion",48:" quindecillion",51:" sexdecillion",54:" septendecillion",57:" octodecillion",60:" novemdecillion",63:" vigintillion"},R={format(d){if(d===void 0)return"?";const e=Math.abs(d);if(e<10)return Math.round(d*100)/100;if(e<1e3)return Math.round(d*10)/10;if(e<1e6)return Number(d).toFixed(0).replace(/\d(?=(\d{3})+$)/g,"$& ");let t=d.toString().split("e+",2),i=Number(t[0]);const r=i<0?2:1;let s=3*Math.floor((Math.abs(Math.round(i)).toString().length-r)/3),a=s+(t[1]?Number(t[1]):0);const u=a%3;return i*=Math.pow(10,u-s),a-=u,Math.round(100*i)/100+(At[a]?At[a]:"e"+a)},formatNumber(d){return this.format(d)},formatNumberPlus(d){return(d>0?"+":"")+this.format(d)},test(){const d={1:"1",10:"10",10.5:"10.5",100:"100",100.5:"100.5",1e3:"1 000",1000.5:"1 001",1234.5:"1 235",12134523451212334e8:"1.21 septillion",14860535876960295e9:"14.86 septillion"};for(const e in d){const t=this.nf(Number(e));t===d[e]?console.log(`${e} == ${t}`):console.error(`${e} != ${t}`);const i=this.nf(-Number(e));i==="-"+d[e]?console.log(`-${e} == ${i}`):console.error(`-${e} != ${i}`)}}};class le{constructor(e,t){this.component=e,this.meta=t,this.game=e.getFactory().getGame(),this.inResourcesManager=new gt(e,t.resources),this.producer=new me(t.interval),this.producer.canStart=this.canStartSaleProcess.bind(this),this.producer.start=this.startSale.bind(this),this.producer.finished=this.finishSale.bind(this)}clearContents(){this.inResourcesManager.reset(),this.producer.reset()}static getMetaSellAmount(e,t,i){const r=e.strategy.resources[t].amount,s=i.getUpgradesManager().getComponentBonuses(e.id).sellAmountBonus;return r*s}getSellAmount(e){return le.getMetaSellAmount(this.component.getMeta(),e,this.component.getFactory())}static getMetaSellPrice(e,t,i){const r=e.strategy.resources[t],s=r.sellPrice*(1+r.sellMargin),a=i.getUpgradesManager().getComponentBonuses(e.id).sellPriceBonus;return s*a*i.getGame().getProfitMultiplier()}getSellPrice(e){return le.getMetaSellPrice(this.component.getMeta(),e,this.component.getFactory())}static getMetaDescriptionData(e,t){const i=e.strategy,r=[],s=[];let a=0;const u=t.getGame().getMeta().resourcesById;for(const l in i.resources){const p=i.resources[l],h=le.getMetaSellAmount(e,l,t),m=h*le.getMetaSellPrice(e,l,t);let c=!0;p.requiresResearch&&(c=t.getGame().getResearchManager().getResearch(p.requiresResearch)>0),p.bonus?c&&s.push(`<span class='${l}'><b>${h}</b> ${Se(u[l].name)}</span> adds <b class='money'>$${R.formatNumber(m)}</b>`):(a+=m,r.push(`<span class='${l}'><b>${h}</b> ${Se(u[l].name)}</span>`))}return{isSeller:!0,interval:i.interval,sellPrice:R.formatNumber(a),sellStr:we(r),bonusStr:s.join(", ")}}getDescriptionData(){const e=le.getMetaDescriptionData(this.component.getMeta(),this.component.getFactory());return this.producer.updateWithDescriptionData(e),this.inResourcesManager.updateWithDescriptionData(e),e}calculateInputTick(e){this.inResourcesManager.takeIn(),this.producer.calculate(e)}canStartSaleProcess(){for(const e in this.meta.resources)if(!this.meta.resources[e].bonus&&this.inResourcesManager.getResource(e)<this.getSellAmount(e))return!1;return!0}startSale(e){}finishSale(e){for(const t in this.meta.resources){const i=this.getSellAmount(t);this.inResourcesManager.getResource(t)>=i&&(this.inResourcesManager.addResource(t,-i),e.resourceSales+=i*this.getSellPrice(t))}}toString(){return`${this.inResourcesManager.toString()}<br />${this.producer.toString()}<br />`}exportToWriter(e){this.inResourcesManager.exportToWriter(e),this.producer.exportToWriter(e)}importFromReader(e,t){this.inResourcesManager.importFromReader(e,t),this.producer.importFromReader(e,t)}}class he{constructor(e,t){this.component=e,this.meta=t,this.game=e.getFactory().getGame(),this.noOfItems=0,this.inputTileIndex=0,this.removeAmount=0,this.producer=new me(t.interval),this.producer.canStart=this.canRemove.bind(this),this.producer.start=this.startRemoval.bind(this),this.producer.finished=this.finishRemoval.bind(this)}clearContents(){this.noOfItems=0,this.inputTileIndex=0,this.removeAmount=0,this.producer.reset()}getMax(){return he.getMetaMax(this.component.getMeta(),this.component.getFactory())}static getMetaMax(e,t){return e.strategy.max*t.getUpgradesManager().getComponentBonuses(e.id).maxStorageBonus}getRemoveAmount(){return he.getMetaRemoveAmount(this.component.getMeta(),this.component.getFactory())}static getMetaRemoveAmount(e,t){return e.strategy.removeAmount*t.getUpgradesManager().getComponentBonuses(e.id).removeAmountBonus}takeIn(){const e=this.component.getSurroundedInputTiles();let t=this.inputTileIndex;for(let i=0;i<e.length;i++){const r=e[(t+i)%e.length],s=r.tile.getComponent().getStrategy().getOutputQueue(r.direction);s.getLast()&&this.noOfItems<this.getMax()&&(s.unsetLast(),t=(t+i+1)%e.length,this.noOfItems++),s.forward()}this.inputTileIndex=t}canRemove(){return this.noOfItems>=this.getRemoveAmount()}startRemoval(){this.removeAmount=Math.min(this.noOfItems,this.getRemoveAmount())}finishRemoval(){this.noOfItems-=this.removeAmount,this.removeAmount=0}calculateInputTick(){this.takeIn(),this.producer.calculate()}getDescriptionData(){const e=he.getMetaDescriptionData(this.component.getMeta(),this.component.getFactory(),this);return e.noOfItems=this.noOfItems,this.producer.updateWithDescriptionData(e),e}static getMetaDescriptionData(e,t,i){return{interval:e.strategy.interval,removeAmount:he.getMetaRemoveAmount(e,t),max:i?i.getMax():he.getMetaMax(e,t)}}toString(){let e=`No of items: ${this.noOfItems}<br />${this.producer.toString()}`;return this.removeAmount>0&&(e+=`Removing ${this.removeAmount} items`),e+"<br />"}exportToWriter(e){e.writeUint32(this.noOfItems),e.writeUint8(this.inputTileIndex),e.writeUint32(this.removeAmount),this.producer.exportToWriter(e)}importFromReader(e){this.noOfItems=e.readUint32(),this.inputTileIndex=e.readUint8(),this.removeAmount=e.readUint32(),this.producer.importFromReader(e)}}class er{constructor(e,t){this.component=e,this.meta=t,this.inputTileIndex=0,this.inItem=null,this.inSortingItem=null,this.outItem=null,this.distributeTileIndexes={default:0},this.sortingIndex={};for(const i in this.component.getMeta().allowedOutputs)this.sortingIndex[i]=null;this.producer=new me(t.interval),this.producer.canStart=this.canStartSorting.bind(this),this.producer.start=this.startSorting.bind(this),this.producer.finished=this.finishedSorting.bind(this)}clearContents(){this.inputTileIndex=0,this.inItem=null,this.inSortingItem=null,this.outItem=null,this.distributeTileIndexes={default:0};for(const e in this.sortingIndex)this.sortingIndex[e]&&(this.distributeTileIndexes[this.sortingIndex[e]]=0);this.producer.reset()}calculateInputTick(){if(!this.inItem){const e=this.component.getSurroundedInputTiles();let t=this.inputTileIndex;for(let i=0;i<e.length;i++){const r=e[(t+i)%e.length],s=r.tile.getComponent().getStrategy().getOutputQueue(r.direction),a=s.getLast();a&&!this.inItem&&(s.unsetLast(),t=(t+i+1)%e.length,this.inItem=a),s.forward()}this.inputTileIndex=t}}calculateOutputTick(){this.producer.calculate(),this.moveItemOut()}canStartSorting(){return this.inItem&&!this.outItem}startSorting(){this.inSortingItem=this.inItem,this.inItem=null}finishedSorting(){this.outItem=this.inSortingItem,this.inSortingItem=null,this.moveItemOut()}moveItemOut(){if(!this.outItem)return;let e=this.outItem.getResourceId();this.distributeTileIndexes[e]===void 0&&(e="default");const t=this.component.getSurroundedOutputTiles();for(let i=0;i<t.length;i++){const r=t[this.distributeTileIndexes[e]];this.distributeTileIndexes[e]=(this.distributeTileIndexes[e]+1)%t.length;const s=r.from.getX()-this.component.getX(),a=r.from.getY()-this.component.getY(),u=this.sortingIndex[s+":"+a];if(!(u&&u!==this.outItem.getResourceId()||!u&&this.distributeTileIndexes[this.outItem.getResourceId()]!==void 0)){const l=r.tile.getComponent().getStrategy().getInputQueue(r.oppositeDirection);if(!l.getFirst()){l.setFirst(this.outItem),this.outItem=null;break}}}}setSortingResource(e,t,i){this.sortingIndex[e+":"+t]=i,this.clearContents()}getSortingResource(e,t){return this.sortingIndex[e+":"+t]}toString(){let e=`Next: ${this.inItem?this.inItem.getResourceId():"-"}<br />`;e+=`Sorting: ${this.inSortingItem?this.inSortingItem.getResourceId():"-"}<br />`,e+=`Out: ${this.outItem?this.outItem.getResourceId():"-"}<br />`,e+=this.producer.toString()+"<br />",e+="Sort rules:<br />";for(const t in this.sortingIndex)e+=`${t}: ${this.sortingIndex[t]}<br />`;e+=`<br />Input index: ${this.inputTileIndex}<br />Out indexes:<br />`;for(const t in this.distributeTileIndexes)e+=`${t}: ${this.distributeTileIndexes[t]}<br />`;return e}exportToWriter(e){e.writeUint8(this.inputTileIndex),z.staticExportData(this.inItem,e),z.staticExportData(this.inSortingItem,e),z.staticExportData(this.outItem,e),e.writeUint8(this.distributeTileIndexes.default);for(const t in this.sortingIndex){const i=this.sortingIndex[t];let r=0,s=0;i&&(r=this.component.getFactory().getGame().getMeta().resourcesById[i].idNum,s=this.distributeTileIndexes[i]),e.writeUint8(r),e.writeUint8(s)}this.producer.exportToWriter(e)}importFromReader(e){this.inputTileIndex=e.readUint8(),this.inItem=z.createFromExport(this.component.getFactory(),e),this.inSortingItem=z.createFromExport(this.component.getFactory(),e),this.outItem=z.createFromExport(this.component.getFactory(),e),this.distributeTileIndexes={default:e.readUint8()};for(const t in this.sortingIndex){const i=e.readUint8();this.sortingIndex[t]=i?this.component.getFactory().getGame().getMeta().resourcesByIdNum[i].id:null,this.sortingIndex[t]&&(this.distributeTileIndexes[this.sortingIndex[t]]=e.readUint8())}this.producer.importFromReader(e)}}class pe{constructor(e,t){this.component=e,this.game=this.component.getFactory().getGame(),this.meta=t,this.outResourcesManager=new Xe(e,t.purchaseResources,t.outputResourcesOrder),this.producer=new me(t.interval),this.producer.canStart=this.canBuy.bind(this),this.producer.start=this.preparePurchase.bind(this),this.producer.finished=this.finishPurchase.bind(this)}static getMetaBuyPrice(e,t,i){return e.strategy.purchaseResources[t].price*i.getGame().getProfitMultiplier()}static getMetaBuyAmount(e,t,i){const r=i.getUpgradesManager().getComponentBonuses(e.id);return e.strategy.purchaseResources[t].amount*r.buyAmountBonus}static getMetaDescriptionData(e,t,i){const r=e.strategy,s=t.getGame().getMeta().resourcesById;let a=[],u=0,l=0;for(const p in r.purchaseResources){const h=pe.getMetaBuyAmount(e,p,t),m=pe.getMetaBuyPrice(e,p,t);u+=h*m,a.push(`<span class='${p}'><b>${h}</b> ${Se(s[p].name)}</span>`),l=Math.max(l,h)}return{interval:r.interval,purchasePrice:R.formatNumber(u),buyStr:we(a),noOfOutputs:Math.ceil(l/r.interval/Xe.getMetaOutputAmount(e,t))}}getBuyPrice(e){return pe.getMetaBuyPrice(this.component.getMeta(),e,this.component.getFactory())}getBuyAmount(e){return pe.getMetaBuyAmount(this.component.getMeta(),e,this.component.getFactory())}getDescriptionData(){const e=pe.getMetaDescriptionData(this.component.getMeta(),this.component.getFactory(),this);return this.producer.updateWithDescriptionData(e),this.outResourcesManager.updateWithDescriptionData(e),e}clearContents(){this.outResourcesManager.reset(),this.producer.reset()}calculateOutputTick(e){this.producer.calculate(e),this.outResourcesManager.distribute()}calculatePurchasePrice(){let e=0;for(const t in this.meta.purchaseResources)e+=this.getBuyAmount(t)*this.getBuyPrice(t);return e}canBuy(){for(const e in this.meta.purchaseResources)if(this.outResourcesManager.getResource(e)+this.getBuyAmount(e)>this.outResourcesManager.getMax(e))return!1;return!0}preparePurchase(e){e.resourceCosts+=this.calculatePurchasePrice()}finishPurchase(e){for(const t in this.meta.purchaseResources)this.outResourcesManager.addResource(t,this.getBuyAmount(t))}toString(){return`${this.outResourcesManager.toString()}<br />${this.producer.toString()}<br />`}exportToWriter(e){this.outResourcesManager.exportToWriter(e),this.producer.exportToWriter(e)}importFromReader(e){this.outResourcesManager.importFromReader(e),this.producer.importFromReader(e)}}class Pt{constructor(e,t){this.queue=new Array(e).fill(void 0),this.tile=t}reset(){this.queue.fill(void 0)}forward(){for(let e=this.queue.length-2;e>=0;e--)this.queue[e+1]||(this.queue[e+1]=this.queue[e],this.queue[e]=void 0)}setFirst(e){this.queue[0]=e}unsetFirst(){this.setFirst(void 0)}setLast(e){this.queue[this.queue.length-1]=e}unsetLast(){this.setLast(void 0)}getFirst(){return this.queue[0]}getLast(){return this.queue[this.queue.length-1]}getQueue(){return this.queue}get(e){return this.queue[e]}set(e,t){this.queue[e]=t??void 0}getLength(){return this.queue.length}toString(){return this.queue.join(",")}exportToWriter(e){for(const t of this.queue)z.staticExportData(t,e)}importFromReader(e){for(let t=0;t<this.queue.length;t++)this.set(t,z.createFromExport(this.tile.getFactory(),e))}}const tr={top:"bottom",bottom:"top",left:"right",right:"left"};class It{constructor(e,t){this.component=e,this.meta=t,this.tile=this.component.getMainTile(),this.reset()}reset(){this.inputQueueOffset=0,this.inputQueuesList=[],this.inputQueues={},this.outputQueueOffset=0,this.outputQueuesList=[],this.outputQueues={},this.isBridge=!1}clearContents(){this.updateInputsOutputs()}static getMetaDescriptionData(e,t){return{}}getDescriptionData(){return It.getMetaDescriptionData(this.component.getMeta(),this.component.getFactory())}updateInputsOutputs(){this.reset();const e=this.tile.getInputOutputManager().getInputsByDirection();for(const s in e)if(e[s]){const a=new Pt(this.meta.queueSize,this.tile);this.inputQueuesList.push(a),this.inputQueues[s]=a}const t=this.tile.getInputOutputManager().getOutputsByDirection();for(const s in t)if(t[s]){const a=new Pt(this.meta.queueSize,this.tile);this.outputQueuesList.push(a),this.outputQueues[s]=a}const i=this.outputQueues.top&&this.inputQueues.bottom||this.outputQueues.bottom&&this.inputQueues.top,r=this.outputQueues.left&&this.inputQueues.right||this.outputQueues.right&&this.inputQueues.left;this.isBridge=i&&r}getOutputQueues(){return this.outputQueues}getOutputQueue(e){return this.outputQueues[e]}getInputQueues(){return this.inputQueues}getInputQueue(e){return this.inputQueues[e]}calculateTransport(){this.isBridge?(this.moveInternalInputsToOutputsBridge("top","bottom"),this.moveInternalInputsToOutputsBridge("left","right")):this.moveInternalInputsToOutputs(),["top","right","bottom","left"].forEach(e=>this.pullFromOutsideToInputs(e,this.inputQueues[e]))}moveInternalInputsToOutputsBridge(e,t){this.inputQueues[t]&&([e,t]=[t,e]);const i=this.inputQueues[e],r=this.outputQueues[t],s=i.getLast();s&&!r.getFirst()&&(r.setFirst(s),i.unsetLast()),i.forward()}moveInternalInputsToOutputs(){let e=0;for(let t=0;t<this.inputQueuesList.length;t++){const i=this.inputQueuesList[(this.inputQueueOffset+t)%this.inputQueuesList.length],r=i.getLast();if(!r){i.forward();continue}for(let s=0;s<this.outputQueuesList.length;s++){const a=(this.outputQueueOffset+s)%this.outputQueuesList.length,u=this.outputQueuesList[a];if(!u.getFirst()){this.outputQueueOffset=(this.outputQueueOffset+1)%this.outputQueuesList.length,u.setFirst(r),i.unsetLast(),e++;break}}i.forward()}this.inputQueueOffset=(this.inputQueueOffset+e)%this.inputQueuesList.length}pullFromOutsideToInputs(e,t){if(!t)return;const r=this.tile.getTileInDirection(e).getComponent();if(r.getMeta().strategy.type==="transport"){const s=r.getStrategy().getOutputQueue(tr[e]);!t.getFirst()&&s.getLast()&&(t.setFirst(s.getLast()),s.unsetLast()),s.forward()}}toString(){let e=`IN offset:${this.inputQueueOffset}<br />`;for(const t in this.inputQueues)e+=t+": "+this.inputQueues[t].getQueue().map(i=>i?i.getResourceId():"").join(",")+"<br />";e+=`<br />OUT offset:${this.outputQueueOffset}<br />`;for(const t in this.outputQueues)e+=t+": "+this.outputQueues[t].getQueue().map(i=>i?i.getResourceId():"").join(",")+"<br />";return e}exportToWriter(e){const t=i=>i?.exportToWriter(e);e.writeUint8(this.inputQueueOffset),e.writeUint8(this.outputQueueOffset),["top","right","bottom","left"].forEach(i=>t(this.inputQueues[i])),["top","right","bottom","left"].forEach(i=>t(this.outputQueues[i]))}importFromReader(e){const t=i=>i?.importFromReader(e);this.inputQueueOffset=e.readUint8(),this.outputQueueOffset=e.readUint8(),["top","right","bottom","left"].forEach(i=>t(this.inputQueues[i])),["top","right","bottom","left"].forEach(i=>t(this.outputQueues[i]))}}class de{constructor(e,t){this.component=e,this.meta=t,this.game=e.getFactory().getGame(),this.productionBonus=0,this.inResourcesManager=new gt(e,t.resources),this.producer=new me(t.interval),this.producer.canStart=this.canProduce.bind(this),this.producer.start=this.startProduction.bind(this),this.producer.finished=this.finishProduction.bind(this)}clearContents(){this.inResourcesManager.reset(),this.producer.reset()}static getMetaBonus(e,t,i){return e.strategy.resources[t].bonus*i.getUpgradesManager().getComponentBonuses(e.applyUpgradesFrom?e.applyUpgradesFrom:e.id).researchPaperBonus}getBonus(e){return de.getMetaBonus(this.component.getMeta(),e,this.component.getFactory())}static getResearchProduction(e,t){return e.strategy.researchProduction*t.getGame().getResearchProductionMultiplier()}getResearchProduction(){return de.getResearchProduction(this.component.getMeta(),this.component.getFactory())}static getMetaDescriptionData(e,t,i){const r=e.strategy.resources,s=t.getGame().getMeta().resourcesById,a=Object.keys(r).map(u=>`<span class='${u}'>${s[u].name.lcFirst()}: <b>${nf(de.getMetaBonus(e,u,t))}</b></span> `);return{interval:e.strategy.interval,bonusStr:arrayToHumanStr(a),productionStr:`<span class='research'><b>${nf(de.getResearchProduction(e,t))}</b> research points </span>`}}getDescriptionData(){const e=de.getMetaDescriptionData(this.component.getMeta(),this.component.getFactory(),this);return this.producer.updateWithDescriptionData(e),this.inResourcesManager.updateWithDescriptionData(e),e}calculateInputTick(){this.inResourcesManager.takeIn(),this.producer.calculate()}canProduce(){return!0}startProduction(){let e=1;for(const t in this.meta.resources)e+=this.inResourcesManager.getResource(t)*this.getBonus(t),this.inResourcesManager.addResource(t,-this.inResourcesManager.getResource(t));this.productionBonus=e}finishProduction(e){e.researchProduction+=this.getResearchProduction()*this.productionBonus}toString(){return this.producer.toString()+"<br />"}exportToWriter(e){e.writeUint32(this.productionBonus),this.producer.exportToWriter(e)}importFromReader(e){this.productionBonus=e.readUint32(),this.producer.importFromReader(e)}}class Re{constructor(e,t){this.component=e,this.meta=t,this.inResourcesManager=new gt(e,t.inputResources),this.outResourcesManager=new Xe(e,t.production,t.outputResourcesOrder),this.productionBonus=0,this.producer=new me(t.interval),this.producer.canStart=this.canStartProduction.bind(this),this.producer.start=this.startProduction.bind(this),this.producer.finished=this.finishedProduction.bind(this)}clearContents(){this.inResourcesManager.reset(),this.outResourcesManager.reset(),this.producer.reset()}static isProducing(e,t,i){return!t.productionRemoveResearch||!t.productionRemoveResearch[i]||!e.getResearchManager().getResearch(t.productionRemoveResearch[i])}static getMetaDescriptionData(e,t,i){const r=e.strategy||e,s=t.getGame().getMeta().resourcesById,a=[],u=[],l=[],p=[];let h=0;for(const m in r.inputResources){const c=r.inputResources[m];a.push(`<span class='${m}'><b>${c.perOutputResource}</b> ${s[m].nameShort.lcFirst()}</span>`),l.push(`<span class='${m}'>${s[m].nameShort.lcFirst()}: <b>${c.max}</b></span>`),p.push(`<span class='${m}'>${s[m].nameShort.lcFirst()}: <b>${c.bonus}</b></span>`),h+=c.bonus}for(const m in r.production)if(Re.isProducing(t.getGame(),r,m)){const c=r.production[m];u.push(`<span class='${m}'><b>${c.amount}</b> ${s[m].nameShort.lcFirst()}</span>`),l.push(`<span class='${m}'>${s[m].nameShort.lcFirst()}: <b>${c.max}</b></span>`)}return{interval:r.interval,inputStr:arrayToHumanStr(a),outputStr:arrayToHumanStr(u),storageStr:arrayToHumanStr(l),bonusStr:arrayToHumanStr(p),maxBonus:h}}getDescriptionData(){const e=Re.getMetaDescriptionData(this.component.getMeta(),this.component.getFactory(),this);return this.producer.updateWithDescriptionData(e),this.inResourcesManager.updateWithDescriptionData(e),this.outResourcesManager.updateWithDescriptionData(e),e}calculateInputTick(){this.inResourcesManager.takeIn()}calculateOutputTick(){this.producer.calculate(),this.outResourcesManager.distribute()}canStartProduction(){for(const e in this.meta.production)if(this.outResourcesManager.getResource(e)+this.meta.production[e].amount>this.outResourcesManager.getMax(e))return!1;return!0}startProduction(){let e=1;for(const t in this.meta.inputResources){const i=this.meta.inputResources[t];this.inResourcesManager.getResource(t)>=i.perOutputResource&&(this.inResourcesManager.addResource(t,-i.perOutputResource),e+=i.bonus)}this.productionBonus=e}finishedProduction(){for(const e in this.meta.production)Re.isProducing(this.component.getFactory().getGame(),this.meta,e)&&this.outResourcesManager.addResource(e,this.meta.production[e].amount*this.productionBonus)}toString(){return this.inResourcesManager.toString()+"<br />"+this.outResourcesManager.toString()+"<br />"+this.producer.toString()+"<br />"}exportToWriter(e){e.writeUint32(this.productionBonus),this.outResourcesManager.exportToWriter(e),this.inResourcesManager.exportToWriter(e),this.producer.exportToWriter(e)}importFromReader(e){this.productionBonus=e.readUint32(),this.outResourcesManager.importFromReader(e),this.inResourcesManager.importFromReader(e),this.producer.importFromReader(e)}}const ir=Object.freeze(Object.defineProperty({__proto__:null,buyer:pe,converter:re,garbage:he,lab:Re,researchCenter:de,seller:le,sorter:er,transport:It},Symbol.toStringTag,{value:"Module"}));class pt{static getStrategyClass(e){const t=ir[e];if(!t)throw new Error("Unknown component strategy "+e);return t}static getForComponent(e){const t=e.getMeta().strategy?.type,i=this.getStrategyClass(t);return new i(e,e.getMeta().strategy)}static getMetaDescriptionData(e,t){const i=this.getStrategyClass(e.strategy.type);if(typeof i.getMetaDescriptionData!="function")throw new Error(`Strategy class ${e.strategy.type} has no getMetaDescriptionData method`);return i.getMetaDescriptionData(e,t)}}class Ae{constructor(e,t,i,r){this.meta=r,this.factory=e,this.x=t,this.y=i,this.strategy=pt.getForComponent(this),this.surroundedInputTiles=[],this.surroundedOutputTiles=[]}static getMetaDescriptionData(e,t,i){const r=pt.getMetaDescriptionData(e,t,i);return this._addCommonMetaDescriptionData(r,e,t,i),r}getDescriptionData(){const e=this.strategy.getDescriptionData();return Ae._addCommonMetaDescriptionData(e,this.meta,this.factory,this.strategy),e}static _addCommonMetaDescriptionData(e,t,i,r){e.name=t.name,e["is"+t.strategy.type.charAt(0).toUpperCase()+t.strategy.type.slice(1)]=!0,e.description=t.description,e.priceStr="$"+R.formatNumber(t.price),t.runningCostPerTick&&(e.runningCostStr="$"+R.formatNumber(this.getMetaRunningCostPerTick(t,i))+"/tick")}static getMetaRunningCostPerTick(e,t){const i=t.getUpgradesManager().getComponentBonuses(e.applyUpgradesFrom??e.id);return e.runningCostPerTick*i.runningCostPerTickIncrease*i.runningCostPerTickBonus*t.getGame().getProfitMultiplier()}getRunningCostPerTick(){return Ae.getMetaRunningCostPerTick(this.meta,this.factory)}_checkForSurroundedInputsOutputs(e,t,i){const r=this.factory.getTile(e,t),s=r.getInputOutputManager().getOutputsByDirection()[i];s&&this.surroundedOutputTiles.push({tile:s,from:r,direction:r.getDirection(s),oppositeDirection:s.getDirection(r)});const a=r.getInputOutputManager().getInputsByDirection()[i];a&&this.surroundedInputTiles.push({tile:a,from:r,direction:a.getDirection(r),oppositeDirection:r.getDirection(a)})}_updateSurroundedTilesCache(){this.surroundedInputTiles=[],this.surroundedOutputTiles=[];for(let e=this.x;e<this.x+this.meta.width;e++)this._checkForSurroundedInputsOutputs(e,this.y,"top");for(let e=this.y;e<this.y+this.meta.height;e++)this._checkForSurroundedInputsOutputs(this.x+this.meta.width-1,e,"right");for(let e=this.x+this.meta.width-1;e>=this.x;e--)this._checkForSurroundedInputsOutputs(e,this.y+this.meta.height-1,"bottom");for(let e=this.y+this.meta.height-1;e>=this.y;e--)this._checkForSurroundedInputsOutputs(this.x,e,"left")}outputsInputsChanged(){this._updateSurroundedTilesCache(),this.getStrategy().clearContents(),this.getStrategy().updateInputsOutputs&&this.getStrategy().updateInputsOutputs()}getSurroundedInputTiles(){return this.surroundedInputTiles}getSurroundedOutputTiles(){return this.surroundedOutputTiles}calculateInputTick(e){this.meta.runningCostPerTick>0&&(e.runningCosts+=this.getRunningCostPerTick())}getFactory(){return this.factory}getMeta(){return this.meta}getStrategy(){return this.strategy}getX(){return this.x}getY(){return this.y}getMainTile(){return this.factory.getTile(this.x,this.y)}exportToWriter(e){this.strategy.exportToWriter(e)}importFromReader(e,t){this.strategy.importFromReader(e,t)}}const rr={top:[0,-1],right:[1,0],bottom:[0,1],left:[-1,0],top_right:[1,-1],top_left:[-1,-1],bottom_right:[1,1],bottom_left:[-1,1]},sr={"-10":"top","-1":"left",1:"right",10:"bottom"};class Z{static BUILDABLE_NO="X";static BUILDABLE_YES=" ";static BUILDABLE_PARTIAL="-";constructor(e,t,i,r,s){this.id=t*s.getMeta().tilesX+e,this.x=e,this.y=t,this.factory=s,this.setTerrain(r),this.setBuildableType(i),this.component=null,this.inputOutputManager=new Zi(this,()=>{this.component&&this.component.outputsInputsChanged()})}getId(){return this.id}getIdStr(){return`${this.x}:${this.y}`}getX(){return this.x}getY(){return this.y}setBuildableType(e){[Z.BUILDABLE_YES,Z.BUILDABLE_PARTIAL].includes(e)||(e=Z.BUILDABLE_NO),this.buildableType=e}getBuildableType(){return this.buildableType}isPossibleToBuildOnType(e){return this.buildableType===Z.BUILDABLE_YES||e.canBuildToPartial&&this.buildableType===Z.BUILDABLE_PARTIAL}setTerrain(e="grass"){this.terrain=e}getTerrain(){return this.terrain}getInputOutputManager(){return this.inputOutputManager}getDirection(e){return sr[String(10*(e.getY()-this.y)+(e.getX()-this.x))]}getTileInDirection(e){const[t,i]=rr[e];return this.factory.getTile(this.x+t,this.y+i)}isMainComponentContainer(){return this.component&&this.component.getX()===this.x&&this.component.getY()===this.y}getFactory(){return this.factory}getComponent(){return this.component}setComponent(e){if(e){const t=new Ae(this.factory,this.x,this.y,e);for(let i=0;i<e.width;i++)for(let r=0;r<e.height;r++){const s=this.factory.getTile(this.x+i,this.y+r);s&&(s.component=t)}this.component=t}else this.component=null;this.inputOutputManager.reset()}exportToWriter1(e){this.inputOutputManager.exportToWriter(e)}exportToWriter2(e){this.component.exportToWriter(e)}importFromReader1(e,t){this.inputOutputManager.importFromReader(e,t)}importFromReader2(e,t){this.component.importFromReader(e,t)}}class Be{constructor(e=[],t=""){this.handledEvents=e,this.eventTag=t,this.events={}}addListener(e,t,i){t||console.warn("Trying to add listener with undefined type!",e),(Array.isArray(this.handledEvents)?this.handledEvents:Object.values(this.handledEvents)).includes(t)||console.warn(`${this.eventTag}: Event ${t} is not handled. ${e} tried to listen for it.`),this.events[t]||(this.events[t]={}),this.events[t][e]=i}removeListener(e,t){this.events[t]&&this.events[t][e]&&delete this.events[t][e]}removeListenerForType(e){for(const t in this.events)this.events[t][e]&&delete this.events[t][e]}invokeEvent(e,...t){if(this.events[e])for(const i in this.events[e]){const r=this.events[e][i];r&&r(...t)}}}class te{getNextMultiplier(){return this.meta.levels[this.amount]?this.meta.levels[this.amount].bonus:0}getTotalMultiplier(){let e=0;for(let t=0;t<this.amount;t++){const i=this.meta.levels[t];i&&(e+=i.bonus)}return e}getMultiplierStrings(e=!1){const t=this.getNextMultiplier(),i=1+this.getTotalMultiplier();let r=0;t>0&&(r=(i+t)/i-1);const s=Math.round(r*1e4)/100;return e?{total:`${Math.round((i-1)*1e4)/100}%`,next:`<b>${s}%</b>`}:{total:`${i}x`,next:`<b>${s}%</b>`}}}class nr extends te{constructor(e,t,i){super(),this.meta=e,this.amount=t,this.factory=i}updateMap(e){const t=this.getTotalMultiplier(),i=e.byComponent[this.meta.componentId];i.runningCostPerTickIncrease+=t,i.buyAmountBonus+=t,i.maxStorageBonus+=t}getTitle(){return"Amount of resources component buys"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`<b>${e.name}</b> buys <span class="green">${t.next}</span> more resources.<br />`+(this.meta.noRunningCost?"":`Increases running cost by <b class="red">${t.next}</b><br />`)+`<br />More production per component, but expenses are proportionally the same. More production per component => more resources to sell.<br /><br /><b>Current total buy resources bonus: </b><b class="green">${t.total}</b>`}}class or extends te{constructor(e,t,i){super(),this.meta=e,this.amount=t,this.factory=i}updateMap(e){const t=this.getTotalMultiplier(),i=e.byComponent[this.meta.componentId];i.runningCostPerTickIncrease+=t,i.convertAmountBonus+=t,i.maxStorageBonus+=t}getTitle(){return"Amount of resources used and produced amount"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`<b>${e.name}</b> uses and produces <b class="green">${t.next}</b> more resources.<br />`+(this.meta.noRunningCost?"":`Increases running cost by <b class="red">${t.next}</b><br />`)+`<br />More production per component, but expenses are proportionally the same. More production per component => more resources to sell.<br /><br /><b>Current total increase: </b><b class="green">${t.total}</b>`}}class ar extends te{constructor(e,t,i){super(),this.meta=e,this.amount=t,this.factory=i}updateMap(e){const t=this.getTotalMultiplier(),i=e.byComponent[this.meta.componentId];i.runningCostPerTickIncrease+=t,i.convertProduceMoreBonus+=t,i.maxStorageBonus+=t}getTitle(){return"Amount of resources produced"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`<b>${e.name}</b> produces <b class="green">${t.next}</b> more resources.<br />`+(this.meta.noRunningCost?"":`Increases running cost by <b class="red">${t.next}</b><br />`)+`<br />More production per component with less raw materials, but expenses are proportionally the same. More production per component => more resources to sell.<br /><br /><b>Current total increase: </b><b class="green">${t.total}</b>`}}class cr extends te{constructor(e,t,i){super(),this.meta=e,this.amount=t,this.factory=i}updateMap(e){const t=this.getTotalMultiplier(),i=e.byComponent[this.meta.componentId];i.removeAmountBonus+=t,i.maxStorageBonus+=t}getTitle(){return"Amount of resources removed"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`${e.name} removes ${t.next} more items<br /><br /><b>Current total bonus: </b><b class="green">${t.total}</b>`}}class ur extends te{constructor(e,t,i){super(),this.meta=e,this.amount=t,this.factory=i}updateMap(e){const t=this.getTotalMultiplier();this.meta.componentId?e.byComponent[this.meta.componentId].packageSizeBonus+=t:e.packageSizeBonus+=t}getTitle(){return"Package size"}getDescription(){let e=null;this.meta.componentId&&(e=this.factory.getGame().getMeta().componentsById[this.meta.componentId]);const t=this.getMultiplierStrings();return`<b>${e?e.name+" outputs":"All components output"}</b> <span class="green">${t.next}</span> more resources into single package.<br /><br />Makes conveyors much more effective, as they transport more resources.<br /><br /><b>Current total bonus: </b><b class="green">${t.total}</b>`}}class lr extends te{constructor(e,t,i){super(),this.meta=e,this.amount=t,this.factory=i}updateMap(e){const t=this.getTotalMultiplier(),i=e.byComponent[this.meta.componentId];i.runningCostPerTickIncrease+=t,i.researchPaperBonus+=t}getTitle(){return"Research paper bonus"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`<b>${e.name}</b> research paper bonus increased by <b class="green">${t.next}</b><br /><br /><b>Current total increase: </b><b class="green">${t.total}</b>`}}class hr extends te{constructor(e,t,i){super(),this.meta=e,this.amount=t,this.factory=i}updateMap(e){e.byComponent[this.meta.componentId].maxStorageBonus+=this.getTotalMultiplier()}getTitle(){return"Max stock size"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`<b>${e.name}</b> max stock increased by <b class="green">${t.next}</b><br /><br /> <b>Current total increase: </b><b class="green">${t.total}</b>`}}class pr extends te{constructor(e,t,i){super(),this.meta=e,this.amount=t,this.factory=i}updateMap(e){e.byComponent[this.meta.componentId].runningCostPerTickBonus-=this.getTotalMultiplier()}getTitle(){return"Reduce running costs"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings(!0);return`<b>${e.name}</b> running costs are reduced by <b class="green">${t.next}</b><br /><br /><b>Current total decrease: </b><b class="green">${t.total}</b>`}}class dr extends te{constructor(e,t,i){super(),this.meta=e,this.amount=t,this.factory=i}updateMap(e){const t=this.getTotalMultiplier(),i=e.byComponent[this.meta.componentId];i.runningCostPerTickIncrease+=t,i.sellAmountBonus+=t,i.maxStorageBonus+=t}getTitle(){return"Amount of resources sold"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`<b>${e.name}</b> sells <b class="green">${t.next}</b> more resources.<br />`+(this.meta.noRunningCost?"":`Increases running cost by <b class="red">${t.next}</b><br />`)+`<br />More resources sold per tick in average => more money<br /><br /><b>Current total increase: </b><b class="green">${t.total}</b>`}}class Xr extends te{constructor(e,t,i){super(),this.meta=e,this.amount=t,this.factory=i}updateMap(e){e.byComponent[this.meta.componentId].sellPriceBonus+=this.getTotalMultiplier()}getTitle(){return"Resources sale price"}getDescription(){const e=this.factory.getGame().getMeta().componentsById[this.meta.componentId],t=this.getMultiplierStrings();return`<b>${e.name}</b> sells with <b class="green">${t.next}</b> higher price. <br /><br /><b>Current total increase: </b><b class="green">${t.total}</b>`}}const mr={buyer:nr,converter:or,converterProduceMore:ar,garbage:cr,packageSize:ur,researchCenterBonus:lr,researchCenterMaxStock:hr,runningCost:pr,sellerSellAmount:dr,sellerSellPrice:Xr},gr={getStrategyClass(d){const e=mr[d];if(!e)throw new Error(`Unknown component strategy ${d}`);return e},getStrategy(d,e,t){const i=this.getStrategyClass(d.type);return new i(d,e,t)}};class se{constructor(){this.data=[],this.totalLength=0}_write(e,t,i){return this.data.push({value:e,length:t,method:i}),this.totalLength+=t,this}writeInt8(e){return this._write(e,1,"setInt8")}writeInt16(e){return this._write(e,2,"setInt16")}writeInt32(e){return this._write(e,4,"setInt32")}writeUint8(e){return this._write(e,1,"setUint8")}writeUint16(e){return this._write(e,2,"setUint16")}writeUint32(e){return this._write(e,4,"setUint32")}writeFloat64(e){return this._write(e,8,"setFloat64")}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeBooleanMap(e){return this.writeUint8(e.getValue())}writeBooleansArrayFunc(e,t){let i=null;for(let r=0;r<e.length;r++)i||(i=new Et),i.writeBoolean(t(e[r])?1:0),(r+1)%8===0&&(this.writeBooleanMap(i),i=null);return i&&(i.fillZero(),this.writeBooleanMap(i)),this}writeWriter(e){if(!e)return this.writeInt32(0);const t=e.getData();this.writeInt32(e.getTotalLength());for(const i of t)this._write(i.value,i.length,i.method);return this}getData(){return this.data}getTotalLength(){return this.totalLength}getBuffer(){const e=new ArrayBuffer(this.totalLength),t=new DataView(e);let i=0;for(const r of this.data)t[r.method](i,r.value,!0),i+=r.length;return e}}class fr{constructor(e){this.factory=e,this.game=e.getGame(),this.upgrades={},this.isChanged=!0}buildMap(){const e={packageSizeBonus:0,byComponent:{}};for(const i in this.game.getMeta().componentsById)e.byComponent[i]={runningCostPerTickIncrease:1,runningCostPerTickBonus:1,buyAmountBonus:1,maxStorageBonus:1,packageSizeBonus:0,convertAmountBonus:1,convertProduceMoreBonus:1,removeAmountBonus:1,researchPaperBonus:1,sellAmountBonus:1,sellPriceBonus:1};const t=this.game.getMeta().upgrades;for(const i in t)this.getStrategy(t[i].id).updateMap(e);return e}getBonuses(){return this.isChanged&&(this.bonuses=this.buildMap(),this.isChanged=!1),this.bonuses}getComponentBonuses(e){return this.getBonuses().byComponent[e]}setUpgrade(e,t){this.upgrades[e]=t,this.isChanged=!0}addUpgrade(e,t){this.setUpgrade(e,this.getUpgrade(e)+t)}getUpgrade(e){return this.upgrades[e]||0}getStrategy(e){const t=this.game.getMeta().upgradesById[e];return gr.getStrategy(t,this.getUpgrade(e),this.factory)}getPrice(e,t=this.getUpgrade(e)){return this.game.getMeta().upgradesById[e].levels[t]?.price??0}getSellPrice(e){const t=this.game.getMeta().upgradesById[e];return this.getUpgrade(e)<=0?0:this.getPrice(e,this.getUpgrade(e)-1)*t.refund}canPurchase(e){return this.couldPurchase(e)&&this.game.getMoney()>=this.getPrice(e)&&this.isVisible(e)}couldPurchase(e){const t=this.game.getMeta().upgradesById[e];return this.getUpgrade(e)<t.levels.length}isVisible(e){const t=this.game.getMeta().upgradesById[e];return!t.requiresResearch||this.game.getResearchManager().getResearch(t.requiresResearch)>0}canSell(e){const t=this.game.getMeta().upgradesById[e];return this.getUpgrade(e)>0&&t.refund!=null&&this.isVisible(e)}exportToWriter(){const e=Object.keys(this.upgrades).filter(i=>this.upgrades[i]>0).length,t=new se;t.writeUint16(e);for(const i in this.upgrades){const r=this.upgrades[i];r>0&&(t.writeUint16(this.game.getMeta().upgradesById[i].idNum),t.writeUint16(r))}return t}importFromReader(e){if(!e.getLength())return;this.upgrades={};const t=e.readUint16();for(let i=0;i<t;i++){const r=e.readUint16(),s=e.readUint16(),a=this.game.getMeta().upgradesByIdNum[r];a&&(this.upgrades[a.id]=s)}this.isChanged=!0}}class yr{constructor(e){this.factory=e,this.game=e.getGame(),this.boughtAreas={}}setAreaBought(e,t){this.boughtAreas[e]=t}getIsAreaBought(e){return!!this.boughtAreas[e]}getPrice(e){return this.factory.getMeta().areasById[e]}canPurchase(e){return this.game.getMoney()>=this.getPrice(e)}canBuildAt(e,t,i,r){for(const s of this.factory.getMeta().areas)for(const a of s.locations)if(!(a.x>=e+i||a.x+a.width<=e||a.y>=t+r||a.y+a.height<=t)&&!this.boughtAreas[s.id])return!1;return!0}exportToWriter(){const e=Object.keys(this.boughtAreas).length,t=new se;t.writeUint8(e);for(const i in this.boughtAreas)t.writeUint8(this.factory.getMeta().areasById[i].idNum);return t}importFromReader(e){if(!e.getLength())return;this.boughtAreas={};const t=e.readUint8();for(let i=0;i<t;i++){const r=e.readUint8(),s=this.factory.getMeta().areasByIdNum[r];this.setAreaBought(s.id,!0)}}}const _={FACTORY_COMPONENTS_CHANGED:"FACTORY_COMPONENTS_CHANGED",TILE_TYPE_CHANGED:"TILE_TYPE_CHANGED",FACTORY_TICK:"FACTORY_TICK",FACTORY_MOUSE_OUT:"FACTORY_MOUSE_OUT",FACTORY_MOUSE_MOVE:"FACTORY_MOUSE_MOVE",FACTORY_MOUSE_DOWN:"FACTORY_MOUSE_DOWN",FACTORY_MOUSE_UP:"FACTORY_MOUSE_UP",FACTORY_SCROLL_START:"FACTORY_SCROLL_START",FACTORY_SCROLL_END:"FACTORY_SCROLL_END",COMPONENT_META_SELECTED:"COMPONENT_META_SELECTED",HOVER_COMPONENT_META:"HOVER_COMPONENT_META",MAP_TOOL_SELECTED:"MAP_TOOL_SELECTED",COMPONENT_SELECTED:"COMPONENT_SELECTED",REFRESH_COMPONENT_INFO:"REFRESH_COMPONENT_INFO",UPGRADE_BOUGHT:"UPGRADE_BOUGHT",OPEN_SCREENSHOT_VIEW:"SHOW_SCREENSHOT_VIEW"};class Ge{constructor(e,t){this.tile=e,this.factory=e.getFactory(),this.componentMeta=t}static possibleToBuy(e,t){return!t.requiresResearch||e.getGame().getResearchManager().getResearch(t.requiresResearch)>0}canBuy(){return this.factory.isPossibleToBuildOnTypeWithSize(this.tile.getX(),this.tile.getY(),this.componentMeta.width,this.componentMeta.height,this.componentMeta)&&!(this.componentMeta.price>this.factory.getGame().getMoney())&&Ge.possibleToBuy(this.factory,this.componentMeta)&&this.factory.getAreasManager().canBuildAt(this.tile.getX(),this.tile.getY(),this.componentMeta.width,this.componentMeta.height)}buy(){this.factory.getGame().addMoney(-this.componentMeta.price),this.buyFree()}buyFree(){this.tile.setComponent(this.componentMeta),this.factory.getEventManager().invokeEvent(_.FACTORY_COMPONENTS_CHANGED,this.tile)}}class _i{constructor(e,t){this.fromTile=e,this.toTile=t,this.factory=e.getFactory()}canUpdate(){const e=this.fromTile.getComponent(),t=this.toTile.getComponent();if(!e||!t||e===t||!this.fromTile.getDirection(this.toTile))return!1;const i=e.getMeta(),r=t.getMeta();return(i.strategy.type==="transport"||r.strategy.type==="transport")&&this._isLinkAllowed(this.fromTile,this.toTile,i.allowedOutputs)&&this._isLinkAllowed(this.toTile,this.fromTile,r.allowedInputs)&&!this._detectLoop(this.fromTile,this.toTile)}_isLinkAllowed(e,t,i){if(!i)return!0;const r=e.getDirection(t),s=e.getX()-e.getComponent().getX(),a=e.getY()-e.getComponent().getY();return i[`${s}:${a}`]||i[`${s}:${a}:${r}`]}_detectLoop(e,t){const i=(r,s=0)=>{if(r.getComponent().getMeta().strategy.type!=="transport")return!1;if(r.getId()===e.getId()&&s>0)return!0;for(const a of r.getInputOutputManager().getOutputsList())if(i(a,s+1))return!0;return!1};return i(t,0)}update(){this.fromTile.getInputOutputManager().setOutput(this.fromTile.getDirection(this.toTile)),this.factory.getEventManager().invokeEvent(_.FACTORY_COMPONENTS_CHANGED,this.fromTile)}}class vr{constructor(e){this.factory=e,this.factoryMeta=e.getMeta(),this.gameMeta=e.getGame().getMeta()}init(){return this._initComponents(),this._initTransportLines(),this}_initComponents(){if(this.factoryMeta.startComponents)for(const e of this.factoryMeta.startComponents){const t=this.factory.getTile(e.x,e.y);new Ge(t,this.gameMeta.componentsById[e.id]).buyFree()}}_initTransportLines(){if(this.factoryMeta.transportLineConnections)for(const e of this.factoryMeta.transportLineConnections){const t=this.factory.getTile(e.fromX,e.fromY),i=this.factory.getTile(e.toX,e.toY),r=new _i(t,i);r.canUpdate()&&r.update()}}}class br{constructor(e,t){this.game=t,this.isPaused=!1,this.isBought=!1,this.meta=e,this.em=new Be(_,"Factory"),this.upgradesManager=new fr(this),this.tiles=[],this.components=[];for(let i=0;i<e.tilesY;i++)for(let r=0;r<e.tilesX;r++){const s=e.terrains[e.terrainMap[i*e.tilesX+r]],a=e.buildMap[i*e.tilesX+r];this.tiles[i*e.tilesX+r]=new Z(r,i,a,s,this)}this.areasManager=new yr(this)}reset(){this.tiles.forEach(e=>e.setComponent(null)),new vr(this).init()}getEventManager(){return this.em}getUpgradesManager(){return this.upgradesManager}getAreasManager(){return this.areasManager}getMeta(){return this.meta}setIsBought(e){this.isBought=e}getIsBought(){return this.isBought}getGame(){return this.game}getTiles(){return this.tiles}getComponents(){return this.components}getTile(e,t){return e<0||e>=this.meta.tilesX||t<0||t>=this.meta.tilesY?null:this.tiles[t*this.meta.tilesX+e]}getIsPaused(){return this.isPaused}setIsPaused(e){this.isPaused=e}isOnMap(e,t,i=1,r=1){return e>=0&&t>=0&&e+i<=this.meta.tilesX&&t+r<=this.meta.tilesY}isPossibleToBuildOnTypeWithSize(e,t,i=1,r=1,s){if(!this.isOnMap(e,t,i,r))return!1;for(let a=0;a<i;a++)for(let u=0;u<r;u++){const l=this.getTile(e+a,t+u);if(!l||!l.isPossibleToBuildOnType(s)||l.getComponent())return!1}return!0}exportToWriter(){const e=new se;e.writeWriter(this.upgradesManager.exportToWriter()),e.writeWriter(this.areasManager.exportToWriter()),e.writeUint8(this.isPaused?1:0),e.writeUint8(this.isBought?1:0),e.writeUint8(this.meta.tilesX),e.writeUint8(this.meta.tilesY);const t=[];e.writeBooleansArrayFunc(this.tiles,i=>i.isMainComponentContainer()?(t.push(i),!0):!1);for(const i of t)e.writeUint8(i.getComponent().getMeta().idNum);for(const i of t)i.exportToWriter1(e);for(const i of t)i.exportToWriter2(e);return e}importFromReader(e,t){this.upgradesManager.importFromReader(e.readReader(),t),this.areasManager.importFromReader(e.readReader(),t),this.isPaused=!!e.readUint8(),this.isBought=!!e.readUint8();const i=e.readUint8(),r=e.readUint8();this.tiles.forEach(a=>a.setComponent(null));const s=[];e.readBooleanArrayFunc(i*r,(a,u)=>{u&&s.push(this.tiles[Math.floor(a/i)*this.meta.tilesX+a%i])});for(const a of s){const u=e.readUint8();a.setComponent(this.getGame().getMeta().componentsByIdNum[u])}for(const a of s)a.importFromReader1(e,t);for(const a of s)a.importFromReader2(e,t);this.em.invokeEvent(_.FACTORY_COMPONENTS_CHANGED)}}class Sr{game;research={};constructor(e){this.game=e}setResearch(e,t){this.research[e]=t}addResearch(e,t){this.setResearch(e,this.getResearch(e)+t)}getResearch(e){return this.research[e]||0}getPrice(e){const t=this.game.getMeta().researchById[e];if(!t)return 0;let i=t.price||0;for(let r=0;r<this.getResearch(t.id);r++)i*=t.priceIncrease;return i}getPriceResearchPoints(e){const t=this.game.getMeta().researchById[e];if(!t)return 0;let i=t.priceResearchPoints||0;for(let r=0;r<this.getResearch(t.id);r++)i*=t.priceIncrease;return i}couldPurchase(e){const t=this.game.getMeta().researchById[e];return!(this.getResearch(e)>=t.max)}isVisible(e){const t=this.game.getMeta().researchById[e];return!t.requiresResearch||this.getResearch(t.requiresResearch)>0}canPurchase(e){return this.couldPurchase(e)&&this.game.getMoney()>=this.getPrice(e)&&this.game.getResearchPoints()>=this.getPriceResearchPoints(e)&&this.isVisible(e)}exportToWriter(){const e=new se,t=new se,i=this.game.getMeta().researchByIdNum;return t.writeUint16(i.length),t.writeBooleansArrayFunc(i,r=>{if(!r)return!1;const s=this.research[r.id]||0;return s>0?(s>1&&(e.writeUint16(r.idNum),e.writeUint16(s)),!0):!1}),t.writeWriter(e),t}importFromReader(e){if(e.getLength()===0)return;this.research={};const t=e.readUint16();e.readBooleanArrayFunc(t,(r,s)=>{if(s){const a=this.game.getMeta().researchByIdNum[r];a&&this.setResearch(a.id,1)}});const i=e.readReader();for(;i.getOffset()<i.getLength();){const r=i.readUint16(),s=i.readUint16(),a=this.game.getMeta().researchByIdNum[r];a&&this.setResearch(a.id,s)}}}const B={GAME_TICK:"GAME_TICK",MONEY_UPDATED:"MONEY_UPDATED",RESEARCH_POINTS_UPDATED:"RESEARCH_POINTS_UPDATED",ACHIEVEMENT_RECEIVED:"ACHIEVEMENT_RECEIVED",TICKS_STOPPED:"TICKS_STOPPED",TICKS_STARTED:"TICKS_STARTED",BONUS_TICKS_UPDATED:"BONUS_TICKS_UPDATED",TIME_TRAVEL_TICKETS_UPDATED:"TIME_TRAVEL_TICKETS_UPDATED",FOCUS:"FOCUS",BLUR:"BLUR",RESEARCH_BOUGHT:"RESEARCH_BOUGHT",BACKGROUND_MODE_ACTIVATED:"BACKGROUND_MODE_ACTIVATED",BACKGROUND_MODE_DISABLED:"BACKGROUND_MODE_DISABLED"};class Gr{constructor(e){this.game=e,this.achievements={},this.testers=this.getTesterImplementations(),this.bonuses=this.getBonusImplementations()}_setAchieved(e,t){this.achievements[e]=t}setAchieved(e,t){this._setAchieved(e,t),t&&this.game.getEventManager().invokeEvent(B.ACHIEVEMENT_RECEIVED,e)}getAchievement(e){return this.achievements[e]}isVisible(e){const t=this.game.getMeta().achievementsById[e];return!(t.requiresAchievement&&!this.getAchievement(t.requiresAchievement))}getTester(e){return this.testers[e.type].test(e)}test(e){return e.tests.every(t=>this.testers[t.type].test(t))}testAll(){const e=this.game.getMeta().achievements;for(const t of e)!this.getAchievement(t.id)&&this.test(t)&&(this.setAchieved(t.id,!0),t.bonus&&this.bonuses[t.bonus.type].invoke(t.bonus))}getTesterDescriptionText(e){const t=this.game.getMeta().achievementsById[e];return t?t.tests.map(i=>this.testers[i.type].getRequirementsInfoText(i)):[]}getBonusDescriptionText(e){const t=this.game.getMeta().achievementsById[e];return!t||!t.bonus?"":this.bonuses[t.bonus.type].getInfoText(t.bonus)}getTesterImplementations(){const e=this.game.getMeta().researchById;return{amountOfMoney:{getRequirementsInfoText:t=>`Have more money than <span class="money">$${R.formatNumber(t.amount)}</span>`,test:t=>this.game.getMoney()>t.amount},avgMoneyIncome:{getRequirementsInfoText:t=>`Have avg income greater than <span class="money">$${R.formatNumber(t.amount)}</span>`,test:t=>this.game.getStatistics().getAvgProfit()>t.amount},researched:{getRequirementsInfoText:t=>`Research ${Se(e[t.researchId].name)}`,test:t=>this.game.getResearchManager().getResearch(t.researchId)>0}}}getBonusImplementations(){return{money:{getInfoText:e=>`<span class="money">+$${R.formatNumber(e.amount)}</span>`,invoke:e=>this.game.addMoney(e.amount)},custom:{getInfoText:e=>e.description,invoke:()=>{}}}}exportToWriter(){const e=new se,t=this.game.getMeta().achievementsByIdNum;return e.writeUint16(t.length),e.writeBooleansArrayFunc(t,i=>this.getAchievement(i.id)),e}importFromReader(e){if(e.getLength()===0)return;const t=e.readUint16();this.achievements={},e.readBooleanArrayFunc(t,(i,r)=>{if(r){const s=this.game.getMeta().achievementsByIdNum[i];s&&this._setAchieved(s.id,!0)}}),Object.keys(this.achievements).length}}class Mr{constructor(e){this.factory=e,this.endTiles=[],this.doneIndex=[],this.queue=[],this.queueChecked=0}calculate(){this.doneIndex.length=0,this.queue.length=0,this.queueChecked=0;for(const e of this.endTiles)this.queue.push(e),this.log(`${e.getIdStr()} added to queue as end tile`);for(;this.queue.length>this.queueChecked;)this.step(this.queue[this.queueChecked]),this.queueChecked++}log(e){}step(e){if(!this.doneIndex[e.getId()]){const t=e.getInputOutputManager().getOutputsList();if(t.length>1&&t.filter(a=>this.doneIndex[a.getId()]).length!==t.length){this.log(`${e.getIdStr()} skipped, not all outputs calculated!`);return}this.doneIndex[e.getId()]=!0,this.log(`Calculate ${e.getIdStr()}`),e.getComponent().getStrategy().calculateTransport?.();const r=e.getInputOutputManager().getInputsList();for(const s of r)this.queue.push(s),this.log(`${s.getIdStr()} added to queue`)}}buildCaches(){this.endTiles=[];const e=this.factory.getTiles();for(const t of e)t.getComponent()&&t.getInputOutputManager().getOutputsList().length!==0&&t.getComponent().getMeta().strategy.type==="transport"&&this.endTiles.push(t)}}class kr{constructor(e){this.factory=e,this.transportCalculator=new Mr(e),this.components=[],this.strategies={},this.cachesOk=!1}calculate(){this.cachesOk||this.buildCaches();const e={runningCosts:0,resourceCosts:0,resourceSales:0,researchProduction:0,profit:0};if(this.factory.getIsPaused())e.isPaused=!0;else{for(const t of this.components)t.calculateInputTick(e),t.getStrategy().calculateInputTick?.(e);this.transportCalculator.calculate();for(const t of this.components)t.getStrategy().calculateOutputTick?.(e);this.factory.getEventManager().invokeEvent(_.FACTORY_TICK,e)}return e.profit=e.resourceSales-e.resourceCosts-e.runningCosts,e}buildCaches(){this.cachesOk=!0,this.transportCalculator.buildCaches(),this.components=this.factory.getTiles().filter(e=>e.isMainComponentContainer()).map(e=>e.getComponent())}setup(){this.factory.getEventManager().addListener("FactoryCalculator",_.FACTORY_COMPONENTS_CHANGED,()=>{this.cachesOk=!1})}destroy(){this.factory.getEventManager().removeListenerForType("FactoryCalculator")}}class Cr{constructor(e){this.game=e,this.factoryCalculators={};for(const t in e.getMeta().factoriesById)this.factoryCalculators[t]=new kr(e.getFactory(t))}init(){for(const e of Object.values(this.factoryCalculators))e.setup();return this}destroy(){for(const e of Object.values(this.factoryCalculators))e.destroy()}calculate(){const e={profit:0,researchProduction:0,factory_results:{}};for(const t in this.factoryCalculators){const i=this.factoryCalculators[t].calculate();e.profit+=i.profit,e.researchProduction+=i.researchProduction,e.factory_results[t]=i}return this.game.addMoney(e.profit),this.game.addResearchPoints(e.researchProduction),e}}class Bt{config;data;constructor(e){this.config=e,this.reset()}getData(){return this.data}_buildDataStructure(e){const t={variables:{},sampleCounter:0};for(const i of e.fields)t.variables[i]={sum:0,values:[],sample:null};return e.child&&(t.addToChildCounter=0,t.child=this._buildDataStructure(e.child)),t}reset(){this.data=this._buildDataStructure(this.config)}handleInput(e){this._handleCollector(this.config,this.data,e)}_handleCollector(e,t,i){t.sampleCounter++;const r={};for(const s of e.fields){const a=t.variables[s];a.sum+=i[s],a.values.length>=e.max_values_length&&(a.sum-=a.values.shift()),a.values.push(i[s]);const u=a.sum/a.values.length;r[s]=u,t.sampleCounter>=e.sample_interval&&(a.sample=u)}t.sampleCounter>=e.sample_interval&&(t.sampleCounter=0),e.child&&e.add_to_child_interval&&(t.addToChildCounter++,t.addToChildCounter>=e.add_to_child_interval&&(t.addToChildCounter=0,this._handleCollector(e.child,t.child,r)))}}class Tr{game;gameCollector;factoryCollectors={};constructor(e){this.game=e,this.gameCollector=new Bt({max_values_length:80,sample_interval:10,fields:["profit","researchProduction"]});for(const t of this.game.getMeta().factories)this.factoryCollectors[t.id]=new Bt({max_values_length:80,sample_interval:10,fields:["profit","researchProduction"]})}init(){return this.game.getEventManager().addListener("Statistics",B.GAME_TICK,e=>{let t={profit:e.profit,researchProduction:e.researchProduction};this.gameCollector.handleInput(t);for(const i of this.game.getMeta().factories){const r=e.factory_results[i.id];r&&!r.isPaused&&(t={profit:r.profit,researchProduction:r.researchProduction},this.factoryCollectors[i.id].handleInput(t))}}),this}destroy(){this.game.getEventManager().removeListenerForType("Statistics")}reset(){this.gameCollector.reset();for(const e of Object.values(this.factoryCollectors))e.reset()}getAvgProfit(){return this.gameCollector.getData().variables.profit.sample}getAvgResearchPointsProduction(){return this.gameCollector.getData().variables.researchProduction.sample}getFactoryAvgProfit(e){return this.factoryCollectors[e]?.getData().variables.profit.sample}getFactoryAvgResearchPointsProduction(e){return this.factoryCollectors[e]?.getData().variables.researchProduction.sample}exportToWriter(){return new se}importFromReader(e,t){}}const Er=()=>{const d=new Date,e=t=>String(t).padStart(2,"0");return`${e(d.getHours())}:${e(d.getMinutes())}:${e(d.getSeconds())}`},Ne=(d,e,t,i)=>{const r=[Er(),e,d,t];i!==void 0&&r.push(JSON.stringify(i)),console.log(r.join(" | "))},P={config:null,init(d){this.config=d},debug(d,e,t){Ne(d,"debug",e,t)},info(d,e,t){Ne(d,"info",e,t)},warning(d,e,t){Ne(d,"warning",e,t)},error(d,e,t){Ne(d,"error",e,t)}};class Ir{name;timeSpent=0;count=0;weightSum=0;lastStartTime=null;firstStartTime=null;interval=null;intervalValue=2e3;constructor(e){this.name=e}init(){this.firstStartTime=Date.now(),this.interval=setInterval(()=>{const t=Date.now()-this.firstStartTime;this.weightSum&&Math.round(this.timeSpent/this.weightSum*10)/10,Math.round(100*this.timeSpent/t*100)/100,this.timeSpent=0,this.count=0,this.weightSum=0,this.firstStartTime=Date.now()},this.intervalValue)}destroy(){this.interval&&clearInterval(this.interval)}start(){this.lastStartTime=Date.now()}stop(e=1){this.lastStartTime&&(this.timeSpent+=Date.now()-this.lastStartTime,this.count++,this.weightSum+=e)}}class _r{game;confirmedTimestamp;ticks=0;bonusTicks=0;purchaseBonusTicks=0;timeTravelTickets=1;focused=!0;isPlaying=!1;isFastActive=!1;interval=null;noOfTicks=0;lastSaveTimestamp=null;benchmarker;backgroundModeTimeout=null;actualTicksPerSec={ticks:0,second:0,actual:0};constructor(e,t){this.game=e,this.confirmedTimestamp=t,this.benchmarker=new Ir(e.getMeta()?.id)}init(){return this.start(),this.game.getEventManager().addListener("Ticker",B.FOCUS,()=>this.disableBackgroundMode()),this.game.getEventManager().addListener("Ticker",B.BLUR,()=>this.startBackgroundModeTimer()),this.game.getEventManager().addListener("Ticker",B.RESEARCH_BOUGHT,()=>this.updateInterval()),P.info("Ticker",`Ticker initialized for game ${this.game.getMeta()?.id}`),this.benchmarker.init(),this}startBackgroundModeTimer(){this.backgroundModeTimeout&&clearTimeout(this.backgroundModeTimeout),this.backgroundModeTimeout=setTimeout(()=>{const e=this.focused;this.focused=!1,e&&this.updateInterval(),this.game.getEventManager().invokeEvent(B.BACKGROUND_MODE_ACTIVATED)},15e3)}disableBackgroundMode(){this.backgroundModeTimeout&&clearTimeout(this.backgroundModeTimeout);const e=!this.focused;this.focused=!0,e&&this.updateInterval(),this.game.getEventManager().invokeEvent(B.BACKGROUND_MODE_DISABLED)}destroy(){this.stop(),this.game.getEventManager().removeListenerForType("Ticker"),this.benchmarker.destroy()}getBonusTicks(){return this.bonusTicks}addBonusTicks(e){this.bonusTicks=Math.round(this.bonusTicks+e),this.game.getEventManager().invokeEvent(B.BONUS_TICKS_UPDATED)}setBonusTicks(e){this.bonusTicks=e,this.game.getEventManager().invokeEvent(B.BONUS_TICKS_UPDATED)}setPurchaseBonusTicks(e){this.purchaseBonusTicks=e,this.updateInterval()}getTimeTravelTickets(){return this.timeTravelTickets}addTimeTravelTickets(e){this.timeTravelTickets=Math.round(this.timeTravelTickets+e),this.game.getEventManager().invokeEvent(B.TIME_TRAVEL_TICKETS_UPDATED)}setTimeTravelTickets(e){this.timeTravelTickets=e,this.game.getEventManager().invokeEvent(B.TIME_TRAVEL_TICKETS_UPDATED)}getLastSaveTimestamp(){return this.lastSaveTimestamp}getIsPlaying(){return this.isPlaying}getIsFastActive(){return this.isFastActive}getIsFocused(){return this.focused}getNoOfTicks(){return this.noOfTicks}addNoOfTicks(e){this.noOfTicks+=e}getNormalTicksPerSec(){return 4+this.game.getResearchManager().getResearch("chronometer")+this.purchaseBonusTicks}getTicksPerSec(){return this.isFastActive?200:this.getNormalTicksPerSec()}getActualTicksPerSec(){return this.actualTicksPerSec.actual}getTickData(){let e=1,t=this.getTicksPerSec();return this.focused||(e=t,t=1),{runs:e,ticksPerSec:t}}updateInterval(){if(this.interval&&clearInterval(this.interval),this.interval=null,!this.isPlaying)return;const{runs:e,ticksPerSec:t}=this.getTickData();this.interval=setInterval(()=>{this.benchmarker.start();for(let i=0;i<e;i++)this.tick();this.benchmarker.stop(e)},Math.round(1e3/t)),this.game.getEventManager().invokeEvent(B.TICKS_STARTED)}start(){this.isPlaying=!0,this.updateInterval()}stop(){this.isPlaying=!1,this.isFastActive=!1,this.interval&&clearInterval(this.interval),this.interval=null,this.game.getEventManager().invokeEvent(B.TICKS_STOPPED)}startFast(){this.bonusTicks>0&&(this.isPlaying=!0,this.isFastActive=!0,this.updateInterval())}stopFast(){this.isFastActive=!1,this.updateInterval()}calculateOfflineGains(){const e=this.game.getMeta();if(!this.lastSaveTimestamp||!e.maxBonusTicks)return 0;let t=(this.confirmedTimestamp.getConfirmedNow()-this.lastSaveTimestamp)*this.getNormalTicksPerSec();t=Math.round(t/e.offlineSlower);const i=e.maxBonusTicks*this.getNormalTicksPerSec();return t>i&&(t=i),t<e.minBonusTicks&&(t=0),t}addOfflineGains(){const e=this.calculateOfflineGains();P.info("Ticker",`Bonus ticks gained: ${e}`),this.addBonusTicks(e)}tick(){const e=this.game.getCalculator().calculate();this.game.getEventManager().invokeEvent(B.GAME_TICK,e),this.noOfTicks++,this.noOfTicks%5===0&&this.game.getAchievementsManager().testAll(),this.isFastActive&&(this.addBonusTicks(-1),this.bonusTicks<=0&&(this.isFastActive=!1,this.updateInterval()));const t=Math.floor(Date.now()/1e3);this.actualTicksPerSec.ticks++,t!==this.actualTicksPerSec.second&&(this.actualTicksPerSec.actual=this.actualTicksPerSec.ticks,this.actualTicksPerSec.ticks=0,this.actualTicksPerSec.second=t)}exportToWriter(){const e=new se;return e.writeUint32(this.bonusTicks),e.writeUint16(this.timeTravelTickets),e.writeUint32(this.noOfTicks),e.writeUint32(this.confirmedTimestamp.getConfirmedNow()),e}importFromReader(e,t){this.setBonusTicks(e.readUint32()),t>=5&&(this.timeTravelTickets=e.readUint16()),this.noOfTicks=e.readUint32(),this.lastSaveTimestamp=e.readUint32()}}const x={SHOW_FACTORY:"SHOW_FACTORY",SHOW_FACTORIES:"SHOW_FACTORIES",SHOW_RESEARCH:"SHOW_RESEARCH",SHOW_UPGRADES:"SHOW_UPGRADES",SHOW_ACHIEVEMENTS:"SHOW_ACHIEVEMENTS",SHOW_HELP:"SHOW_HELP",SHOW_STATISTICS:"SHOW_STATISTICS",SHOW_PURCHASES:"SHOW_PURCHASES",SHOW_SETTINGS:"SHOW_SETTINGS",SHOW_TIME_TRAVEL:"SHOW_TIME_TRAVEL",GAME_TICK:"GAME_TICK",MONEY_UPDATED:"MONEY_UPDATED",RESEARCH_POINTS_UPDATED:"RESEARCH_POINTS_UPDATED",ACHIEVEMENT_RECEIVED:"ACHIEVEMENT_RECEIVED",TOGGLE_TICKS:"TOGGLE_TICKS",TICKS_STOPPED:"TICKS_STOPPED",TICKS_STARTED:"TICKS_STARTED",BONUS_TICKS_UPDATED:"BONUS_TICKS_UPDATED",TIME_TRAVEL_TICKETS_UPDATED:"TIME_TRAVEL_TICKETS_UPDATED",FOCUS:"FOCUS",BLUR:"BLUR",RESEARCH_BOUGHT:"RESEARCH_BOUGHT",BACKGROUND_MODE_ACTIVATED:"BACKGROUND_MODE_ACTIVATED",BACKGROUND_MODE_DISABLED:"BACKGROUND_MODE_DISABLED",PREMIUM_STATUS_CHANGED:"PREMIUM_STATUS_CHANGED"},wr=new Be(x,"GameUiBus"),Q={play:null,game:null,gameUiBus:wr,reset(){this.play=null,this.game=null,this.gameUiBus=null}};class Rr{constructor(e,t){this.meta=e,this.confirmedTimestamp=t,this.money=e.startingMoney,this.researchPoints=e.startingResearchPoints,this.em=Q.gameUiBus,this.factories={};for(const i in e.factories){const r=e.factories[i];this.factories[r.id]=new br(r,this)}this.researchManager=new Sr(this),this.achievementsManager=new Gr(this),this.calculator=new Cr(this),this.statistics=new Tr(this),this.ticker=new _r(this,t),this.profitMultiplier=1,this.researchProductionMultiplier=1,this.isPremium=!1}init(){return this.calculator.init(),this.statistics.init(),this.ticker.init(),this}destroy(){this.calculator.destroy(),this.statistics.destroy(),this.ticker.destroy()}getMeta(){return this.meta}getEventManager(){return this.em}getResearchManager(){return this.researchManager}getAchievementsManager(){return this.achievementsManager}getCalculator(){return this.calculator}getStatistics(){return this.statistics}getTicker(){return this.ticker}getFactory(e){return this.factories[e]}setProfitMultiplier(e){this.profitMultiplier=e}getProfitMultiplier(){return this.profitMultiplier}setResearchProductionMultiplier(e){this.researchProductionMultiplier=e}getResearchProductionMultiplier(){return this.researchProductionMultiplier}setIsPremium(e){this.isPremium=e}getIsPremium(){return this.isPremium}getMoney(){return this.money}setMoney(e){e=isNaN(Number(e))?0:e,e<this.meta.minNegativeMoney&&(e=this.meta.minNegativeMoney),this.money=e,this.em.invokeEvent(B.MONEY_UPDATED,this.money)}addMoney(e){this.setMoney(this.money+(isNaN(Number(e))?0:e))}getResearchPoints(){return this.researchPoints}setResearchPoints(e){e=isNaN(Number(e))?0:e,this.researchPoints=e,this.em.invokeEvent(B.RESEARCH_POINTS_UPDATED,this.researchPoints)}addResearchPoints(e){this.setResearchPoints(this.researchPoints+(isNaN(Number(e))?0:e))}exportToWriter(){const e=new se;e.writeUint16(7),e.writeFloat64(this.money),e.writeFloat64(this.researchPoints),e.writeInt8(this.isPremium?1:0),e.writeWriter(this.researchManager.exportToWriter()),e.writeWriter(this.achievementsManager.exportToWriter()),e.writeWriter(this.statistics.exportToWriter()),e.writeWriter(this.ticker.exportToWriter()),e.writeUint8(this.meta.factories.length);for(const t in this.factories){const i=this.factories[t];e.writeUint8(i.getMeta().idNum),e.writeWriter(i.exportToWriter())}return e}importFromReader(e){const t=e.readUint16();this.setMoney(e.readFloat64()),this.setResearchPoints(e.readFloat64()),t>=7?this.setIsPremium(!!e.readInt8()):this.setIsPremium(!1),this.researchManager.importFromReader(e.readReader(),t),this.achievementsManager.importFromReader(e.readReader(),t),this.statistics.importFromReader(e.readReader(),t),this.ticker.importFromReader(e.readReader(),t);const i=e.readUint8();for(let r=0;r<i;r++){const s=this.meta.factoriesByIdNum[e.readUint8()],a=e.readReader();s||console.warn("Game.import: Missing factoryMeta for index",r),s&&this.factories[s.id].importFromReader(a,t)}this.statistics.reset()}}const wi=()=>{const d={},e=new URLSearchParams(window.location.search);for(const[t,i]of e.entries())d[t]=i;return d},Ar=()=>{const d=wi(),e=d.ref;if(d.kongregate_username&&e==="kongregate")return"kongregate";if(e==="notdoppler")return"notdoppler";if(e==="armorgames")return"armorgames";if(e==="newgrounds")return"newgrounds";if(e==="beta")return"beta";const t=window.location.href;return t.includes("localhost")||t.includes("file")?"localhost":"direct"},dt={getUrlVars:wi,identifySite:Ar},ue="SaveManager";class Pr{constructor(e,t,i){this.api=e,this.localStorageKey=`${i}|${t}`,this.cloudSaveName="Main",this.cloudSaveIntervalMs=ae.saveManager.cloudSaveIntervalMs,this.localSaveIntervalMs=ae.saveManager.localSaveIntervalMs,this.cloudSaveInterval=null,this.localSaveInterval=null;const r=dt.getUrlVars();this.useCloud=r.cloud!=="0"&&r.cloud!==0&&r.cloud!=="false",this.useCloud||P.info(ue,"Cloud save disabled")}getCloudSaveInterval(){return this.cloudSaveIntervalMs}getLocalSaveInterval(){return this.localSaveIntervalMs}setUpdateGameFromLoadedDataCallback(e){return this.updateGameFromLoadedDataCallback=e,this}setGetSaveDataCallback(e){return this.saveDataCallback=e,this}init(e,t){return new Promise(i=>{const r=()=>{this._startInterval(),P.info(ue,"Initialized"),t?.(),i()};e?(this.saveAutoCloud(()=>{}),this.saveAutoLocal(()=>{}),r()):this.loadAuto(()=>r())})}_startInterval(){this.cloudSaveInterval=setInterval(()=>{this.saveAutoCloud(()=>{P.info(ue,"Auto saved to cloud")})},this.cloudSaveIntervalMs),this.localSaveInterval=setInterval(()=>{this.saveAutoLocal(()=>{P.info(ue,"Auto saved to local")})},this.localSaveIntervalMs)}destroy(){this.cloudSaveInterval&&clearInterval(this.cloudSaveInterval),this.localSaveInterval&&clearInterval(this.localSaveInterval)}getSavesInfo(e,t){this.api.getSavesInfo(e,t)}saveManual(e,t){this._saveCloud(e,t)}saveAuto(e){this._saveLocal(this.cloudSaveName,()=>{this._saveCloud(this.cloudSaveName,e)})}saveAutoCloud(e){this._saveCloud(this.cloudSaveName,e)}saveAutoLocal(e){this._saveLocal(this.cloudSaveName,e)}_saveCloud(e,t){this.useCloud?this.api.save(e,this.saveDataCallback(),t):(P.info(ue,"Cloud save skipped!"),t?.())}_saveLocal(e,t){localStorage.setItem(`${this.localStorageKey}|${e}`,JSON.stringify(this.saveDataCallback())),t?.()}loadManual(e,t){this._loadCloud(e,i=>{this.updateGameFromSaveData(i),this.saveAutoCloud(()=>{}),t?.()})}loadAuto(e){this._loadCloud(this.cloudSaveName,t=>{this._loadLocal(this.cloudSaveName,i=>{let r=null;i&&t?i.meta.ver>t.meta.ver?(P.info(ue,`Preferred local save local ver:${i.meta.ver} > cloud ver:${t.meta.ver}`),r=i):(P.info(ue,`Preferred cloud save local ver:${i.meta.ver} < cloud ver:${t.meta.ver}`),r=t):i?r=i:t&&(r=t),r&&this.updateGameFromSaveData(r),e?.()})})}updateGameFromSaveData(e){this.updateGameFromLoadedDataCallback?.(e)}_loadCloud(e,t){this.api.load(e,t)}_loadLocal(e,t){try{const i=`${this.localStorageKey}|${e}`,r=localStorage.getItem(i);if(!r){console.log("SaveManager: No local save found for slot",e),t(null);return}try{const s=JSON.parse(r);console.log("SaveManager: Local save data length:",typeof s?.data=="string"?s.data.length:0),t(s)}catch(s){console.warn("SaveManager: Failed to parse local save JSON",s),t(null)}}catch(i){console.warn("SaveManager: Error while loading local save",i),t(null)}}}class Br{constructor(e){this.play=e,this.game=e.getGame(),this.unlocks={},this.strategies={bonusTicks:{apply:({amount:t})=>{this.game.getTicker().addBonusTicks(t),this.game.setIsPremium(!0),P.info("PurchasesManager",`Added ${t} bonus ticks`)}},timeTravelTickets:{apply:({amount:t})=>{this.game.getTicker().addTimeTravelTickets(t),this.game.setIsPremium(!0),P.info("PurchasesManager",`Added ${t} time travel tickets`)}},researchProductionBonus:{apply:({bonus:t})=>{this.game.setResearchProductionMultiplier(this.game.getResearchProductionMultiplier()*t),this.game.setIsPremium(!0),P.info("PurchasesManager","Set research production bonus")}},extraTicks:{apply:({bonus:t})=>{this.game.getTicker().setPurchaseBonusTicks(t),this.game.setIsPremium(!0),P.info("PurchasesManager","Set extra ticks")}},extraProfit:{apply:({bonus:t})=>{this.game.setProfitMultiplier(t),this.game.setIsPremium(!0),P.info("PurchasesManager","Set extra profit")}}}}isVisible(e){const t=this.play.getMeta().productsById[e];return t?!(t.requiresProduct&&!this.getIsUnlocked(t.requiresProduct))&&!t.special:!1}getPriceKey(){return this.play.getApi().getKey()}init(e=()=>{}){this.loadPurchases(e)}loadPurchases(e=()=>{}){this.play.getApi().loadPurchases(t=>{P.info("PurchasesManager","Purchases loaded",t),this.handlePurchases(t),e()})}startPurchase(e,t=()=>{}){this.play.getApi().purchase(e,()=>{this.loadPurchases(t)})}destroy(){}handlePurchases(e){this.game.setResearchProductionMultiplier(1),this.game.getTicker().setPurchaseBonusTicks(0),this.game.setProfitMultiplier(1),e.forEach(this.handlePurchase.bind(this))}handlePurchase(e){const t=this.play.getMeta().productsById[e.productId];if(!t){P.warning("PurchasesManager",`Unknown product with id ${e.productId}`,e);return}const i=this.strategies[t.strategy.type];i?(i.apply(t.strategy),P.info("PurchasesManager",`Applied consumable strategy ${t.strategy.type} for purchase ${e.productId}`),t.consumable?this.play.getSaveManager().saveAuto(()=>{this.play.getApi().setConsumed(e.externalId,()=>{P.info("PurchasesManager",`Purchase ${e.externalId} set to consumed`)})}):(this.unlocks[e.productId]=!0,P.info("PurchasesManager",`Purchase unlocked ${e.productId} with external id ${e.externalId}`))):P.error("PurchasesManager",`Invalid consumable strategy ${t.strategy.type} for purchase ${e.productId}. Could not handle purchase.`)}getIsUnlocked(e){return!!this.unlocks[e]}}class xr{storageKey;hashLength=40;userHash=null;constructor(e){this.storageKey=e}init(){return this.userHash=localStorage.getItem(this.storageKey),this.userHash||(this.userHash=this._generateUserHash(this.hashLength),this.updateUserHash(this.userHash)),this}updateUserHash(e){localStorage.setItem(this.storageKey,e)}getUserHash(){return this.userHash}toString(){return this.userHash}_generateUserHash(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Array.from({length:e},()=>t.charAt(Math.floor(Math.random()*t.length))).join("")}}const V={INCENTIVIZED_AD_SHOW:"INCENTIVIZED_AD_SHOW",INCENTIVIZED_AD_CHECK_STATUS:"INCENTIVIZED_AD_CHECK_STATUS",INCENTIVIZED_AD_STATUS:"INCENTIVIZED_AD_STATUS",INCENTIVIZED_AD_COMPLETED:"INCENTIVIZED_AD_COMPLETED",INCENTIVIZED_AD_ABANDONED:"INCENTIVIZED_AD_ABANDONED"};class Xt{static chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";static lookup=null;static setup(){if(!this.lookup){this.lookup=new Uint8Array(256);for(let e=0;e<this.chars.length;e++)this.lookup[this.chars.charCodeAt(e)]=e}}static encode(e){const t=new Uint8Array(e);let i="";for(let s=0;s<t.length;s+=3){const a=t[s],u=t[s+1]||0,l=t[s+2]||0;i+=this.chars[a>>2],i+=this.chars[(a&3)<<4|u>>4],i+=this.chars[(u&15)<<2|l>>6],i+=this.chars[l&63]}const r=t.length%3;return r===1?i=i.slice(0,-2)+"==":r===2&&(i=i.slice(0,-1)+"="),i}static decode(e){this.setup();let t=0;e.endsWith("==")?t=2:e.endsWith("=")&&(t=1);const i=e.length*3/4-t,r=new ArrayBuffer(i),s=new Uint8Array(r);let a=0;for(let u=0;u<e.length;u+=4){const l=this.lookup[e.charCodeAt(u)],p=this.lookup[e.charCodeAt(u+1)],h=this.lookup[e.charCodeAt(u+2)],m=this.lookup[e.charCodeAt(u+3)];s[a++]=l<<2|p>>4,isNaN(h)||(s[a++]=(p&15)<<4|h>>2),isNaN(m)||(s[a++]=(h&3)<<6|m)}return r}}Xt.setup();class Pe{constructor(e){this.buffer=e,this.dataView=new DataView(e),this.offset=0}_read(e,t){if(this.offset+e>this.buffer.byteLength)throw new Error(`Read out of bounds: trying to read ${e} bytes at offset ${this.offset}, buffer length ${this.buffer.byteLength}`);const i=this.dataView[t](this.offset,!0);return this.offset+=e,i}_peek(e,t){if(this.offset+e>this.buffer.byteLength)throw new Error(`Peek out of bounds: trying to peek ${e} bytes at offset ${this.offset}, buffer length ${this.buffer.byteLength}`);return this.dataView[t](this.offset,!0)}peekBytes(e){if(this.offset+e>this.buffer.byteLength)throw new Error(`Peek out of bounds: trying to peek ${e} bytes at offset ${this.offset}, buffer length ${this.buffer.byteLength}`);return new Uint8Array(this.buffer,this.offset,e)}readBooleanMap(){return new Et(this.readUint8()).reverse()}readChar(){return String.fromCharCode(this.readInt8())}readInt8(){return this._read(1,"getInt8")}readInt16(){return this._read(2,"getInt16")}readInt32(){return this._read(4,"getInt32")}readUint8(){return this._read(1,"getUint8")}readUint16(){return this._read(2,"getUint16")}readUint32(){return this._read(4,"getUint32")}readFloat64(){return this._read(8,"getFloat64")}peekInt8(){return this._peek(1,"getInt8")}peekInt16(){return this._peek(2,"getInt16")}peekInt32(){return this._peek(4,"getInt32")}peekUint8(){return this._peek(1,"getUint8")}peekUint16(){return this._peek(2,"getUint16")}peekUint32(){return this._peek(4,"getUint32")}peekFloat64(){return this._peek(8,"getFloat64")}readReader(){const e=this.readInt32();if(this.offset+e>this.buffer.byteLength)throw new Error("readReader: length exceeds buffer size");const t=new ArrayBuffer(e),i=new Int8Array(t,0,e);for(let r=0;r<e;r++)i[r]=this.readInt8();return new Pe(t)}peekReader(){const e=this.peekInt32();if(this.offset+4+e>this.buffer.byteLength)throw new Error("peekReader: length exceeds buffer size");return new Pe(this.buffer.slice(this.offset+4,this.offset+4+e))}readBooleanArrayFunc(e,t){let i=null;for(let r=0;r<e;r++)r%8===0&&(i=this.readBooleanMap()),t(r,i.readBoolean())}getBuffer(){return this.buffer}getLength(){return this.buffer.byteLength}getOffset(){return this.offset}}class Or{userHash;storageKey;em;purchases=[];savesMeta={};saves={};insentiveInterval=null;isShowingAd=!1;isAvailable=!1;constructor(e,t,i){this.userHash=t,this.storageKey=`${i}|${t}`,this.em=e}getTimestamp(e){e(Math.floor(Date.now()/1e3))}_saveToLocalStorage(){localStorage.setItem(this.storageKey,JSON.stringify({purchases:this.purchases,savesMeta:this.savesMeta,saves:this.saves}))}_loadFromLocalStorage(){this.purchases=[],this.saves={},this.savesMeta={},this.decodeMainSave();try{const e=JSON.parse(localStorage.getItem(this.storageKey));e&&(this.purchases=e.purchases||[],this.savesMeta=e.savesMeta||{},this.saves=e.saves||{})}catch(e){P.warning("Local","Could not load data",e)}}init(){return new Promise(e=>{this._loadFromLocalStorage(),this.initializeIncentivizedAds(),P.info("Local","Init"),setTimeout(()=>{P.info("Local","API loaded"),e()},100)})}destroy(){this.insentiveInterval&&clearInterval(this.insentiveInterval)}purchase(e,t){setTimeout(()=>{this.purchases.push({externalId:String(Math.floor(Math.random()*1e12)),productId:e}),this._saveToLocalStorage(),t()},100)}loadPurchases(e){setTimeout(()=>e(this.purchases),100)}setConsumed(e,t){setTimeout(()=>{this.purchases=this.purchases.filter(i=>i.externalId!==e),this._saveToLocalStorage(),t(!0)},100)}submitStatistic(e,t,i){this._saveToLocalStorage(),setTimeout(i,100)}getSavesInfo(e,t){setTimeout(()=>t(this.savesMeta),100)}load(e,t){setTimeout(()=>t(this.savesMeta[e]?{meta:this.savesMeta[e],data:this.saves[e]}:null),100)}save(e,t,i){setTimeout(()=>{this.savesMeta[e]=t.meta,this.saves[e]=t.data,this._saveToLocalStorage(),i(!0)},100)}initializeIncentivizedAds(){this.insentiveInterval=setInterval(()=>{this.isAvailable=!this.isAvailable,this.em.invokeEvent(V.INCENTIVIZED_AD_STATUS,this.isAvailable)},2e3),this.em.addListener("Local",V.INCENTIVIZED_AD_CHECK_STATUS,()=>{this.em.invokeEvent(V.INCENTIVIZED_AD_STATUS,this.isAvailable)}),this.em.addListener("Local",V.INCENTIVIZED_AD_SHOW,()=>this._showIncentivizedAd())}_showIncentivizedAd(){if(this.isShowingAd||!this.isAvailable)return;this.isShowingAd=!0,this.isAvailable=!1,this.em.invokeEvent(V.INCENTIVIZED_AD_STATUS,this.isAvailable);const e=document.createElement("div");e.id="LocalApiAd",e.style.cssText="position:absolute; top:0; left:0; width:100%; height:100%; background-color:red; text-align:center; font-size:50px; padding-top:200px;",e.innerText="This is an ad!",document.body.appendChild(e),setTimeout(()=>{this.isShowingAd=!1,this.em.invokeEvent(V.INCENTIVIZED_AD_COMPLETED),e.remove()},500)}decodeMainSave(){const t=this.saves["Main"];if(!t)return P.info("LocalApi","No Main save data found"),null;try{const i=Xt.decode(t),r=new Uint8Array(i),s=new Pe(i),a=s.readUint16(),u=s.readFloat64(),l=s.readFloat64();let p=0;return a>=7&&(p=s.readInt8()),{version:a,money:u,researchPoints:l,isPremium:p,reader:s}}catch(i){return P.warning("LocalApi","Failed to decode Main save",i),null}}}class Lr{em;localApi;constructor(e,t){this.em=new Be(V,"ApiLocal"),this.localApi=new Or(this.em,e,t)}getEventManager(){return this.em}getKey(){return"local"}init(e){this.localApi.init(e).then(()=>{this.localApi.decodeMainSave()})}destroy(){this.localApi.destroy()}getTimestamp(e){this.localApi.getTimestamp(e)}purchase(e,t){this.localApi.purchase(e,t)}loadPurchases(e){this.localApi.loadPurchases(e)}setConsumed(e,t){this.localApi.setConsumed(e,t)}submitStatistic(e,t,i){this.localApi.submitStatistic(e,t,i)}getSavesInfo(e,t){this.localApi.getSavesInfo(e,t)}load(e,t){this.localApi.load(e,t)}save(e,t,i){this.localApi.save(e,t,i)}initializeIncentivizedAds(){return this.localApi.initializeIncentivizedAds(),!0}}class Nr{constructor(e,t,i){this.userHash=e,this.apiUrl=t,this.ref=i}init(e){logger.info("ServerApi","Init"),typeof e=="function"&&e()}async getTimestamp(){try{const e=await fetch(`${this.apiUrl}/getTimestamp?user_hash=${this.userHash}`);if(!e.ok)throw new Error("Failed to fetch timestamp");return await e.json()}catch(e){return logger.error("ServerApi","getTimestamp failed",e),null}}purchase(e){const t=`${this.apiUrl}/makePurchase?package_id=${e}&user_hash=${this.userHash}&timezone=${encodeURIComponent(Intl.DateTimeFormat().resolvedOptions().timeZone)}&back_url=${encodeURIComponent(window.location.protocol+"//"+window.location.host)}&site=${this.ref==="direct"?"grestGames":this.ref}`;document.location=t}async loadPurchases(){logger.info("ServerApi","Load items");try{const e=await fetch(`${this.apiUrl}/getPurchases?user_hash=${this.userHash}`);if(!e.ok)throw new Error("Failed to fetch purchases");const t=await e.json();return logger.info("ServerApi","Items loaded",t),t.code!==0?[]:t.data.items.map(i=>({externalId:i.created,productId:i.package_id}))}catch(e){return logger.error("ServerApi","loadPurchases failed",e),[]}}async setConsumed(e){logger.info("ServerApi",`Set consumed ${e}`);try{const t=await fetch(`${this.apiUrl}/setConsumed?user_hash=${this.userHash}&created=${e}`);if(!t.ok)throw new Error("Failed to set consumed");const i=await t.json();return logger.info("ServerApi","Items consumed",i),i.code===0}catch(t){return logger.error("ServerApi","setConsumed failed",t),!1}}}const W="PlayFab";class Ur{constructor(e){PlayFab.settings.titleId="1BFF70",this.customId=e}_getMetaVarName(e){return`${e}-meta`}init(e){logger.info(W,"Init"),this.login(e),setInterval(()=>this.login(),432e5)}login(e){logger.info(W,"Login");const t={CustomId:this.customId,CreateAccount:!0};PlayFab.ClientApi.LoginWithCustomID(t,(i,r)=>{i&&i.code===200?(logger.info(W,"Logged in!",[i,r]),e&&e()):(logger.error(W,"init failed!",[i,r]),e&&e())})}load(e,t){const i={Keys:[e,this._getMetaVarName(e)]};PlayFab.ClientApi.GetUserData(i,(r,s)=>{if(logger.info(W,"Loaded!",[r,s]),r&&r.code===200)try{const a=JSON.parse(r.data.Data[this._getMetaVarName(e)].Value),u=r.data.Data[e].Value;t({meta:a,data:u});return}catch(a){logger.error(W,"load parse failed",a)}logger.error(W,"load failed!",[r,s]),t(null)})}save(e,t,i){const r={Data:{[e]:t.data,[this._getMetaVarName(e)]:JSON.stringify(t.meta)}};PlayFab.ClientApi.UpdateUserData(r,(s,a)=>{s&&s.code===200?(logger.info(W,`Saved ${e}`,[s,a]),i(!0)):(logger.error(W,"Save failed!",[s,a]),i(!1))})}submitStatistic(){}getSavesInfo(e,t){const r={Keys:e.map(s=>this._getMetaVarName(s))};PlayFab.ClientApi.GetUserData(r,(s,a)=>{if(s&&s.code===200){logger.info(W,"getSavesInfo loaded!",[s,a]);const u={};for(const l of e){const p=this._getMetaVarName(l);try{s.data.Data[p]?.Value&&(u[l]=JSON.parse(s.data.Data[p].Value))}catch(h){logger.error(W,"getSavesInfo parse failed",h)}}t(u);return}logger.error(W,"getSavesInfo failed!",[s,a]),t({})})}}class Dr{constructor(e,t,i){this.em=new Be(ApiEvent,"ApiWeb"),this.serverApi=new Nr(e,t,i),this.playFabApi=new Ur(e)}getEventManager(){return this.em}getKey(){return"web"}getTimestamp(e){this.serverApi.getTimestamp(e)}init(e){this.playFabApi.init(()=>{this.serverApi.init(()=>{e()})})}destroy(){}purchase(e,t){this.serverApi.purchase(e,t)}loadPurchases(e){this.serverApi.loadPurchases(e)}setConsumed(e,t){this.serverApi.setConsumed(e,t)}submitStatistic(){}getSavesInfo(e,t){this.playFabApi.getSavesInfo(e,t)}load(e,t){this.playFabApi.load(e,t)}save(e,t,i){this.playFabApi.save(e,t,i)}initializeIncentivizedAds(){return!1}showIncentivizedAd(){return!1}}const Fr=(d,e)=>{switch(d){case"localhost":return P.info("ApiFactory","Local API loaded"),new Lr(e,ae.api.local.storageKey,d);default:return P.info("ApiFactory","Web API loaded"),new Dr(e,ae.api.server.url,d)}};class qr{constructor(e){this.serverTs=0,this.localTs=0,this.timeDif=0,this.loaderFunction=e}init(){return new Promise(e=>{this.loaderFunction(t=>{this.serverTs=t&&!isNaN(Number(t))?Number(t):Math.round(Date.now()/1e3),this.localTs=Math.round(Date.now()/1e3),this.timeDif=this.serverTs-this.localTs,P.info("Ts",`Loaded ${t} Used: ${this.serverTs} Dif: ${this.timeDif}`),e()})})}getConfirmedNow(){return Math.round(Date.now()/1e3)+this.timeDif}}class Ri{constructor(e){this.game=e}getMessage(){return`Show ad for ${$.main.incentivizedAdBonusTicks} bonus ticks`}complete(){P.info("IncentivizedAdCompletedAction",`Incentivized ad completed, added ${$.main.incentivizedAdBonusTicks} bonus ticks`),this.game.getTicker().addBonusTicks($.main.incentivizedAdBonusTicks)}}class Hr{constructor(){this.userHash=null,this.api=null,this.saveManager=null,this.purchasesManager=null,this.confirmedTimestamp=null,this.game=null}getMeta(){return $}getGame(){return this.game}getSaveManager(){return this.saveManager}getPurchasesManager(){return this.purchasesManager}getApi(){return this.api}getUserHash(){return this.userHash}isDevMode(){return dt.identifySite()==="localhost"}async init(e=!1,t=()=>{}){try{console.log("Play: Starting initialization..."),console.log("Play: Initializing UserHash..."),this.userHash=new xr(ae.userHash.key),await this.userHash.init(),console.log("Play: UserHash initialized"),console.log("Play: Initializing API..."),this.api=Fr(dt.identifySite(),this.userHash.getUserHash()),await this.api.init(),console.log("Play: API initialized"),this.api.getEventManager().addListener("Play",V.INCENTIVIZED_AD_COMPLETED,()=>new Ri(this.getGame()).complete()),console.log("Play: Initializing confirmed timestamp..."),this.confirmedTimestamp=new qr(this.api.getTimestamp.bind(this.api)),await this.confirmedTimestamp.init(),console.log("Play: Confirmed timestamp initialized"),console.log("Play: Initializing Game..."),this.game=new Rr(ae.meta.main,this.confirmedTimestamp),Q.game=this.game,console.log("Play: Game instance created"),console.log("Play: Initializing SaveManager..."),this.saveManager=this._createSaveManager(),await this.saveManager.init(e),console.log("Play: SaveManager initialized"),console.log("Play: Initializing PurchasesManager..."),this.purchasesManager=new Br(this),await this.purchasesManager.init(),console.log("Play: PurchasesManager initialized"),console.log("Play: Initializing game logic..."),this.game.init(),console.log("Play: Game logic initialized"),P.info("Play","Initialized"),t()}catch(i){throw console.error("Play: Initialization failed:",i),i}}_createSaveManager(){return new Pr(this.api,this.userHash,"FactoryIdleSave").setGetSaveDataCallback(()=>({meta:{ver:this.game.getTicker().getNoOfTicks(),timestamp:Math.round(Date.now()/1e3),date:new Date().toISOString()},data:Xt.encode(this.exportToWriter().getBuffer())})).setUpdateGameFromLoadedDataCallback(e=>{try{this.importFromReader(new Pe(Xt.decode(e.data))),this.game.getTicker().addOfflineGains(),P.info("Play","Game loaded from save")}catch(t){P.error("Play","Could not update game from save data",t.message)}})}destroy(){this.game?.destroy(),this.api?.destroy(),this.saveManager?.destroy(),this.purchasesManager?.destroy()}exportToWriter(){return this.game.exportToWriter()}importFromReader(e){this.game.importFromReader(e)}}class Yr{constructor(e){this.path=e,this.imagesData={},this.images={},this.noOfImagesLoaded=0}addImages(e){for(const[t,i]of Object.entries(e))this.imagesData[t]||(this.imagesData[t]=this.path+i);return this}async loadAllAsync(){const e=Object.entries(this.imagesData);e.length!==0&&(this.noOfImagesLoaded=0,await Promise.all(e.map(([t,i])=>new Promise(r=>{const s=new Image;s.onload=()=>{this.noOfImagesLoaded++,r()},s.onerror=()=>{console.warn(`ImageMap: Failed to load image: ${i}`),this.noOfImagesLoaded++,r()},s.src=`${i}?x=${Math.random()}`,this.images[t]=s}))))}getImage(e){return this.images[e]||null}get totalImages(){return Object.keys(this.imagesData).length}get loadedImages(){return this.noOfImagesLoaded}get isAllLoaded(){return this.noOfImagesLoaded===this.totalImages}get loadingProgress(){return this.totalImages===0?100:Math.round(this.noOfImagesLoaded/this.totalImages*100)}}const Wr=new Yr(ae.imageMap.path).addImages({yellowSelection:"mouse/yellow.png",greenSelection:"mouse/green.png",redSelection:"mouse/red.png",blueSelection:"mouse/selected.png",cantPlace:"mouse/cantPlace.png",terrains:"terrains.png",components:"components.png",componentIcons:"componentIcons.png",transportLine:"transportLine.png",resources:"resources.png"});function zr(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var Ue={exports:{}},De={exports:{}},K={},F={},xt;function q(){if(xt)return F;xt=1,F.__esModule=!0,F.extend=r,F.indexOf=l,F.escapeExpression=p,F.isEmpty=h,F.createFrame=m,F.blockParams=c,F.appendContextPath=o;var d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},e=/[&<>"'`=]/g,t=/[&<>"'`=]/;function i(n){return d[n]}function r(n){for(var X=1;X<arguments.length;X++)for(var g in arguments[X])Object.prototype.hasOwnProperty.call(arguments[X],g)&&(n[g]=arguments[X][g]);return n}var s=Object.prototype.toString;F.toString=s;var a=function(X){return typeof X=="function"};a(/x/)&&(F.isFunction=a=function(n){return typeof n=="function"&&s.call(n)==="[object Function]"}),F.isFunction=a;var u=Array.isArray||function(n){return n&&typeof n=="object"?s.call(n)==="[object Array]":!1};F.isArray=u;function l(n,X){for(var g=0,y=n.length;g<y;g++)if(n[g]===X)return g;return-1}function p(n){if(typeof n!="string"){if(n&&n.toHTML)return n.toHTML();if(n==null)return"";if(!n)return n+"";n=""+n}return t.test(n)?n.replace(e,i):n}function h(n){return!n&&n!==0?!0:!!(u(n)&&n.length===0)}function m(n){var X=r({},n);return X._parent=n,X}function c(n,X){return n.path=X,n}function o(n,X){return(n?n+".":"")+X}return F}var Fe={exports:{}},Ot;function J(){return Ot||(Ot=1,(function(d,e){e.__esModule=!0;var t=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function i(r,s){var a=s&&s.loc,u=void 0,l=void 0,p=void 0,h=void 0;a&&(u=a.start.line,l=a.end.line,p=a.start.column,h=a.end.column,r+=" - "+u+":"+p);for(var m=Error.prototype.constructor.call(this,r),c=0;c<t.length;c++)this[t[c]]=m[t[c]];Error.captureStackTrace&&Error.captureStackTrace(this,i);try{a&&(this.lineNumber=u,this.endLineNumber=l,Object.defineProperty?(Object.defineProperty(this,"column",{value:p,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:h,enumerable:!0})):(this.column=p,this.endColumn=h))}catch{}}i.prototype=new Error,e.default=i,d.exports=e.default})(Fe,Fe.exports)),Fe.exports}var ke={},qe={exports:{}},Lt;function Vr(){return Lt||(Lt=1,(function(d,e){e.__esModule=!0;var t=q();e.default=function(i){i.registerHelper("blockHelperMissing",function(r,s){var a=s.inverse,u=s.fn;if(r===!0)return u(this);if(r===!1||r==null)return a(this);if(t.isArray(r))return r.length>0?(s.ids&&(s.ids=[s.name]),i.helpers.each(r,s)):a(this);if(s.data&&s.ids){var l=t.createFrame(s.data);l.contextPath=t.appendContextPath(s.data.contextPath,s.name),s={data:l}}return u(r,s)})},d.exports=e.default})(qe,qe.exports)),qe.exports}var He={exports:{}},Nt;function $r(){return Nt||(Nt=1,(function(d,e){e.__esModule=!0;function t(a){return a&&a.__esModule?a:{default:a}}var i=q(),r=J(),s=t(r);e.default=function(a){a.registerHelper("each",function(u,l){if(!l)throw new s.default("Must pass iterator to #each");var p=l.fn,h=l.inverse,m=0,c="",o=void 0,n=void 0;l.data&&l.ids&&(n=i.appendContextPath(l.data.contextPath,l.ids[0])+"."),i.isFunction(u)&&(u=u.call(this)),l.data&&(o=i.createFrame(l.data));function X(f,b,M){o&&(o.key=f,o.index=b,o.first=b===0,o.last=!!M,n&&(o.contextPath=n+f)),c=c+p(u[f],{data:o,blockParams:i.blockParams([u[f],f],[n+f,null])})}if(u&&typeof u=="object")if(i.isArray(u))for(var g=u.length;m<g;m++)m in u&&X(m,m,m===u.length-1);else if(typeof Symbol=="function"&&u[Symbol.iterator]){for(var y=[],v=u[Symbol.iterator](),G=v.next();!G.done;G=v.next())y.push(G.value);u=y;for(var g=u.length;m<g;m++)X(m,m,m===u.length-1)}else(function(){var f=void 0;Object.keys(u).forEach(function(b){f!==void 0&&X(f,m-1),f=b,m++}),f!==void 0&&X(f,m-1,!0)})();return m===0&&(c=h(this)),c})},d.exports=e.default})(He,He.exports)),He.exports}var Ye={exports:{}},Ut;function Kr(){return Ut||(Ut=1,(function(d,e){e.__esModule=!0;function t(s){return s&&s.__esModule?s:{default:s}}var i=J(),r=t(i);e.default=function(s){s.registerHelper("helperMissing",function(){if(arguments.length!==1)throw new r.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},d.exports=e.default})(Ye,Ye.exports)),Ye.exports}var We={exports:{}},Dt;function jr(){return Dt||(Dt=1,(function(d,e){e.__esModule=!0;function t(a){return a&&a.__esModule?a:{default:a}}var i=q(),r=J(),s=t(r);e.default=function(a){a.registerHelper("if",function(u,l){if(arguments.length!=2)throw new s.default("#if requires exactly one argument");return i.isFunction(u)&&(u=u.call(this)),!l.hash.includeZero&&!u||i.isEmpty(u)?l.inverse(this):l.fn(this)}),a.registerHelper("unless",function(u,l){if(arguments.length!=2)throw new s.default("#unless requires exactly one argument");return a.helpers.if.call(this,u,{fn:l.inverse,inverse:l.fn,hash:l.hash})})},d.exports=e.default})(We,We.exports)),We.exports}var ze={exports:{}},Ft;function Qr(){return Ft||(Ft=1,(function(d,e){e.__esModule=!0,e.default=function(t){t.registerHelper("log",function(){for(var i=[void 0],r=arguments[arguments.length-1],s=0;s<arguments.length-1;s++)i.push(arguments[s]);var a=1;r.hash.level!=null?a=r.hash.level:r.data&&r.data.level!=null&&(a=r.data.level),i[0]=a,t.log.apply(t,i)})},d.exports=e.default})(ze,ze.exports)),ze.exports}var Ve={exports:{}},qt;function Jr(){return qt||(qt=1,(function(d,e){e.__esModule=!0,e.default=function(t){t.registerHelper("lookup",function(i,r,s){return i&&s.lookupProperty(i,r)})},d.exports=e.default})(Ve,Ve.exports)),Ve.exports}var $e={exports:{}},Ht;function Zr(){return Ht||(Ht=1,(function(d,e){e.__esModule=!0;function t(a){return a&&a.__esModule?a:{default:a}}var i=q(),r=J(),s=t(r);e.default=function(a){a.registerHelper("with",function(u,l){if(arguments.length!=2)throw new s.default("#with requires exactly one argument");i.isFunction(u)&&(u=u.call(this));var p=l.fn;if(i.isEmpty(u))return l.inverse(this);var h=l.data;return l.data&&l.ids&&(h=i.createFrame(l.data),h.contextPath=i.appendContextPath(l.data.contextPath,l.ids[0])),p(u,{data:h,blockParams:i.blockParams([u],[h&&h.contextPath])})})},d.exports=e.default})($e,$e.exports)),$e.exports}var Yt;function Ai(){if(Yt)return ke;Yt=1,ke.__esModule=!0,ke.registerDefaultHelpers=X,ke.moveHelperToHooks=g;function d(y){return y&&y.__esModule?y:{default:y}}var e=Vr(),t=d(e),i=$r(),r=d(i),s=Kr(),a=d(s),u=jr(),l=d(u),p=Qr(),h=d(p),m=Jr(),c=d(m),o=Zr(),n=d(o);function X(y){t.default(y),r.default(y),a.default(y),l.default(y),h.default(y),c.default(y),n.default(y)}function g(y,v,G){y.helpers[v]&&(y.hooks[v]=y.helpers[v],G||delete y.helpers[v])}return ke}var Ke={},je={exports:{}},Wt;function es(){return Wt||(Wt=1,(function(d,e){e.__esModule=!0;var t=q();e.default=function(i){i.registerDecorator("inline",function(r,s,a,u){var l=r;return s.partials||(s.partials={},l=function(p,h){var m=a.partials;a.partials=t.extend({},m,s.partials);var c=r(p,h);return a.partials=m,c}),s.partials[u.args[0]]=u.fn,l})},d.exports=e.default})(je,je.exports)),je.exports}var zt;function ts(){if(zt)return Ke;zt=1,Ke.__esModule=!0,Ke.registerDefaultDecorators=i;function d(r){return r&&r.__esModule?r:{default:r}}var e=es(),t=d(e);function i(r){t.default(r)}return Ke}var Qe={exports:{}},Vt;function Pi(){return Vt||(Vt=1,(function(d,e){e.__esModule=!0;var t=q(),i={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(s){if(typeof s=="string"){var a=t.indexOf(i.methodMap,s.toLowerCase());a>=0?s=a:s=parseInt(s,10)}return s},log:function(s){if(s=i.lookupLevel(s),typeof console<"u"&&i.lookupLevel(i.level)<=s){var a=i.methodMap[s];console[a]||(a="log");for(var u=arguments.length,l=Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];console[a].apply(console,l)}}};e.default=i,d.exports=e.default})(Qe,Qe.exports)),Qe.exports}var ge={},Je={},$t;function is(){if($t)return Je;$t=1,Je.__esModule=!0,Je.createNewLookupObject=e;var d=q();function e(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return d.extend.apply(void 0,[Object.create(null)].concat(i))}return Je}var Kt;function Bi(){if(Kt)return ge;Kt=1,ge.__esModule=!0,ge.createProtoAccessControl=s,ge.resultIsAllowed=a,ge.resetLoggedProperties=p;function d(h){return h&&h.__esModule?h:{default:h}}var e=is(),t=Pi(),i=d(t),r=Object.create(null);function s(h){var m=Object.create(null);m.constructor=!1,m.__defineGetter__=!1,m.__defineSetter__=!1,m.__lookupGetter__=!1;var c=Object.create(null);return c.__proto__=!1,{properties:{whitelist:e.createNewLookupObject(c,h.allowedProtoProperties),defaultValue:h.allowProtoPropertiesByDefault},methods:{whitelist:e.createNewLookupObject(m,h.allowedProtoMethods),defaultValue:h.allowProtoMethodsByDefault}}}function a(h,m,c){return u(typeof h=="function"?m.methods:m.properties,c)}function u(h,m){return h.whitelist[m]!==void 0?h.whitelist[m]===!0:h.defaultValue!==void 0?h.defaultValue:(l(m),!1)}function l(h){r[h]!==!0&&(r[h]=!0,i.default.log("error",'Handlebars: Access has been denied to resolve the property "'+h+`" because it is not an "own property" of its parent.
You can add a runtime option to disable the check or this warning:
See https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details`))}function p(){Object.keys(r).forEach(function(h){delete r[h]})}return ge}var jt;function _t(){if(jt)return K;jt=1,K.__esModule=!0,K.HandlebarsEnvironment=n;function d(g){return g&&g.__esModule?g:{default:g}}var e=q(),t=J(),i=d(t),r=Ai(),s=ts(),a=Pi(),u=d(a),l=Bi(),p="4.7.8";K.VERSION=p;var h=8;K.COMPILER_REVISION=h;var m=7;K.LAST_COMPATIBLE_COMPILER_REVISION=m;var c={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};K.REVISION_CHANGES=c;var o="[object Object]";function n(g,y,v){this.helpers=g||{},this.partials=y||{},this.decorators=v||{},r.registerDefaultHelpers(this),s.registerDefaultDecorators(this)}n.prototype={constructor:n,logger:u.default,log:u.default.log,registerHelper:function(y,v){if(e.toString.call(y)===o){if(v)throw new i.default("Arg not supported with multiple helpers");e.extend(this.helpers,y)}else this.helpers[y]=v},unregisterHelper:function(y){delete this.helpers[y]},registerPartial:function(y,v){if(e.toString.call(y)===o)e.extend(this.partials,y);else{if(typeof v>"u")throw new i.default('Attempting to register a partial called "'+y+'" as undefined');this.partials[y]=v}},unregisterPartial:function(y){delete this.partials[y]},registerDecorator:function(y,v){if(e.toString.call(y)===o){if(v)throw new i.default("Arg not supported with multiple decorators");e.extend(this.decorators,y)}else this.decorators[y]=v},unregisterDecorator:function(y){delete this.decorators[y]},resetLoggedPropertyAccesses:function(){l.resetLoggedProperties()}};var X=u.default.log;return K.log=X,K.createFrame=e.createFrame,K.logger=u.default,K}var Ze={exports:{}},Qt;function rs(){return Qt||(Qt=1,(function(d,e){e.__esModule=!0;function t(i){this.string=i}t.prototype.toString=t.prototype.toHTML=function(){return""+this.string},e.default=t,d.exports=e.default})(Ze,Ze.exports)),Ze.exports}var ie={},et={},Jt;function ss(){if(Jt)return et;Jt=1,et.__esModule=!0,et.wrapHelper=d;function d(e,t){if(typeof e!="function")return e;var i=function(){var s=arguments[arguments.length-1];return arguments[arguments.length-1]=t(s),e.apply(this,arguments)};return i}return et}var Zt;function ns(){if(Zt)return ie;Zt=1,ie.__esModule=!0,ie.checkRevision=h,ie.template=m,ie.wrapProgram=c,ie.resolvePartial=o,ie.invokePartial=n,ie.noop=X;function d(f){return f&&f.__esModule?f:{default:f}}function e(f){if(f&&f.__esModule)return f;var b={};if(f!=null)for(var M in f)Object.prototype.hasOwnProperty.call(f,M)&&(b[M]=f[M]);return b.default=f,b}var t=q(),i=e(t),r=J(),s=d(r),a=_t(),u=Ai(),l=ss(),p=Bi();function h(f){var b=f&&f[0]||1,M=a.COMPILER_REVISION;if(!(b>=a.LAST_COMPATIBLE_COMPILER_REVISION&&b<=a.COMPILER_REVISION))if(b<a.LAST_COMPATIBLE_COMPILER_REVISION){var k=a.REVISION_CHANGES[M],E=a.REVISION_CHANGES[b];throw new s.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+k+") or downgrade your runtime to an older version ("+E+").")}else throw new s.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+f[1]+").")}function m(f,b){if(!b)throw new s.default("No environment passed to template");if(!f||!f.main)throw new s.default("Unknown template object: "+typeof f);f.main.decorator=f.main_d,b.VM.checkRevision(f.compiler);var M=f.compiler&&f.compiler[0]===7;function k(T,C,I){I.hash&&(C=i.extend({},C,I.hash),I.ids&&(I.ids[0]=!0)),T=b.VM.resolvePartial.call(this,T,C,I);var A=i.extend({},I,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),N=b.VM.invokePartial.call(this,T,C,A);if(N==null&&b.compile&&(I.partials[I.name]=b.compile(T,f.compilerOptions,b),N=I.partials[I.name](C,A)),N!=null){if(I.indent){for(var D=N.split(`
`),H=0,Me=D.length;H<Me&&!(!D[H]&&H+1===Me);H++)D[H]=I.indent+D[H];N=D.join(`
`)}return N}else throw new s.default("The partial "+I.name+" could not be compiled when running in runtime-only mode")}var E={strict:function(C,I,A){if(!C||!(I in C))throw new s.default('"'+I+'" not defined in '+C,{loc:A});return E.lookupProperty(C,I)},lookupProperty:function(C,I){var A=C[I];if(A==null||Object.prototype.hasOwnProperty.call(C,I)||p.resultIsAllowed(A,E.protoAccessControl,I))return A},lookup:function(C,I){for(var A=C.length,N=0;N<A;N++){var D=C[N]&&E.lookupProperty(C[N],I);if(D!=null)return C[N][I]}},lambda:function(C,I){return typeof C=="function"?C.call(I):C},escapeExpression:i.escapeExpression,invokePartial:k,fn:function(C){var I=f[C];return I.decorator=f[C+"_d"],I},programs:[],program:function(C,I,A,N,D){var H=this.programs[C],Me=this.fn(C);return I||D||N||A?H=c(this,C,Me,I,A,N,D):H||(H=this.programs[C]=c(this,C,Me)),H},data:function(C,I){for(;C&&I--;)C=C._parent;return C},mergeIfNeeded:function(C,I){var A=C||I;return C&&I&&C!==I&&(A=i.extend({},I,C)),A},nullContext:Object.seal({}),noop:b.VM.noop,compilerInfo:f.compiler};function w(T){var C=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],I=C.data;w._setup(C),!C.partial&&f.useData&&(I=g(T,I));var A=void 0,N=f.useBlockParams?[]:void 0;f.useDepths&&(C.depths?A=T!=C.depths[0]?[T].concat(C.depths):C.depths:A=[T]);function D(H){return""+f.main(E,H,E.helpers,E.partials,I,N,A)}return D=y(f.main,D,E,C.depths||[],I,N),D(T,C)}return w.isTop=!0,w._setup=function(T){if(T.partial)E.protoAccessControl=T.protoAccessControl,E.helpers=T.helpers,E.partials=T.partials,E.decorators=T.decorators,E.hooks=T.hooks;else{var C=i.extend({},b.helpers,T.helpers);v(C,E),E.helpers=C,f.usePartial&&(E.partials=E.mergeIfNeeded(T.partials,b.partials)),(f.usePartial||f.useDecorators)&&(E.decorators=i.extend({},b.decorators,T.decorators)),E.hooks={},E.protoAccessControl=p.createProtoAccessControl(T);var I=T.allowCallsToHelperMissing||M;u.moveHelperToHooks(E,"helperMissing",I),u.moveHelperToHooks(E,"blockHelperMissing",I)}},w._child=function(T,C,I,A){if(f.useBlockParams&&!I)throw new s.default("must pass block params");if(f.useDepths&&!A)throw new s.default("must pass parent depths");return c(E,T,f[T],C,0,I,A)},w}function c(f,b,M,k,E,w,T){function C(I){var A=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],N=T;return T&&I!=T[0]&&!(I===f.nullContext&&T[0]===null)&&(N=[I].concat(T)),M(f,I,f.helpers,f.partials,A.data||k,w&&[A.blockParams].concat(w),N)}return C=y(M,C,f,T,k,w),C.program=b,C.depth=T?T.length:0,C.blockParams=E||0,C}function o(f,b,M){return f?!f.call&&!M.name&&(M.name=f,f=M.partials[f]):M.name==="@partial-block"?f=M.data["partial-block"]:f=M.partials[M.name],f}function n(f,b,M){var k=M.data&&M.data["partial-block"];M.partial=!0,M.ids&&(M.data.contextPath=M.ids[0]||M.data.contextPath);var E=void 0;if(M.fn&&M.fn!==X&&(function(){M.data=a.createFrame(M.data);var w=M.fn;E=M.data["partial-block"]=function(C){var I=arguments.length<=1||arguments[1]===void 0?{}:arguments[1];return I.data=a.createFrame(I.data),I.data["partial-block"]=k,w(C,I)},w.partials&&(M.partials=i.extend({},M.partials,w.partials))})(),f===void 0&&E&&(f=E),f===void 0)throw new s.default("The partial "+M.name+" could not be found");if(f instanceof Function)return f(b,M)}function X(){return""}function g(f,b){return(!b||!("root"in b))&&(b=b?a.createFrame(b):{},b.root=f),b}function y(f,b,M,k,E,w){if(f.decorator){var T={};b=f.decorator(b,T,M,k&&k[0],E,w,k),i.extend(b,T)}return b}function v(f,b){Object.keys(f).forEach(function(M){var k=f[M];f[M]=G(k,b)})}function G(f,b){var M=b.lookupProperty;return l.wrapHelper(f,function(k){return i.extend({lookupProperty:M},k)})}return ie}var tt={exports:{}},ei;function xi(){return ei||(ei=1,(function(d,e){e.__esModule=!0,e.default=function(t){(function(){typeof globalThis!="object"&&(Object.prototype.__defineGetter__("__magic__",function(){return this}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__)})();var i=globalThis.Handlebars;t.noConflict=function(){return globalThis.Handlebars===t&&(globalThis.Handlebars=i),t}},d.exports=e.default})(tt,tt.exports)),tt.exports}var ti;function os(){return ti||(ti=1,(function(d,e){e.__esModule=!0;function t(v){return v&&v.__esModule?v:{default:v}}function i(v){if(v&&v.__esModule)return v;var G={};if(v!=null)for(var f in v)Object.prototype.hasOwnProperty.call(v,f)&&(G[f]=v[f]);return G.default=v,G}var r=_t(),s=i(r),a=rs(),u=t(a),l=J(),p=t(l),h=q(),m=i(h),c=ns(),o=i(c),n=xi(),X=t(n);function g(){var v=new s.HandlebarsEnvironment;return m.extend(v,s),v.SafeString=u.default,v.Exception=p.default,v.Utils=m,v.escapeExpression=m.escapeExpression,v.VM=o,v.template=function(G){return o.template(G,v)},v}var y=g();y.create=g,X.default(y),y.default=y,e.default=y,d.exports=e.default})(De,De.exports)),De.exports}var it={exports:{}},ii;function Oi(){return ii||(ii=1,(function(d,e){e.__esModule=!0;var t={helpers:{helperExpression:function(r){return r.type==="SubExpression"||(r.type==="MustacheStatement"||r.type==="BlockStatement")&&!!(r.params&&r.params.length||r.hash)},scopedId:function(r){return/^\.|this\b/.test(r.original)},simpleId:function(r){return r.parts.length===1&&!t.helpers.scopedId(r)&&!r.depth}}};e.default=t,d.exports=e.default})(it,it.exports)),it.exports}var fe={},rt={exports:{}},ri;function as(){return ri||(ri=1,(function(d,e){e.__esModule=!0;var t=(function(){var i={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(u,l,p,h,m,c,o){var n=c.length-1;switch(m){case 1:return c[n-1];case 2:this.$=h.prepareProgram(c[n]);break;case 3:this.$=c[n];break;case 4:this.$=c[n];break;case 5:this.$=c[n];break;case 6:this.$=c[n];break;case 7:this.$=c[n];break;case 8:this.$=c[n];break;case 9:this.$={type:"CommentStatement",value:h.stripComment(c[n]),strip:h.stripFlags(c[n],c[n]),loc:h.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:c[n],value:c[n],loc:h.locInfo(this._$)};break;case 11:this.$=h.prepareRawBlock(c[n-2],c[n-1],c[n],this._$);break;case 12:this.$={path:c[n-3],params:c[n-2],hash:c[n-1]};break;case 13:this.$=h.prepareBlock(c[n-3],c[n-2],c[n-1],c[n],!1,this._$);break;case 14:this.$=h.prepareBlock(c[n-3],c[n-2],c[n-1],c[n],!0,this._$);break;case 15:this.$={open:c[n-5],path:c[n-4],params:c[n-3],hash:c[n-2],blockParams:c[n-1],strip:h.stripFlags(c[n-5],c[n])};break;case 16:this.$={path:c[n-4],params:c[n-3],hash:c[n-2],blockParams:c[n-1],strip:h.stripFlags(c[n-5],c[n])};break;case 17:this.$={path:c[n-4],params:c[n-3],hash:c[n-2],blockParams:c[n-1],strip:h.stripFlags(c[n-5],c[n])};break;case 18:this.$={strip:h.stripFlags(c[n-1],c[n-1]),program:c[n]};break;case 19:var X=h.prepareBlock(c[n-2],c[n-1],c[n],c[n],!1,this._$),g=h.prepareProgram([X],c[n-1].loc);g.chained=!0,this.$={strip:c[n-2].strip,program:g,chain:!0};break;case 20:this.$=c[n];break;case 21:this.$={path:c[n-1],strip:h.stripFlags(c[n-2],c[n])};break;case 22:this.$=h.prepareMustache(c[n-3],c[n-2],c[n-1],c[n-4],h.stripFlags(c[n-4],c[n]),this._$);break;case 23:this.$=h.prepareMustache(c[n-3],c[n-2],c[n-1],c[n-4],h.stripFlags(c[n-4],c[n]),this._$);break;case 24:this.$={type:"PartialStatement",name:c[n-3],params:c[n-2],hash:c[n-1],indent:"",strip:h.stripFlags(c[n-4],c[n]),loc:h.locInfo(this._$)};break;case 25:this.$=h.preparePartialBlock(c[n-2],c[n-1],c[n],this._$);break;case 26:this.$={path:c[n-3],params:c[n-2],hash:c[n-1],strip:h.stripFlags(c[n-4],c[n])};break;case 27:this.$=c[n];break;case 28:this.$=c[n];break;case 29:this.$={type:"SubExpression",path:c[n-3],params:c[n-2],hash:c[n-1],loc:h.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:c[n],loc:h.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:h.id(c[n-2]),value:c[n],loc:h.locInfo(this._$)};break;case 32:this.$=h.id(c[n-1]);break;case 33:this.$=c[n];break;case 34:this.$=c[n];break;case 35:this.$={type:"StringLiteral",value:c[n],original:c[n],loc:h.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(c[n]),original:Number(c[n]),loc:h.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:c[n]==="true",original:c[n]==="true",loc:h.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:h.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:h.locInfo(this._$)};break;case 40:this.$=c[n];break;case 41:this.$=c[n];break;case 42:this.$=h.preparePath(!0,c[n],this._$);break;case 43:this.$=h.preparePath(!1,c[n],this._$);break;case 44:c[n-2].push({part:h.id(c[n]),original:c[n],separator:c[n-1]}),this.$=c[n-2];break;case 45:this.$=[{part:h.id(c[n]),original:c[n]}];break;case 46:this.$=[];break;case 47:c[n-1].push(c[n]);break;case 48:this.$=[];break;case 49:c[n-1].push(c[n]);break;case 50:this.$=[];break;case 51:c[n-1].push(c[n]);break;case 58:this.$=[];break;case 59:c[n-1].push(c[n]);break;case 64:this.$=[];break;case 65:c[n-1].push(c[n]);break;case 70:this.$=[];break;case 71:c[n-1].push(c[n]);break;case 78:this.$=[];break;case 79:c[n-1].push(c[n]);break;case 82:this.$=[];break;case 83:c[n-1].push(c[n]);break;case 86:this.$=[];break;case 87:c[n-1].push(c[n]);break;case 90:this.$=[];break;case 91:c[n-1].push(c[n]);break;case 94:this.$=[];break;case 95:c[n-1].push(c[n]);break;case 98:this.$=[c[n]];break;case 99:c[n-1].push(c[n]);break;case 100:this.$=[c[n]];break;case 101:c[n-1].push(c[n]);break}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(u,l){throw new Error(u)},parse:function(u){var l=this,p=[0],h=[null],m=[],c=this.table,o="",n=0,X=0;this.lexer.setInput(u),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc>"u"&&(this.lexer.yylloc={});var g=this.lexer.yylloc;m.push(g);var y=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);function v(){var A;return A=l.lexer.lex()||1,typeof A!="number"&&(A=l.symbols_[A]||A),A}for(var G,f,b,M,k={},E,w,T,C;;){if(f=p[p.length-1],this.defaultActions[f]?b=this.defaultActions[f]:((G===null||typeof G>"u")&&(G=v()),b=c[f]&&c[f][G]),typeof b>"u"||!b.length||!b[0]){var I="";{C=[];for(E in c[f])this.terminals_[E]&&E>2&&C.push("'"+this.terminals_[E]+"'");this.lexer.showPosition?I="Parse error on line "+(n+1)+`:
`+this.lexer.showPosition()+`
Expecting `+C.join(", ")+", got '"+(this.terminals_[G]||G)+"'":I="Parse error on line "+(n+1)+": Unexpected "+(G==1?"end of input":"'"+(this.terminals_[G]||G)+"'"),this.parseError(I,{text:this.lexer.match,token:this.terminals_[G]||G,line:this.lexer.yylineno,loc:g,expected:C})}}if(b[0]instanceof Array&&b.length>1)throw new Error("Parse Error: multiple actions possible at state: "+f+", token: "+G);switch(b[0]){case 1:p.push(G),h.push(this.lexer.yytext),m.push(this.lexer.yylloc),p.push(b[1]),G=null,X=this.lexer.yyleng,o=this.lexer.yytext,n=this.lexer.yylineno,g=this.lexer.yylloc;break;case 2:if(w=this.productions_[b[1]][1],k.$=h[h.length-w],k._$={first_line:m[m.length-(w||1)].first_line,last_line:m[m.length-1].last_line,first_column:m[m.length-(w||1)].first_column,last_column:m[m.length-1].last_column},y&&(k._$.range=[m[m.length-(w||1)].range[0],m[m.length-1].range[1]]),M=this.performAction.call(k,o,X,n,this.yy,b[1],h,m),typeof M<"u")return M;w&&(p=p.slice(0,-1*w*2),h=h.slice(0,-1*w),m=m.slice(0,-1*w)),p.push(this.productions_[b[1]][0]),h.push(k.$),m.push(k._$),T=c[p[p.length-2]][p[p.length-1]],p.push(T);break;case 3:return!0}}return!0}},r=(function(){var a={EOF:1,parseError:function(l,p){if(this.yy.parser)this.yy.parser.parseError(l,p);else throw new Error(l)},setInput:function(l){return this._input=l,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var l=this._input[0];this.yytext+=l,this.yyleng++,this.offset++,this.match+=l,this.matched+=l;var p=l.match(/(?:\r\n?|\n).*/g);return p?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),l},unput:function(l){var p=l.length,h=l.split(/(?:\r\n?|\n)/g);this._input=l+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-p-1),this.offset-=p;var m=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),h.length-1&&(this.yylineno-=h.length-1);var c=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:h?(h.length===m.length?this.yylloc.first_column:0)+m[m.length-h.length].length-h[0].length:this.yylloc.first_column-p},this.options.ranges&&(this.yylloc.range=[c[0],c[0]+this.yyleng-p]),this},more:function(){return this._more=!0,this},less:function(l){this.unput(this.match.slice(l))},pastInput:function(){var l=this.matched.substr(0,this.matched.length-this.match.length);return(l.length>20?"...":"")+l.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var l=this.match;return l.length<20&&(l+=this._input.substr(0,20-l.length)),(l.substr(0,20)+(l.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var l=this.pastInput(),p=new Array(l.length+1).join("-");return l+this.upcomingInput()+`
`+p+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var l,p,h,m,c;this._more||(this.yytext="",this.match="");for(var o=this._currentRules(),n=0;n<o.length&&(h=this._input.match(this.rules[o[n]]),!(h&&(!p||h[0].length>p[0].length)&&(p=h,m=n,!this.options.flex)));n++);return p?(c=p[0].match(/(?:\r\n?|\n).*/g),c&&(this.yylineno+=c.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+p[0].length},this.yytext+=p[0],this.match+=p[0],this.matches=p,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(p[0].length),this.matched+=p[0],l=this.performAction.call(this,this.yy,this,o[m],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),l||void 0):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var l=this.next();return typeof l<"u"?l:this.lex()},begin:function(l){this.conditionStack.push(l)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(l){this.begin(l)}};return a.options={},a.performAction=function(l,p,h,m){function c(o,n){return p.yytext=p.yytext.substring(o,p.yyleng-n+o)}switch(h){case 0:if(p.yytext.slice(-2)==="\\\\"?(c(0,1),this.begin("mu")):p.yytext.slice(-1)==="\\"?(c(0,1),this.begin("emu")):this.begin("mu"),p.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),this.conditionStack[this.conditionStack.length-1]==="raw"?15:(c(5,9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(p.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return p.yytext=c(1,2).replace(/\\"/g,'"'),80;case 32:return p.yytext=c(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return p.yytext=p.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},a.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],a.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},a})();i.lexer=r;function s(){this.yy={}}return s.prototype=i,i.Parser=s,new s})();e.default=t,d.exports=e.default})(rt,rt.exports)),rt.exports}var st={exports:{}},nt={exports:{}},si;function Li(){return si||(si=1,(function(d,e){e.__esModule=!0;function t(p){return p&&p.__esModule?p:{default:p}}var i=J(),r=t(i);function s(){this.parents=[]}s.prototype={constructor:s,mutating:!1,acceptKey:function(h,m){var c=this.accept(h[m]);if(this.mutating){if(c&&!s.prototype[c.type])throw new r.default('Unexpected node type "'+c.type+'" found when accepting '+m+" on "+h.type);h[m]=c}},acceptRequired:function(h,m){if(this.acceptKey(h,m),!h[m])throw new r.default(h.type+" requires "+m)},acceptArray:function(h){for(var m=0,c=h.length;m<c;m++)this.acceptKey(h,m),h[m]||(h.splice(m,1),m--,c--)},accept:function(h){if(h){if(!this[h.type])throw new r.default("Unknown type: "+h.type,h);this.current&&this.parents.unshift(this.current),this.current=h;var m=this[h.type](h);if(this.current=this.parents.shift(),!this.mutating||m)return m;if(m!==!1)return h}},Program:function(h){this.acceptArray(h.body)},MustacheStatement:a,Decorator:a,BlockStatement:u,DecoratorBlock:u,PartialStatement:l,PartialBlockStatement:function(h){l.call(this,h),this.acceptKey(h,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:a,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(h){this.acceptArray(h.pairs)},HashPair:function(h){this.acceptRequired(h,"value")}};function a(p){this.acceptRequired(p,"path"),this.acceptArray(p.params),this.acceptKey(p,"hash")}function u(p){a.call(this,p),this.acceptKey(p,"program"),this.acceptKey(p,"inverse")}function l(p){this.acceptRequired(p,"name"),this.acceptArray(p.params),this.acceptKey(p,"hash")}e.default=s,d.exports=e.default})(nt,nt.exports)),nt.exports}var ni;function cs(){return ni||(ni=1,(function(d,e){e.__esModule=!0;function t(h){return h&&h.__esModule?h:{default:h}}var i=Li(),r=t(i);function s(){var h=arguments.length<=0||arguments[0]===void 0?{}:arguments[0];this.options=h}s.prototype=new r.default,s.prototype.Program=function(h){var m=!this.options.ignoreStandalone,c=!this.isRootSeen;this.isRootSeen=!0;for(var o=h.body,n=0,X=o.length;n<X;n++){var g=o[n],y=this.accept(g);if(y){var v=a(o,n,c),G=u(o,n,c),f=y.openStandalone&&v,b=y.closeStandalone&&G,M=y.inlineStandalone&&v&&G;y.close&&l(o,n,!0),y.open&&p(o,n,!0),m&&M&&(l(o,n),p(o,n)&&g.type==="PartialStatement"&&(g.indent=/([ \t]+$)/.exec(o[n-1].original)[1])),m&&f&&(l((g.program||g.inverse).body),p(o,n)),m&&b&&(l(o,n),p((g.inverse||g.program).body))}}return h},s.prototype.BlockStatement=s.prototype.DecoratorBlock=s.prototype.PartialBlockStatement=function(h){this.accept(h.program),this.accept(h.inverse);var m=h.program||h.inverse,c=h.program&&h.inverse,o=c,n=c;if(c&&c.chained)for(o=c.body[0].program;n.chained;)n=n.body[n.body.length-1].program;var X={open:h.openStrip.open,close:h.closeStrip.close,openStandalone:u(m.body),closeStandalone:a((o||m).body)};if(h.openStrip.close&&l(m.body,null,!0),c){var g=h.inverseStrip;g.open&&p(m.body,null,!0),g.close&&l(o.body,null,!0),h.closeStrip.open&&p(n.body,null,!0),!this.options.ignoreStandalone&&a(m.body)&&u(o.body)&&(p(m.body),l(o.body))}else h.closeStrip.open&&p(m.body,null,!0);return X},s.prototype.Decorator=s.prototype.MustacheStatement=function(h){return h.strip},s.prototype.PartialStatement=s.prototype.CommentStatement=function(h){var m=h.strip||{};return{inlineStandalone:!0,open:m.open,close:m.close}};function a(h,m,c){m===void 0&&(m=h.length);var o=h[m-1],n=h[m-2];if(!o)return c;if(o.type==="ContentStatement")return(n||!c?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(o.original)}function u(h,m,c){m===void 0&&(m=-1);var o=h[m+1],n=h[m+2];if(!o)return c;if(o.type==="ContentStatement")return(n||!c?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(o.original)}function l(h,m,c){var o=h[m==null?0:m+1];if(!(!o||o.type!=="ContentStatement"||!c&&o.rightStripped)){var n=o.value;o.value=o.value.replace(c?/^\s+/:/^[ \t]*\r?\n?/,""),o.rightStripped=o.value!==n}}function p(h,m,c){var o=h[m==null?h.length-1:m-1];if(!(!o||o.type!=="ContentStatement"||!c&&o.leftStripped)){var n=o.value;return o.value=o.value.replace(c?/\s+$/:/[ \t]+$/,""),o.leftStripped=o.value!==n,o.leftStripped}}e.default=s,d.exports=e.default})(st,st.exports)),st.exports}var Y={},oi;function us(){if(oi)return Y;oi=1,Y.__esModule=!0,Y.SourceLocation=r,Y.id=s,Y.stripFlags=a,Y.stripComment=u,Y.preparePath=l,Y.prepareMustache=p,Y.prepareRawBlock=h,Y.prepareBlock=m,Y.prepareProgram=c,Y.preparePartialBlock=o;function d(n){return n&&n.__esModule?n:{default:n}}var e=J(),t=d(e);function i(n,X){if(X=X.path?X.path.original:X,n.path.original!==X){var g={loc:n.path.loc};throw new t.default(n.path.original+" doesn't match "+X,g)}}function r(n,X){this.source=n,this.start={line:X.first_line,column:X.first_column},this.end={line:X.last_line,column:X.last_column}}function s(n){return/^\[.*\]$/.test(n)?n.substring(1,n.length-1):n}function a(n,X){return{open:n.charAt(2)==="~",close:X.charAt(X.length-3)==="~"}}function u(n){return n.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function l(n,X,g){g=this.locInfo(g);for(var y=n?"@":"",v=[],G=0,f=0,b=X.length;f<b;f++){var M=X[f].part,k=X[f].original!==M;if(y+=(X[f].separator||"")+M,!k&&(M===".."||M==="."||M==="this")){if(v.length>0)throw new t.default("Invalid path: "+y,{loc:g});M===".."&&G++}else v.push(M)}return{type:"PathExpression",data:n,depth:G,parts:v,original:y,loc:g}}function p(n,X,g,y,v,G){var f=y.charAt(3)||y.charAt(2),b=f!=="{"&&f!=="&",M=/\*/.test(y);return{type:M?"Decorator":"MustacheStatement",path:n,params:X,hash:g,escaped:b,strip:v,loc:this.locInfo(G)}}function h(n,X,g,y){i(n,g),y=this.locInfo(y);var v={type:"Program",body:X,strip:{},loc:y};return{type:"BlockStatement",path:n.path,params:n.params,hash:n.hash,program:v,openStrip:{},inverseStrip:{},closeStrip:{},loc:y}}function m(n,X,g,y,v,G){y&&y.path&&i(n,y);var f=/\*/.test(n.open);X.blockParams=n.blockParams;var b=void 0,M=void 0;if(g){if(f)throw new t.default("Unexpected inverse block on decorator",g);g.chain&&(g.program.body[0].closeStrip=y.strip),M=g.strip,b=g.program}return v&&(v=b,b=X,X=v),{type:f?"DecoratorBlock":"BlockStatement",path:n.path,params:n.params,hash:n.hash,program:X,inverse:b,openStrip:n.strip,inverseStrip:M,closeStrip:y&&y.strip,loc:this.locInfo(G)}}function c(n,X){if(!X&&n.length){var g=n[0].loc,y=n[n.length-1].loc;g&&y&&(X={source:g.source,start:{line:g.start.line,column:g.start.column},end:{line:y.end.line,column:y.end.column}})}return{type:"Program",body:n,strip:{},loc:X}}function o(n,X,g,y){return i(n,g),{type:"PartialBlockStatement",name:n.path,params:n.params,hash:n.hash,program:X,openStrip:n.strip,closeStrip:g&&g.strip,loc:this.locInfo(y)}}return Y}var ai;function ls(){if(ai)return fe;ai=1,fe.__esModule=!0,fe.parseWithoutProcessing=h,fe.parse=m;function d(c){if(c&&c.__esModule)return c;var o={};if(c!=null)for(var n in c)Object.prototype.hasOwnProperty.call(c,n)&&(o[n]=c[n]);return o.default=c,o}function e(c){return c&&c.__esModule?c:{default:c}}var t=as(),i=e(t),r=cs(),s=e(r),a=us(),u=d(a),l=q();fe.parser=i.default;var p={};l.extend(p,u);function h(c,o){if(c.type==="Program")return c;i.default.yy=p,p.locInfo=function(X){return new p.SourceLocation(o&&o.srcName,X)};var n=i.default.parse(c);return n}function m(c,o){var n=h(c,o),X=new s.default(o);return X.accept(n)}return fe}var ye={},ci;function hs(){if(ci)return ye;ci=1,ye.__esModule=!0,ye.Compiler=u,ye.precompile=l,ye.compile=p;function d(c){return c&&c.__esModule?c:{default:c}}var e=J(),t=d(e),i=q(),r=Oi(),s=d(r),a=[].slice;function u(){}u.prototype={compiler:u,equals:function(o){var n=this.opcodes.length;if(o.opcodes.length!==n)return!1;for(var X=0;X<n;X++){var g=this.opcodes[X],y=o.opcodes[X];if(g.opcode!==y.opcode||!h(g.args,y.args))return!1}n=this.children.length;for(var X=0;X<n;X++)if(!this.children[X].equals(o.children[X]))return!1;return!0},guid:0,compile:function(o,n){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=n,this.stringParams=n.stringParams,this.trackIds=n.trackIds,n.blockParams=n.blockParams||[],n.knownHelpers=i.extend(Object.create(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},n.knownHelpers),this.accept(o)},compileProgram:function(o){var n=new this.compiler,X=n.compile(o,this.options),g=this.guid++;return this.usePartial=this.usePartial||X.usePartial,this.children[g]=X,this.useDepths=this.useDepths||X.useDepths,g},accept:function(o){if(!this[o.type])throw new t.default("Unknown type: "+o.type,o);this.sourceNode.unshift(o);var n=this[o.type](o);return this.sourceNode.shift(),n},Program:function(o){this.options.blockParams.unshift(o.blockParams);for(var n=o.body,X=n.length,g=0;g<X;g++)this.accept(n[g]);return this.options.blockParams.shift(),this.isSimple=X===1,this.blockParams=o.blockParams?o.blockParams.length:0,this},BlockStatement:function(o){m(o);var n=o.program,X=o.inverse;n=n&&this.compileProgram(n),X=X&&this.compileProgram(X);var g=this.classifySexpr(o);g==="helper"?this.helperSexpr(o,n,X):g==="simple"?(this.simpleSexpr(o),this.opcode("pushProgram",n),this.opcode("pushProgram",X),this.opcode("emptyHash"),this.opcode("blockValue",o.path.original)):(this.ambiguousSexpr(o,n,X),this.opcode("pushProgram",n),this.opcode("pushProgram",X),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(o){var n=o.program&&this.compileProgram(o.program),X=this.setupFullMustacheParams(o,n,void 0),g=o.path;this.useDecorators=!0,this.opcode("registerDecorator",X.length,g.original)},PartialStatement:function(o){this.usePartial=!0;var n=o.program;n&&(n=this.compileProgram(o.program));var X=o.params;if(X.length>1)throw new t.default("Unsupported number of partial arguments: "+X.length,o);X.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):X.push({type:"PathExpression",parts:[],depth:0}));var g=o.name.original,y=o.name.type==="SubExpression";y&&this.accept(o.name),this.setupFullMustacheParams(o,n,void 0,!0);var v=o.indent||"";this.options.preventIndent&&v&&(this.opcode("appendContent",v),v=""),this.opcode("invokePartial",y,g,v),this.opcode("append")},PartialBlockStatement:function(o){this.PartialStatement(o)},MustacheStatement:function(o){this.SubExpression(o),o.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(o){this.DecoratorBlock(o)},ContentStatement:function(o){o.value&&this.opcode("appendContent",o.value)},CommentStatement:function(){},SubExpression:function(o){m(o);var n=this.classifySexpr(o);n==="simple"?this.simpleSexpr(o):n==="helper"?this.helperSexpr(o):this.ambiguousSexpr(o)},ambiguousSexpr:function(o,n,X){var g=o.path,y=g.parts[0],v=n!=null||X!=null;this.opcode("getContext",g.depth),this.opcode("pushProgram",n),this.opcode("pushProgram",X),g.strict=!0,this.accept(g),this.opcode("invokeAmbiguous",y,v)},simpleSexpr:function(o){var n=o.path;n.strict=!0,this.accept(n),this.opcode("resolvePossibleLambda")},helperSexpr:function(o,n,X){var g=this.setupFullMustacheParams(o,n,X),y=o.path,v=y.parts[0];if(this.options.knownHelpers[v])this.opcode("invokeKnownHelper",g.length,v);else{if(this.options.knownHelpersOnly)throw new t.default("You specified knownHelpersOnly, but used the unknown helper "+v,o);y.strict=!0,y.falsy=!0,this.accept(y),this.opcode("invokeHelper",g.length,y.original,s.default.helpers.simpleId(y))}},PathExpression:function(o){this.addDepth(o.depth),this.opcode("getContext",o.depth);var n=o.parts[0],X=s.default.helpers.scopedId(o),g=!o.depth&&!X&&this.blockParamIndex(n);g?this.opcode("lookupBlockParam",g,o.parts):n?o.data?(this.options.data=!0,this.opcode("lookupData",o.depth,o.parts,o.strict)):this.opcode("lookupOnContext",o.parts,o.falsy,o.strict,X):this.opcode("pushContext")},StringLiteral:function(o){this.opcode("pushString",o.value)},NumberLiteral:function(o){this.opcode("pushLiteral",o.value)},BooleanLiteral:function(o){this.opcode("pushLiteral",o.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(o){var n=o.pairs,X=0,g=n.length;for(this.opcode("pushHash");X<g;X++)this.pushParam(n[X].value);for(;X--;)this.opcode("assignToHash",n[X].key);this.opcode("popHash")},opcode:function(o){this.opcodes.push({opcode:o,args:a.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(o){o&&(this.useDepths=!0)},classifySexpr:function(o){var n=s.default.helpers.simpleId(o.path),X=n&&!!this.blockParamIndex(o.path.parts[0]),g=!X&&s.default.helpers.helperExpression(o),y=!X&&(g||n);if(y&&!g){var v=o.path.parts[0],G=this.options;G.knownHelpers[v]?g=!0:G.knownHelpersOnly&&(y=!1)}return g?"helper":y?"ambiguous":"simple"},pushParams:function(o){for(var n=0,X=o.length;n<X;n++)this.pushParam(o[n])},pushParam:function(o){var n=o.value!=null?o.value:o.original||"";if(this.stringParams)n.replace&&(n=n.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),o.depth&&this.addDepth(o.depth),this.opcode("getContext",o.depth||0),this.opcode("pushStringParam",n,o.type),o.type==="SubExpression"&&this.accept(o);else{if(this.trackIds){var X=void 0;if(o.parts&&!s.default.helpers.scopedId(o)&&!o.depth&&(X=this.blockParamIndex(o.parts[0])),X){var g=o.parts.slice(1).join(".");this.opcode("pushId","BlockParam",X,g)}else n=o.original||n,n.replace&&(n=n.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",o.type,n)}this.accept(o)}},setupFullMustacheParams:function(o,n,X,g){var y=o.params;return this.pushParams(y),this.opcode("pushProgram",n),this.opcode("pushProgram",X),o.hash?this.accept(o.hash):this.opcode("emptyHash",g),y},blockParamIndex:function(o){for(var n=0,X=this.options.blockParams.length;n<X;n++){var g=this.options.blockParams[n],y=g&&i.indexOf(g,o);if(g&&y>=0)return[n,y]}}};function l(c,o,n){if(c==null||typeof c!="string"&&c.type!=="Program")throw new t.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+c);o=o||{},"data"in o||(o.data=!0),o.compat&&(o.useDepths=!0);var X=n.parse(c,o),g=new n.Compiler().compile(X,o);return new n.JavaScriptCompiler().compile(g,o)}function p(c,o,n){if(o===void 0&&(o={}),c==null||typeof c!="string"&&c.type!=="Program")throw new t.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+c);o=i.extend({},o),"data"in o||(o.data=!0),o.compat&&(o.useDepths=!0);var X=void 0;function g(){var v=n.parse(c,o),G=new n.Compiler().compile(v,o),f=new n.JavaScriptCompiler().compile(G,o,void 0,!0);return n.template(f)}function y(v,G){return X||(X=g()),X.call(this,v,G)}return y._setup=function(v){return X||(X=g()),X._setup(v)},y._child=function(v,G,f,b){return X||(X=g()),X._child(v,G,f,b)},y}function h(c,o){if(c===o)return!0;if(i.isArray(c)&&i.isArray(o)&&c.length===o.length){for(var n=0;n<c.length;n++)if(!h(c[n],o[n]))return!1;return!0}}function m(c){if(!c.path.parts){var o=c.path;c.path={type:"PathExpression",data:!1,depth:0,parts:[o.original+""],original:o.original+"",loc:o.loc}}}return ye}var ot={exports:{}},at={exports:{}},Ce={},bt={},ct={},ut={},ui;function ps(){if(ui)return ut;ui=1;var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return ut.encode=function(e){if(0<=e&&e<d.length)return d[e];throw new TypeError("Must be between 0 and 63: "+e)},ut.decode=function(e){var t=65,i=90,r=97,s=122,a=48,u=57,l=43,p=47,h=26,m=52;return t<=e&&e<=i?e-t:r<=e&&e<=s?e-r+h:a<=e&&e<=u?e-a+m:e==l?62:e==p?63:-1},ut}var li;function Ni(){if(li)return ct;li=1;var d=ps(),e=5,t=1<<e,i=t-1,r=t;function s(u){return u<0?(-u<<1)+1:(u<<1)+0}function a(u){var l=(u&1)===1,p=u>>1;return l?-p:p}return ct.encode=function(l){var p="",h,m=s(l);do h=m&i,m>>>=e,m>0&&(h|=r),p+=d.encode(h);while(m>0);return p},ct.decode=function(l,p,h){var m=l.length,c=0,o=0,n,X;do{if(p>=m)throw new Error("Expected more digits in base 64 VLQ value.");if(X=d.decode(l.charCodeAt(p++)),X===-1)throw new Error("Invalid base64 digit: "+l.charAt(p-1));n=!!(X&r),X&=i,c=c+(X<<o),o+=e}while(n);h.value=a(c),h.rest=p},ct}var St={},hi;function xe(){return hi||(hi=1,(function(d){function e(f,b,M){if(b in f)return f[b];if(arguments.length===3)return M;throw new Error('"'+b+'" is a required argument.')}d.getArg=e;var t=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,i=/^data:.+\,.+$/;function r(f){var b=f.match(t);return b?{scheme:b[1],auth:b[2],host:b[3],port:b[4],path:b[5]}:null}d.urlParse=r;function s(f){var b="";return f.scheme&&(b+=f.scheme+":"),b+="//",f.auth&&(b+=f.auth+"@"),f.host&&(b+=f.host),f.port&&(b+=":"+f.port),f.path&&(b+=f.path),b}d.urlGenerate=s;function a(f){var b=f,M=r(f);if(M){if(!M.path)return f;b=M.path}for(var k=d.isAbsolute(b),E=b.split(/\/+/),w,T=0,C=E.length-1;C>=0;C--)w=E[C],w==="."?E.splice(C,1):w===".."?T++:T>0&&(w===""?(E.splice(C+1,T),T=0):(E.splice(C,2),T--));return b=E.join("/"),b===""&&(b=k?"/":"."),M?(M.path=b,s(M)):b}d.normalize=a;function u(f,b){f===""&&(f="."),b===""&&(b=".");var M=r(b),k=r(f);if(k&&(f=k.path||"/"),M&&!M.scheme)return k&&(M.scheme=k.scheme),s(M);if(M||b.match(i))return b;if(k&&!k.host&&!k.path)return k.host=b,s(k);var E=b.charAt(0)==="/"?b:a(f.replace(/\/+$/,"")+"/"+b);return k?(k.path=E,s(k)):E}d.join=u,d.isAbsolute=function(f){return f.charAt(0)==="/"||t.test(f)};function l(f,b){f===""&&(f="."),f=f.replace(/\/$/,"");for(var M=0;b.indexOf(f+"/")!==0;){var k=f.lastIndexOf("/");if(k<0||(f=f.slice(0,k),f.match(/^([^\/]+:\/)?\/*$/)))return b;++M}return Array(M+1).join("../")+b.substr(f.length+1)}d.relative=l;var p=(function(){var f=Object.create(null);return!("__proto__"in f)})();function h(f){return f}function m(f){return o(f)?"$"+f:f}d.toSetString=p?h:m;function c(f){return o(f)?f.slice(1):f}d.fromSetString=p?h:c;function o(f){if(!f)return!1;var b=f.length;if(b<9||f.charCodeAt(b-1)!==95||f.charCodeAt(b-2)!==95||f.charCodeAt(b-3)!==111||f.charCodeAt(b-4)!==116||f.charCodeAt(b-5)!==111||f.charCodeAt(b-6)!==114||f.charCodeAt(b-7)!==112||f.charCodeAt(b-8)!==95||f.charCodeAt(b-9)!==95)return!1;for(var M=b-10;M>=0;M--)if(f.charCodeAt(M)!==36)return!1;return!0}function n(f,b,M){var k=g(f.source,b.source);return k!==0||(k=f.originalLine-b.originalLine,k!==0)||(k=f.originalColumn-b.originalColumn,k!==0||M)||(k=f.generatedColumn-b.generatedColumn,k!==0)||(k=f.generatedLine-b.generatedLine,k!==0)?k:g(f.name,b.name)}d.compareByOriginalPositions=n;function X(f,b,M){var k=f.generatedLine-b.generatedLine;return k!==0||(k=f.generatedColumn-b.generatedColumn,k!==0||M)||(k=g(f.source,b.source),k!==0)||(k=f.originalLine-b.originalLine,k!==0)||(k=f.originalColumn-b.originalColumn,k!==0)?k:g(f.name,b.name)}d.compareByGeneratedPositionsDeflated=X;function g(f,b){return f===b?0:f===null?1:b===null?-1:f>b?1:-1}function y(f,b){var M=f.generatedLine-b.generatedLine;return M!==0||(M=f.generatedColumn-b.generatedColumn,M!==0)||(M=g(f.source,b.source),M!==0)||(M=f.originalLine-b.originalLine,M!==0)||(M=f.originalColumn-b.originalColumn,M!==0)?M:g(f.name,b.name)}d.compareByGeneratedPositionsInflated=y;function v(f){return JSON.parse(f.replace(/^\)]}'[^\n]*\n/,""))}d.parseSourceMapInput=v;function G(f,b,M){if(b=b||"",f&&(f[f.length-1]!=="/"&&b[0]!=="/"&&(f+="/"),b=f+b),M){var k=r(M);if(!k)throw new Error("sourceMapURL could not be parsed");if(k.path){var E=k.path.lastIndexOf("/");E>=0&&(k.path=k.path.substring(0,E+1))}b=u(s(k),b)}return a(b)}d.computeSourceURL=G})(St)),St}var Gt={},pi;function Ui(){if(pi)return Gt;pi=1;var d=xe(),e=Object.prototype.hasOwnProperty,t=typeof Map<"u";function i(){this._array=[],this._set=t?new Map:Object.create(null)}return i.fromArray=function(s,a){for(var u=new i,l=0,p=s.length;l<p;l++)u.add(s[l],a);return u},i.prototype.size=function(){return t?this._set.size:Object.getOwnPropertyNames(this._set).length},i.prototype.add=function(s,a){var u=t?s:d.toSetString(s),l=t?this.has(s):e.call(this._set,u),p=this._array.length;(!l||a)&&this._array.push(s),l||(t?this._set.set(s,p):this._set[u]=p)},i.prototype.has=function(s){if(t)return this._set.has(s);var a=d.toSetString(s);return e.call(this._set,a)},i.prototype.indexOf=function(s){if(t){var a=this._set.get(s);if(a>=0)return a}else{var u=d.toSetString(s);if(e.call(this._set,u))return this._set[u]}throw new Error('"'+s+'" is not in the set.')},i.prototype.at=function(s){if(s>=0&&s<this._array.length)return this._array[s];throw new Error("No element indexed by "+s)},i.prototype.toArray=function(){return this._array.slice()},Gt.ArraySet=i,Gt}var Mt={},di;function ds(){if(di)return Mt;di=1;var d=xe();function e(i,r){var s=i.generatedLine,a=r.generatedLine,u=i.generatedColumn,l=r.generatedColumn;return a>s||a==s&&l>=u||d.compareByGeneratedPositionsInflated(i,r)<=0}function t(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}return t.prototype.unsortedForEach=function(r,s){this._array.forEach(r,s)},t.prototype.add=function(r){e(this._last,r)?(this._last=r,this._array.push(r)):(this._sorted=!1,this._array.push(r))},t.prototype.toArray=function(){return this._sorted||(this._array.sort(d.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},Mt.MappingList=t,Mt}var Xi;function Di(){if(Xi)return bt;Xi=1;var d=Ni(),e=xe(),t=Ui().ArraySet,i=ds().MappingList;function r(s){s||(s={}),this._file=e.getArg(s,"file",null),this._sourceRoot=e.getArg(s,"sourceRoot",null),this._skipValidation=e.getArg(s,"skipValidation",!1),this._sources=new t,this._names=new t,this._mappings=new i,this._sourcesContents=null}return r.prototype._version=3,r.fromSourceMap=function(a){var u=a.sourceRoot,l=new r({file:a.file,sourceRoot:u});return a.eachMapping(function(p){var h={generated:{line:p.generatedLine,column:p.generatedColumn}};p.source!=null&&(h.source=p.source,u!=null&&(h.source=e.relative(u,h.source)),h.original={line:p.originalLine,column:p.originalColumn},p.name!=null&&(h.name=p.name)),l.addMapping(h)}),a.sources.forEach(function(p){var h=p;u!==null&&(h=e.relative(u,p)),l._sources.has(h)||l._sources.add(h);var m=a.sourceContentFor(p);m!=null&&l.setSourceContent(p,m)}),l},r.prototype.addMapping=function(a){var u=e.getArg(a,"generated"),l=e.getArg(a,"original",null),p=e.getArg(a,"source",null),h=e.getArg(a,"name",null);this._skipValidation||this._validateMapping(u,l,p,h),p!=null&&(p=String(p),this._sources.has(p)||this._sources.add(p)),h!=null&&(h=String(h),this._names.has(h)||this._names.add(h)),this._mappings.add({generatedLine:u.line,generatedColumn:u.column,originalLine:l!=null&&l.line,originalColumn:l!=null&&l.column,source:p,name:h})},r.prototype.setSourceContent=function(a,u){var l=a;this._sourceRoot!=null&&(l=e.relative(this._sourceRoot,l)),u!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[e.toSetString(l)]=u):this._sourcesContents&&(delete this._sourcesContents[e.toSetString(l)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))},r.prototype.applySourceMap=function(a,u,l){var p=u;if(u==null){if(a.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);p=a.file}var h=this._sourceRoot;h!=null&&(p=e.relative(h,p));var m=new t,c=new t;this._mappings.unsortedForEach(function(o){if(o.source===p&&o.originalLine!=null){var n=a.originalPositionFor({line:o.originalLine,column:o.originalColumn});n.source!=null&&(o.source=n.source,l!=null&&(o.source=e.join(l,o.source)),h!=null&&(o.source=e.relative(h,o.source)),o.originalLine=n.line,o.originalColumn=n.column,n.name!=null&&(o.name=n.name))}var X=o.source;X!=null&&!m.has(X)&&m.add(X);var g=o.name;g!=null&&!c.has(g)&&c.add(g)},this),this._sources=m,this._names=c,a.sources.forEach(function(o){var n=a.sourceContentFor(o);n!=null&&(l!=null&&(o=e.join(l,o)),h!=null&&(o=e.relative(h,o)),this.setSourceContent(o,n))},this)},r.prototype._validateMapping=function(a,u,l,p){if(u&&typeof u.line!="number"&&typeof u.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(a&&"line"in a&&"column"in a&&a.line>0&&a.column>=0&&!u&&!l&&!p)){if(a&&"line"in a&&"column"in a&&u&&"line"in u&&"column"in u&&a.line>0&&a.column>=0&&u.line>0&&u.column>=0&&l)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:a,source:l,original:u,name:p}))}},r.prototype._serializeMappings=function(){for(var a=0,u=1,l=0,p=0,h=0,m=0,c="",o,n,X,g,y=this._mappings.toArray(),v=0,G=y.length;v<G;v++){if(n=y[v],o="",n.generatedLine!==u)for(a=0;n.generatedLine!==u;)o+=";",u++;else if(v>0){if(!e.compareByGeneratedPositionsInflated(n,y[v-1]))continue;o+=","}o+=d.encode(n.generatedColumn-a),a=n.generatedColumn,n.source!=null&&(g=this._sources.indexOf(n.source),o+=d.encode(g-m),m=g,o+=d.encode(n.originalLine-1-p),p=n.originalLine-1,o+=d.encode(n.originalColumn-l),l=n.originalColumn,n.name!=null&&(X=this._names.indexOf(n.name),o+=d.encode(X-h),h=X)),c+=o}return c},r.prototype._generateSourcesContent=function(a,u){return a.map(function(l){if(!this._sourcesContents)return null;u!=null&&(l=e.relative(u,l));var p=e.toSetString(l);return Object.prototype.hasOwnProperty.call(this._sourcesContents,p)?this._sourcesContents[p]:null},this)},r.prototype.toJSON=function(){var a={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(a.file=this._file),this._sourceRoot!=null&&(a.sourceRoot=this._sourceRoot),this._sourcesContents&&(a.sourcesContent=this._generateSourcesContent(a.sources,a.sourceRoot)),a},r.prototype.toString=function(){return JSON.stringify(this.toJSON())},bt.SourceMapGenerator=r,bt}var Te={},kt={},mi;function Xs(){return mi||(mi=1,(function(d){d.GREATEST_LOWER_BOUND=1,d.LEAST_UPPER_BOUND=2;function e(t,i,r,s,a,u){var l=Math.floor((i-t)/2)+t,p=a(r,s[l],!0);return p===0?l:p>0?i-l>1?e(l,i,r,s,a,u):u==d.LEAST_UPPER_BOUND?i<s.length?i:-1:l:l-t>1?e(t,l,r,s,a,u):u==d.LEAST_UPPER_BOUND?l:t<0?-1:t}d.search=function(i,r,s,a){if(r.length===0)return-1;var u=e(-1,r.length,i,r,s,a||d.GREATEST_LOWER_BOUND);if(u<0)return-1;for(;u-1>=0&&s(r[u],r[u-1],!0)===0;)--u;return u}})(kt)),kt}var Ct={},gi;function ms(){if(gi)return Ct;gi=1;function d(i,r,s){var a=i[r];i[r]=i[s],i[s]=a}function e(i,r){return Math.round(i+Math.random()*(r-i))}function t(i,r,s,a){if(s<a){var u=e(s,a),l=s-1;d(i,u,a);for(var p=i[a],h=s;h<a;h++)r(i[h],p)<=0&&(l+=1,d(i,l,h));d(i,l+1,h);var m=l+1;t(i,r,s,m-1),t(i,r,m+1,a)}}return Ct.quickSort=function(i,r){t(i,r,0,i.length-1)},Ct}var fi;function gs(){if(fi)return Te;fi=1;var d=xe(),e=Xs(),t=Ui().ArraySet,i=Ni(),r=ms().quickSort;function s(p,h){var m=p;return typeof p=="string"&&(m=d.parseSourceMapInput(p)),m.sections!=null?new l(m,h):new a(m,h)}s.fromSourceMap=function(p,h){return a.fromSourceMap(p,h)},s.prototype._version=3,s.prototype.__generatedMappings=null,Object.defineProperty(s.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),s.prototype.__originalMappings=null,Object.defineProperty(s.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),s.prototype._charIsMappingSeparator=function(h,m){var c=h.charAt(m);return c===";"||c===","},s.prototype._parseMappings=function(h,m){throw new Error("Subclasses must implement _parseMappings")},s.GENERATED_ORDER=1,s.ORIGINAL_ORDER=2,s.GREATEST_LOWER_BOUND=1,s.LEAST_UPPER_BOUND=2,s.prototype.eachMapping=function(h,m,c){var o=m||null,n=c||s.GENERATED_ORDER,X;switch(n){case s.GENERATED_ORDER:X=this._generatedMappings;break;case s.ORIGINAL_ORDER:X=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var g=this.sourceRoot;X.map(function(y){var v=y.source===null?null:this._sources.at(y.source);return v=d.computeSourceURL(g,v,this._sourceMapURL),{source:v,generatedLine:y.generatedLine,generatedColumn:y.generatedColumn,originalLine:y.originalLine,originalColumn:y.originalColumn,name:y.name===null?null:this._names.at(y.name)}},this).forEach(h,o)},s.prototype.allGeneratedPositionsFor=function(h){var m=d.getArg(h,"line"),c={source:d.getArg(h,"source"),originalLine:m,originalColumn:d.getArg(h,"column",0)};if(c.source=this._findSourceIndex(c.source),c.source<0)return[];var o=[],n=this._findMapping(c,this._originalMappings,"originalLine","originalColumn",d.compareByOriginalPositions,e.LEAST_UPPER_BOUND);if(n>=0){var X=this._originalMappings[n];if(h.column===void 0)for(var g=X.originalLine;X&&X.originalLine===g;)o.push({line:d.getArg(X,"generatedLine",null),column:d.getArg(X,"generatedColumn",null),lastColumn:d.getArg(X,"lastGeneratedColumn",null)}),X=this._originalMappings[++n];else for(var y=X.originalColumn;X&&X.originalLine===m&&X.originalColumn==y;)o.push({line:d.getArg(X,"generatedLine",null),column:d.getArg(X,"generatedColumn",null),lastColumn:d.getArg(X,"lastGeneratedColumn",null)}),X=this._originalMappings[++n]}return o},Te.SourceMapConsumer=s;function a(p,h){var m=p;typeof p=="string"&&(m=d.parseSourceMapInput(p));var c=d.getArg(m,"version"),o=d.getArg(m,"sources"),n=d.getArg(m,"names",[]),X=d.getArg(m,"sourceRoot",null),g=d.getArg(m,"sourcesContent",null),y=d.getArg(m,"mappings"),v=d.getArg(m,"file",null);if(c!=this._version)throw new Error("Unsupported version: "+c);X&&(X=d.normalize(X)),o=o.map(String).map(d.normalize).map(function(G){return X&&d.isAbsolute(X)&&d.isAbsolute(G)?d.relative(X,G):G}),this._names=t.fromArray(n.map(String),!0),this._sources=t.fromArray(o,!0),this._absoluteSources=this._sources.toArray().map(function(G){return d.computeSourceURL(X,G,h)}),this.sourceRoot=X,this.sourcesContent=g,this._mappings=y,this._sourceMapURL=h,this.file=v}a.prototype=Object.create(s.prototype),a.prototype.consumer=s,a.prototype._findSourceIndex=function(p){var h=p;if(this.sourceRoot!=null&&(h=d.relative(this.sourceRoot,h)),this._sources.has(h))return this._sources.indexOf(h);var m;for(m=0;m<this._absoluteSources.length;++m)if(this._absoluteSources[m]==p)return m;return-1},a.fromSourceMap=function(h,m){var c=Object.create(a.prototype),o=c._names=t.fromArray(h._names.toArray(),!0),n=c._sources=t.fromArray(h._sources.toArray(),!0);c.sourceRoot=h._sourceRoot,c.sourcesContent=h._generateSourcesContent(c._sources.toArray(),c.sourceRoot),c.file=h._file,c._sourceMapURL=m,c._absoluteSources=c._sources.toArray().map(function(M){return d.computeSourceURL(c.sourceRoot,M,m)});for(var X=h._mappings.toArray().slice(),g=c.__generatedMappings=[],y=c.__originalMappings=[],v=0,G=X.length;v<G;v++){var f=X[v],b=new u;b.generatedLine=f.generatedLine,b.generatedColumn=f.generatedColumn,f.source&&(b.source=n.indexOf(f.source),b.originalLine=f.originalLine,b.originalColumn=f.originalColumn,f.name&&(b.name=o.indexOf(f.name)),y.push(b)),g.push(b)}return r(c.__originalMappings,d.compareByOriginalPositions),c},a.prototype._version=3,Object.defineProperty(a.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function u(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}a.prototype._parseMappings=function(h,m){for(var c=1,o=0,n=0,X=0,g=0,y=0,v=h.length,G=0,f={},b={},M=[],k=[],E,w,T,C,I;G<v;)if(h.charAt(G)===";")c++,G++,o=0;else if(h.charAt(G)===",")G++;else{for(E=new u,E.generatedLine=c,C=G;C<v&&!this._charIsMappingSeparator(h,C);C++);if(w=h.slice(G,C),T=f[w],T)G+=w.length;else{for(T=[];G<C;)i.decode(h,G,b),I=b.value,G=b.rest,T.push(I);if(T.length===2)throw new Error("Found a source, but no line and column");if(T.length===3)throw new Error("Found a source and line, but no column");f[w]=T}E.generatedColumn=o+T[0],o=E.generatedColumn,T.length>1&&(E.source=g+T[1],g+=T[1],E.originalLine=n+T[2],n=E.originalLine,E.originalLine+=1,E.originalColumn=X+T[3],X=E.originalColumn,T.length>4&&(E.name=y+T[4],y+=T[4])),k.push(E),typeof E.originalLine=="number"&&M.push(E)}r(k,d.compareByGeneratedPositionsDeflated),this.__generatedMappings=k,r(M,d.compareByOriginalPositions),this.__originalMappings=M},a.prototype._findMapping=function(h,m,c,o,n,X){if(h[c]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+h[c]);if(h[o]<0)throw new TypeError("Column must be greater than or equal to 0, got "+h[o]);return e.search(h,m,n,X)},a.prototype.computeColumnSpans=function(){for(var h=0;h<this._generatedMappings.length;++h){var m=this._generatedMappings[h];if(h+1<this._generatedMappings.length){var c=this._generatedMappings[h+1];if(m.generatedLine===c.generatedLine){m.lastGeneratedColumn=c.generatedColumn-1;continue}}m.lastGeneratedColumn=1/0}},a.prototype.originalPositionFor=function(h){var m={generatedLine:d.getArg(h,"line"),generatedColumn:d.getArg(h,"column")},c=this._findMapping(m,this._generatedMappings,"generatedLine","generatedColumn",d.compareByGeneratedPositionsDeflated,d.getArg(h,"bias",s.GREATEST_LOWER_BOUND));if(c>=0){var o=this._generatedMappings[c];if(o.generatedLine===m.generatedLine){var n=d.getArg(o,"source",null);n!==null&&(n=this._sources.at(n),n=d.computeSourceURL(this.sourceRoot,n,this._sourceMapURL));var X=d.getArg(o,"name",null);return X!==null&&(X=this._names.at(X)),{source:n,line:d.getArg(o,"originalLine",null),column:d.getArg(o,"originalColumn",null),name:X}}}return{source:null,line:null,column:null,name:null}},a.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(h){return h==null}):!1},a.prototype.sourceContentFor=function(h,m){if(!this.sourcesContent)return null;var c=this._findSourceIndex(h);if(c>=0)return this.sourcesContent[c];var o=h;this.sourceRoot!=null&&(o=d.relative(this.sourceRoot,o));var n;if(this.sourceRoot!=null&&(n=d.urlParse(this.sourceRoot))){var X=o.replace(/^file:\/\//,"");if(n.scheme=="file"&&this._sources.has(X))return this.sourcesContent[this._sources.indexOf(X)];if((!n.path||n.path=="/")&&this._sources.has("/"+o))return this.sourcesContent[this._sources.indexOf("/"+o)]}if(m)return null;throw new Error('"'+o+'" is not in the SourceMap.')},a.prototype.generatedPositionFor=function(h){var m=d.getArg(h,"source");if(m=this._findSourceIndex(m),m<0)return{line:null,column:null,lastColumn:null};var c={source:m,originalLine:d.getArg(h,"line"),originalColumn:d.getArg(h,"column")},o=this._findMapping(c,this._originalMappings,"originalLine","originalColumn",d.compareByOriginalPositions,d.getArg(h,"bias",s.GREATEST_LOWER_BOUND));if(o>=0){var n=this._originalMappings[o];if(n.source===c.source)return{line:d.getArg(n,"generatedLine",null),column:d.getArg(n,"generatedColumn",null),lastColumn:d.getArg(n,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},Te.BasicSourceMapConsumer=a;function l(p,h){var m=p;typeof p=="string"&&(m=d.parseSourceMapInput(p));var c=d.getArg(m,"version"),o=d.getArg(m,"sections");if(c!=this._version)throw new Error("Unsupported version: "+c);this._sources=new t,this._names=new t;var n={line:-1,column:0};this._sections=o.map(function(X){if(X.url)throw new Error("Support for url field in sections not implemented.");var g=d.getArg(X,"offset"),y=d.getArg(g,"line"),v=d.getArg(g,"column");if(y<n.line||y===n.line&&v<n.column)throw new Error("Section offsets must be ordered and non-overlapping.");return n=g,{generatedOffset:{generatedLine:y+1,generatedColumn:v+1},consumer:new s(d.getArg(X,"map"),h)}})}return l.prototype=Object.create(s.prototype),l.prototype.constructor=s,l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){for(var p=[],h=0;h<this._sections.length;h++)for(var m=0;m<this._sections[h].consumer.sources.length;m++)p.push(this._sections[h].consumer.sources[m]);return p}}),l.prototype.originalPositionFor=function(h){var m={generatedLine:d.getArg(h,"line"),generatedColumn:d.getArg(h,"column")},c=e.search(m,this._sections,function(n,X){var g=n.generatedLine-X.generatedOffset.generatedLine;return g||n.generatedColumn-X.generatedOffset.generatedColumn}),o=this._sections[c];return o?o.consumer.originalPositionFor({line:m.generatedLine-(o.generatedOffset.generatedLine-1),column:m.generatedColumn-(o.generatedOffset.generatedLine===m.generatedLine?o.generatedOffset.generatedColumn-1:0),bias:h.bias}):{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(h){return h.consumer.hasContentsOfAllSources()})},l.prototype.sourceContentFor=function(h,m){for(var c=0;c<this._sections.length;c++){var o=this._sections[c],n=o.consumer.sourceContentFor(h,!0);if(n)return n}if(m)return null;throw new Error('"'+h+'" is not in the SourceMap.')},l.prototype.generatedPositionFor=function(h){for(var m=0;m<this._sections.length;m++){var c=this._sections[m];if(c.consumer._findSourceIndex(d.getArg(h,"source"))!==-1){var o=c.consumer.generatedPositionFor(h);if(o){var n={line:o.line+(c.generatedOffset.generatedLine-1),column:o.column+(c.generatedOffset.generatedLine===o.line?c.generatedOffset.generatedColumn-1:0)};return n}}}return{line:null,column:null}},l.prototype._parseMappings=function(h,m){this.__generatedMappings=[],this.__originalMappings=[];for(var c=0;c<this._sections.length;c++)for(var o=this._sections[c],n=o.consumer._generatedMappings,X=0;X<n.length;X++){var g=n[X],y=o.consumer._sources.at(g.source);y=d.computeSourceURL(o.consumer.sourceRoot,y,this._sourceMapURL),this._sources.add(y),y=this._sources.indexOf(y);var v=null;g.name&&(v=o.consumer._names.at(g.name),this._names.add(v),v=this._names.indexOf(v));var G={source:y,generatedLine:g.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:g.generatedColumn+(o.generatedOffset.generatedLine===g.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:g.originalLine,originalColumn:g.originalColumn,name:v};this.__generatedMappings.push(G),typeof G.originalLine=="number"&&this.__originalMappings.push(G)}r(this.__generatedMappings,d.compareByGeneratedPositionsDeflated),r(this.__originalMappings,d.compareByOriginalPositions)},Te.IndexedSourceMapConsumer=l,Te}var Tt={},yi;function fs(){if(yi)return Tt;yi=1;var d=Di().SourceMapGenerator,e=xe(),t=/(\r?\n)/,i=10,r="$$$isSourceNode$$$";function s(a,u,l,p,h){this.children=[],this.sourceContents={},this.line=a??null,this.column=u??null,this.source=l??null,this.name=h??null,this[r]=!0,p!=null&&this.add(p)}return s.fromStringWithSourceMap=function(u,l,p){var h=new s,m=u.split(t),c=0,o=function(){var v=f(),G=f()||"";return v+G;function f(){return c<m.length?m[c++]:void 0}},n=1,X=0,g=null;return l.eachMapping(function(v){if(g!==null)if(n<v.generatedLine)y(g,o()),n++,X=0;else{var G=m[c]||"",f=G.substr(0,v.generatedColumn-X);m[c]=G.substr(v.generatedColumn-X),X=v.generatedColumn,y(g,f),g=v;return}for(;n<v.generatedLine;)h.add(o()),n++;if(X<v.generatedColumn){var G=m[c]||"";h.add(G.substr(0,v.generatedColumn)),m[c]=G.substr(v.generatedColumn),X=v.generatedColumn}g=v},this),c<m.length&&(g&&y(g,o()),h.add(m.splice(c).join(""))),l.sources.forEach(function(v){var G=l.sourceContentFor(v);G!=null&&(p!=null&&(v=e.join(p,v)),h.setSourceContent(v,G))}),h;function y(v,G){if(v===null||v.source===void 0)h.add(G);else{var f=p?e.join(p,v.source):v.source;h.add(new s(v.originalLine,v.originalColumn,f,G,v.name))}}},s.prototype.add=function(u){if(Array.isArray(u))u.forEach(function(l){this.add(l)},this);else if(u[r]||typeof u=="string")u&&this.children.push(u);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+u);return this},s.prototype.prepend=function(u){if(Array.isArray(u))for(var l=u.length-1;l>=0;l--)this.prepend(u[l]);else if(u[r]||typeof u=="string")this.children.unshift(u);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+u);return this},s.prototype.walk=function(u){for(var l,p=0,h=this.children.length;p<h;p++)l=this.children[p],l[r]?l.walk(u):l!==""&&u(l,{source:this.source,line:this.line,column:this.column,name:this.name})},s.prototype.join=function(u){var l,p,h=this.children.length;if(h>0){for(l=[],p=0;p<h-1;p++)l.push(this.children[p]),l.push(u);l.push(this.children[p]),this.children=l}return this},s.prototype.replaceRight=function(u,l){var p=this.children[this.children.length-1];return p[r]?p.replaceRight(u,l):typeof p=="string"?this.children[this.children.length-1]=p.replace(u,l):this.children.push("".replace(u,l)),this},s.prototype.setSourceContent=function(u,l){this.sourceContents[e.toSetString(u)]=l},s.prototype.walkSourceContents=function(u){for(var l=0,p=this.children.length;l<p;l++)this.children[l][r]&&this.children[l].walkSourceContents(u);for(var h=Object.keys(this.sourceContents),l=0,p=h.length;l<p;l++)u(e.fromSetString(h[l]),this.sourceContents[h[l]])},s.prototype.toString=function(){var u="";return this.walk(function(l){u+=l}),u},s.prototype.toStringWithSourceMap=function(u){var l={code:"",line:1,column:0},p=new d(u),h=!1,m=null,c=null,o=null,n=null;return this.walk(function(X,g){l.code+=X,g.source!==null&&g.line!==null&&g.column!==null?((m!==g.source||c!==g.line||o!==g.column||n!==g.name)&&p.addMapping({source:g.source,original:{line:g.line,column:g.column},generated:{line:l.line,column:l.column},name:g.name}),m=g.source,c=g.line,o=g.column,n=g.name,h=!0):h&&(p.addMapping({generated:{line:l.line,column:l.column}}),m=null,h=!1);for(var y=0,v=X.length;y<v;y++)X.charCodeAt(y)===i?(l.line++,l.column=0,y+1===v?(m=null,h=!1):h&&p.addMapping({source:g.source,original:{line:g.line,column:g.column},generated:{line:l.line,column:l.column},name:g.name})):l.column++}),this.walkSourceContents(function(X,g){p.setSourceContent(X,g)}),{code:l.code,map:p}},Tt.SourceNode=s,Tt}var vi;function ys(){return vi||(vi=1,Ce.SourceMapGenerator=Di().SourceMapGenerator,Ce.SourceMapConsumer=gs().SourceMapConsumer,Ce.SourceNode=fs().SourceNode),Ce}var bi;function vs(){return bi||(bi=1,(function(d,e){e.__esModule=!0;var t=q(),i=void 0;try{var r=ys();i=r.SourceNode}catch{}i||(i=function(u,l,p,h){this.src="",h&&this.add(h)},i.prototype={add:function(l){t.isArray(l)&&(l=l.join("")),this.src+=l},prepend:function(l){t.isArray(l)&&(l=l.join("")),this.src=l+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}});function s(u,l,p){if(t.isArray(u)){for(var h=[],m=0,c=u.length;m<c;m++)h.push(l.wrap(u[m],p));return h}else if(typeof u=="boolean"||typeof u=="number")return u+"";return u}function a(u){this.srcFile=u,this.source=[]}a.prototype={isEmpty:function(){return!this.source.length},prepend:function(l,p){this.source.unshift(this.wrap(l,p))},push:function(l,p){this.source.push(this.wrap(l,p))},merge:function(){var l=this.empty();return this.each(function(p){l.add(["  ",p,`
`])}),l},each:function(l){for(var p=0,h=this.source.length;p<h;p++)l(this.source[p])},empty:function(){var l=this.currentLocation||{start:{}};return new i(l.start.line,l.start.column,this.srcFile)},wrap:function(l){var p=arguments.length<=1||arguments[1]===void 0?this.currentLocation||{start:{}}:arguments[1];return l instanceof i?l:(l=s(l,this,p),new i(p.start.line,p.start.column,this.srcFile,l))},functionCall:function(l,p,h){return h=this.generateList(h),this.wrap([l,p?"."+p+"(":"(",h,")"])},quotedString:function(l){return'"'+(l+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(l){var p=this,h=[];Object.keys(l).forEach(function(c){var o=s(l[c],p);o!=="undefined"&&h.push([p.quotedString(c),":",o])});var m=this.generateList(h);return m.prepend("{"),m.add("}"),m},generateList:function(l){for(var p=this.empty(),h=0,m=l.length;h<m;h++)h&&p.add(","),p.add(s(l[h],this));return p},generateArray:function(l){var p=this.generateList(l);return p.prepend("["),p.add("]"),p}},e.default=a,d.exports=e.default})(at,at.exports)),at.exports}var Si;function bs(){return Si||(Si=1,(function(d,e){e.__esModule=!0;function t(c){return c&&c.__esModule?c:{default:c}}var i=_t(),r=J(),s=t(r),a=q(),u=vs(),l=t(u);function p(c){this.value=c}function h(){}h.prototype={nameLookup:function(o,n){return this.internalNameLookup(o,n)},depthedLookup:function(o){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(o),")"]},compilerInfo:function(){var o=i.COMPILER_REVISION,n=i.REVISION_CHANGES[o];return[o,n]},appendToBuffer:function(o,n,X){return a.isArray(o)||(o=[o]),o=this.source.wrap(o,n),this.environment.isSimple?["return ",o,";"]:X?["buffer += ",o,";"]:(o.appendToBuffer=!0,o)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(o,n){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",o,",",JSON.stringify(n),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(o,n,X,g){this.environment=o,this.options=n,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!g,this.name=this.environment.name,this.isChild=!!X,this.context=X||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(o,n),this.useDepths=this.useDepths||o.useDepths||o.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||o.useBlockParams;var y=o.opcodes,v=void 0,G=void 0,f=void 0,b=void 0;for(f=0,b=y.length;f<b;f++)v=y[f],this.source.currentLocation=v.loc,G=G||v.loc,this[v.opcode].apply(this,v.args);if(this.source.currentLocation=G,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new s.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),`;
`]),this.decorators.push("return fn;"),g?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend(`function(fn, props, container, depth0, data, blockParams, depths) {
`),this.decorators.push(`}
`),this.decorators=this.decorators.merge()));var M=this.createFunctionContext(g);if(this.isChild)return M;var k={compiler:this.compilerInfo(),main:M};this.decorators&&(k.main_d=this.decorators,k.useDecorators=!0);var E=this.context,w=E.programs,T=E.decorators;for(f=0,b=w.length;f<b;f++)w[f]&&(k[f]=w[f],T[f]&&(k[f+"_d"]=T[f],k.useDecorators=!0));return this.environment.usePartial&&(k.usePartial=!0),this.options.data&&(k.useData=!0),this.useDepths&&(k.useDepths=!0),this.useBlockParams&&(k.useBlockParams=!0),this.options.compat&&(k.compat=!0),g?k.compilerOptions=this.options:(k.compiler=JSON.stringify(k.compiler),this.source.currentLocation={start:{line:1,column:0}},k=this.objectLiteral(k),n.srcName?(k=k.toStringWithSourceMap({file:n.destName}),k.map=k.map&&k.map.toString()):k=k.toString()),k},preamble:function(){this.lastContext=0,this.source=new l.default(this.options.srcName),this.decorators=new l.default(this.options.srcName)},createFunctionContext:function(o){var n=this,X="",g=this.stackVars.concat(this.registers.list);g.length>0&&(X+=", "+g.join(", "));var y=0;Object.keys(this.aliases).forEach(function(f){var b=n.aliases[f];b.children&&b.referenceCount>1&&(X+=", alias"+ ++y+"="+f,b.children[0]="alias"+y)}),this.lookupPropertyFunctionIsUsed&&(X+=", "+this.lookupPropertyFunctionVarDeclaration());var v=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&v.push("blockParams"),this.useDepths&&v.push("depths");var G=this.mergeSource(X);return o?(v.push(G),Function.apply(this,v)):this.source.wrap(["function(",v.join(","),`) {
  `,G,"}"])},mergeSource:function(o){var n=this.environment.isSimple,X=!this.forceBuffer,g=void 0,y=void 0,v=void 0,G=void 0;return this.source.each(function(f){f.appendToBuffer?(v?f.prepend("  + "):v=f,G=f):(v&&(y?v.prepend("buffer += "):g=!0,G.add(";"),v=G=void 0),y=!0,n||(X=!1))}),X?v?(v.prepend("return "),G.add(";")):y||this.source.push('return "";'):(o+=", buffer = "+(g?"":this.initializeBuffer()),v?(v.prepend("return buffer + "),G.add(";")):this.source.push("return buffer;")),o&&this.source.prepend("var "+o.substring(2)+(g?"":`;
`)),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return`
      lookupProperty = container.lookupProperty || function(parent, propertyName) {
        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {
          return parent[propertyName];
        }
        return undefined
    }
    `.trim()},blockValue:function(o){var n=this.aliasable("container.hooks.blockHelperMissing"),X=[this.contextName(0)];this.setupHelperArgs(o,0,X);var g=this.popStack();X.splice(1,0,g),this.push(this.source.functionCall(n,"call",X))},ambiguousBlockValue:function(){var o=this.aliasable("container.hooks.blockHelperMissing"),n=[this.contextName(0)];this.setupHelperArgs("",0,n,!0),this.flushInline();var X=this.topStack();n.splice(1,0,X),this.pushSource(["if (!",this.lastHelper,") { ",X," = ",this.source.functionCall(o,"call",n),"}"])},appendContent:function(o){this.pendingContent?o=this.pendingContent+o:this.pendingLocation=this.source.currentLocation,this.pendingContent=o},append:function(){if(this.isInline())this.replaceStack(function(n){return[" != null ? ",n,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var o=this.popStack();this.pushSource(["if (",o," != null) { ",this.appendToBuffer(o,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(o){this.lastContext=o},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(o,n,X,g){var y=0;!g&&this.options.compat&&!this.lastContext?this.push(this.depthedLookup(o[y++])):this.pushContext(),this.resolvePath("context",o,y,n,X)},lookupBlockParam:function(o,n){this.useBlockParams=!0,this.push(["blockParams[",o[0],"][",o[1],"]"]),this.resolvePath("context",n,1)},lookupData:function(o,n,X){o?this.pushStackLiteral("container.data(data, "+o+")"):this.pushStackLiteral("data"),this.resolvePath("data",n,0,!0,X)},resolvePath:function(o,n,X,g,y){var v=this;if(this.options.strict||this.options.assumeObjects){this.push(m(this.options.strict&&y,this,n,X,o));return}for(var G=n.length;X<G;X++)this.replaceStack(function(f){var b=v.nameLookup(f,n[X],o);return g?[" && ",b]:[" != null ? ",b," : ",f]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(o,n){this.pushContext(),this.pushString(n),n!=="SubExpression"&&(typeof o=="string"?this.pushString(o):this.pushStackLiteral(o))},emptyHash:function(o){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(o?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var o=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(o.ids)),this.stringParams&&(this.push(this.objectLiteral(o.contexts)),this.push(this.objectLiteral(o.types))),this.push(this.objectLiteral(o.values))},pushString:function(o){this.pushStackLiteral(this.quotedString(o))},pushLiteral:function(o){this.pushStackLiteral(o)},pushProgram:function(o){o!=null?this.pushStackLiteral(this.programExpression(o)):this.pushStackLiteral(null)},registerDecorator:function(o,n){var X=this.nameLookup("decorators",n,"decorator"),g=this.setupHelperArgs(n,o);this.decorators.push(["fn = ",this.decorators.functionCall(X,"",["fn","props","container",g])," || fn;"])},invokeHelper:function(o,n,X){var g=this.popStack(),y=this.setupHelper(o,n),v=[];X&&v.push(y.name),v.push(g),this.options.strict||v.push(this.aliasable("container.hooks.helperMissing"));var G=["(",this.itemsSeparatedBy(v,"||"),")"],f=this.source.functionCall(G,"call",y.callParams);this.push(f)},itemsSeparatedBy:function(o,n){var X=[];X.push(o[0]);for(var g=1;g<o.length;g++)X.push(n,o[g]);return X},invokeKnownHelper:function(o,n){var X=this.setupHelper(o,n);this.push(this.source.functionCall(X.name,"call",X.callParams))},invokeAmbiguous:function(o,n){this.useRegister("helper");var X=this.popStack();this.emptyHash();var g=this.setupHelper(0,o,n),y=this.lastHelper=this.nameLookup("helpers",o,"helper"),v=["(","(helper = ",y," || ",X,")"];this.options.strict||(v[0]="(helper = ",v.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",v,g.paramsInit?["),(",g.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",g.callParams)," : helper))"])},invokePartial:function(o,n,X){var g=[],y=this.setupParams(n,1,g);o&&(n=this.popStack(),delete y.name),X&&(y.indent=JSON.stringify(X)),y.helpers="helpers",y.partials="partials",y.decorators="container.decorators",o?g.unshift(n):g.unshift(this.nameLookup("partials",n,"partial")),this.options.compat&&(y.depths="depths"),y=this.objectLiteral(y),g.push(y),this.push(this.source.functionCall("container.invokePartial","",g))},assignToHash:function(o){var n=this.popStack(),X=void 0,g=void 0,y=void 0;this.trackIds&&(y=this.popStack()),this.stringParams&&(g=this.popStack(),X=this.popStack());var v=this.hash;X&&(v.contexts[o]=X),g&&(v.types[o]=g),y&&(v.ids[o]=y),v.values[o]=n},pushId:function(o,n,X){o==="BlockParam"?this.pushStackLiteral("blockParams["+n[0]+"].path["+n[1]+"]"+(X?" + "+JSON.stringify("."+X):"")):o==="PathExpression"?this.pushString(n):o==="SubExpression"?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:h,compileChildren:function(o,n){for(var X=o.children,g=void 0,y=void 0,v=0,G=X.length;v<G;v++){g=X[v],y=new this.compiler;var f=this.matchExistingProgram(g);if(f==null){this.context.programs.push("");var b=this.context.programs.length;g.index=b,g.name="program"+b,this.context.programs[b]=y.compile(g,n,this.context,!this.precompile),this.context.decorators[b]=y.decorators,this.context.environments[b]=g,this.useDepths=this.useDepths||y.useDepths,this.useBlockParams=this.useBlockParams||y.useBlockParams,g.useDepths=this.useDepths,g.useBlockParams=this.useBlockParams}else g.index=f.index,g.name="program"+f.index,this.useDepths=this.useDepths||f.useDepths,this.useBlockParams=this.useBlockParams||f.useBlockParams}},matchExistingProgram:function(o){for(var n=0,X=this.context.environments.length;n<X;n++){var g=this.context.environments[n];if(g&&g.equals(o))return g}},programExpression:function(o){var n=this.environment.children[o],X=[n.index,"data",n.blockParams];return(this.useBlockParams||this.useDepths)&&X.push("blockParams"),this.useDepths&&X.push("depths"),"container.program("+X.join(", ")+")"},useRegister:function(o){this.registers[o]||(this.registers[o]=!0,this.registers.list.push(o))},push:function(o){return o instanceof p||(o=this.source.wrap(o)),this.inlineStack.push(o),o},pushStackLiteral:function(o){this.push(new p(o))},pushSource:function(o){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),o&&this.source.push(o)},replaceStack:function(o){var n=["("],X=void 0,g=void 0,y=void 0;if(!this.isInline())throw new s.default("replaceStack on non-inline");var v=this.popStack(!0);if(v instanceof p)X=[v.value],n=["(",X],y=!0;else{g=!0;var G=this.incrStack();n=["((",this.push(G)," = ",v,")"],X=this.topStack()}var f=o.call(this,X);y||this.popStack(),g&&this.stackSlot--,this.push(n.concat(f,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var o=this.inlineStack;this.inlineStack=[];for(var n=0,X=o.length;n<X;n++){var g=o[n];if(g instanceof p)this.compileStack.push(g);else{var y=this.incrStack();this.pushSource([y," = ",g,";"]),this.compileStack.push(y)}}},isInline:function(){return this.inlineStack.length},popStack:function(o){var n=this.isInline(),X=(n?this.inlineStack:this.compileStack).pop();if(!o&&X instanceof p)return X.value;if(!n){if(!this.stackSlot)throw new s.default("Invalid stack pop");this.stackSlot--}return X},topStack:function(){var o=this.isInline()?this.inlineStack:this.compileStack,n=o[o.length-1];return n instanceof p?n.value:n},contextName:function(o){return this.useDepths&&o?"depths["+o+"]":"depth"+o},quotedString:function(o){return this.source.quotedString(o)},objectLiteral:function(o){return this.source.objectLiteral(o)},aliasable:function(o){var n=this.aliases[o];return n?(n.referenceCount++,n):(n=this.aliases[o]=this.source.wrap(o),n.aliasable=!0,n.referenceCount=1,n)},setupHelper:function(o,n,X){var g=[],y=this.setupHelperArgs(n,o,g,X),v=this.nameLookup("helpers",n,"helper"),G=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})");return{params:g,paramsInit:y,name:v,callParams:[G].concat(g)}},setupParams:function(o,n,X){var g={},y=[],v=[],G=[],f=!X,b=void 0;f&&(X=[]),g.name=this.quotedString(o),g.hash=this.popStack(),this.trackIds&&(g.hashIds=this.popStack()),this.stringParams&&(g.hashTypes=this.popStack(),g.hashContexts=this.popStack());var M=this.popStack(),k=this.popStack();(k||M)&&(g.fn=k||"container.noop",g.inverse=M||"container.noop");for(var E=n;E--;)b=this.popStack(),X[E]=b,this.trackIds&&(G[E]=this.popStack()),this.stringParams&&(v[E]=this.popStack(),y[E]=this.popStack());return f&&(g.args=this.source.generateArray(X)),this.trackIds&&(g.ids=this.source.generateArray(G)),this.stringParams&&(g.types=this.source.generateArray(v),g.contexts=this.source.generateArray(y)),this.options.data&&(g.data="data"),this.useBlockParams&&(g.blockParams="blockParams"),g},setupHelperArgs:function(o,n,X,g){var y=this.setupParams(o,n,X);return y.loc=JSON.stringify(this.source.currentLocation),y=this.objectLiteral(y),g?(this.useRegister("options"),X.push("options"),["options=",y]):X?(X.push(y),""):y}},(function(){for(var c="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),o=h.RESERVED_WORDS={},n=0,X=c.length;n<X;n++)o[c[n]]=!0})(),h.isValidJavaScriptVariableName=function(c){return!h.RESERVED_WORDS[c]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(c)};function m(c,o,n,X,g){var y=o.popStack(),v=n.length;for(c&&v--;X<v;X++)y=o.nameLookup(y,n[X],g);return c?[o.aliasable("container.strict"),"(",y,", ",o.quotedString(n[X]),", ",JSON.stringify(o.source.currentLocation)," )"]:y}e.default=h,d.exports=e.default})(ot,ot.exports)),ot.exports}var Gi;function Ss(){return Gi||(Gi=1,(function(d,e){e.__esModule=!0;function t(v){return v&&v.__esModule?v:{default:v}}var i=os(),r=t(i),s=Oi(),a=t(s),u=ls(),l=hs(),p=bs(),h=t(p),m=Li(),c=t(m),o=xi(),n=t(o),X=r.default.create;function g(){var v=X();return v.compile=function(G,f){return l.compile(G,f,v)},v.precompile=function(G,f){return l.precompile(G,f,v)},v.AST=a.default,v.Compiler=l.Compiler,v.JavaScriptCompiler=h.default,v.Parser=u.parser,v.parse=u.parse,v.parseWithoutProcessing=u.parseWithoutProcessing,v}var y=g();y.create=g,n.default(y),y.Visitor=c.default,y.default=y,e.default=y,d.exports=e.default})(Ue,Ue.exports)),Ue.exports}var Gs=Ss();const L=zr(Gs),Ms=`<div class="headerXX"> \r
    You have <span class="money">$<b id="moneyValue">{{money}}</b></span>  to spend. Isn't that nice. Average total income <span class="money">$<b id="incomeValue">{{income}}</b></span>.<br /> {{#if researchBought}} You have <span\r
        class="research"><b id="researchPoints"></b></span> research points. Avg production <span class="research"><b\r
            id="researchIncome"></b></span> {{/if}}</div>\r
<div class="helpXX">\r
    <div style="float:right"><span id="ticks"></span> ticks/sec</div> Buy more land to create even bigger empire.  \r
    Go ahead, buy some!\r
</div>\r
<div id="factorySelection" class="factories"> {{#each factories}} <div class="factoryButton {{design}}"\r
        data-id="{{id}}">\r
        <div class="name"> {{name}} </div> <span class="paused">{{#if isPaused}}&lt;&lt; Paused\r
            &gt;&gt;{{else}}&nbsp;{{/if}}</span> {{#if isBought}} <div class="productionTitle">Income</div>\r
        <div class="textLine money" data-id="{{id}}" data-key="income">-</div>\r
        <div class="productionTitle">Research</div>\r
        <div class="textLine research" data-id="{{id}}" data-key="researchProduction">-</div>\r
        <div class="button selectButton" data-id="{{id}}">SELECT</div> {{else}} <div class="productionTitle price">Price\r
        </div>\r
        <div class="textLine money">\${{price}}</div>\r
        <div class="button buyButton" data-id="{{id}}">BUY</div> {{/if}}\r
    </div> {{/each}} \r
</div>`,ks=`<div class="alertBg" id="{{idBg}}"></div>\r
<div class="alert" id="{{id}}">\r
  <span class="title">{{title}}</span>\r
  <br />\r
  <span class="message">{{{message}}}</span>\r
  <br />\r
  <span class="button">{{buttonTitle}}</span>\r
</div>`;let Cs=0;class ft{constructor(e,t){this.title=e,this.message=t,this.buttonTitle="OK",this.id=`alert${Cs++}`,this.idBg=`${this.id}Bg`,this.container=document.body,this.element=null,this.bg=null,this.callback=null}setButtonTitle(e){return this.buttonTitle=e,this}setCallback(e){return this.callback=e,this}display(){this.container.insertAdjacentHTML("beforeend",L.compile(ks)({id:this.id,idBg:this.idBg,title:this.title,message:this.message,buttonTitle:this.buttonTitle})),this.element=document.getElementById(this.id),this.bg=document.getElementById(this.idBg);const e=Math.round((window.innerHeight-this.element.offsetHeight)/2),t=Math.round((window.innerWidth-this.element.offsetWidth)/2);this.element.style.top=`${e}px`,this.element.style.left=`${t}px`;const i=this.element.querySelector(".button");return i&&i.addEventListener("click",()=>{this.hide(),this.callback&&this.callback()}),this.bg.style.opacity=0,this.bg.style.transition="opacity 0.2s ease",this.bg.style.display="block",requestAnimationFrame(()=>this.bg.style.opacity=1),this.element.style.opacity=0,this.element.style.transition="opacity 0.2s ease",this.element.style.display="block",requestAnimationFrame(()=>this.element.style.opacity=1),this}hide(){this.element&&(this.element.style.opacity=0,this.element.addEventListener("transitionend",()=>this.element?.remove(),{once:!0})),this.bg&&(this.bg.style.opacity=0,this.bg.addEventListener("transitionend",()=>this.bg?.remove(),{once:!0}))}}class Mi{constructor(e,t){this.game=e,this.factoryMeta=this.game.getMeta().factoriesById[t]}canBuy(){return this.game.getMoney()>=this.factoryMeta.price}buy(){this.game.addMoney(-this.factoryMeta.price);const e=this.game.getFactory(this.factoryMeta.id);e.reset(),e.setIsBought(!0)}}const ee={KEY_PRESS:"KEY_PRESS",FOCUS:"FOCUS",BLUR:"BLUR",SHOW_MAIN_GAME:"SHOW_MAIN_GAME",SHOW_MISSIONS:"SHOW_MISSIONS",SHOW_MISSION:"SHOW_MISSION",SHOW_SETTINGS:"SHOW_SETTINGS",SHOW_TIME_TRAVEL:"SHOW_TIME_TRAVEL",SHOW_PURCHASES:"SHOW_PURCHASES",SHOW_HELP:"SHOW_HELP",OPEN_SCREENSHOT_VIEW:"SHOW_SCREENSHOT_VIEW"},ce=new Be(ee,"GlobalMainUiBus");class Ts{constructor(e){this.globalUiEm=ce,this.gameUiEm=Q.gameUiBus,this.game=e,this.statistics=e.getStatistics(),this.container=null}display(e){this.container=e;const t=[],i=this.game.getMeta().factories;for(const r of i){const s=this.game.getFactory(r.id);t.push({id:r.id,name:r.name,price:R.format(r.price),isBought:s.getIsBought(),isPaused:s.getIsPaused()})}this.container.innerHTML=L.compile(Ms)({factories:t,researchBought:!!this.game.getResearchManager().getResearch("researchCenter")}),this.container.querySelectorAll(".selectButton").forEach(r=>{r.addEventListener("click",s=>{const a=s.target.dataset.id;this.gameUiEm.invokeEvent(x.SHOW_FACTORY,a)})}),this.container.querySelectorAll(".buyButton").forEach(r=>{r.addEventListener("click",s=>{const a=s.target.dataset.id,u=new Mi(this.game,a);u.canBuy()?(u.buy(),this.gameUiEm.invokeEvent(x.SHOW_FACTORY,a)):new ft("","You don't have enough money to buy this factory!").display()})}),this.game.getEventManager().addListener("factoriesUi",x.GAME_TICK,()=>this.update()),this.update()}updateText(e,t){const i=this.container.querySelector(e);i&&(i.textContent=t)}update(){this.updateText("#moneyValue",this.game.getMoney()),this.updateText("#researchPoints",this.game.getResearchPoints());const e=this.statistics.getAvgProfit();this.updateText("#incomeValue",e?R.formatNumber(e):" ? ");const t=this.statistics.getAvgResearchPointsProduction();this.updateText("#researchIncome",t?R.formatNumber(t):" ? "),this.container.querySelectorAll(".factoryButton").forEach(i=>{const r=i.getAttribute("data-id"),s=this.statistics.getFactoryAvgProfit(r);this.updateText(".money[data-key='income']",s?R.formatNumberPlus(s):" ? ");const a=this.statistics.getFactoryAvgResearchPointsProduction(r);this.updateText(".research[data-key='researchProduction']",a?R.formatNumberPlus(a):" ? ");const u=new Mi(this.game,r).canBuy(),l=i.querySelector(".buyButton");l&&(u?(l.classList.remove("cantBuy"),l.textContent="BUY"):(l.classList.add("cantBuy"),l.textContent="TOO EXPENSIVE"))}),this.updateText("#ticks",R.formatNumber(this.game.getTicker().getActualTicksPerSec()))}destroy(){this.globalUiEm.removeListenerForType("factoriesUi"),this.gameUiEm.removeListenerForType("factoriesUi"),this.game.getEventManager().removeListenerForType("factoriesUi"),this.container&&(this.container.textContent="",this.container=null)}}const Es=`<table class="factoryBox" width="100%" cellspacing="0" cellpadding="0" border="0">\r
\r
    <tr>\r
        <td class="overviewArea" valign="top">\r
            <div class="overviewContainer">\r
\r
            </div>\r
        </td>\r
        <td class="topArea" valign="top">\r
            <div class="topContainer">\r
                <div class="menuContainer"></div>\r
                <div class="infoContainer"></div>\r
                <div class="controlsContainer"></div>\r
            </div>\r
        </td>\r
    </tr>\r
    <tr>\r
        <td class="componentsArea" valign="top">\r
            <div class="componentsContainer"></div>\r
            <div class="mapToolsContainer"></div>\r
            <div class="incentivizedAd"></div>\r
        </td>\r
        <td class="mapArea" valign="top">\r
            <div class="mapContainer"></div>\r
        </td>\r
    </tr>\r
</table>\r
`,Is=`<div class="menuBox">\r
    <a href="javascript:void(0);" id="factoriesButton">Factories</a> {{#if hasStatistics}}\r
    <a href="javascript:void(0);" id="statisticsButton">Statistics</a> {{/if}} {{#if hasResearch}}\r
    <a href="javascript:void(0);" id="researchButton">Research</a> {{/if}} {{#if hasUpgrades}}\r
    <a href="javascript:void(0);" id="upgradesButton">Upgrades</a> {{/if}} {{#if hasAchievements}}\r
    <a href="javascript:void(0);" id="achievementsButton">Achievements</a> {{/if}}\r
  <a href="javascript:void(0);" id="extraButton">Extra</a>\r
  <a href="javascript:void(0);" id="timeTravelButton">Time travel</a>\r
  <a href="javascript:void(0);" id="settingsButton">Settings</a>\r
  <a href="javascript:void(0);" id="helpButton">Help</a>\r
</div>`;class _s{constructor(e){this.globalUiEm=ce,this.game=e.getGame(),this.gameUiEm=this.game.getEventManager(),this.factory=e}display(e){this.container=e,this.container.insertAdjacentHTML("beforeend",L.compile(Is)({hasResearch:this.game.getMeta().research.length>0,hasUpgrades:this.game.getMeta().upgrades.length>0,hasAchievements:this.game.getMeta().achievements.length>0,hasStatistics:!0})),this.container.querySelector("#factoriesButton").addEventListener("click",()=>{this.gameUiEm.invokeEvent(x.SHOW_FACTORIES)}),this.container.querySelector("#researchButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(x.SHOW_RESEARCH,this.factory.getMeta().id)),this.container.querySelector("#upgradesButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(x.SHOW_UPGRADES,this.factory.getMeta().id)),this.container.querySelector("#achievementsButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(x.SHOW_ACHIEVEMENTS,this.factory.getMeta().id)),this.container.querySelector("#helpButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(x.SHOW_HELP)),this.container.querySelector("#statisticsButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(x.SHOW_STATISTICS)),this.container.querySelector("#extraButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(x.SHOW_PURCHASES)),this.container.querySelector("#settingsButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(x.SHOW_SETTINGS)),this.container.querySelector("#timeTravelButton").addEventListener("click",()=>this.gameUiEm.invokeEvent(x.SHOW_TIME_TRAVEL)),this.gameUiEm.addListener("factoryMenuUi",B.GAME_TICK,()=>{this.updateButtons()}),this.updateButtons()}updateButtons(){const e=this.factory.getGame().getAchievementsManager();this.toggleVisibility("#researchButton",e.getAchievement("makingProfit")),this.toggleVisibility("#upgradesButton",e.getAchievement("gettingSmarter")),this.toggleVisibility("#statisticsButton",e.getAchievement("collectingCash2"));const t=e.getAchievement("collectingCash");this.toggleVisibility("#extraButton",t),this.toggleVisibility("#timeTravelButton",t),[{selector:"#researchButton",achievement:"makingProfit"},{selector:"#upgradesButton",achievement:"gettingSmarter"},{selector:"#statisticsButton",achievement:"collectingCash2"},{selector:"#extraButton",achievement:"collectingCash"},{selector:"#timeTravelButton",achievement:"collectingCash"}].forEach(({selector:r,achievement:s})=>{const a=e.getAchievement(s);this.toggleVisibility(r,a)})}toggleVisibility(e,t){const i=this.container.querySelector(e);i&&i.classList.toggle("hidden",!t)}destroy(){this.gameUiEm.removeListenerForType("factoryMenuUi"),this.globalUiEm.removeListenerForType("factoryMenuUi"),this.container.innerHTML="",this.container=null}}class ws{constructor(e,t,i){this.imageMap=e,this.factory=t,this.tileSize=i.tileSize,this.tilesX=t.getMeta().tilesX,this.tilesY=t.getMeta().tilesY,this.game=t.getGame(),this.shouldDrawBuildableAreas=!1}display(e){this.container=e,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.width=this.tilesX*this.tileSize,this.canvas.height=this.tilesY*this.tileSize,e.append(this.canvas),this.sprite=this.imageMap.getImage("terrains"),this.redraw();const t=this.factory.getEventManager();t.addListener("LayerBackground",_.TILE_TYPE_CHANGED,()=>this.redraw()),t.addListener("LayerBackground",_.MAP_TOOL_SELECTED,i=>{this.shouldDrawBuildableAreas=!!i,this.redraw()})}getCanvas(){return this.canvas}redraw(){const e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height);const t={undefined:{y:0,tiles:6},grass:{y:0,tiles:6},floor:{y:1,tiles:6},wall:{y:1,tiles:6},road:{y:0,tiles:6}};this.drawTerrain(e,t);for(const i of this.factory.getTiles())switch(i.getTerrain()){case"wall":this.drawTerrainBorders(e,i,7,1,{grass:!0,road:!0}),this.drawTerrainBorders(e,i,10,6,{floor:!0,grass:!0,road:!0});break;case"floor":this.drawTerrainBorders(e,i,7,1,{grass:!0,road:!0});break;case"road":this.drawRoad(e,i,2,{road:!0});break}this.shouldDrawBuildableAreas&&this.drawBuildableAreas()}drawBuildableAreas(){const e=this.canvas.getContext("2d"),t={" ":"greenSelection","-":"yellowSelection",X:"redSelection"};for(const i of this.factory.getTiles()){const r=this.imageMap.getImage(t[i.getBuildableType()]),s=i.getX()*this.tileSize,a=i.getY()*this.tileSize;e.drawImage(r,s,a,this.tileSize,this.tileSize)}}drawTerrain(e,t){for(const i of this.factory.getTiles()){const r=i.getX()*this.tileSize,s=i.getY()*this.tileSize,a=t[i.getTerrain()],u=i.getX()*73893^i.getY()*19349663,p=Math.abs(u)%a.tiles*(this.tileSize+1),h=a.y*(this.tileSize+1);e.drawImage(this.sprite,p,h,this.tileSize,this.tileSize,r,s,this.tileSize,this.tileSize)}}drawTerrainBorders(e,t,i,r,s){const a=this.tileSize,u=a+1,l=t.getX()*this.tileSize,p=t.getY()*this.tileSize,h=i*u,m=(i+1)*u,c=(i+2)*u,o=t.getX()*73893^t.getY()*19349663,n=Math.abs(Math.floor(o%r)*u),X=I=>{const A=t.getTileInDirection(I);return!A||s[A.getTerrain()]},g=X("top"),y=X("right"),v=X("bottom"),G=X("left"),f=X("top_right"),b=X("top_left"),M=X("bottom_right"),k=X("bottom_left");g&&y&&e.drawImage(this.sprite,3*u+10,c,11,11,l+10,p,11,11),g&&G&&e.drawImage(this.sprite,3*u,c,11,11,l,p,11,11),v&&y&&e.drawImage(this.sprite,3*u+10,c+10,11,11,l+10,p+10,11,11),v&&G&&e.drawImage(this.sprite,3*u,c+10,11,11,l,p+10,11,11),f&&!g&&!y&&e.drawImage(this.sprite,0*u+10,c,11,11,l+10,p,11,11),b&&!g&&!G&&e.drawImage(this.sprite,0*u,c,11,11,l,p,11,11),M&&!v&&!y&&e.drawImage(this.sprite,0*u+10,c+10,11,11,l+10,p+10,11,11),k&&!v&&!G&&e.drawImage(this.sprite,0*u,c+10,11,11,l,p+10,11,11);const E=G?10:0,w=y?10:0,T=g?10:0,C=v?10:0;g&&e.drawImage(this.sprite,n+E,h,a-E-w,11,l+E,p,a-E-w,11),v&&e.drawImage(this.sprite,n+E,h+10,a-E-w,11,l+E,p+10,a-E-w,11),y&&e.drawImage(this.sprite,n+10,m+T,11,a-T-C,l+10,p+T,11,a-T-C),G&&e.drawImage(this.sprite,n,m+T,11,a-T-C,l,p+T,11,a-T-C)}drawRoad(e,t,i,r){const s=h=>{const m=t.getTileInDirection(h);return!m||r[m.getTerrain()]},a=`${s("top")?"1":"0"}${s("right")?"1":"0"}${s("bottom")?"1":"0"}${s("left")?"1":"0"}`,u={"0000":[0,0],1e3:[1,0],"0100":[2,0],"0010":[3,0],"0001":[4,0],1010:[0,1],"0101":[0,2],1100:[0,3],"0110":[1,3],"0011":[2,3],1001:[3,3],1111:[4,4],1110:[0,4],"0111":[1,4],1011:[2,4],1101:[3,4]},[l,p]=u[a];e.drawImage(this.sprite,l*(this.tileSize+1),(i+p)*(this.tileSize+1),this.tileSize,this.tileSize,t.getX()*this.tileSize,t.getY()*this.tileSize,this.tileSize,this.tileSize)}destroy(){this.factory.getEventManager().removeListenerForType("LayerBackground"),this.container&&(this.container.innerHTML="",this.container=null)}}class Rs{constructor(e,{tileSize:t}){this.imageMap=e,this.tileSize=t}drawComponentLayer(e,t){if(!t.isMainComponentContainer())return;const i=t.getComponent().getMeta(),r=this.imageMap.getImage("components"),s=i.spriteX*(this.tileSize+1),a=i.spriteY*(this.tileSize+1),u=t.getX()*this.tileSize,l=t.getY()*this.tileSize,p=this.tileSize*i.width,h=this.tileSize*i.height;e.drawImage(r,s,a,p,h,u,l,p,h)}}class As{constructor(e,t){this.imageMap=e,this.tileSize=t.tileSize,this.drawMap=this._getDrawMap()}drawComponentLayer(e,t){if(t.isMainComponentContainer()){const i=t.getComponent().getMeta(),r=this._getDrawParameters(t);let s=this.imageMap.getImage(i.id);s||(s=this.imageMap.getImage("transportLine"));const a=r.n*this.tileSize,u=0,l=this.tileSize*i.width,p=this.tileSize*i.height,h=t.getX()*this.tileSize,m=t.getY()*this.tileSize,c=this.tileSize*i.width,o=this.tileSize*i.height,n=r.rotation,X=r.flip;this._drawImage(e,s,a,u,l,p,h,m,c,o,n,X),e.font="9px Arial",e.textAlign="center"}}_getDrawParameters(e){const t=e.getInputOutputManager().getInputsByDirection(),i=e.getInputOutputManager().getOutputsByDirection(),r=(t.top?"1":"0")+(t.right?"1":"0")+(t.bottom?"1":"0")+(t.left?"1":"0"),s=(i.top?"1":"0")+(i.right?"1":"0")+(i.bottom?"1":"0")+(i.left?"1":"0");return this.drawMap[r]&&this.drawMap[r][s]?this.drawMap[r][s]:this.drawMap.error}_drawImage(e,t,i,r,s,a,u,l,p,h,m,c){e.save();let o=m*Math.PI/180;c||(o=2*Math.PI-o),e.translate(u+p/2,l+h/2),e.rotate(o),c&&e.scale(-1,1),e.drawImage(t,i,r+1,s,a,-p/2,-h/2,p,h),e.restore()}_getDrawMap(){return{error:{n:17,rotation:0,flip:!1},"0000":{"0000":{n:0,rotation:0,flip:!1},1e3:{n:1,rotation:0,flip:!1},"0100":{n:1,rotation:-90,flip:!1},"0010":{n:1,rotation:180,flip:!1},"0001":{n:1,rotation:90,flip:!1}},1e3:{"0000":{n:2,rotation:0,flip:!1},"0100":{n:4,rotation:0,flip:!1},"0010":{n:3,rotation:0,flip:!1},"0001":{n:4,rotation:0,flip:!0},"0110":{n:5,rotation:0,flip:!0},"0101":{n:6,rotation:0,flip:!1},"0011":{n:5,rotation:0,flip:!1},"0111":{n:7,rotation:0,flip:!1}},"0100":{"0000":{n:2,rotation:270,flip:!1},1e3:{n:4,rotation:90,flip:!0},"0010":{n:4,rotation:270,flip:!1},"0001":{n:3,rotation:270,flip:!1},1010:{n:6,rotation:270,flip:!1},1001:{n:5,rotation:270,flip:!1},"0011":{n:5,rotation:90,flip:!0},1011:{n:7,rotation:270,flip:!1}},"0010":{"0000":{n:2,rotation:180,flip:!1},1e3:{n:3,rotation:180,flip:!1},"0100":{n:4,rotation:180,flip:!0},"0001":{n:4,rotation:180,flip:!1},1100:{n:5,rotation:180,flip:!1},1001:{n:5,rotation:180,flip:!0},"0101":{n:6,rotation:180,flip:!1},1101:{n:7,rotation:180,flip:!1}},"0001":{"0000":{n:2,rotation:90,flip:!1},1e3:{n:4,rotation:90,flip:!1},"0100":{n:3,rotation:90,flip:!1},"0010":{n:4,rotation:270,flip:!0},1100:{n:5,rotation:270,flip:!0},1010:{n:6,rotation:90,flip:!1},"0110":{n:5,rotation:90,flip:!1},1110:{n:7,rotation:90,flip:!1}},1100:{"0000":{n:8,rotation:0,flip:!1},"0010":{n:10,rotation:0,flip:!0},"0001":{n:10,rotation:270,flip:!1},"0011":{n:13,rotation:270,flip:!1}},1010:{"0000":{n:9,rotation:0,flip:!1},"0100":{n:11,rotation:90,flip:!1},"0001":{n:11,rotation:270,flip:!1},"0101":{n:12,rotation:90,flip:!0}},1001:{"0000":{n:8,rotation:90,flip:!1},"0100":{n:10,rotation:270,flip:!0},"0010":{n:10,rotation:0,flip:!1},"0110":{n:13,rotation:0,flip:!1}},"0110":{"0000":{n:8,rotation:270,flip:!1},1e3:{n:10,rotation:180,flip:!1},"0001":{n:10,rotation:90,flip:!0},1001:{n:13,rotation:180,flip:!1}},"0101":{"0000":{n:9,rotation:90,flip:!1},1e3:{n:11,rotation:180,flip:!1},"0010":{n:11,rotation:0,flip:!1},1010:{n:12,rotation:0,flip:!1}},"0011":{"0000":{n:8,rotation:180,flip:!1},1e3:{n:10,rotation:180,flip:!0},"0100":{n:10,rotation:90,flip:!1},1100:{n:13,rotation:90,flip:!1}},1110:{"0000":{n:15,rotation:270,flip:!1},"0001":{n:14,rotation:270,flip:!1}},1101:{"0000":{n:15,rotation:0,flip:!1},"0010":{n:14,rotation:0,flip:!1}},1011:{"0000":{n:15,rotation:90,flip:!1},"0100":{n:14,rotation:90,flip:!1}},"0111":{"0000":{n:15,rotation:180,flip:!1},1e3:{n:14,rotation:180,flip:!1}},1111:{"0000":{n:16,rotation:0,flip:!1}}}}}class Ps{constructor(e,t,i){this.imageMap=e,this.factory=t,this.game=t.getGame(),this.tileSize=i.tileSize,this.tilesX=t.getMeta().tilesX,this.tilesY=t.getMeta().tilesY,this.canvas=null,this.strategies={default:new Rs(this.imageMap,{tileSize:this.tileSize}),track:new As(this.imageMap,{tileSize:this.tileSize})},this.tilesWithComponentCache=[]}getCanvas(){return this.canvas}display(e){this.container=e,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.width=this.tilesX*this.tileSize,this.canvas.height=this.tilesY*this.tileSize,e.append(this.canvas),this.factory.getEventManager().addListener("LayerComponent",_.FACTORY_COMPONENTS_CHANGED,()=>{this.buildCache(),this.redraw()}),this.factory.getEventManager().addListener("LayerComponent",_.FACTORY_TICK,()=>{this.game.getTicker().getIsFocused()}),this.buildCache(),this.redraw()}buildCache(){this.tilesWithComponentCache=[];const e=this.factory.getTiles();for(const t of e)t.getComponent()&&this.tilesWithComponentCache.push(t);this.tilesWithComponentCache.filter(t=>t.isMainComponentContainer()).length}redraw(){const e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height),this.imageMap.getImage("components")||console.warn("ComponentLayer: components image not loaded");for(const i of this.tilesWithComponentCache){if(!i.isMainComponentContainer())continue;const r=this.factory.getAreasManager?.();if(r&&!r.canBuildAt(i.getX(),i.getY(),i.getComponent().getMeta().width,i.getComponent().getMeta().height))continue;const s=i.getComponent().getMeta().drawStrategy||"default";this.strategies[s].drawComponentLayer(e,i)}}destroy(){this.factory.getEventManager().removeListenerForType("LayerComponent"),this.container.innerHTML="",this.container=null,this.canvas=null}}class Bs{constructor(e,t,i){this.imageMap=e,this.factory=t,this.game=t.getGame(),this.tileSize=i.tileSize,this.packageSize=15;const r=this.packageSize/3;this.tilesX=t.getMeta().tilesX,this.tilesY=t.getMeta().tilesY,this.resourcesMeta=this.factory.getGame().getMeta().resourcesById,this.firstPackageLocation={top:{top:-this.packageSize+r,bottom:-this.tileSize/2-r},bottom:{top:this.tileSize/2-this.packageSize+r,bottom:-r},right:{right:-r,left:this.tileSize/2-this.packageSize+r},left:{right:-this.tileSize/2-r,left:-this.packageSize+r}},this.movementDirectionCoefficient={top:{top:-5,bottom:5},bottom:{top:-5,bottom:5},right:{right:5,left:-5},left:{right:5,left:-5}},this.canvas=null,this.queuesCache=[]}getCanvas(){return this.canvas}display(e){this.container=e,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.width=this.tilesX*this.tileSize,this.canvas.height=this.tilesY*this.tileSize,e.append(this.canvas),this.factory.getEventManager().addListener("LayerPackage",_.FACTORY_TICK,()=>{this.game.getTicker().getIsFocused()&&this.redraw()}),this.factory.getEventManager().addListener("LayerPackage",_.FACTORY_COMPONENTS_CHANGED,()=>{this.buildCache(),this.redraw()}),this.buildCache(),this.redraw()}buildCache(){this.queuesCache=[];const e=this.factory.getTiles();for(const t of e){const i=t.getComponent();if(i&&i.getMeta().strategy.type==="transport"){const r=i.getStrategy(),s=r.getInputQueues(),a=r.getOutputQueues();this._addQueueToCache(t,s.top,"top","bottom"),this._addQueueToCache(t,a.top,"top","top"),this._addQueueToCache(t,a.left,"left","left"),this._addQueueToCache(t,s.left,"left","right"),this._addQueueToCache(t,s.right,"right","left"),this._addQueueToCache(t,a.right,"right","right"),this._addQueueToCache(t,a.bottom,"bottom","bottom"),this._addQueueToCache(t,s.bottom,"bottom","top")}}}_addQueueToCache(e,t,i,r){t&&this.queuesCache.push({tile:e,queue:t,posDir:i,moveDir:r})}redraw(){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height);for(const t of this.queuesCache)this.drawQueue(t.tile,t.queue,t.posDir,t.moveDir)}drawQueue(e,t,i,r){const s=this.canvas.getContext("2d"),a=e.getX()*this.tileSize+this.tileSize/2,u=e.getY()*this.tileSize+this.tileSize/2;for(let l=0;l<t.getLength();l++){let p=l;(r==="top"||r==="left")&&(p=t.getLength()-p-1);const h=t.get(p);if(!h)continue;const m=this.resourcesMeta[h.getResourceId()],c=m.spriteX*(this.packageSize+1),o=m.spriteY*(this.packageSize+1);let n,X;i==="left"||i==="right"?(n=a+this.firstPackageLocation[i][r]+this.movementDirectionCoefficient[i][r]*p+h.getOffset()/2,X=u-this.packageSize/2+h.getOffset()):(n=a-this.packageSize/2+h.getOffset(),X=u+this.firstPackageLocation[i][r]+this.movementDirectionCoefficient[i][r]*p+h.getOffset()/2),s.drawImage(this.imageMap.getImage("resources"),c,o,this.packageSize,this.packageSize,Math.round(n)+2,Math.round(X)+2,this.packageSize-4,this.packageSize-4)}}destroy(){this.factory.getEventManager().removeListenerForType("LayerPackage"),this.container.innerHTML="",this.container=null,this.canvas=null}}class Fi{constructor(e,t=1,i=1){this.tile=e,this.factory=e.getFactory(),this.width=t,this.height=i}canSell(){return!0}sell(){for(let e=0;e<this.width;e++)for(let t=0;t<this.height;t++){const i=this.factory.getTile(this.tile.getX()+e,this.tile.getY()+t);this._sellTile(i)}}_sellTile(e){const t=e.getComponent();if(!t)return;const i=t.getMeta(),r=t.getX(),s=t.getY();let a=!0;for(let u of this.factory.getMeta().startComponents)u.id===i.id&&u.x===r&&u.y===s&&(a=!1);for(let u=0;u<i.width;u++)for(let l=0;l<i.height;l++)this.factory.getTile(r+u,s+l).setComponent(null);this.factory.getEventManager().invokeEvent(_.FACTORY_COMPONENTS_CHANGED,e),a&&this.factory.getGame().addMoney(i.price*i.priceRefund)}}class xs{constructor(e,t){this.tile=e,this.factory=e.getFactory(),this.toolId=t}canUpdate(){return!!this.toolId}update(){if(!this.toolId)return;const[e,t]=this.toolId.split("-");e==="terrain"?(this.tile.setTerrain(t),this.tile.getFactory().getMeta().buildableTerrains[t]?this.tile.setBuildableType(Z.BUILDABLE_YES):this.tile.setBuildableType(Z.BUILDABLE_NO)):e==="buildable"&&t==="road"&&this.tile.setBuildableType(Z.BUILDABLE_PARTIAL),this.factory.getEventManager().invokeEvent(_.TILE_TYPE_CHANGED,this.tile)}}const Os='<div id="{{id}}" class="tip">{{content}}</div>';let Ls=0;class qi{constructor(e,t){this.initElement=e,this.content=typeof t=="string"?t:null,this.element=typeof t!="string"?t:null,this.isVisible=!1,this.mouseMove=i=>{this.updateLocation(i),this.display()},this.mouseOut=()=>{this.hide()}}init(){if(!this.element){this.id=`tip${Ls++}`;const e=document.createElement("div");e.innerHTML=L.compile(Os)({id:this.id,content:this.content}),this.element=e.firstElementChild,document.body.appendChild(this.element)}return Object.assign(this.element.style,{position:"absolute",display:"none"}),this.initElement.addEventListener("mousemove",this.mouseMove),this.initElement.addEventListener("mouseout",this.mouseOut),this}destroy(){return this.hide(),this.initElement.removeEventListener("mousemove",this.mouseMove),this.initElement.removeEventListener("mouseout",this.mouseOut),this}display(){this.isVisible||(this.isVisible=!0,this.element.style.display="block",this.element.style.opacity="1")}updateLocation(e){const t=this.element.getBoundingClientRect(),i=t.width,r=t.height;let s=e.pageX-i/2,a=e.pageY+15;const u=window.innerWidth,l=window.innerHeight,p=window.scrollX,h=window.scrollY;s-p<10&&(s=p+10),s+i-p>u-20&&(s=u+p-i-20),a+r-h>l-20&&(a=e.pageY-r-20),this.element.style.left=`${s}px`,this.element.style.top=`${a}px`}hide(){this.isVisible&&(this.element.style.display="none",this.isVisible=!1)}}class Ns{container=null;lastTip=null;mouseSelectionElement=null;cantPlaceElement=null;componentSelectedElement=null;constructor(e,t,i){this.factory=e,this.game=e.getGame(),this.imageMap=t,this.tileSize=i}display(e){this.container=e}destroy(){this.container=null,this.turnOffBuildMode(),this.turnOffCantBuildMode(),this.turnOffComponentSelected(),this.turnOffNotEnoughMoneyTip()}updateMouseInformationModes(e,t){if(!e||!t){this.turnOffBuildMode(),this.turnOffCantBuildMode(),this.turnOffNotEnoughMoneyTip();return}const i=this.game.getMeta().componentsById[e],r=this.factory.getTile(t.x,t.y),s=new Ge(r,i),a=!this.factory.isOnMap(t.x,t.y,i.width,i.height),u=this.factory.isPossibleToBuildOnTypeWithSize(t.x,t.y,i.width,i.height,i),l=this.factory.getAreasManager().canBuildAt(t.x,t.y,i.width,i.height);a?this.turnOffBuildMode():this.updateBuildMode(e,t),u&&l||a?s.canBuy()?(this.turnOffCantBuildMode(),this.turnOffNotEnoughMoneyTip()):(this.updateCantBuildMode(e,t),this.updateNotEnoughMoneyTip()):(this.updateCantBuildMode(e,t),this.turnOffNotEnoughMoneyTip())}updateComponentSelected(e){if(!e)return this.turnOffComponentSelected();const t=e.getMeta();this.componentSelectedElement||(this.componentSelectedElement=this.createImageElement(this.imageMap.getImage("blueSelection")),this.container.appendChild(this.componentSelectedElement)),this.setElementStyle(this.componentSelectedElement,{left:e.getX()*this.tileSize+"px",top:e.getY()*this.tileSize+"px",width:this.tileSize*t.width+"px",height:this.tileSize*t.height+"px",opacity:.5,pointerEvents:"none",position:"absolute"})}turnOffComponentSelected(){this.componentSelectedElement&&(this.componentSelectedElement.remove(),this.componentSelectedElement=null)}updateBuildMode(e,t){const i=this.game.getMeta().componentsById[e];this.mouseSelectionElement||(this.mouseSelectionElement=this.createImageElement(this.imageMap.getImage("yellowSelection")),this.container.appendChild(this.mouseSelectionElement)),this.setElementStyle(this.mouseSelectionElement,{left:t.x*this.tileSize+"px",top:t.y*this.tileSize+"px",width:this.tileSize*i.width+"px",height:this.tileSize*i.height+"px",opacity:.5,pointerEvents:"none",position:"absolute"})}turnOffBuildMode(){this.mouseSelectionElement&&(this.mouseSelectionElement.remove(),this.mouseSelectionElement=null)}updateCantBuildMode(e,t){const i=this.game.getMeta().componentsById[e];this.cantPlaceElement||(this.cantPlaceElement=this.createImageElement(this.imageMap.getImage("cantPlace")),this.container.appendChild(this.cantPlaceElement)),this.setElementStyle(this.cantPlaceElement,{left:t.x*this.tileSize+"px",top:t.y*this.tileSize+"px",width:this.tileSize*i.width+"px",height:this.tileSize*i.height+"px",opacity:.5,pointerEvents:"none",position:"absolute"})}turnOffCantBuildMode(){this.cantPlaceElement&&(this.cantPlaceElement.remove(),this.cantPlaceElement=null)}updateNotEnoughMoneyTip(){this.lastTip||(this.lastTip=new qi(this.container,`<span class="red">You don't have enough money!</span>`).init(),document.body.style.cursor="no-drop")}turnOffNotEnoughMoneyTip(){this.lastTip&&(this.lastTip.destroy(),this.lastTip=null,document.body.style.cursor="")}createImageElement(e){const t=document.createElement("img");return t.src=e.src,t.style.position="absolute",t.style.pointerEvents="none",t.style.opacity=.5,t}setElementStyle(e,t){Object.assign(e.style,t)}}const ne="LayerMouse";class Us{constructor(e,t,i){this.imageMap=e,this.factory=t,this.game=t.getGame(),this.tileSize=i.tileSize,this.tilesX=t.getMeta().tilesX,this.tilesY=t.getMeta().tilesY,this.selectedComponentMetaId=null,this.selectedMapToolId=null,this.clickedComponent=null,this.mouseInfoHelper=new Ns(t,e,i.tileSize)}display(e){this.selectedComponentMetaId=null,this.container=e,this.tilesX*this.tileSize,this.element=document.createElement("div"),Object.assign(this.element.style,{position:"absolute",width:`${this.tilesX*this.tileSize}px`,height:`${this.tilesY*this.tileSize}px`}),this.container.append(this.element),this._setupNativePointerEvents(),this._setupMouseListeners(),this.mouseInfoHelper.display(e)}_setupMouseListeners(){let e=null,t=null,i=null;this.factory.getEventManager().addListener(ne,_.FACTORY_MOUSE_MOVE,r=>{if(e&&e.altKeyDown)this.updateTileMeta(e),this.updateTileMeta(r);else if(this.selectedComponentMetaId){this.mouseInfoHelper.updateMouseInformationModes(this.selectedComponentMetaId,r);const s=this.game.getMeta().componentsById[this.selectedComponentMetaId];e&&r.leftMouseDown&&!e.shiftKeyDown&&s.buildByDragging?(this.buyComponent(e),this.buyComponent(r),this.connectComponents(t,r)):e&&(r.leftMouseDown&&e.shiftKeyDown||r.rightMouseDown)&&(this.sellComponent(e),this.sellComponent(r))}else e&&(r.leftMouseDown&&e.shiftKeyDown||r.rightMouseDown)&&(this.sellComponent(e),this.sellComponent(r));t=r}),this.factory.getEventManager().addListener(ne,_.FACTORY_MOUSE_OUT,()=>{this.mouseInfoHelper.turnOffBuildMode(),this.mouseInfoHelper.turnOffCantBuildMode(),e=null,t=null}),this.factory.getEventManager().addListener(ne,_.FACTORY_MOUSE_DOWN,r=>{e=r}),this.factory.getEventManager().addListener(ne,_.FACTORY_MOUSE_UP,r=>{if(e&&e.x===r.x&&e.y===r.y){let s=this.factory.getTile(r.x,r.y).getComponent();e.altKeyDown?this.updateTileMeta(r):this.selectedComponentMetaId?e.leftMouseDown&&!e.shiftKeyDown?this.buyComponent(e):(e.leftMouseDown&&e.shiftKeyDown||e.rightMouseDown)&&this.sellComponent(e):!this.selectedComponentMetaId&&(e.leftMouseDown&&e.shiftKeyDown||e.rightMouseDown)?this.sellComponent(e):s&&(i===s&&(s=null),this.factory.getEventManager().invokeEvent(_.COMPONENT_SELECTED,s),i=s)}e=null}),this.factory.getEventManager().addListener(ne,_.COMPONENT_META_SELECTED,r=>{this.factory.getEventManager().invokeEvent(_.COMPONENT_SELECTED,null),this.selectedComponentMetaId=r,this.mouseInfoHelper.updateMouseInformationModes(r,t),i=null}),this.factory.getEventManager().addListener(ne,_.MAP_TOOL_SELECTED,r=>{this.factory.getEventManager().invokeEvent(_.COMPONENT_SELECTED,null),this.selectedMapToolId=r,i=null}),this.factory.getEventManager().addListener(ne,_.COMPONENT_SELECTED,r=>{this.mouseInfoHelper.updateComponentSelected(r)})}updateTileMeta(e){const t=new xs(this.factory.getTile(e.x,e.y),this.selectedMapToolId);t.canUpdate()&&t.update()}buyComponent(e){const t=new Ge(this.factory.getTile(e.x,e.y),this.game.getMeta().componentsById[this.selectedComponentMetaId]);t.canBuy()&&t.buy()}sellComponent(e){const t=this.game.getMeta().componentsById[this.selectedComponentMetaId],i=new Fi(this.factory.getTile(e.x,e.y),t?t.width:1,t?t.height:1);i.canSell()&&i.sell()}connectComponents(e,t){const i=new _i(this.factory.getTile(e.x,e.y),this.factory.getTile(t.x,t.y));i.canUpdate()&&i.update()}_setupNativePointerEvents(){let e=null;const t=this.element;t.addEventListener("pointerout",()=>{this.factory.getEventManager().invokeEvent(_.FACTORY_MOUSE_OUT,e),e=null}),t.addEventListener("pointermove",i=>{let r={width:1,height:1};this.selectedComponentMetaId&&(r=this.game.getMeta().componentsById[this.selectedComponentMetaId]);const s=t.getBoundingClientRect(),a=i.clientX-s.left-this.tileSize*r.width/2,u=i.clientY-s.top-this.tileSize*r.height/2,l={x:Math.round(a/this.tileSize),y:Math.round(u/this.tileSize),leftMouseDown:i.buttons===1,rightMouseDown:i.buttons===2,shiftKeyDown:i.shiftKey,altKeyDown:i.altKey,pointerType:i.pointerType};l.x=Math.min(this.tilesX-r.width,Math.max(0,l.x)),l.y=Math.min(this.tilesY-r.height,Math.max(0,l.y)),(!e||e.x!==l.x||e.y!==l.y)&&(this.factory.getEventManager().invokeEvent(_.FACTORY_MOUSE_MOVE,l),e=l)}),t.addEventListener("pointerdown",i=>{this.factory.getEventManager().invokeEvent(_.FACTORY_MOUSE_DOWN,{x:e?.x??0,y:e?.y??0,leftMouseDown:i.buttons===1,rightMouseDown:i.buttons===2,shiftKeyDown:i.shiftKey,altKeyDown:i.altKey,pointerType:i.pointerType})}),t.addEventListener("pointerup",()=>{this.factory.getEventManager().invokeEvent(_.FACTORY_MOUSE_UP,e)})}destroy(){this.mouseInfoHelper.destroy(),this.factory.getEventManager().removeListenerForType(ne),this.container.innerHTML="",this.container=null}}class ki{constructor(e,t){this.factory=e,this.areaId=t,this.areaMeta=e.getMeta().areasById[t]}canBuy(){return this.areaMeta.price<=this.factory.getGame().getMoney()}buy(){this.factory.getGame().addMoney(-this.areaMeta.price),this.factory.getAreasManager().setAreaBought(this.areaId,!0)}}const Ds=`<div class="confirmBg" id="{{idBg}}"></div>\r
<div class="confirm" id="{{id}}">\r
  <span class="title">{{title}}</span>\r
  <br />\r
  <span class="message">{{{message}}}</span>\r
  <br />\r
  <span class="cancelButton">{{cancelTitle}}</span>\r
  <span class="okButton">{{okTitle}}</span>\r
</div>`;let Fs=0;class mt{title;message;okTitle="Ok";cancelTitle="Cancel";okCallback;cancelCallback;element;bg;constructor(e,t){this.title=e,this.message=t,this.id=`confirm${Fs++}`,this.idBg=`${this.id}Bg`}setOkTitle(e){return this.okTitle=e,this}setCancelTitle(e){return this.cancelTitle=e,this}setOkCallback(e){return this.okCallback=e,this}setCancelCallback(e){return this.cancelCallback=e,this}display(){const e=L.compile(Ds)({id:this.id,idBg:this.idBg,title:this.title,message:this.message,okTitle:this.okTitle,cancelTitle:this.cancelTitle});if(document.body.insertAdjacentHTML("beforeend",e),this.element=document.getElementById(this.id),this.bg=document.getElementById(this.idBg),!this.element||!this.bg)return this;const t=()=>{const{innerWidth:i,innerHeight:r}=window,{offsetWidth:s,offsetHeight:a}=this.element;this.element.style.left=`${Math.round((i-s)/2)}px`,this.element.style.top=`${Math.round((r-a)/2)}px`};return t(),window.addEventListener("resize",t),this.element.querySelector(".okButton")?.addEventListener("click",()=>{this.hide(),this.okCallback?.()}),this.element.querySelector(".cancelButton")?.addEventListener("click",()=>{this.hide(),this.cancelCallback?.()}),this.bg.style.opacity=0,this.element.style.opacity=0,this.bg.style.display="block",this.element.style.display="block",requestAnimationFrame(()=>{this.bg.style.transition="opacity 0.2s ease",this.element.style.transition="opacity 0.2s ease",this.bg.style.opacity=1,this.element.style.opacity=1}),this}hide(){if(this.element&&this.bg){const e=t=>{t.style.transition="opacity 0.2s ease",t.style.opacity=0,t.addEventListener("transitionend",()=>t.remove(),{once:!0})};e(this.element),e(this.bg)}}}class qs{constructor(e,t,{tileSize:i}){this.imageMap=e,this.factory=t,this.game=t.getGame(),this.tileSize=i,this.tilesX=t.getMeta().tilesX,this.tilesY=t.getMeta().tilesY}display(e){this.container=e,this.container.insertAdjacentHTML("beforeend",'<div id="areasLayer" style="position:absolute"></div>'),this.factory.getEventManager().addListener("AreasLayer",_.FACTORY_COMPONENTS_CHANGED,()=>this.redraw()),this.area=this.container.querySelector("#areasLayer"),this.redraw()}redraw(){this.area.innerHTML="";const e=this.factory.getMeta(),t=this.factory.getAreasManager();e.areas.forEach(s=>{t.getIsAreaBought(s.id)||s.locations.forEach((a,u)=>{const l=document.createElement("div");if(l.className="mapBuyArea",l.dataset.id=s.id,Object.assign(l.style,{left:`${this.tileSize*a.x}px`,top:`${this.tileSize*a.y}px`,width:`${this.tileSize*a.width}px`,height:`${this.tileSize*a.height}px`,position:"absolute"}),this.area.appendChild(l),u===0){const p=document.createElement("div");p.className="mapBuyAreaTitle money",p.innerHTML=`
            ${s.name}<br />
            Buy for <br />
            <b>$${R.formatNumber(s.price)}`,Object.assign(p.style,{left:`${this.tileSize*a.x}px`,top:`${this.tileSize*a.y}px`,width:`${this.tileSize*a.width}px`,marginTop:`${this.tileSize*a.height/2-23}px`,position:"absolute"}),this.area.appendChild(p)}})});let i=null,r=!1;this.factory.getEventManager().addListener("AreasLayer",_.FACTORY_SCROLL_START,()=>{r=!0}),this.factory.getEventManager().addListener("AreasLayer",_.FACTORY_SCROLL_END,()=>{setTimeout(()=>r=!1,100)}),this.area.querySelectorAll(".mapBuyArea").forEach(s=>{s.addEventListener("pointerover",a=>{const u=a.currentTarget.dataset.id;i!==u&&(this.area.querySelectorAll(".mapBuyArea").forEach(l=>l.classList.remove("mapBuyAreaOver")),this.area.querySelectorAll(`.mapBuyArea[data-id="${u}"]`).forEach(l=>l.classList.add("mapBuyAreaOver"))),i=u}),s.addEventListener("pointerout",()=>{this.area.querySelectorAll(".mapBuyArea").forEach(a=>a.classList.remove("mapBuyAreaOver")),i=null}),s.addEventListener("click",a=>{if(r)return;const u=a.currentTarget.dataset.id,l=e.areasById[u];new ki(this.factory,u).canBuy()?new mt("",`<center>Are you sure you want to buy this area for <br />
            <b class="money" style="font-size:1.1em">$${R.formatNumber(l.price)}</b></center>`).setOkTitle("Yes, buy").setCancelTitle("No").setOkCallback(()=>{const h=new ki(this.factory,u);h.canBuy()&&(h.buy(),this.redraw())}).display():new ft("","<center>You don't have enough money to buy selected area</center>").display()})})}destroy(){this.factory.getEventManager().removeListenerForType("AreasLayer"),this.container.innerHTML="",this.container=null,this.canvas=null}}class Hs{constructor(e,{tileSize:t},i,r,s){this.tileSize=t,this.tilesX=e.getMeta().tilesX,this.tilesY=e.getMeta().tilesY,this.backgroundCanvas=i,this.componentsCanvas=r,this.packagesCanvas=s}open(){this.canvas=document.createElement("canvas"),this.canvas.width=this.tilesX*this.tileSize,this.canvas.height=this.tilesY*this.tileSize;const e=this.canvas.getContext("2d");e.drawImage(this.backgroundCanvas,0,0),e.drawImage(this.componentsCanvas,0,0),e.drawImage(this.packagesCanvas,0,0),window.open("about:blank","image from canvas").document.write(`
        <html>
          <body style="text-align:center; background-color:black; color:orangered; font-weight:bold;">
            <div style="margin: 0 0 8px 0;">
              For sharing copy or save image to disk. Or just make a screenshot, if your monitor is big enough :p
            </div>
            <img src="${this.canvas.toDataURL("image/png")}" alt="from canvas"/>
          </body>
        </html>
      `)}}class Ys{constructor(e,t){this.globalUiEm=ce,this.imageMap=t,this.factory=e,this.game=e.getGame(),this.tileSize=21,this.backgroundLayer=new ws(this.imageMap,e,{tileSize:this.tileSize}),this.componentLayer=new Ps(this.imageMap,e,{tileSize:this.tileSize}),this.packageLayer=new Bs(this.imageMap,e,{tileSize:this.tileSize}),this.mouseLayer=new Us(this.imageMap,e,{tileSize:this.tileSize}),this.areasLayer=new qs(this.imageMap,e,{tileSize:this.tileSize})}display(e){this.container=e;const t=this.container.clientWidth,i=this.container.clientHeight,r=this.factory.getMeta().tilesX*this.tileSize,s=this.factory.getMeta().tilesY*this.tileSize;this.overlay=document.createElement("div"),Object.assign(this.overlay.style,{overflow:"hidden",margin:"0",width:`${Math.min(t,r)}px`,height:`${Math.min(i,s)}px`,position:"relative"}),this.element=document.createElement("div"),Object.assign(this.element.style,{position:"absolute",width:`${r}px`,height:`${s}px`,left:"0px",top:"0px"}),this.overlay.append(this.element),this.container.append(this.overlay),this.setupMapDragging(),this.backgroundLayer.display(this.element),this.componentLayer.display(this.element),this.packageLayer.display(this.element),this.mouseLayer.display(this.element),this.areasLayer.display(this.element),this.globalUiEm.addListener("FactoryMapUi",_.OPEN_SCREENSHOT_VIEW,()=>{new Hs(this.factory,{tileSize:this.tileSize},this.backgroundLayer.getCanvas(),this.componentLayer.getCanvas(),this.packageLayer.getCanvas()).open()})}setupMapDragging(){let e=!0;this.factory.getEventManager().addListener("FactoryMapUi",_.COMPONENT_META_SELECTED,h=>{const m=this.game.getMeta().componentsById[h];e=!m||!m.buildByDragging});let t,i,r,s;const a=h=>{const m=h.pageX-t,c=h.pageY-i;this.setElementOffset(r+m,s+c),this.factory.getEventManager().invokeEvent(_.FACTORY_SCROLL_START)},u=()=>{document.body.removeEventListener("pointermove",a),document.body.removeEventListener("pointerup",u),this.factory.getEventManager().invokeEvent(_.FACTORY_SCROLL_END)};this.element.addEventListener("pointerdown",h=>{h.button===0&&!h.shiftKey&&!h.altKey&&e&&(t=h.pageX,i=h.pageY,this.element.getBoundingClientRect(),r=parseInt(this.element.style.left||"0",10),s=parseInt(this.element.style.top||"0",10),document.body.addEventListener("pointermove",a),document.body.addEventListener("pointerup",u))});const l=-this.factory.getMeta().startX*this.tileSize,p=-this.factory.getMeta().startY*this.tileSize;this.setElementOffset(l,p)}setElementOffset(e,t){const i=this.clampOffset(e,t);this.element.style.left=`${i.left}px`,this.element.style.top=`${i.top}px`}clampOffset(e,t){this.overlay.getBoundingClientRect(),this.element.getBoundingClientRect();const i=0,r=this.overlay.clientWidth-this.element.offsetWidth,s=0,a=this.overlay.clientHeight-this.element.offsetHeight;return{left:Math.min(Math.max(e,r),i),top:Math.min(Math.max(t,a),s)}}destroy(){this.factory.getEventManager().removeListenerForType("FactoryMapUi"),this.backgroundLayer.destroy(),this.componentLayer.destroy(),this.packageLayer.destroy(),this.mouseLayer.destroy(),this.areasLayer.destroy(),this.container.innerHTML="",this.container=null}}const Ws=`<div class="componentsBox">\r
  <div class="title">Components</div>\r
  <table cellspacing="0" cellpadding="0" border="0"> \r
    {{#each components}} <tr> \r
      {{#each sub}} <td>\r
        <div class="buttonArea"> \r
          {{#if name}} <div class="button but{{id}} {{#if isNoComponent}}buttonSelected{{/if}}" data-id="{{id}}">\r
            <div class="icon" data-id="{{id}}" style="{{style}}"></div>\r
          </div> {{/if}} \r
        </div>\r
      </td> {{/each}} \r
    </tr> {{/each}} \r
  </table>\r
  <div style="text-align:center; margin: 10px 0 10px 0;"> <a href="javascript:void(0);" id="makeScreenShotButton"\r
      style="color:white; font-size:0.9em;">Show whole map</a> </div>\r
</div>`;class zs{constructor(e){this.globalUiEm=ce,this.factory=e,this.game=e.getGame(),this.lastSelectedComponentId=null,this.selectedComponentId=null}display(e){this.container=e;const t=this.game.getMeta().componentsSelection.map(r=>({sub:r.map(s=>{const a=this.game.getMeta().componentsById[s];return a&&Ge.possibleToBuy(this.factory,a)?{id:a.id,name:a.name,style:`background-position: -${26*a.iconX}px -${26*a.iconY}px`}:s==="noComponent"?{name:"No component",style:"background-position: 0px 0px"}:{}})}));this.container.insertAdjacentHTML("beforeend",L.compile(Ws)({components:t})),this.factory.getEventManager().addListener("componentsUi",_.COMPONENT_META_SELECTED,r=>{this.container.querySelectorAll(".button").forEach(s=>s.classList.remove("buttonSelected")),this.selectedComponentId===r?this.selectedComponentId=null:(this.container.querySelectorAll(`.but${r}`).forEach(s=>s.classList.add("buttonSelected")),this.selectedComponentId=r)}),this.container.addEventListener("pointerdown",r=>{const s=r.target.closest(".button");if(!s)return;const a=s.dataset.id??null;this.factory.getEventManager().invokeEvent(_.COMPONENT_META_SELECTED,a)}),this.container.addEventListener("pointerenter",r=>{const s=r.target.closest(".button");if(!s)return;const a=s.dataset.id??null;this.factory.getEventManager().invokeEvent(_.HOVER_COMPONENT_META,a)},!0),this.container.addEventListener("pointerleave",r=>{r.target.closest(".button")&&this.factory.getEventManager().invokeEvent(_.HOVER_COMPONENT_META,null)},!0),this.globalUiEm.addListener("componentsUi",ee.KEY_PRESS,r=>{r.code==="Space"&&(this.factory.getEventManager().invokeEvent(_.COMPONENT_META_SELECTED,this.selectedComponentId?null:this.lastSelectedComponentId),r.preventDefault())}),this.container.querySelector("#makeScreenShotButton")?.addEventListener("click",()=>{this.globalUiEm.invokeEvent(_.OPEN_SCREENSHOT_VIEW)}),this.factory.getEventManager().invokeEvent(_.COMPONENT_META_SELECTED,null)}destroy(){this.factory.getEventManager().removeListenerForType("componentsUi"),this.game.getEventManager().removeListenerForType("componentsUi"),this.globalUiEm.removeListenerForType("componentsUi"),this.container&&(this.container.innerHTML="",this.container=null)}}const Vs=`<div class="componentControls"></div>\r
<div class="componentInfo"></div>`,Ci=`<div class="componentGraph"></div>\r
<div class="componentInfoArea">\r
  <span class="title">{{component.name}}</span>\r
  <br /> {{#if isMeta}}Price: <b class="money">{{component.priceStr}}</b> &nbsp;&nbsp; {{/if}} {{#if component.runningCostStr}}Costs: \r
  <b class="money">{{component.runningCostStr}}</b>{{/if}} {{#if component.effectivenessStr}}\r
  <span class="effectiveness">Efficiency: <b class="effectiveness">{{component.effectivenessStr}}</b>\r
  </span>{{/if}}\r
  <br />\r
  <div class="specialInfo"> {{#if component.description}}\r
    <span class="description">{{component.description}}</span>{{/if}} {{#if component.isBuyer}} Buys\r
    {{{component.buyStr}}} {{#if component.purchasePrice}}for <b class="money">\${{component.purchasePrice}}</b>{{/if}}\r
    after every <b>{{component.interval}}</b> ticks and sends it to conveyors. Should have\r
    <b>{{component.noOfOutputs}}</b> out conveyor(s). <br /> {{/if}} {{#if component.isConverter}} After every\r
    <b>{{component.interval}}</b> ticks uses {{{component.inputStr}}} to produce {{{component.outputStr}}}. Should have\r
    at least <b>{{component.noOfOutputs}}</b> out conveyor(s). <br /> {{/if}} {{#if component.isSeller}} Sells\r
    {{{component.sellStr}}} for <b class="money">\${{component.sellPrice}}</b> after every <b>{{component.interval}}</b>\r
    ticks {{#if component.bonusStr}}\r
    <br />Bonus: {{{component.bonusStr}}}{{/if}}\r
    <br /> {{/if}} {{#if component.isGarbage}} After every <b>{{component.interval}}</b> ticks removes\r
    <b>{{component.removeAmount}}</b> items. <br /> {{#if isLocation}} Stock\r
    <b>{{component.noOfItems}}</b>/{{component.max}} items {{/if}} {{/if}} {{#if component.isSorter}} Takes in any\r
    element and sorts them to different outputs. {{/if}} {{#if component.isResearchCenter}} Produces <span\r
      class="research">{{{component.productionStr}}}</span> after every <b>{{component.interval}}</b> ticks. <br />\r
    Production bonus of each {{{component.bonusStr}}} <br /> {{/if}} {{#if component.isLab}} Produces\r
    <b>{{{component.outputStr}}}</b> after every <b>{{component.interval}}</b> ticks <br /> Production bonus of each\r
    {{{component.bonusStr}}} <br /> {{/if}} {{#if component.isTransport}} Transports items from one component to\r
    another. Can take in 1 item/tick. {{/if}} {{#if component.stock}}\r
    <b>Stock</b> {{#each component.stock}}\r
    <span class="{{resourceId}}">{{resourceName}}: </span>\r
    <b class="{{resource}}">{{amount}}</b>/{{max}} {{/each}} {{/if}}\r
  </div>\r
</div>`,$s=`{{#each locations}}{{name}}\r
  <select data-id="{{id}}"> {{#each resources}}\r
      <option value="{{id}}">{{name}}</option>\r
    {{/each}}\r
  </select>\r
  <br />{{/each}}`;class Ks{constructor(e,t,i,r){this.component=e,this.factory=e.getFactory(),this.offsetX=t,this.offsetY=i,this.resource=r}canUpdate(){return this.component.getMeta().strategy.type==="sorter"}update(){this.component.getStrategy().setSortingResource(this.offsetX,this.offsetY,this.resource),this.factory.getEventManager().invokeEvent(FactoryEvent.FACTORY_COMPONENTS_CHANGED,this.tile),this.factory.getEventManager().invokeEvent(FactoryEvent.REFRESH_COMPONENT_INFO)}}class js{constructor(e){this.component=e,this.strategy=e.getStrategy(),this.container=null}display(e){this.container=e;const t=[{id:null,name:"all other"},...this.component.getFactory().getGame().getMeta().resources.map(s=>({id:s.id,name:s.name}))],i=this.strategy.getSortingIndex(),r=Object.keys(i).map(s=>({id:s,name:s,resources:t,selected:i[s]}));this.container.html(Handlebars.compile($s)({locations:r})),this.container.find("select").each((s,a)=>{const[u,l]=a.getAttribute("data-id").split(":");a.value=this.strategy.getSortingResource(u,l),a.addEventListener("change",p=>{const[h,m]=p.target.getAttribute("data-id").split(":"),c=p.target.value,o=new Ks(this.component,h,m,c);o.canUpdate()&&o.update()})})}destroy(){this.container.innerHTML="",this.container=null}}const oe=25,Ti=1,Ee=oe/2,Ei=33;class Hi{constructor(e,t){this.rootNode=e,this.imageMap=t,this.positions={},this.maxLevel=0,this.canvas=null}display(e){const t={node:this.rootNode,width:0};this.positions[this.rootNode.getId()]=t,this.calculateWidths(this.rootNode),t.y=0,t.x=t.width/2-Ee,t.sx=0,this.calculatePositions(this.rootNode);const i=document.createElement("canvas");i.style.position="absolute",i.width=t.width+Ee,i.height=Ei*(this.maxLevel+1),this.canvas=i,this.ctx=this.canvas.getContext("2d"),this.drawElements(this.rootNode),e.innerHTML="",e.appendChild(i),Object.assign(e.style,{width:`${i.width}px`})}calculateWidths(e){const t=e.getChildren();for(const i in t){const r=t[i];this.positions[r.getId()]={node:r,width:0},this.calculateWidths(r),this.positions[e.getId()].width+=this.positions[r.getId()].width}this.positions[e.getId()].width||(this.positions[e.getId()].width+=40)}calculatePositions(e){this.maxLevel=Math.max(this.maxLevel,e.getLevel());const t=this.positions[e.getId()],i=e.getChildren();let r=t.sx;for(const s in i){const a=i[s],u=this.positions[a.getId()];u.y=Ei*a.getLevel(),u.x=r+u.width/2-Ee,u.sx=r,r+=u.width,this.calculatePositions(a)}}drawComponentIcon(e,t,i){const r=this.imageMap.getImage("componentIcons");if(!r){console.warn("ProductionGraphUi: Missing sprite for componentIcons");return}const s=e.getComponentMeta();this.ctx.drawImage(r,(oe+Ti)*s.iconX,(oe+Ti)*s.iconY,oe,oe,t,i,oe,oe)}drawElements(e){const t=e.getChildren(),i=this.positions[e.getId()];for(const r in t){const s=t[r],a=this.positions[s.getId()];this.drawLine(i.x+Ee,i.y+oe,a.x+Ee,a.y),this.drawElements(s)}this.drawComponentIcon(e,i.x,i.y),this.writeToNode(i.x+27,i.y+16.5,e.amount)}drawLine(e,t,i,r){this.ctx.beginPath(),this.ctx.strokeStyle="rgb(201,201,201)",this.ctx.lineWidth=1,this.ctx.moveTo(e,t),this.ctx.lineTo(i,r),this.ctx.stroke()}writeToNode(e,t,i){this.ctx.font="11px Arial",this.ctx.textAlign="left",this.ctx.fillStyle="#FFFFFF",this.ctx.fillText(i,e,t)}}class Ii{constructor(e,t,i){this.id=Math.random(),this.componentMeta=e,this.amount=t,this.level=i,this.parent=null,this.children={}}getId(){return this.id}setAmount(e){this.amount=e}getAmount(){return this.amount}getComponentMeta(){return this.componentMeta}getLevel(){return this.level}getParent(){return this.parent}setParent(e){this.parent=e}getChildren(){return this.children}hasChildren(){return Object.keys(this.children).length>0}addChild(e,t){this.children[e]=t}getRoot(){return this.parent?this.parent.getRoot():this}multiplyAmount(e){this.amount*=e;for(const t in this.children)this.children[t].multiplyAmount(e)}toGraph(e,t){const i={id:this.id,label:`${this.componentMeta.name}(${this.amount})`,shape:"box",level:this.level};e.push(i),this.parent&&t.push({from:this.parent.getId(),to:this.id});for(const r in this.children)this.children[r].toGraph(e,t)}findLeastCommonMultiplier(e,t){if(!e||!t)return 0;let i=Math.abs(e),r=Math.abs(t);for(;r;){const s=r;r=i%r,i=s}return Math.abs(e*t/i)}}class Yi{constructor(e){this.factory=e,this.meta=e.getGame().getMeta()}buildTree(e,t){const i=new Ii(this.meta.componentsById[e],1,0);return this._buildTree(i,t),i}_buildTree(e,t){if(t<=0)return;const i=this.meta.productionTree[e.getComponentMeta().id]||{};for(const r in i){const s=i[r],a=new Ii(this.meta.componentsById[s],1,e.getLevel()+1);this._balanceNode(e,a,r),a.setParent(e),e.addChild(r,a),this._buildTree(a,t-1)}}_balanceNode(e,t,i){const r=this.getConsumption(this.meta.componentsById[e.getComponentMeta().id],i),s=this.getProduction(this.meta.componentsById[t.getComponentMeta().id],i),a=this.findLeastCommonMultiple(r*e.getAmount(),s),u=Math.round(a/r),l=Math.round(a/s);if(u>e.getAmount()){const p=u/e.getAmount();e.getRoot().multiplyAmount(p)}t.setAmount(l)}findLeastCommonMultiple(e,t){if(!e||!t)return 0;let i=Math.abs(e),r=Math.abs(t);for(;r;){const s=r;r=i%r,i=s}return Math.abs(e*t/i)}getProduction(e,t){let i=0;const r=pt.getStrategyClass(e.strategy.type);return e.strategy.type==="buyer"?i=r.getMetaBuyAmount(e,t,this.factory):e.strategy.type==="converter"&&(i=r.getMetaProduceAmount(e,t,this.factory)),i/e.strategy.interval*10}getConsumption(e,t){let i=0;const r=pt.getStrategyClass(e.strategy.type);return e.strategy.type==="converter"?i=r.getMetaUseAmount(e,t,this.factory):e.strategy.type==="seller"&&(i=r.getMetaSellAmount(e,t,this.factory)),i/e.strategy.interval*10}}class Wi{constructor(e,t){this.game=e,this.seconds=t;const i=this.game.getTicker().getNormalTicksPerSec();this.ticks=this.seconds*i;const r=this.game.getStatistics();this.profit=r.getAvgProfit()*this.ticks,this.researchPoints=r.getAvgResearchPointsProduction()*this.ticks}getTicks(){return this.ticks}getProfit(){return this.profit}getResearchPoints(){return this.researchPoints}canPassTime(){return this.game.getTicker().getTimeTravelTickets()>0}passTime(){const e=this.game.getTicker();this.game.addMoney(this.profit),this.game.addResearchPoints(this.researchPoints),e.addNoOfTicks(this.ticks),e.getTimeTravelTickets()>0&&e.addTimeTravelTickets(-1)}}class Qs{constructor(e,t,i,r){this.factory=e,this.game=e.getGame(),this.statistics=t,this.play=i,this.imageMap=r,this.selectedPosition=null,this.hoveredComponentMetaId=null,this.selectedComponentMetaId=null,this.selectedComponent=null,this.componentStrategies={sorter:js},this.displayedStrategy=null,this.displayedStrategyComponent=null,this.container=null,this.infoContainer=null,this.controlsContainer=null,this.listenerKey="componentInfoUi"}display(e){this.container=e,this.container.insertAdjacentHTML("beforeend",L.compile(Vs)({})),this.infoContainer=this.container.querySelector(".componentInfo"),this.controlsContainer=this.container.querySelector(".componentControls");const t=this.factory.getEventManager();t.addListener(this.listenerKey,_.FACTORY_MOUSE_MOVE,i=>{this.selectedPosition=i,this.checkWhatShouldBeDisplayed(!1)}),t.addListener(this.listenerKey,_.FACTORY_MOUSE_OUT,()=>{this.selectedPosition=null,this.checkWhatShouldBeDisplayed(!1)}),t.addListener(this.listenerKey,_.FACTORY_TICK,()=>{this.checkWhatShouldBeDisplayed(!0)}),t.addListener(this.listenerKey,_.REFRESH_COMPONENT_INFO,()=>{this.checkWhatShouldBeDisplayed(!1)}),t.addListener(this.listenerKey,_.HOVER_COMPONENT_META,i=>{this.hoveredComponentMetaId=i,this.checkWhatShouldBeDisplayed(!1)}),t.addListener(this.listenerKey,_.COMPONENT_META_SELECTED,i=>{this.selectedComponentMetaId=i,this.selectedComponent=null,this.checkWhatShouldBeDisplayed(!1)}),t.addListener(this.listenerKey,_.COMPONENT_SELECTED,i=>{this.selectedComponent=i,this.checkWhatShouldBeDisplayed(!1)})}checkWhatShouldBeDisplayed(e=!1){this.hoveredComponentMetaId&&!e?(this.showComponentMetaInfo(this.hoveredComponentMetaId),this.hideComponentStrategy()):this.selectedComponent?(this.showComponentInfo(this.selectedComponent),this.showComponentStrategy(this.selectedComponent)):this.selectedComponentMetaId&&!e?(this.showComponentMetaInfo(this.selectedComponentMetaId),this.hideComponentStrategy()):this.selectedPosition?(this.showLocationInfo(this.selectedPosition.x,this.selectedPosition.y),this.hideComponentStrategy()):e&&this.showDefaultInfo()}showComponentInfo(e){this.showLocationInfo(e.getX(),e.getY())}showLocationInfo(e,t){const i=this.factory.getTile(e,t),r={isLocation:!0,tile:{x:i.getX(),y:i.getY(),terrain:i.getTerrain(),buildableType:i.getBuildableType()},component:i.getComponent()?i.getComponent().getDescriptionData():{}};this.infoContainer.innerHTML=L.compile(Ci)(r)}showComponentStrategy(e){if(this.displayedStrategyComponent===e)return;const t=this.componentStrategies[e.getMeta().strategy.type];t?(this.displayedStrategyComponent=e,this.displayedStrategy=new t(e),this.displayedStrategy.display(this.controlsContainer),this.controlsContainer.style.display="block"):this.hideComponentStrategy()}hideComponentStrategy(){this.displayedStrategy&&(this.displayedStrategy.destroy(),this.displayedStrategy=null,this.displayedStrategyComponent=null),this.controlsContainer.innerHTML="",this.controlsContainer.style.display="none"}showComponentMetaInfo(e){const t=this.game.getMeta().componentsById[e],i={isMeta:!0,component:Ae.getMetaDescriptionData(t,this.factory)};this.infoContainer.innerHTML=L.compile(Ci)(i);const r=new Yi(this.factory).buildTree(e,1);if(r.hasChildren()){const s=new Hi(r,this.imageMap),a=this.infoContainer.querySelector(".componentGraph");s.display(a);const u=this.infoContainer.querySelector(".componentInfoArea");u&&a&&(u.style.width=`${u.offsetWidth-a.offsetWidth}px`)}}hideInfo(){this.hideComponentStrategy(),this.infoContainer.innerHTML=""}showDefaultInfo(){if(!this.play.isDevMode()){this.hideInfo();return}this.showIncomesData()}showIncomesData(){this.hideInfo();const e=this.statistics.getFactoryAvgResearchPointsProduction(this.factory.getMeta().id)*this.game.getTicker().getTicksPerSec()||0,t=this.statistics.getFactoryAvgProfit(this.factory.getMeta().id)*this.game.getTicker().getTicksPerSec()||0,i=(s,a,u="")=>`
      <tr>
        <td align="center"><b class="${u}">${s}</b></td>
        ${a.map(l=>`<td align="center" class="${u}">${l}</td>`).join("")}
      </tr>`,r=`
      <table cellspacing="0" cellpadding="0" border="0">
        <tr>
          <td width="100"></td>
          <td width="100"><b>15min</b></td>
          <td width="100"><b>1h</b></td>
          <td width="100"><b>24h</b></td>
          <td width="100"><b>1 week</b></td>
        </tr>
        ${i("Research:",[R.formatNumber(900*e),R.formatNumber(3600*e),R.formatNumber(1440*60*e),R.formatNumber(10080*60*e)],"research")}
        ${i("Money",[`$${R.formatNumber(900*t)}`,`$${R.formatNumber(3600*t)}`,`$${R.formatNumber(1440*60*t)}`,`$${R.formatNumber(10080*60*t)}`],"money")}
        <tr>
          <td></td>
          <td><a href="#" class="passTime" data-amount="15">PASS</a></td>
          <td><a href="#" class="passTime" data-amount="60">PASS</a></td>
          <td><a href="#" class="passTime" data-amount="1440">PASS</a></td>
          <td><a href="#" class="passTime" data-amount="10080">PASS</a></td>
        </tr>
      </table>`;this.infoContainer.insertAdjacentHTML("beforeend",r),this.infoContainer.querySelectorAll(".passTime").forEach(s=>{s.addEventListener("click",a=>{a.preventDefault();const u=parseInt(a.target.dataset.amount,10);new Wi(this.game,60*u).passTime()})})}destroy(){this.factory.getEventManager().removeListenerForType(this.listenerKey),this.container.innerHTML="",this.container=null}}const Js=`<div class="controlsBox">\r
  <a href="javascript:void(0);" id="clearPackages" class="button clearPackagesButton">Clear tracks</a>\r
  <a href="javascript:void(0);" id="resetFactory" class="button resetFactoryButton">Reset</a>\r
  <br style="clear:both" />\r
  <a href="javascript:void(0);" class="button stopButton" id="stopButton">Pause</a>\r
  <a href="javascript:void(0);" class="button playButton" id="playButton">Play</a>\r
  <a href="javascript:void(0);" class="button playFastButton" id="playFastButton">Fast &gt;&gt;</a>\r
  <a href="javascript:void(0);" class="button playNormalButton" id="playNormalButton">Normal</a>\r
  <div id="bonusTicks" class="bonusTicks">Bonus ticks: <span></span>\r
  </div>\r
</div>`;class Zs{constructor(e){this.factory=e}canClear(){return!0}clear(){const e=this.factory.getTiles();for(let t of e){const i=t.getComponent();i&&i.getStrategy().clearContents()}this.factory.getEventManager().invokeEvent(_.FACTORY_COMPONENTS_CHANGED,e)}}class en{constructor(e){this.factory=e}canReset(){return!0}reset(){console.log("Resetting");const e=this.factory.getTiles();for(let t of e){const i=new Fi(t,1,1);i.canSell()&&i.sell()}this.factory.reset()}}const lt="factoryControlsUi";class tn{constructor(e){this.factory=e,this.game=e.getGame(),this.container=null,this.pauseButton=null,this.playButton=null,this.playFastButton=null,this.playNormalButton=null,this.bonusTicks=null,this.clearPackagesButton=null,this.resetFactoryButton=null}updateControlButtons(){const e=this.game.getTicker();e.getBonusTicks()?(this.bonusTicks.style.display="block",e.getIsFastActive()?(this.playFastButton.style.display="none",this.playNormalButton.style.display="block"):(this.playFastButton.style.display="block",this.playNormalButton.style.display="none")):(this.bonusTicks.style.display="none",this.playFastButton.style.display="none",this.playNormalButton.style.display="none"),this.factory.getIsPaused()?(this.playButton.style.display="block",this.pauseButton.style.display="none"):(this.playButton.style.display="none",this.pauseButton.style.display="block")}updateBonusTicksValue(){const e=this.bonusTicks.querySelector("span");e&&(e.textContent=R.formatNumber(this.game.getTicker().getBonusTicks())),this.updateControlButtons()}display(e){this.container=e,this.container.insertAdjacentHTML("beforeend",L.compile(Js)());const t=this.game.getTicker();this.pauseButton=this.container.querySelector("#stopButton"),this.playButton=this.container.querySelector("#playButton"),this.playFastButton=this.container.querySelector("#playFastButton"),this.playNormalButton=this.container.querySelector("#playNormalButton"),this.bonusTicks=this.container.querySelector("#bonusTicks"),this.clearPackagesButton=this.container.querySelector("#clearPackages"),this.resetFactoryButton=this.container.querySelector("#resetFactory"),this.updateControlButtons(),this.updateBonusTicksValue();const i=(r,s=!1)=>{s?t.startFast():t.stopFast(),this.factory.setIsPaused(r),this.updateControlButtons()};this.pauseButton.addEventListener("pointerdown",()=>i(!0)),this.playButton.addEventListener("pointerdown",()=>i(!1)),this.playFastButton.addEventListener("pointerdown",()=>i(!1,!0)),this.playNormalButton.addEventListener("pointerdown",()=>i(!1)),this.clearPackagesButton.addEventListener("pointerdown",()=>{const r=new Zs(this.factory);r.canClear()&&r.clear()}),this.resetFactoryButton.addEventListener("pointerdown",()=>{new mt("Are you sure?","This will remove all components from the map").setOkCallback(()=>{const r=new en(this.factory);r.canReset()&&r.reset()}).display()}),this.game.getEventManager().addListener(lt,B.TICKS_STARTED,()=>this.updateControlButtons()),this.game.getEventManager().addListener(lt,B.TICKS_STOPPED,()=>this.updateControlButtons()),this.game.getEventManager().addListener(lt,B.BONUS_TICKS_UPDATED,()=>this.updateBonusTicksValue())}destroy(){this.game.getEventManager().removeListenerForType(lt),this.container&&(this.container.innerHTML=""),this.container=null}}const rn=`<div class="mapToolsBox">\r
  <div class="location"></div>\r
  <div class="title">Map tools</div>\r
  <div class="help">Press ALT to draw</div>\r
  <div class="button buttonSelected but" data-id="">Nothing</div> {{#each tools}} {{#if showBreak}}\r
      <br style="clear:both" /> {{/if}}\r
    <div class="button but{{id}}" data-id="{{id}}">\r
      <div class="mapTool {{id}}" data-id="{{id}}">{{name}}</div>\r
    </div>\r
  {{/each}}\r
  <br style="clear:both" />\r
  <br />\r
  <div class="title">Map data</div>\r
  <textArea id="mapData"></textArea>\r
  <br />\r
</div>`,Ie="factoryMapToolsUi";class sn{constructor(e){this.factory=e,this.game=e.getGame(),this.selectedToolId=null,this.container=null}display(e){this.container=e;const t=[{id:"buildable-road",name:"Partial buildable area",showBreak:!1},...Object.values(this.factory.getMeta().terrains).map(r=>({id:`terrain-${r}`,name:r,showBreak:!1}))];this.container.insertAdjacentHTML("beforeend",L.compile(rn)({tools:t})),this.locationElement=this.container.querySelector(".location"),this.mapDataElement=this.container.querySelector("#mapData"),this.buttons=this.container.querySelectorAll(".button"),this.updateMapData();const i=this.factory.getEventManager();i.addListener(Ie,_.FACTORY_MOUSE_MOVE,r=>{this.locationElement&&(this.locationElement.textContent=`${r.x}:${r.y}`)}),i.addListener(Ie,_.TILE_TYPE_CHANGED,()=>{this.updateMapData()}),i.addListener(Ie,_.MAP_TOOL_SELECTED,r=>{this.selectedToolId=r,this.buttons.forEach(s=>{s.classList.toggle("buttonSelected",s.dataset.id===r)})}),i.addListener(Ie,_.COMPONENT_META_SELECTED,()=>{this.factory.getEventManager().invokeEvent(_.MAP_TOOL_SELECTED,null)}),this.buttons.forEach(r=>{r.addEventListener("pointerdown",s=>{const a=s.target.dataset.id;i.invokeEvent(_.COMPONENT_META_SELECTED,null),i.invokeEvent(_.MAP_TOOL_SELECTED,a??null)})})}updateMapData(){const{tiles:e}=this.factory,{terrains:t}=this.factory.getMeta(),i=Object.fromEntries(Object.entries(t).map(([a,u])=>[u,a])),r="terrainMap: '"+e.map(a=>i[a.getTerrain()]).join("")+`',\r
`,s="buildMap: '"+e.map(a=>a.getBuildableType()).join("")+`',\r
`;this.mapDataElement&&(this.mapDataElement.textContent=r+s)}destroy(){this.factory.getEventManager().removeListenerForType(Ie),this.container&&(this.container.innerHTML="",this.container=null),this.buttons.forEach(e=>{e.replaceWith(e.cloneNode(!0))})}}const nn=`<div class="overviewBox">\r
  <span class="miniText">Money:</span>\r
  <span class="money">$<b id="money"></b>\r
  </span>\r
  <br />\r
  <span class="miniText">Income:</span>\r
  <span class="money smallText">$<span id="income"></span>\r
  </span>\r
  <span class="smallText">/tick (avg)</span>\r
  <br />\r
  <br /> {{#if researchBought}}\r
    <span class="miniText">Research:</span>\r
    <span class="research smallText">\r
      <span id="research"></span>\r
    </span>\r
    <br />\r
    <span class="miniText">Income:</span>\r
    <span class="research smallText">\r
      <span id="researchIncome"></span>\r
    </span>\r
    <span class="smallText">/tick (avg)</span>\r
    <br /> {{/if}}\r
  <span class="miniText ticks">\r
    <span id="ticks"></span> ticks/sec </span>\r
  <br />\r
</div>`;class on{constructor(e,t){this.factory=e,this.game=e.getGame(),this.statistics=t,this.container=null}display(e){this.container=e,this.container.insertAdjacentHTML("beforeend",L.compile(nn)({researchBought:!!this.game.getResearchManager().getResearch("researchCenter")})),this.game.getEventManager().addListener("factoryOverviewUi",B.GAME_TICK,()=>{this.update()}),this.update()}update(){if(!this.container)return;const{game:e,statistics:t,factory:i,container:r}=this,s=this.container.querySelector("#money");s.textContent=R.formatNumber(this.game.getMoney());const a=this.container.querySelector("#research");a&&e.getResearchPoints()&&(a.textContent=R.formatNumber(e.getResearchPoints()));const u=t.getFactoryAvgProfit(i.getMeta().id),l=u*e.getTicker().getTicksPerSec(),p=r.querySelector("#income");p&&(p.textContent=R.formatNumber(u));const h=r.querySelector("#incomePerSec");h&&(h.textContent=R.formatNumber(l));const m=t.getFactoryAvgResearchPointsProduction(i.getMeta().id),c=r.querySelector("#researchIncome");c&&(c.textContent=R.formatNumber(m));const o=r.querySelector("#ticks");o&&(o.textContent=R.formatNumber(e.getTicker().getActualTicksPerSec()))}destroy(){this.game.getEventManager().removeListenerForType("factoryOverviewUi"),this.container&&(this.container.innerHTML="",this.container=null)}}const an=`<div class="incentivizedAdBox">\r
    <div class="button {{#if isAvailable}}available{{/if}}"> \r
        {{#if isAvailable}} {{message}} {{else}} No ad to show currently {{/if}} </div>\r
  </div>`;class cn{constructor(e){this.play=e,this.apiEm=e.getApi().getEventManager(),this.isAdAvailable=null,this.designInterval=null,this.element=null,this.container=null}display(e){this.container=e,this.apiEm.addListener("IncentivizedAd",V.INCENTIVIZED_AD_STATUS,t=>{this.isAdAvailable=t,this.update()}),this.apiEm.addListener("IncentivizedAd",V.INCENTIVIZED_AD_ABANDONED,()=>{new ft("Incentivized ad","You left too quickly, watch the ad till the end to get the bonus! :)").display()}),this.apiEm.invokeEvent(V.INCENTIVIZED_AD_CHECK_STATUS),this.container.addEventListener("pointerdown",t=>{t.target.closest(".incentivizedAdBox")&&this.apiEm.invokeEvent(V.INCENTIVIZED_AD_SHOW)}),this.update()}update(){if(this.container&&this.isAdAvailable!=null){const e=new Ri(this.play.getGame());this.render(e.getMessage())}}render(e){this.container.innerHTML=L.compile(an)({isAvailable:this.isAdAvailable,message:e})}destroy(){this.container&&(this.container.innerHTML=""),this.apiEm.removeListenerForType("IncentivizedAd"),this.designInterval&&clearInterval(this.designInterval)}}class un{constructor(e,t,i){this.globalUiEm=ce,this.play=t,this.factory=e,this.game=e.getGame(),this.gameUiEm=this.game.getEventManager(),this.statistics=this.game.getStatistics(),this.imageMap=i,this.menuUi=new _s(e),this.mapUi=new Ys(e,this.imageMap),this.componentsUi=new zs(e),this.mapToolsUi=new sn(e),this.infoUi=new Qs(e,this.statistics,t,this.imageMap),this.controlsUi=new tn(e),this.overviewUi=new on(e,this.statistics),this.incentivizedAdButtonUi=new cn(t)}display(e){if(this.container=e,this.container.addEventListener("contextmenu",t=>{t.preventDefault()}),this.container.insertAdjacentHTML("beforeend",L.compile(Es)()),this.mainContainer=document.querySelector(".main"),this.game.getIsPremium()){this.mainContainer.classList.toggle("fullScreen",!0);const t=this.container.querySelector(".mapContainer");t.style.width=`${window.innerWidth-250}px`,t.style.height=`${window.innerHeight-150}px`}this.menuUi.display(this.container.querySelector(".menuContainer")),this.mapUi.display(this.container.querySelector(".mapContainer")),this.componentsUi.display(this.container.querySelector(".componentsContainer")),this.infoUi.display(this.container.querySelector(".infoContainer")),this.controlsUi.display(this.container.querySelector(".controlsContainer")),this.overviewUi.display(this.container.querySelector(".overviewContainer")),this.play.isDevMode()&&this.mapToolsUi.display(this.container.querySelector(".mapToolsContainer")),this.incentivizedAdButtonUi.display(this.container.querySelector(".incentivizedAd"))}destroy(){this.mapUi.destroy(),this.componentsUi.destroy(),this.infoUi.destroy(),this.controlsUi.destroy(),this.overviewUi.destroy(),this.mapToolsUi.destroy(),this.incentivizedAdButtonUi.destroy(),this.mainContainer&&this.mainContainer.classList.toggle("fullScreen",!1),this.game.getEventManager().removeListenerForType("FactoryUi"),this.container.innerHTML="",this.container=null}}const ln=`<div class="researchBox">\r
  <span class="backButton" id="backToReactor">Back to factory</span>\r
  <div class="header"> You have <b id="researchPoints" class="research">????</b> research points and <b class="money">$ <span id="money"></span>\r
    </b>. Use it wisely! You have researched <b>{{have}} of {{max}}</b> technologies. <br />\r
    <span class="miniText">Research applies to every factory.</span>\r
  </div>\r
  <br /> {{#each research}} {{#if changeGroup}}\r
      <br style="clear:left" />\r
      <br /> {{/if}}\r
    <div class="researchItem" data-id="{{id}}">\r
      <div class="icon">\r
        <div class="iconSelf" "{{iconStyle}}"></div>\r
      </div>\r
      <div class="buyButton" data-id="{{id}}">BUY</div> {{name}} {{#if showBoughtAndMax}}\r
        <span class="bought"></span>/{{max}} {{/if}} &nbsp;&nbsp;&nbsp;&nbsp; {{#if price}}\r
        <span class="priceTitle">Price:</span>\r
        <span class="money">{{price}}</span> {{/if}} {{#if priceResearchPoints}}\r
        <span class="priceTitle">Research:</span>\r
        <span class="research">{{priceResearchPoints}}</span> {{/if}}\r
      <br />\r
      <div class="description"> {{description}} </div>\r
    </div>\r
  {{/each}}\r
</div>`;class hn{constructor(e,t){this.game=e,this.researchId=t}canBuy(){return this.game.getResearchManager().canPurchase(this.researchId)}buy(){const e=this.game.getResearchManager();this.game.addMoney(-e.getPrice(this.researchId)),this.game.addResearchPoints(-e.getPriceResearchPoints(this.researchId)),e.addResearch(this.researchId,1),this.game.getEventManager().invokeEvent(GameEvent.RESEARCH_BOUGHT,this.researchId)}}class pn{constructor(e){this.gameUiEm=Q.gameUiBus,this.game=e,this.container=null}display(e){this.container=e;const t=this.game.getResearchManager();let i=0,r=0;for(const u of this.game.getMeta().research)i+=u.max||0,r+=t.getResearch(u.id);const s=[];for(const u of this.game.getMeta().research)if(t.isVisible(u.id)){const l=!u.max||t.getResearch(u.id)<u.max;s.push({id:u.id,name:u.name,description:u.description,price:l?R.formatNumber(t.getPrice(u.id)):null,priceResearchPoints:l?R.formatNumber(t.getPriceResearchPoints(u.id)):null,max:u.max,showBoughtAndMax:u.max>1,iconStyle:`background-position: -${26*u.iconX}px -${26*u.iconY}px`})}this.container.insertAdjacentHTML("beforeend",L.compile(ln)({research:s,max:i,have:r})),this.onBackButtonClick=()=>{this.gameUiEm.invokeEvent(x.SHOW_FACTORY)};const a=this.container.querySelector(".backButton");a&&(a.removeEventListener("pointerdown",this.onBackButtonClick),a.addEventListener("pointerdown",this.onBackButtonClick)),this.buyResearch=u=>{const l=new hn(this.game,u);l.canBuy()&&(l.buy(),this.refreshView())},this.container.querySelectorAll(".researchItem").forEach(u=>{const l=u.dataset.id;u.removeEventListener("pointerdown",this.buyResearch),u.addEventListener("pointerdown",()=>this.buyResearch(l))}),this.game.getEventManager().addListener("researchUi",B.GAME_TICK,()=>this.update()),this.update()}refreshView(){const e=this.container;this.destroy(),this.display(e)}update(){const e=this.container.querySelector("#researchPoints");e.textContent=R.formatNumber(this.game.getResearchPoints());const t=this.container.querySelector("#money");t.textContent=R.formatNumber(this.game.getMoney()),this.container.querySelectorAll(".researchItem").forEach(i=>{const r=i.dataset.id;i.querySelector(".bought");const s=i.querySelector(".buyButton"),a=this.game.getResearchManager().couldPurchase(r);s.style.display=a?"":"none";const u=this.game.getResearchManager().canPurchase(r);s.classList.toggle("cantBuy",!u)})}destroy(){this.game.getEventManager().removeListenerForType("researchUi"),this.gameUiEm.removeListenerForType("researchUi"),this.container&&(this.container.innerHTML=""),this.container=null}}const dn=`<div class="upgradesBox">\r
  <span class="backButton" id="backToReactor">Back to factory</span>\r
  <div class="header"> You have <b class="money">$ <span id="money"></span>\r
    </b> to spend. Make it count! <br />\r
    <span class="miniText">Upgrades apply only to this area.</span>\r
  </div>\r
  <br /> {{#each groups}} {{#if isBreak}}\r
      <br style="clear:both" />\r
    {{else}}\r
      <div class="upgradeGroup">\r
        <div class="head">\r
          <div class="buildingIcon">\r
            <div class="buildingIconSelf" style="{{iconStyle}}"></div>\r
          </div>\r
          <div class="text">{{name}}</div> {{#each upgrades}} {{#if isSeparator}}\r
              <div style="width:10px; height:10px; float:right;"></div>\r
            {{else}}\r
              <div class="upgradeItem upgradeItem_{{action}}" data-id="{{id}}" data-action="{{action}}">\r
                <div class="upgradeIcon" style="{{iconStyle}}"></div>\r
                <div class="upgradePopup smallText">\r
                  <b>{{title}}</b> {{#if isSell}}( <u>sell</u>){{/if}}\r
                  <br />\r
                  <span>Bought: </span>\r
                  <b class="bought green"></b>{{#if max}}\r
                    <b class="red">/{{max}}</b>{{/if}}\r
                  <br /> {{#if isBuy}} {{#if isMaxed}}\r
                      <b class="red">Maxed!</b>\r
                      <br />\r
                    {{else}}\r
                      <span class="priceTitle">Buy for:</span>\r
                      <b class="money">\${{buyPrice}}</b>\r
                      <br /> {{/if}}\r
                    <br /> {{{description}}} {{/if}} {{#if isSell}} {{#if canSell}}\r
                      <span class="priceTitle">Sell for:</span>\r
                      <b class="money">\${{sellPrice}}</b>\r
                      <span class="miniText">(refunds {{refund}})</span>\r
                      <br />\r
                    {{else}}\r
                      <b class="red">You haven't bought any, can't sell</b>\r
                      <br /> {{/if}} {{/if}}\r
                </div>\r
              </div>\r
            {{/if}} {{/each}}\r
        </div>\r
      </div>\r
    {{/if}} {{/each}}\r
</div>`;class Xn{constructor(e,t){this.factory=e,this.game=e.getGame(),this.upgradeId=t}canBuy(){return this.factory.getUpgradesManager().canPurchase(this.upgradeId)}buy(){const e=this.factory.getUpgradesManager().getPrice(this.upgradeId);this.game.addMoney(-e),this.factory.getUpgradesManager().addUpgrade(this.upgradeId,1),this.factory.getEventManager().invokeEvent(FactoryEvent.UPGRADE_BOUGHT,this.upgradeId)}}class mn{constructor(e,t){this.factory=e,this.game=e.getGame(),this.upgradeId=t}canSell(){return this.factory.getUpgradesManager().canSell(this.upgradeId)}sell(){const e=this.factory.getUpgradesManager().getSellPrice(this.upgradeId);this.game.addMoney(e),this.factory.getUpgradesManager().addUpgrade(this.upgradeId,-1)}}class gn{constructor(e){this.gameUiEm=Q.gameUiBus,this.factory=e,this.game=e.getGame(),this.container=null}display(e){this.container=e;const t=this.factory.getUpgradesManager(),i=[];for(const s of this.game.getMeta().upgradesLayout){if(s.type==="break"){i.push({isBreak:!0});continue}const a=[];for(const u of s.items){if(u==="_")continue;const l=this.game.getMeta().upgradesById[u];if(!l){console.error(`Group item with id ${u} not found!`);continue}if(!t.isVisible(l.id))continue;const p=t.getStrategy(l.id);l.refund&&a.push({id:l.id,action:"sell",isSell:!0,canSell:t.canSell(l.id),sellPrice:R.formatNumber(t.getSellPrice(l.id)),refund:`${100*l.refund}%`,title:p.getTitle(),description:p.getDescription(),iconStyle:`background-position: -${26*l.iconX}px -${26*l.iconY}px`}),a.push({id:l.id,action:"buy",isBuy:!0,isMaxed:!t.couldPurchase(l.id),buyPrice:R.formatNumber(t.getPrice(l.id)),title:p.getTitle(),description:p.getDescription(),iconStyle:`background-position: -${26*l.iconX}px -${26*l.iconY}px`})}a.length>0&&(a.reverse(),i.push({name:s.name,upgrades:a,iconStyle:`background-position: -${26*s.iconX}px -${26*s.iconY}px`}))}this.container.innerHTML=L.compile(dn)({groups:i});const r=this.container.querySelector(".backButton");r&&r.addEventListener("pointerdown",()=>{this.gameUiEm.invokeEvent(x.SHOW_FACTORY)}),this.container.querySelectorAll(".upgradeItem").forEach(s=>{const a=s.dataset.id,u=s.dataset.action;new qi(s,s.querySelector(".upgradePopup")).init(),s.addEventListener("pointerdown",()=>{if(u==="sell"){const l=new mn(this.factory,a);l.canSell()&&l.sell()}else if(u==="buy"){const l=new Xn(this.factory,a);l.canBuy()&&l.buy()}this.refreshView()})}),this.game.getEventManager().addListener("upgradeUi",B.GAME_TICK,()=>this.update()),this.update()}refreshView(){const e=this.container;this.destroy(),this.display(e)}update(){const e=document.querySelector("#money");e&&(e.textContent=R.formatNumber(this.game.getMoney())),this.container.querySelectorAll(".upgradeItem").forEach(t=>{const i=t.dataset.id,r=t.dataset.action,s=this.factory.getUpgradesManager(),a=s.getUpgrade(i),u=t.querySelector(".upgradeIcon"),l=t.querySelector(".upgradePopup .bought");u&&(u.textContent=a),l&&(l.textContent=a),r==="buy"?s.couldPurchase(i)?(t.classList.remove("upgradeItemMaxed"),s.canPurchase(i)?t.classList.remove("upgradeItemCantBuy"):t.classList.add("upgradeItemCantBuy")):t.classList.add("upgradeItemMaxed"):r==="sell"&&(s.canSell(i)?t.classList.remove("upgradeItemCantSell"):t.classList.add("upgradeItemCantSell"))})}destroy(){this.game.getEventManager().removeListenerForType("upgradeUi"),this.gameUiEm.removeListenerForType("upgradeUi"),this.container&&(this.container.innerHTML=""),this.container=null}}const fn=`<div class="achievementsBox"> <span class="backButton" id="backToReactor">Back to factory</span> <br /> {{#each achievements}} {{#if changeGroup}} <br style="clear:left" /><br /> {{/if}} <div class="item" data-id="{{id}}">\r
        <div class="icon {{icon}}" style="float:left;"></div>\r
        <div class="bonus">{{{bonus}}}</div>\r
        <div class="name"> {{name}} </div> <br />\r
        <div class="requirements"> {{{requirements}}} </div>\r
    </div> {{/each}}</div>`;class yn{constructor(e){this.gameUiEm=Q.gameUiBus,this.game=e,this.manager=this.game.getAchievementsManager(),this.container=null}display(e){this.container=e;const t=[],i=this.game.getMeta().achievements;for(const s of i)this.manager.isVisible(s.id)&&t.push({id:s.id,name:s.name,requirements:this.manager.getTesterDescriptionText(s.id),bonus:this.manager.getBonusDescriptionText(s.id)});this.container.innerHTML=L.compile(fn)({achievements:t});const r=this.container.querySelector(".backButton");r&&r.addEventListener("pointerdown",()=>this.gameUiEm.invokeEvent(x.SHOW_FACTORY)),this.game.getEventManager().addListener("achievementsUi",B.ACHIEVEMENT_RECEIVED,()=>this.update()),this.update()}update(){this.container.querySelectorAll(".item").forEach(t=>{const i=t.dataset.id;this.manager.getAchievement(i)?t.classList.add("achieved"):t.classList.remove("achieved")})}destroy(){this.game.getEventManager().removeListenerForType("achievementsUi"),this.gameUiEm.removeListenerForType("achievementsUi"),this.container&&(this.container.innerHTML="",this.container=null)}}const vn='<div class="achievementPopup" id="{{idStr}}">    <span class="name">{{name}}</span>    <span class="bonus">{{{bonus}}}</span>    <br/>    <span class="requirements">{{{requirement}}}</span></div>';let _e=0;class wt{static counter=1;constructor(e,t){this.game=e,this.achievementId=t,this.id=`achievementPopup${wt.counter++}`,this.timeoutId=null,this.container=document.body,this.element=null}display(){const e=this.game.getMeta().achievementsById[this.achievementId],t=L.compile(vn)({idStr:this.id,name:e.name,requirement:this.game.getAchievementsManager().getTesterDescriptionText(e.id),bonus:this.game.getAchievementsManager().getBonusDescriptionText(e.id)});this.container.insertAdjacentHTML("beforeend",t),this.element=document.getElementById(this.id),this.element.classList.add("popup-hidden"),this.element.addEventListener("click",()=>this.hide()),this.timeoutId=setTimeout(()=>this.hide(),8e3);const i=window.innerWidth/2-this.element.offsetWidth/2,r=150+_e*(this.element.offsetHeight+10);Object.assign(this.element.style,{left:`${i}px`,top:`${r}px`,zIndex:1e3+_e}),requestAnimationFrame(()=>{this.element.classList.remove("popup-hidden"),this.element.classList.add("popup-visible")}),_e++}hide(){this.element&&(this.element.classList.remove("popup-visible"),this.element.classList.add("popup-hidden"),this.element.addEventListener("transitionend",()=>{this.element?.remove(),this.element=null},{once:!0}),clearTimeout(this.timeoutId),_e=Math.max(0,_e-1))}}const bn=`<div id="helpBg"></div>\r
<div id="help">\r
  <a href="javascript:void(0);" class="closeButton" style="float:right; display:block;">Close</a>\r
  <div class="menu">\r
    <a href="javascript:void(0);" data-id="gettingStarted">1. Getting started</a>\r
    <a href="javascript:void(0);" data-id="ironProduction">2. Setting up iron production</a>\r
    <a href="javascript:void(0);" data-id="labProduction">3. Setting up lab production</a>\r
    <a href="javascript:void(0);" data-id="plasticProduction">4. Setting up plastic</a>\r
    <a href="javascript:void(0);" data-id="sorter">5. Setting up sorter</a>\r
    <a href="javascript:void(0);" data-id="proTips">6. Pro tips</a>\r
    <a href="javascript:void(0);" data-id="faq">7. Frequent questions</a>\r
    <br />\r
    <br />\r
    <a href="javascript:void(0);" data-id="updates">UPDATES</a>\r
  </div>\r
  <div class="section" id="gettingStarted">\r
    <b class="title">Getting started</b>\r
    <br />\r
    <img src="img/tutorial/start.png" align="left" style="margin: 3px 6px 3px 0;" /> * <span style="color:lightblue; text-decoration:underline">Left panel contains components.</span> Click on one and then click on the map to where you would like to place it. <br />\r
    <br /> * <span style="color:lightblue; text-decoration:underline">Use conveyors</span> to connect components, so they start producing stuff. <br />\r
    <br /> * <span style="color:lightblue; text-decoration:underline">Make conveyors by click dragging</span> from inside the component to the component you want the conveyor to drop off. <br />\r
    <br /> * <span style="color:lightblue; text-decoration:underline">Sell components</span> by selecting any component from left panel and right clicking on the map to clear its footprint. <br />\r
    <br /> * <span style="color:lightblue; text-decoration:underline">Drag the map around</span> and read stats using the cursor "component". <br />\r
    <br style="clear:both" />\r
    <b class="title">Keys</b>\r
    <br /> * <u>Left click</u> - most actions, buy component etc. <br /> * <u>Right click OR SHIFT + left click/drag</u> - Sell components by selecting any component from left panel and right clicking on the map to clear its footprint. (You can hold down mouse and move around to clear whole area quickly.) <br /> * <u>SPACE</u> - Toggle mouse to last selected component and back <br />\r
    <br />\r
    <b class="title">What to expect?</b>\r
    <br /> * More challenging game play as time goes on! <br /> * Bigger and more complicated factories consisting of complicated product chains. <br /> * Joy and happiness when you make a mess! :) <br />\r
    <br />\r
    <b class="title">Offline progress?</b>\r
    <br /> If game is closed you will get bonus ticks that allow the game to be run really fast. <br />\r
    <br />\r
  </div>\r
  <div class="section" id="ironProduction">\r
    <b class="title">Setting up iron production</b>\r
    <br />\r
    <img src="img/tutorial/iron.png" align="left" style="margin: 3px 6px 3px 0;" />\r
    <br /> In the start you should produce <b class="iron">iron</b> from <b class="ironOre">iron ore</b>\r
    <br />\r
    <br /> For a 100% effective layout you need 4 iron buyers, 2 iron foundry and 1 seller. <br />\r
    <br /> Later as you research more technologies, these relationships change. For each component a chart shows how much of everything you need. <br />\r
    <br /> Depending on your upgrades, these numbers may be very odd, then use your best judgement to get the best layout :) (Like in other places you don\\'t need good judgement :p) <br />\r
    <br /> Have fun! <br style="clear:both" />\r
  </div>\r
  <div class="section" id="labProduction">\r
    <b class="title">Setting up lab production</b>\r
    <br />\r
    <img src="img/tutorial/lab.png" align="left" style="margin: 3px 6px 3px 0;" /> Labs give huge bonus to research centers, so use them as many as you can afford if you want to research new more advanced technologies. <br />\r
    <br /> Luckily for you, setting up a lab can be quite a task. Labs require many different resources to be effective, but at the same time make production chain quite costly. <br />\r
    <br style="clear:both" />\r
  </div>\r
  <div class="section" id="plasticProduction">\r
    <b class="title">Setting up plastic production</b>\r
    <br />\r
    <img src="img/tutorial/plastic.png" align="left" style="margin: 3px 6px 3px 0;" /> Plastic production is a bit more complicated, as it also produces waste. <br />\r
    <br /> Resources come out clockwise starting from top left: plastic, waste, plastic, waste and so on. Using this piece of information, you can design your layout. <br />\r
    <br /> Later sorters will help to organize waste handling, additionally you can research clean production that will remove waste completely after you get electronics. <br />\r
    <br style="clear:both" />\r
  </div>\r
  <div class="section" id="sorter">\r
    <b class="title">Sorter</b>\r
    <br />\r
    <img src="img/tutorial/sorter2.png" style="margin: 3px 6px 3px 0;" />\r
    <br />\r
    <img src="img/tutorial/sorter.png" align="left" style="margin: 3px 6px 3px 0;" />\r
    <br /> * Sorter is a safe way to sort out waste in your production lines. <br />\r
    <br /> * Sorter needs to be configured - <b>click on the sorter</b> and set which exit should transport waste (or some other resource) <br />\r
    <br />\r
  </div>\r
  <div class="section" id="proTips">\r
    <b class="title">Pro tips</b>\r
    <br />\r
    <img src="img/tutorial/orderWithNumbers.png" align="left" style="margin: 3px 6px 3px 0;" /> * Order of outputs/inputs and conveyor crossings is always <b>top -> right -> bottom -> left (clockwise)</b>. This rule works everywhere. <br />\r
    <br /> * You can construct multiple input/output lines from/to same component. Very useful if component produces more than one resource per tick. <br />\r
    <br /> * Producing 20 items over 10 ticks means you need two output lines to get 100% efficiency. <br />\r
    <br />\r
    <br style="clear:both" />\r
    <img src="img/tutorial/split.png" align="right" style="margin: 3px 6px 3px 0;" /> * Splitting conveyor path can be used to sort resources, but has limited throughput. <br />\r
    <br /> * Multiple outputs from same component can also be used for sorting, but may jam if line gets full. <br />\r
    <br /> * Ultimately you can use sorter component, but it also has its flaws. <br />\r
    <br />\r
    <br style="clear:both" />\r
  </div>\r
  <div class="section" id="faq">\r
    <b class="title">Frequently asked questions</b>\r
    <br />\r
    <b style="color:lightblue; text-decoration:underline">I found a bug</b>\r
    <br /> * You probably didn\\'t :) Think through your setup 3 times, if still seems like a bug, ask forums for a solution. Don\\'t forget that this game is designed to be more difficult and challenging than an average game in the same category. <br />\r
    <br />\r
    <b style="color:lightblue; text-decoration:underline">Why can\\'t I get 100% efficiency for a buyer</b>\r
    <br /> Check that you actually transport everything out from buyer. Sometimes one exit conveyor is not enough. <br />\r
    <br />\r
    <b style="color:lightblue; text-decoration:underline">Waste & plastic switched order</b>\r
    <br /> * It can happen if one of the lines gets full, therefore all resources would be sent to another output lines. <br />\r
    <br />\r
    <b style="color:lightblue; text-decoration:underline">Upgrade is useless.</b>\r
    <br /> Some upgrades may seem useless at some points - just don\\'t buy them yet - they will be useful later. It is wise to think which upgrades are good for you and which are not. For example sometimes buying 3 upgrades at once would mean you don\\'t need to change your layout. But buying one of them would mean you have to redesign a lot. <br /> If you bought an upgrade that changes production in a way you don\\'t like, just sell it and all good. <br />\r
    <br />\r
  </div>\r
  <div class="section" id="updates">\r
    <b class="title">Updates</b>\r
    <br />\r
    <div style="height:500px; overflow-y:scroll">\r
      <b>V1.07</b>\r
      <br /> Quite a huge update that adds a lot of new content to the game! <br /> + New very big factory - Terafactory! <br /> + A lot more upgrades... like a lot! <br /> + New late game production <br /> + New research center with new quite fun to setup production cycle. <br />\r
      <br /> As balancing late game is quite hard because of different ways how you can setup things - what do you think about the balance of new stuff? Is it too easy/too hard? <br /> Let me know at Reddit/Kongregate - what do you think! <br />\r
      <br /> If anyone wants a challenge - fit research center 4 to first map! That should be quite a challenge to do :) <br />\r
      <br />\r
      <b>V1.06</b>\r
      <br /> This is a huge balancing update! I have received a lot of feedback that it is an idle game, but still felt a bit too slow. Well now this update makes the game progress a lot faster! Depending on your progress, it can be up to 3x faster <br /> * Profits of most sellers increased a bit. <br /> * Most research is now cheaper to get. <br /> * Lots of more upgrades for late game. <br /> * 8x more offline bonus ticks. <br /> * Bonus tick purchase amounts doubled. <br /> * Fixed text/image errors in help pages. <br /> * All updates are now shown in the game help section "Updates" <br /> * If clicking load game, it will ask for confirmation <br />\r
      <br /> Premium version for factoryidle.com <br /> Acquired with any new purchase after this release or older non consumable purchases <br /> * Uses up whole screen. <br /> * No adds if you make a purchase at factoryidle.com <br />\r
      <br />\r
      <b>V1.05</b>\r
      <br /> * Metals lab and gas&oil lab does not produce waste anymore. Check your builds, as probably you are sending now some stuff to waste. <br /> * Late game balancing updates. (diesel sells with much better price, rockets research cheaper.) <br />\r
      <br />\r
      <b>V1.04</b>\r
      <br /> * background mode delay changed to 15sec. Previously was 2 minutes. <br /> * smaller UI fixes <br /> * Safari bugfix <br /> * Fixed bug with avg calculation that caused it to overshoot often and then stabilizing a bit later to lower value. Special thanks to Tiogshi who actually debugged and pointed this out! Wow! <br />\r
      <br />\r
      <b>V1.03</b>\r
      <br /> * If output/input of the component is changed, it clears its contents. This makes output order of items “less random” (though it never was random) <br /> * button that opens whole map on new tab for screenshot or just for viewing. <br /> * Game tells how many output conveyors element should have. Should make planning easier. <br /> * new components and lots of new upgrades. Seriously, lots of upgrades added. New final component is rockets.. really, rockets! <br />\r
      <br />\r
      <b>V1.02</b>\r
      <br /> * Max stock of all elements except research related is increased by 4 times. Components store maximum of 20 production cycles worth of items, in most cases 200 ticks. <br /> * Sorters are 2x more effective, basically one sorter can handle one fully loaded line. This is experimental, let’s see how it works out. It is still more effective to use splits as they use less room. <br /> * Cursor component will sell if right clicked. <br /> * Increased add watching bonus ticks amount to 1000 <br /> * When running bonus ticks, it will show actual ticks/sec value. As in many cases UI makes it slower, added ticks per sec value to factories view also for longer “bonus ticks” runs. <br /> * Fixed not seeing saved games. It happened because session key expired if game was running more than 24 hours straight and after that cloud save didn’t work + you didn’t see your saves. It now automatically refreshes session. <br />\r
    </div>\r
  </div>\r
</div>`;class Sn{constructor(e){this.gameUiEm=Q.gameUiBus,this.game=e,this.isVisible=!1,this.helpElement=null,this.helpBg=null,this.menuSections={}}init(){return this.gameUiEm.addListener("help",x.SHOW_HELP,()=>this.display()),this}display(){if(this.isVisible)return;if(this.isVisible=!0,!this.helpElement){if(document.body.insertAdjacentHTML("beforeend",L.compile(bn)({})),this.helpElement=document.getElementById("help"),this.helpBg=document.getElementById("helpBg"),!this.helpElement||!this.helpBg)return;const t=document.documentElement.offsetWidth;this.helpElement.style.left=`${(t-this.helpElement.offsetWidth)/2}px`;const i=this.helpElement.querySelector(".closeButton");i&&i.addEventListener("click",()=>this.hide()),this.helpElement.querySelectorAll(".menu a").forEach(s=>{const a=s.getAttribute("data-id"),u=this.helpElement.querySelector(`#${a}`);u&&(this.menuSections[a]=u,s.addEventListener("click",()=>{Object.values(this.menuSections).forEach(l=>l.classList.remove("visible")),u.classList.add("visible")}))}),this.helpBg.addEventListener("click",()=>this.hide())}this.helpElement.style.display="block",this.helpElement.style.opacity="1",this.helpBg&&(this.helpBg.style.display="block",this.helpBg.style.opacity="1");const e=this.helpElement.querySelector("#gettingStarted");e&&e.classList.add("visible")}hide(){!this.isVisible||!this.helpElement||(this.isVisible=!1,Object.values(this.menuSections).forEach(e=>e.classList.remove("visible")),this.helpBg&&(this.helpBg.style.opacity="0",this.helpBg.style.display="none"),this.helpElement.style.opacity="0",this.helpElement.style.display="none")}destroy(){this.helpElement&&(this.helpElement.remove(),this.helpElement=null),this.helpBg&&(this.helpBg.remove(),this.helpBg=null),this.menuSections={},this.game.getEventManager().removeListenerForType("help"),this.gameUiEm.removeListenerForType("help")}}const Gn=`<div class="statisticsBox">\r
  <span class="backButton" id="backToReactor">Back to factory</span> Expenses <table>\r
    <tr>\r
      <td>Component</td>\r
      <td>Count</td>\r
      <td>Avg effectiveness</td>\r
      <td>Running costs</td>\r
      <td>Purchases</td>\r
    </tr>\r
  </table> Income <table>\r
    <tr>\r
      <td>Component</td>\r
      <td>Count</td>\r
      <td>Avg efficiency</td>\r
      <td>Sales</td>\r
    </tr>\r
  </table> Resources <table>\r
    <tr>\r
      <td>Resource</td>\r
      <td>Total produced</td>\r
    </tr>\r
  </table>\r
  <div class="graph" style="height:900px;"></div>\r
</div>`;class Mn{constructor(e,t){this.gameUiEm=Q.gameUiBus,this.factory=e,this.imageMap=t,this.game=e.getGame(),this.manager=this.game.getAchievementsManager(),this.container=null}display(e){this.container=e,this.container.insertAdjacentHTML("beforeend",L.compile(Gn)({})),this.container.querySelector(".backButton").addEventListener("pointerdown",()=>{this.gameUiEm.invokeEvent(x.SHOW_FACTORY)}),this.game.getEventManager().addListener("statisticsUi",B.GAME_TICK,()=>{this.update()});const t=new Yi(this.factory).buildTree("ironSeller",100);new Hi(t,this.imageMap).display(this.container.querySelector(".graph")),this.update()}update(){}destroy(){this.game.getEventManager().removeListenerForType("statisticsUi"),this.gameUiEm.removeListenerForType("statisticsUi"),this.container&&(this.container.innerHTML="",this.container=null)}}const kn=`<div id="purchasesBg"></div>\r
<div id="purchases">\r
  <a href="javascript:void(0);" class="closeButton" style="float:right; display:block;">Close</a>\r
  <b>Extra</b>\r
  <br />\r
  <br /> I really like making games and have been building them from my free time for a very long time. (Check my games) <br /> But as making games is very time consuming (I have two young children and a full time job at a startup. So if you can relate, imagine that :p), I highly appreciate any support - would it be ideas, comments, criticism or monetary! <br /> With this game I have good ideas on what features to add and if you like this game, I kindly ask you to show your support by making a purchase. I don\\'t expect these games to pay a salary, but to cover at least some of the time I put into making them. :) <br /> I really don\\'t like monetizing strategies games use nowadays - pay for every freaking move, so most certainly I will not follow them. <br />\r
  <br /> {{#if mainSiteVersion}}\r
    <b>Any purchase will remove ads and scales game to use whole screen. (Only if played at factoryidle.com)</b>\r
    <br /> {{/if}}\r
  <br style="clear:both" />\r
  <div class="specials"> {{#each specials}}\r
      <div class="item {{#if isBought}}boughtItem{{/if}}" data-id="{{id}}">\r
        <div class="name">{{name}}</div>\r
        <div class="description">{{{description}}}</div>\r
        <div class="buy"> {{#if isBought}}\r
            <span class="bought">Bought</span>\r
          {{else}}\r
            <a href="javascript:void(0);" data-purchaseId="{{id}}" class="button">Get it!</a> {{/if}}\r
        </div>\r
        <div class="price">{{#if isBought}}&nbsp;{{else}}{{priceStr}}{{/if}}</div>\r
      </div>\r
    {{/each}}\r
  </div>\r
  <br style="clear:both;" />\r
  <table class="timeTravelTable listTable">\r
    <tr>\r
      <td colspan="4" class="title">Time travel</td>\r
    </tr>\r
    <tr>\r
      <td colspan="4" class="description">Each ticket gives you <b>3 hour</b> income and research points. <br />You can use them any time you like after the purchase. </td>\r
    </tr> {{#each timeTravelTickets}}\r
      <tr class="item" data-id="{{id}}">\r
        <td width="150">{{name}}</td>\r
        <td width="40">{{priceStr}}</td>\r
        <td class="comment">{{description}}</td>\r
        <td width="50">\r
          <a href="javascript:void(0);" data-purchaseId="{{id}}" class="button">Get it!</a>\r
        </td>\r
      </tr>\r
    {{/each}}\r
  </table>\r
  <table class="bonusTicksTable listTable">\r
    <tr>\r
      <td colspan="4" class="title">\r
        <b>Bonus ticks</b>\r
      </td>\r
    </tr>\r
    <tr>\r
      <td colspan="4" class="description">Makes game ticks run really fast - <b>up to 200ticks/sec</b>\r
        <br />(Ticks run fastest if game runs in background mode - not focused)\r
      </td>\r
    </tr> {{#each bonusTicks}}\r
      <tr class="item" data-id="{{id}}">\r
        <td width="150">{{name}}</td>\r
        <td width="40">{{priceStr}}</td>\r
        <td class="comment">{{description}}</td>\r
        <td width="50">\r
          <a href="javascript:void(0);" data-purchaseId="{{id}}" class="button">Get it!</a>\r
        </td>\r
      </tr>\r
    {{/each}}\r
  </table>\r
  <br style="clear:both" />\r
  <br />\r
  <span style="font-size:0.9em; color:gray">* If you have problems with purchases, write to <a href="mailto:factoryidle@inditel.ee" style="color:gray" target="_blank">factoryidle@inditel.ee</a>. Please attach your user key. </span>\r
</div>`;class Cn{constructor(e){this.gameUiEm=Q.gameUiBus,this.play=e,this.purchasesManager=this.play.getPurchasesManager(),this.bg=null,this.element=null}init(){return this.gameUiEm.addListener("purchases",x.SHOW_PURCHASES,()=>{this.display()}),this}display(){const e=dt.identifySite(),t=this.play.getMeta(),i={mainSiteVersion:e==="localhost"||e==="direct"};for(const r in t.productsLayout){const s=t.productsLayout[r];i[r]=[];for(const a of s){const u=t.productsById[a];this.purchasesManager.isVisible(u.id)&&i[r].push({isItem:!0,id:u.id,name:u.name,description:u.description,priceStr:u.priceStr[this.purchasesManager.getPriceKey()],isBought:this.purchasesManager.getIsUnlocked(u.id)})}}document.body.insertAdjacentHTML("beforeend",L.compile(kn)(i)),this.bg=document.getElementById("purchasesBg"),this.element=document.getElementById("purchases"),this.element.style.left=`${(document.documentElement.offsetWidth-this.element.offsetWidth)/2}px`,this.element.querySelector(".closeButton").addEventListener("click",()=>this.hide()),this.element.querySelectorAll(".item").forEach(r=>{r.addEventListener("click",s=>{const a=s.currentTarget.getAttribute("data-id");this.purchasesManager.getIsUnlocked(a)||this.purchasesManager.startPurchase(a,()=>{this.hide(),this.display()})})}),this.bg.addEventListener("click",()=>this.hide())}hide(){this.element&&(this.element.remove(),this.element=null),this.bg&&(this.bg.remove(),this.bg=null)}destroy(){this.hide(),this.gameUiEm.removeListenerForType("purchases")}}const Tn=`<div id="settingsBg"></div>\r
<div id="settings">\r
  <a href="javascript:void(0);" class="closeButton" style="float:right; display:block;">Close</a>\r
  <b class="title">User key</b>\r
  <br /> This is your unique user key. Keep it safe and have a backup! <br /> There is no way to restore your game if this key gets lost! <br />\r
  <input type="text" class="userHash" id="userHash" value="{{userHash}}" name="userHash" readonly="readonly" />\r
  <a href="javascript:void(0)" id="copyToClipboardButton">Click here to copy to clipboard</a> or select user id and press CTRL+C (windows) or CMD+C (mac) to copy it. <br />\r
  <br />\r
  <b class="title">Save </b>\r
  <br /> Use manual save if you want to experiment and might need to get your game back to earlier state. Game <b>auto saves</b> to your computer every {{localSaveInterval}} and to cloud every {{cloudSaveInterval}}. <br /> {{#each saveSlots}}\r
    <div class="saveSlot">\r
      <b>{{name}}</b>\r
      <br />\r
      <input type="button" class="saveToSlot" data-id="{{id}}" value="Save" />\r
      <br />\r
      <br />\r
      {{#if hasSave}} {{lastSave}}\r
        <br /> Ticks: <b>{{ticks}}</b>\r
        <br />\r
        <input type="button" class="loadSlot" data-id="{{id}}" value="Load" />\r
      {{else}} No save exists on <br /> this slot yet <br />\r
      {{/if}}\r
    </div>\r
  {{/each}}\r
  <br style="clear:both" /> {{#if devMode}}\r
    <b class="title">Load from data</b>\r
    <br />\r
    <input type="text" id="loadData" />\r
    <input type="button" id="loadDataButton" value="Load data">\r
    <br style="clear:both" /> {{/if}}\r
  <br />\r
  <b class="title">Switch user key</b>\r
  <br /> If you have existing user key, copy it here and click update. <br /> This will reload the page with new account. <br />\r
  <br />\r
  <input type="text" class="updateUserHash" id="updateUserHash" value="" name="updateUserHash" />\r
  <input type="button" name="updateUserHashButton" id="updateUserHashButton" value="Update" />\r
  <br />\r
  <br />\r
  <b class="title">Reset</b>\r
  <br />\r
  <b class="red">Resets the game. </b> You have been warned! <br /> Notice that: <br /> * Manual saves will not be deleted and can be used to restore the game <br /> * If you have made purchases, you keep unlocks like faster ticks, but lose consumed items like bonus ticks <br />\r
  <br />\r
  <input type="button" name="resetGame" id="resetGame" value="Reset whole game - you lose all progress!" />\r
  <div style="float:right">Version 1.07</div>\r
  <br />\r
</div>`,En='<div class="loadingBg" id="{{idBg}}"></div><div class="loading" id="{{id}}">    <center>    <img src="img/loader.gif" class="icon"/><br />    <span class="message">{{{title}}}</span>    </center></div>';class In{static centerElement(e,t={vertical:!0,horizontal:!0}){const i=window.innerWidth,r=window.innerHeight;t.horizontal&&(e.style.left=`${Math.round((i-e.offsetWidth)/2)}px`),t.vertical&&(e.style.top=`${Math.round((r-e.offsetHeight)/2)}px`)}}let _n=0;class wn{constructor(e="Loading..."){this.title=e,this.id=`loading${_n++}`,this.idBg=`${this.id}Bg`,this.container=null,this.element=null,this.bg=null,this.clickCallback=null}setClickCallback(e){return this.clickCallback=e,this}display(){return document.body.insertAdjacentHTML("beforeend",L.compile(En)({id:this.id,idBg:this.idBg,title:this.title})),this.element=document.getElementById(this.id),this.bg=document.getElementById(this.idBg),In.centerElement(this.element),requestAnimationFrame(()=>{this.element.classList.add("visible"),this.bg.classList.add("visible")}),this.clickCallback&&this.bg.addEventListener("click",()=>{this.clickCallback(),this.hide()}),this}hide(){if(!this.element||!this.bg)return;this.element.classList.remove("visible"),this.bg.classList.remove("visible");const e=t=>{if(!t)return;const i=parseFloat(getComputedStyle(t).transitionDuration)*1e3;setTimeout(()=>t.remove(),i)};e(this.element),e(this.bg)}}function Rn(d,e=!1){if(!d)return"";let t=d.getFullYear(),i=d.getMonth()+1,r=d.getDate(),s=d.getHours(),a=d.getMinutes(),u=d.getSeconds();e&&(t=d.getUTCFullYear(),i=d.getUTCMonth()+1,r=d.getUTCDate(),s=d.getUTCHours(),a=d.getUTCMinutes(),u=d.getUTCSeconds());const l=p=>p<10?"0"+p:p;return`${t}.${l(i)}.${l(r)} ${l(s)}:${l(a)}:${l(u)}`}class An{constructor(e,t,i,r){this.play=e,this.game=t,this.gameUiEm=this.game.getEventManager(),this.userHash=i,this.saveManager=r,this.isVisible=!1,this.bg=null,this.element=null}init(){return this.gameUiEm.addListener("settingsUi",x.SHOW_SETTINGS,()=>{this.display()}),this}display(){if(this.isVisible)return;let e=!1;const t=new wn().setClickCallback(()=>{e=!0}).display();this.saveManager.getSavesInfo(["slot1","slot2","slot3"],i=>{e||(t.hide(),this._display(i))})}_display(e){const t=Array.from({length:3},(i,r)=>{const s=r+1,a=e[`slot${s}`];return{id:`slot${s}`,name:`Slot ${s}`,hasSave:!!a,lastSave:a?Rn(new Date(a.timestamp*1e3),!1):"-",ticks:a?a.ver:"-"}});document.body.insertAdjacentHTML("beforeend",L.compile(Tn)({userHash:this.userHash.toString(),cloudSaveInterval:Math.ceil(this.saveManager.getCloudSaveInterval()/6e4)+" minutes",localSaveInterval:Math.ceil(this.saveManager.getLocalSaveInterval()/1e3)+" seconds",saveSlots:t,devMode:this.play.isDevMode()})),this.bg=document.getElementById("settingsBg"),this.element=document.getElementById("settings"),this.isVisible=!0,this.element.style.left=`${(document.documentElement.offsetWidth-this.element.offsetWidth)/2}px`,this.element.querySelector(".closeButton").addEventListener("click",()=>this.hide()),this.element.querySelector("#userHash").addEventListener("click",i=>{i.target.setSelectionRange(0,i.target.value.length)}),this.element.querySelector("#updateUserHashButton").addEventListener("click",()=>{const i=this.element.querySelector("#updateUserHash").value;i&&(this.userHash.updateUserHash(i),window.location.reload())}),this.element.querySelector("#copyToClipboardButton").addEventListener("click",async()=>{const i=this.element.querySelector("#userHash");i.select();try{await navigator.clipboard.writeText(i.value),console.log("Copied to clipboard successfully!")}catch(r){console.log("Failed to copy: ",r)}}),this.element.querySelectorAll(".saveToSlot").forEach(i=>{i.addEventListener("click",r=>{const s=r.currentTarget.dataset.id;this.saveManager.saveManual(s,()=>this.hide())})}),this.element.addEventListener("click",i=>{const r=i.target.closest(".loadSlot");if(!r)return;const s=r.dataset.id;new mt("Load game","Are you sure you want to load game?").setCancelTitle("Yes, load game").setOkTitle("Nooooo!!!").setCancelCallback(()=>{this.saveManager.loadManual(s,()=>{this.hide(),this.gameUiEm.invokeEvent(x.SHOW_FACTORIES)})}).display()}),this.element.querySelector("#loadDataButton").addEventListener("click",()=>{const i=this.element.querySelector("#loadData").value;this.saveManager.updateGameFromSaveData({data:i}),this.hide(),this.gameUiEm.invokeEvent(x.SHOW_FACTORIES)}),this.element.querySelector("#resetGame").addEventListener("click",()=>{new mt("Reset game","Are you sure you want to reset the game?").setCancelTitle("Yes, RESET GAME").setOkTitle("Nooooo!!!").setCancelCallback(()=>{j.reset(!0),this.destroy()}).display()}),this.bg.addEventListener("click",()=>this.hide())}hide(){this.isVisible=!1,this.element?.remove(),this.bg?.remove()}destroy(){this.hide(),this.game.getEventManager().removeListenerForType("settingsUi"),this.gameUiEm.removeListenerForType("settingsUi")}}const Pn=`<div id="timeTravelBg"></div>\r
<div id="timeTravel">\r
  <a href="javascript:void(0);" class="closeButton" style="float:right; display:block;">Close</a>\r
  <b>Time travel</b>\r
  <br />\r
  <br /> Travel quickly through space and time to build your empire faster. <br /> Each ticket will give you <b>3 hour</b> income and research points. <br />\r
  <br /> You have <b class="tickets">{{tickets}}</b> tickets for time travel! <br />\r
  <a href="javascript:void(0);" class="getMore">Get more tickets</a>\r
  <br style="clear:both" />\r
  <br /> If you travel now you will pass <b>{{ticks}}</b> ticks and get: <br />\r
  <span class="money">\r
    <b>\${{profit}}</b> ( <b>\${{profitPerTick}}</b> per tick) </span>\r
  <br />\r
  <span class="research">\r
    <b>{{researchPoints}}</b> research points ( <b>{{researchPointsPerTick}}</b> per tick) </span>\r
  <br />\r
  <span class="comment"> These are your combined avg incomes from all factories. <br /> It might be wise to wait until your factories balance <a href="javascript:void(0)" class="refresh">refresh</a>\r
  </span>\r
  <br /> {{#if hasTickets}}\r
    <br />\r
    <a href="javascript:void(0);" class="travel">Use 1 ticket and travel to the future!</a>\r
    <br style="clear:both" />\r
  {{else}}\r
    <br /> Unfortunately you don\\'t have any tickets... {{/if}}\r
</div>`;class Bn{constructor(e){this.gameUiEm=Q.gameUiBus,this.play=e,this.game=e.getGame(),this.isVisible=!1,this.element=null,this.bg=null}init(){return this.gameUiEm.addListener("timeTravelUi",x.SHOW_TIME_TRAVEL,()=>this.display()),this}display(){if(this.isVisible)return;const e=new Wi(this.game,3600*this.play.getMeta().timeTravelTicketValue);if(document.body.insertAdjacentHTML("beforeend",L.compile(Pn)({tickets:this.game.getTicker().getTimeTravelTickets(),hasTickets:this.game.getTicker().getTimeTravelTickets()>0,ticks:R.formatNumber(e.getTicks()),profit:R.formatNumber(e.getProfit()),profitPerTick:R.formatNumber(Math.round(e.getProfit()/e.getTicks())),researchPoints:R.formatNumber(e.getResearchPoints()),researchPointsPerTick:R.formatNumber(Math.round(e.getResearchPoints()/e.getTicks()))})),this.isVisible=!0,this.element=document.getElementById("timeTravel"),this.bg=document.getElementById("timeTravelBg"),!this.element)return;const t=document.documentElement.offsetWidth;this.element.style.left=`${(t-this.element.offsetWidth)/2}px`;const i=this.element.querySelector(".getMore");i&&i.addEventListener("click",()=>{this.gameUiEm.invokeEvent(x.SHOW_PURCHASES),this.hide()});const r=this.element.querySelector(".travel");r&&r.addEventListener("click",()=>{e.canPassTime()?(e.passTime(),this.hide(),this.display()):alert("You don't have a ticket for time travel!")});const s=this.element.querySelector(".refresh");s&&s.addEventListener("click",()=>{this.hide(),this.display()});const a=this.element.querySelector(".closeButton");a&&a.addEventListener("click",()=>this.hide()),this.bg&&this.bg.addEventListener("click",()=>this.hide())}hide(){this.isVisible&&(this.isVisible=!1,this.element&&(this.element.remove(),this.element=null),this.bg&&(this.bg.remove(),this.bg=null))}destroy(){this.hide(),this.game.getEventManager().removeListenerForType("timeTravelUi"),this.gameUiEm.removeListenerForType("timeTravelUi")}}class xn{constructor(e,t){this.globalUiEm=ce,this.gameUiEm=Q.gameUiBus,this.play=e,this.game=e.getGame(),this.imageMap=t,this.focusInterval=null,this.currentUi=null}display(e){this.game.getMeta().isMission&&this.game.init(),this.container=e,this.setupEvents(),this.helpUi=new Sn().init(),this.purchasesUi=new Cn(this.play).init(),this.settingsUi=new An(this.play,this.game,this.play.getUserHash(),this.play.getSaveManager()).init(),this.timeTravelUi=new Bn(this.play).init(),this._showUi("factories"),this.game.getMeta().isMission&&this.gameUiEm.invokeEvent(x.SHOW_FACTORY,"mission")}setupEvents(){let e=null;this.gameUiEm.addListener("GameUi",x.SHOW_FACTORY,t=>{t??=e,e=t,this._showUi("factory",t)}),this.gameUiEm.addListener("GameUi",x.SHOW_FACTORIES,()=>this._showUi("factories")),this.gameUiEm.addListener("GameUi",x.SHOW_RESEARCH,()=>this._showUi("research")),this.gameUiEm.addListener("GameUi",x.SHOW_UPGRADES,t=>{t??=e,e=t,this._showUi("upgrades",t)}),this.gameUiEm.addListener("GameUi",x.SHOW_ACHIEVEMENTS,()=>this._showUi("achievements")),this.gameUiEm.addListener("GameUi",x.SHOW_STATISTICS,()=>this._showUi("statistics",e)),this.game.getEventManager().addListener("GameUi",B.ACHIEVEMENT_RECEIVED,t=>{new wt(this.game,t).display()}),this.globalUiEm.addListener("GameUi",ee.FOCUS,()=>this.game.getEventManager().invokeEvent(B.FOCUS)),this.globalUiEm.addListener("GameUi",ee.BLUR,()=>this.game.getEventManager().invokeEvent(B.BLUR))}_showUi(e,t){switch(this._destroyCurrentUi(),e){case"factory":this.currentUi=new un(this.game.getFactory(t),this.play,this.imageMap);break;case"factories":this.currentUi=new Ts(this.game);break;case"research":this.currentUi=new pn(this.game);break;case"upgrades":this.currentUi=new gn(this.game.getFactory(t));break;case"achievements":this.currentUi=new yn(this.game);break;case"statistics":this.currentUi=new Mn(this.game.getFactory(t),this.imageMap);break}this.currentUi?.display(this.container)}_destroyCurrentUi(){this.currentUi&&(this.currentUi.destroy(),this.currentUi=null)}destroy(){this._destroyCurrentUi(),this.helpUi?.destroy(),this.purchasesUi?.destroy(),this.settingsUi?.destroy(),this.timeTravelUi?.destroy(),this.game.getMeta().isMission&&this.game.destroy(),this.globalUiEm.removeListenerForType("GameUi"),this.gameUiEm.removeListenerForType("GameUi"),this.game.getEventManager().removeListenerForType("GameUi"),this.container=null,this.focusInterval&&clearInterval(this.focusInterval)}}const On=`<div class="runningInBackgroundInfoUiBg" id="runningInBackgroundInfoUi"></div>\r
<div class="runningInBackgroundInfoUi"> <b>Background mode active</b><br /> <br /> Don\\'t worry, game runs at <b\r
        class="green">normal speed</b>, just uses a lot less CPU (power) thanks to not updating some graphical\r
    elements.<br /> <br /> <span class="green">Just focus (click) the game to deactivate</span></div>`;class Ln{constructor(){this.globalUiEm=ce,this.timer=null,this.container=null,this.containerElement=null,this.backgroundElement=null,this.templateHtml=null}init(){this.globalUiEm.addListener("RunningInBackgroundInfoUi",ee.FOCUS,()=>this.hide()),this.globalUiEm.addListener("RunningInBackgroundInfoUi",ee.BLUR,()=>this.delayedDisplay())}destroy(){this.globalUiEm.removeListenerForType("RunningInBackgroundInfoUi")}delayedDisplay(e=15e5){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>this.display(),e)}display(e={}){this.container=document.body;const t=L.compile(On)(e),i=document.createElement("div");i.innerHTML=t,this.container.appendChild(i),this.backgroundElement=i.querySelector(".runningInBackgroundInfoUiBg"),this.containerElement=i.querySelector(".runningInBackgroundInfoUi");const r=this.container.offsetWidth/2-this.containerElement.offsetWidth/2;Object.assign(this.containerElement.style,{position:"absolute",left:`${r}px`,top:"150px"}),this.backgroundElement.style.display="none",this.containerElement.style.display="none",this.backgroundElement.style.transition="opacity 0.5s",this.containerElement.style.transition="opacity 0.5s",requestAnimationFrame(()=>{this.backgroundElement.style.display="",this.backgroundElement.style.opacity=1,this.containerElement.style.display="",this.containerElement.style.opacity=1})}hide(){this.timer&&clearTimeout(this.timer),this.backgroundElement&&(this.backgroundElement.remove(),this.backgroundElement=null),this.containerElement&&(this.containerElement.remove(),this.containerElement=null)}}const Nn=`<div id="introBg"></div>\r
<div id="intro">\r
  <b class="title">FACTORY IDLE</b>\r
\r
  <p>\r
 Welcome to the crazy world of <b>factory idle</b>!\r
  </p>\r
\r
  <p>\r
    Your goal here is to build an <b style="color:greenyellow">automated factory</b> \r
    with many <b style="color:greenyellow">production chains</b>. \r
    You start with simple stuff and later produce \r
    <b style="color:rgb(150,181,134)">high quality military technology</b>, like tanks and rockets! Seriously, high quality!\r
  </p>\r
\r
  <p>\r
    Path to complicated products is <u style="color:red">not an easy one</u> though, so be warned! \r
    There will be great challenges ahead waiting for you! Check <b style="color:yellow">help section</b> for good ideas.\r
  </p>\r
\r
  <p>\r
    <b>Disclaimer</b>: This game is <b style="color:red; text-decoration:underline">harder than an average</b> idle game \r
    and requires you to turn on a <u style="color:orange">brain</u>. If you have more than one, turn them all ON! Overheat warning!\r
  </p>\r
\r
  <a href="javascript:void(0);" class="closeButton">Ok, got it and I will not sue anyone!</a>\r
  <span class="note">(except factory workers, always sue them for messing up your conveyors!)</span>\r
</div>\r
`;class Un{constructor(){this.isVisible=!1,this.container=document.body,this.templateHtml=null,this.menuMap={}}display(e={}){if(this.isVisible)return;document.body.insertAdjacentHTML("beforeend",L.compile(Nn)(e)),this.isVisible=!0;const t=document.querySelector("#intro"),i=document.querySelector("#introBg"),r=(document.documentElement.clientWidth-t.offsetWidth)/2;t.style.position="absolute",t.style.left=`${r}px`;const s=t.querySelector(".closeButton");s&&s.addEventListener("pointerdown",()=>this.hide()),t.querySelectorAll(".menu a").forEach(l=>{const p=l.dataset.id,h=t.querySelector(`#${p}`);!p||!h||(this.menuMap[p]=h,l.addEventListener("pointerdown",()=>{Object.values(this.menuMap).forEach(m=>m.style.display="none"),h.style.display="block"}))});const u=t.querySelector("#gettingStarted");u&&(u.style.display="block"),i&&i.addEventListener("click",()=>this.hide())}hide(){if(!this.isVisible)return;const e=document.querySelector("#intro"),t=document.querySelector("#introBg");e&&e.remove(),t&&t.remove(),this.isVisible=!1,this.menuMap={}}destroy(){this.hide(),this.game?.getEventManager&&this.game.getEventManager().removeListenerForType("intro"),this.gameUiEm?.removeListenerForType&&this.gameUiEm.removeListenerForType("intro")}}class Dn{constructor(e,t){this.play=e,this.imageMap=t,this.globalUiEm=ce}setupFocusChecker(){let e=document.hasFocus();this.focusInterval=setInterval(()=>{const t=document.hasFocus();e!==t&&(e=t,e?this.globalUiEm.invokeEvent(ee.FOCUS):this.globalUiEm.invokeEvent(ee.BLUR))},200)}display(e){this.container=e,this.runningInBackgroundInfoUi=new Ln(this.globalUiEm),this.runningInBackgroundInfoUi.init();const t=this.play.getGame().getTicker(),i=new Un,r=Date.now(),s=()=>{const a=Date.now()-r;t.getNoOfTicks()<1e3&&a>=100&&(i.display(),this.play.getGame().getEventManager().removeListener("MainUi",B.TICKS_STARTED,s))};this.play.getGame().getEventManager().addListener("MainUi",B.TICKS_STARTED,s),this.setupFocusChecker(),this.play.getGame().getIsPremium()&&console.info("MainUi: Premium version, skipping loading ads"),window.addEventListener("keypress",a=>{this.globalUiEm.invokeEvent(ee.KEY_PRESS,a)}),window.addEventListener("beforeunload",()=>{this.play.getSaveManager().saveAuto()}),this.globalUiEm.addListener("MainUi",ee.SHOW_MAIN_GAME,()=>{this._showUi("mainGame")}),this.play.getGame().getEventManager().addListener("MainUi",B.GAME_TICK,()=>{const a=this.play.getGame().getTicker().getNoOfTicks();if(ae.meta.warnToStoreUserHashAfterTicks[a]){const u=`userHashTmpAlert${Math.round(1e10*Math.random())}`,l=`
                    You seem to be enjoying the game! Here is a good tip that maybe will save the day once!<br/>
                    Make a copy of your user hash. User hash is used to find your save game and purchases if you have any.<br/>
                    Your user hash: 
                    <input type="text" readonly id="${u}" value="${this.play.getUserHash()}" 
                        style="border:1px solid red; background:black; color:red; font-weight:bold; padding:4px; margin:3px; width:280px; font-size:0.9em; text-align:center;"/><br/>
                    Ignore this reminder if you already did and have fun!<br/>
                `;new ft("SAVE USER HASH TO A SAFE PLACE!",l).display();const p=document.getElementById(u);p.addEventListener("click",()=>{p.setSelectionRange(0,p.value.length)})}}),this._showUi("mainGame")}_showUi(e,t){this._destroyCurrentUi(),e==="mainGame"&&(this.currentUi=new xn(this.play,this.imageMap)),this.currentUi.display(this.container)}_destroyCurrentUi(){this.currentUi&&(this.currentUi.destroy(),this.currentUi=null)}destroy(){this.runningInBackgroundInfoUi.destroy(),this.globalUiEm.removeListenerForType("MainUi"),this.play.getGame().getEventManager().removeListenerForType("MainUi"),this.container=null,clearInterval(this.focusInterval)}}class Fn{constructor(){this.play=null,this.imageMap=Wr,this.mainUi=null}async init(e=!1){try{console.log("Main: Starting initialization..."),console.log("Main: Loading images..."),await this.imageMap.loadAllAsync(),console.log("Main: Images loaded successfully"),console.log("Main: Initializing Play..."),this.play=new Hr,await new Promise(t=>this.play.init(e,t)),console.log("Main: Play initialized successfully"),this.play.isDevMode?.(),console.log("Main: Initializing UI..."),this.mainUi=new Dn(this.play,this.imageMap),this.mainUi.display(document.getElementById("gameArea")),console.log("Main: UI initialized successfully")}catch(t){throw console.error("Main: Initialization failed:",t),t}}destroy(){console.log("Main destroyed1",this),this.mainUi?.destroy(),this.play?.destroy(),console.log("Main destroyed2",this)}}class j{static mainInstance=null;static async init(e=!1){return this.mainInstance?console.log("MainSingleton.init called but instance already exists"):(this.mainInstance=new Fn,await this.mainInstance.init(e)),this.mainInstance}static getInstance(){if(!j.mainInstance)throw new Error("MainSingleton not initialized yet. Call init() first.");return j.mainInstance}static destroy(){try{const e=j.mainInstance;if(!e)return;console.log("MainSingleton: Destroying..."),document.querySelectorAll("#intro, #introBg").forEach(t=>t.remove()),e.mainUi?.destroy(),e.play?.destroy(),e.globalUiEm?.removeAllListeners?.(),e.play?.em?.removeAllListeners?.(),e.focusInterval&&clearInterval(e.focusInterval),e.saveManager?.destroy?.(),e.runningInBackgroundInfoUi?.destroy?.(),j.mainInstance=null}catch{console.log("MainSingleton.destroy failed")}}static async reset(e=!1){return console.log(j.mainInstance),console.log("MainSingleton.reset called"),j.destroy(),console.log(j.mainInstance),await j.init(e)}}const ht={get messageEl(){return document.getElementById("loadingMessage")},get bgEl(){return document.getElementById("initialLoaderBg")},get loaderEl(){return document.getElementById("initialLoader")},showMessage(d){this.messageEl&&(this.messageEl.textContent=d)},hide(){this.loaderEl&&(this.loaderEl.style.display="none"),this.bgEl&&(this.bgEl.style.display="none")}};function qn(){const d=document.createElement("canvas");return d.getContext&&d.getContext("2d")}window.addEventListener("DOMContentLoaded",async()=>{try{if(!qn()){ht.showMessage("⚠️ Your browser is too old and does not support canvas. Please update!");return}ht.showMessage("Loading game… please wait…"),await j.init(!1),ht.hide(),console.log("✅ Game initialized successfully!")}catch(d){console.error("❌ Game failed to start:",d),ht.showMessage("Failed to load game modules. Check console for details.")}});
